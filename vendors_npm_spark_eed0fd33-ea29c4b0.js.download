(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[37],{"8/a0":function(t,e,o){var a,i=e,r=o("oAGj"),n=o("SpAV"),l=o("JgVS"),s=o("cEEQ"),c=o("c+uM"),u=o("tGKA"),h=o("hgLm"),g=o("oKlP"),p=o("sIWg"),d=o("1NAc");i.BannerDecorationStrategy=(a=function(){this.spacingScalar=.75,l.BaseDecorationStrategy.call(this)},r.defineClass({name:"BannerDecorationStrategy",ctor:a,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{easeOutQuad:function(t,e,o,a){var i=t/a;return-o*i*(i-2)+e},easeOut:function(t,e,o){return this.easeOutQuad(o,t,e-t,1)},supportsConfiguration:function(t){return t.style.backing==c.LockupBacking.Banner},decorate:function(t,e){function o(t,e){return new g.TheoPoint(t,e)}var a=t.style,i=a.padding;e.numberOfLines>1&&(i+=a.spacing*this.spacingScalar);var f=e.avgTextPointSize*i,y=[],k=p.TheoRect.fromSize(e.size).transform(e.placement),S=!1;t.style.backing==c.LockupBacking.BannerHorizontal?S=!1:t.style.backing==c.LockupBacking.BannerVertical?S=!0:n.CoreAssert.isTrue(!1,"Invalid backing shape.","BannerDecorationStrategy.decorate","BannerDecorationStrategy.swift",99);var L=l.BaseDecorationStrategy.getHorizontalOffsetForItalicAngle(e.avgLinePointSize*e.typographicBoundingRatios.heightFromBaselineRatio,t.style.font.fontData.italicAngle),m=e.typographicBoundingRatios.backingVerticalOffsetRatio*e.avgLinePointSize,C=this.easeOut(0,m,Math.min(1,i)),v=S?k.minX-f:-4093,A=S?-4093:k.minY-f+C,w=h.TheoPathBuilder.init_d41d(),R=L+(S?k.size.width+2*f:8186),b=S?8186:k.size.height+2*f,D=new d.TheoSize(R,b),T=u.Matrix2D.translationXY(v,A),x=function(t,e,a){var i=h.TheoPathBuilder.init_d41d(),n=e.transformPoint(t.eval(o(0,0)));i.moveTo(n.x,n.y);var l=new p.TheoRect(n.x,n.y,n.x,n.y);if(a)for(var s=r.iter([o(0,1),o(1,1),o(1,0)]);!s.done;s.next()){var c=s.value;n=e.transformPoint(t.eval(c)),i.lineTo(n.x,n.y),l=l.expandToFit(n)}else for(var u=r.iter([o(1,0),o(1,1),o(0,1)]);!u.done;u.next())c=u.value,n=e.transformPoint(t.eval(c)),i.lineTo(n.x,n.y),l=l.expandToFit(n);return i.closePath(),{path:i.path,bounds:l}}(p.TheoRect.fromSize(D),u.Matrix2D.Identity,!0).path;w.addPath(x,e.placement);var I=w.path,B=new d.TheoSize(r.opt(I.bounds,(function(t){return t.width})),r.opt(I.bounds,(function(t){return t.height})));return y.push(s.LockupItem.init_708e(!1,B,T,I)),new l.DecorationResults(r.clone(y))}}}),a)},"9kak":function(t,e,o){var a,i=e,r=o("oAGj");i.LockupRowInfo=(a=function(t,e){if(this.aspectRatio=0,this.words=[],this.text="",this.appendable=!0,this.rowHeightAdjustRatio=1,this.colOffsetLeft=0,this.colOffsetRight=0,void 0===t&&(t=null),void 0===e&&(e=!0),null!=t)for(var o=r.iter(t);!o.done;o.next()){var a=o.value;this.addWord(a)}this.appendable=e},r.defineClass({name:"LockupRowInfo",ctor:a,props:{addWord:function(t){if(this.words.length>0){var e=this.words[this.words.length-1];this.aspectRatio+=e.spaceAspectRatio,this.text+=" "}this.text+=t.text,this.words.push(t),this.aspectRatio+=t.aspectRatio,1!=this.words.length&&t.characterHeightRatio!=this.rowHeightAdjustRatio?this.rowHeightAdjustRatio=1:this.rowHeightAdjustRatio=t.characterHeightRatio}}}),a)},EDIN:function(t,e,o){var a,i=e,r=o("oAGj"),n=o("JgVS"),l=o("cEEQ"),s=o("c+uM"),c=o("8t9B");i.NoDecorationStrategy=(a=function(){n.BaseDecorationStrategy.call(this)},r.defineClass({name:"NoDecorationStrategy",ctor:a,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{supportsConfiguration:function(t){return t.style.backing==s.LockupBacking.None},decorate:function(t,e){var o,a=t.style,i=!1;if((o=t.style.characterStyles[c.TypeLockupController.HIGHLIGHT_STYLE])&&(i=o.textLook==s.LockupTextLook.FillAndOutline2),a.textLook!=s.LockupTextLook.FillAndOutline2&&!i)return new n.DecorationResults([]);for(var u=[],h=r.iter(r.range(0,e.items.length,!1));!h.done;h.next()){var g=h.value,p=e.items[g];if(p.type==l.LockupItemType.Text){var d,f,y=a.textLook==s.LockupTextLook.FillAndOutline2;null!=(d=p.characterStyle)&&(f=t.style.characterStyles[d])&&(y=f.textLook==s.LockupTextLook.FillAndOutline2||f.textLook==s.LockupTextLook.UNSET&&y),y&&((p=p.clone()).hasPrimaryColor=!1,u.push(p))}}return new n.DecorationResults(r.clone(u))}}}),a)},GFAD:function(t,e,o){var a,i=e,r=o("oAGj");i.LockupUtils=(a=function(){},r.defineClass({name:"LockupUtils",ctor:a,statics:{percentageDiff:function(t,e){return 100*Math.abs((t-e)/((t+e)/2))}}}),a)},JEnV:function(t,e,o){var a,i,r,n=e,l=o("oAGj"),s=o("SpAV"),c=o("cEEQ"),u=o("9kak"),h=o("c+uM"),g=o("GFAD"),p=o("tGKA"),d=o("8t9B"),f=o("3UhB"),y=o("uUew"),k=o("1NAc");n.paddingScalar=.6,n.spacingScalar=.75,n.EvenRowHeightsLayoutStrategy=(a=function(t,e){void 0===e&&(e=!1),t==h.LockupAlignment.Left||t==h.LockupAlignment.Right||t==h.LockupAlignment.Center?this.alignment=t:(s.CoreAssert.fail("Unexpected alignment: "+t,"EvenRowHeightsLayoutStrategy.init","EvenRowHeightsLayoutStrategy.swift",30),this.alignment=h.LockupAlignment.Left),this.capToTargetAspectRatio=e},l.defineClass({name:"EvenRowHeightsLayoutStrategy",ctor:a,superName:"BaseLockupLayoutStrategy",statics:{calcNonCombiningItemCount:function(t,e,o){return e>20||t>300&&o>5?0:6},canCombineItemPair:function(t,e,o,a,i,r,n){var s,c,u;if((s=t.font)&&null!=(c=t.pointSize)&&null!=(u=e.spaceWidth)){var h=s.spaceWidthRatio*c,g=Math.abs(h-u)<.001||0==u,p=l.toInt(n/2);return g&&o&&!a&&t.characterStyle==e.characterStyle&&t.placement.ty==e.placement.ty&&i>p&&i<r-p}return!1},isAutoHighlightMethod:function(t){return t==d.HighlightMethod.EvenRows||t==d.HighlightMethod.OddRows||t==d.HighlightMethod.Bracket||t==d.HighlightMethod.InsideBracket},useCharStyleForAutoMethod:function(t,e,o){var a=t%2==(o==d.HighlightMethod.EvenRows?0:1);return o!=d.HighlightMethod.Bracket&&o!=d.HighlightMethod.InsideBracket||(a=0==t||e?o==d.HighlightMethod.Bracket:o==d.HighlightMethod.InsideBracket),a},usesVariableCharacterSizes:function(t){var e,o=t.style;return!(0!=!t.characterStyleRanges.length||!(e=o.characterStyles[d.TypeLockupController.HIGHLIGHT_STYLE])||-1==e.spacing||0==e.spacing)},_implements:function(t){return"LockupLayoutStrategy"==t}},props:{supportsConfiguration:function(t){return t.style.layout==h.LockupLayout.Standard&&t.style.alignment==this.alignment},layout:function(t){var e=t.text,o=t.style,i=o.font.fontData,r=t.containerSize,s=r.width,u=r.height,h=o.spacing*n.spacingScalar,g=s,y=u,S=g/y,L=c.getTypographicBoundingRatiosOfString(e,i,!1),m=d.TypeLockupController.HIGHLIGHT_STYLE,C=l.opt(l.opt(o.characterStyles[m],(function(t){return t.font})),(function(t){return t.fontData})),v=f.TypeLockupUtils.getCharFontAdjust(o,L.hasUppercase),A=!1,w=a.usesVariableCharacterSizes(t);w&&o.characterStyles[m].spacing>1&&((o=t.style.clone()).characterStyles[m].spacing=v,A=!0,null!=C&&(C=i,i=o.characterStyles[m].font.fontData,o.characterStyles[m].font=o.font));var R=l.clone(this.getCompactedRows(t,S,t.highlightMethod,null!=t.preferredFontSize,L));if(0==R.length)return new c.LayoutResults([],new k.TheoSize(0,0),p.Matrix2D.Identity,L,0);var b,D,T,x=this.getAspectRatioOfAllRows(l.clone(R),h),I=this.getWidestRowAspectRatio(l.clone(R));if(0==I.aspectRatio)return new c.LayoutResults([],new k.TheoSize(0,0),p.Matrix2D.Identity,L,0);null!=(T=t.preferredFontSize)?y=(g=(b=(D=T)*L.heightRatio)*I.aspectRatio)/x:(x<S?g=y*x:y=g/x,D=(b=g/I.aspectRatio)/L.heightRatio);for(var B=y,O=g,F=g/(I.aspectRatio/h),E=D*v,_=D*i.capRatio,W=D*L.textVerticalOffsetRatio-_,P=f.TypeLockupUtils.getCharFontYAdjust(o,D,E),U=W,M=0,N=[],H=0,V=l.iter(l.range(0,R.length,!1));!V.done;V.next()){var G=V.value,K=R[G],z=a.calcNonCombiningItemCount(e.length,K.words.length,R.length);if(H=D,w){for(var Y=!0,j=l.iter(K.words);!j.done;j.next()){var q=j.value;if(l.isEmpty(q.characterStyle)||D==E){Y=!1;break}}H=Y?E:D}G>0&&(U+=F);var X=K.aspectRatio*b;switch(this.alignment){case 0:M=0;break;case 1:M=g-X+0;break;case 2:M=0+(g-X)/2}for(var J=0,Q=0,Z=l.iter(K.words);!Z.done;Z.next()){q=Z.value;var $=l.isEmpty(q.characterStyle)||H==E?0:P,tt=l.isEmpty(q.characterStyle)?D:E,et=q.aspectRatio*b,ot=M,at=U+0+$,it=l.isEmpty(q.characterStyle)?null:q.characterStyle;A&&(it=l.isEmpty(q.characterStyle)?m:null),J=q.spaceAspectRatio*b;var rt,nt=null;null!=(rt=q.complementaryStyleAspectRatio)&&(nt=rt*b);var lt,st=null;null!=(lt=q.complementaryStyleSpaceAspectRatio)&&(st=lt*b);var ct,ut=c.LockupItem.init_38d4(!0,it,new k.TheoSize(et,_),p.Matrix2D.translationXY(ot,at),q.text,l.isEmpty(q.characterStyle)?i:C||i,tt,D,L,G,q.rangeInLockup,void 0,J,nt,st);(ct=l.last(N))&&(ct.canAppendNext=a.canCombineItemPair(ct,ut,t.useOptimization,t.forceLetterForma,Q,K.words.length,z)),N.push(ut),Q+=1,M+=et+J}U+=H*L.heightRatio}return new c.LayoutResults(l.clone(N),new k.TheoSize(O,B),p.Matrix2D.translationXY(0,0),L,I.aspectRatio)},calculateTracking:function(t,e){var o=t.text,a=t.style.font.fontData,i=t.containerSize.width,r=t.style.spacing*n.spacingScalar,s=c.getTypographicBoundingRatiosOfString(o,a,!1),u=0,h=e.width,g=e.height,p=h/g,d=l.clone(this.getCompactedRows(t,p,t.highlightMethod,!0,s));if(0==d.length)return t.style.tracking;var f=this.getAspectRatioOfAllRows(l.clone(d),r),y=this.getWidestRowAspectRatio(l.clone(d)),k=y.aspectRatio;if(0==k)return t.style.tracking;var S=(h=g*f)/k,L=k*S;if(L<i){u=this.getSpacing(l.clone(d),y,S,i,!1).letterSpacing;for(var m=l.iter(d);!m.done;m.next()){var C=m.value;if(C.words.length>1){var v=this.getSpacing(l.clone(d),C,S,i,!1);v.letterSpacing<u&&(u=v.letterSpacing)}}(u/=S/s.heightRatio)<.01&&(u=0)}else u=-L;return u},calculateLeading:function(t,e){var o=t.containerSize,a=o.width,i=o.height,r=0,s=e.width,u=e.height,h=s/u,g=c.getTypographicBoundingRatiosOfString(t.text,t.style.font.fontData,!1),p=l.clone(this.getCompactedRows(t,h,t.highlightMethod,!1,g));if(p.length<=1)return t.style.spacing;var d=this.getAspectRatioOfAllRows(l.clone(p),r),f=this.getWidestRowAspectRatio(l.clone(p));u=s/d;var y=s/f.aspectRatio,k=f.aspectRatio*y;if(u<i){var S=a/((i-u)/(l.toDouble(p.length)-1));r=f.aspectRatio/S/n.spacingScalar}else l.info("fits in width. old tracking is :",t.style.tracking,k,"CW:",a,i,s,u),r=-u;return r},getSpacing:function(t,e,o,a,i){var r=0,n=0,s=0,c=0;if(e.words.length<=1)return{letterSpacing:s,wordSpacing:c};for(var u=l.iter(e.words);!u.done;u.next()){var h=u.value;r+=h.aspectRatio*o+h.spaceAspectRatio*o,0!=h.spaceAspectRatio&&h.canBreak&&(n+=1)}return r-=l.last(e.words).spaceAspectRatio*o,i?c=(a-r)/(l.toDouble(n)-1):(s=(a-r)/(l.toDouble(e.words.length)-1),n>1&&s>0&&(s=(a-r-(c=s)*(l.toDouble(n)-1))/(l.toDouble(e.words.length)-1))),{letterSpacing:s,wordSpacing:c}},getWidestRowAspectRatio:function(t){for(var e=t[0],o=l.iter(t);!o.done;o.next()){var a=o.value;a.aspectRatio>e.aspectRatio&&(e=a)}return e},getAspectRatioOfAllRows:function(t,e){var o=t.length-1,a=this.getWidestRowAspectRatio(l.clone(t));if(0==a.aspectRatio)return 0;for(var i=a.aspectRatio/e,r=0,n=l.iter(t);!n.done;n.next()){var s=n.value;r+=1/a.aspectRatio*s.rowHeightAdjustRatio}return 1/(r+1/i*l.toDouble(o))},rowsForTargetRowAspectRatio:function(t,e,o){var a=[];a.push(new u.LockupRowInfo);for(var i=0,r=0,n=!0,l=t.length,s=0;s<l;){var c=a[i],h=t[s];if(h.isNewLine)c.appendable=!1,a[i]=c,s+=1;else{for(var p=c.aspectRatio,d=h.aspectRatio+h.spaceAspectRatio,f=s;f+1<l&&!t[f].canBreak;)d+=t[f+=1].aspectRatio+t[f].spaceAspectRatio;var y=s>0&&t[s-1].canBreak,k=c.appendable&&(n||!y);if(k&&r>0){var S=p+d;if(this.capToTargetAspectRatio&&S>e)k=!1;else{var L=g.LockupUtils.percentageDiff(e,p);k=g.LockupUtils.percentageDiff(e,S)<L}}if(k){if(!o)for(;!h.canBreak&&s<l;)c.addWord(h),(s+=1)<l&&(h=t[s]);c.addWord(h),r+=1,a[i]=c}else{i+=1,r=1;var m=new u.LockupRowInfo;if(o)n=!(s>0&&!t[s-1].canBreak);else for(;!h.canBreak&&s<l;)m.addWord(h),(s+=1)<l&&(h=t[s]);m.addWord(h),a.push(m)}s+=1}}return a},getCompactedRows:function(t,e,o,i,r){var s=t.text,c=t.style,h=c.font.fontData,g=c.spacing*n.spacingScalar,p=c.tracking,k=i||t.forceLetterForma,S=l.clone(t.characterStyleRanges),L=d.TypeLockupController.HIGHLIGHT_STYLE,m=l.opt(l.opt(c.characterStyles[L],(function(t){return t.font})),(function(t){return t.fontData})),C=f.TypeLockupUtils.getCharFontAdjust(c,r.hasUppercase);t.characterStyleRanges.length>0&&null!=c.characterStyles[L]&&-1!=c.characterStyles[L].spacing&&0!=c.characterStyles[L].spacing&&c.characterStyles[L].spacing>1&&((c=t.style.clone()).characterStyles[L].spacing=C,S=l.clone(f.TypeLockupUtils.invertRanges(l.clone(t.characterStyleRanges),s.length)),null!=m&&(m=h,h=c.characterStyles[L].font.fontData,c.characterStyles[L].font=c.font));var v=l.clone(f.TypeLockupUtils.computeLockupMeasurements(s,h,r.heightRatio,!1,k,p,l.clone(S),l.clone(c.characterStyles),C,t.forceLetterForma)),A=v.length;if(0==A)return[];var w,R=new u.LockupRowInfo(l.clone(v)).aspectRatio,b=.5,D=.6+1.6*R;if(null!=(w=t.preferredFontSize)){var T=w*r.heightRatio,x=t.containerSize.width/T;b=x,D=x}for(var I=l.clone(this.getOptimalCompactedRows(l.clone(v),R,e,g,b,D,!1,i)),B=0,O=l.iter(v);!O.done;O.next())B+=O.value.isNewLine?0:1;if(null!=t.rowWordLengths&&t.rowWordLengths.reduce((function(t,e){return t+e}),0)==B&&(!t.allowFewerLineBreaks||I.length>=t.rowWordLengths.length)&&(I=l.clone(this.getPrecomputedRows(l.clone(v),l.clone(t.rowWordLengths)))),null!=c.characterStyles[L]&&null!=c.characterStyles[L].font&&(A>1&&!k||k&&I.length>1)&&a.isAutoHighlightMethod(o)){var F=l.clone(f.TypeLockupUtils.computeLockupMeasurements(s,h,r.heightRatio,!1,k,p,l.clone([]),l.clone({}),void 0,t.forceLetterForma)),E=[new y.TextRange(0,l.chars(s).length)],_=l.clone(f.TypeLockupUtils.computeLockupMeasurements(s,m,r.heightRatio,!1,k,p,l.clone(E),l.clone(c.characterStyles),C,t.forceLetterForma));I=l.clone(this.getOptimalCompactedAutoRows(l.clone(F),l.clone(_),R,e,g,.5,.6+1.6*R,!1,!1,o))}if(i&&c.tracking>0)for(var W=l.iter(l.range(0,I.length,!1));!W.done;W.next()){var P=W.value;I[P].aspectRatio=0;for(var U=l.iter(l.range(0,I[P].words.length,!1));!U.done;U.next()){var M=U.value;I[P].aspectRatio+=I[P].words[M].aspectRatio,I[P].words[M].canBreak&&M!=I[P].words.length-1?(I[P].words[M].spaceAspectRatio=h.spaceWidthRatio/r.heightRatio,I[P].aspectRatio+=I[P].words[M].spaceAspectRatio):I[P].words[M].spaceAspectRatio=0}}return I},getOptimalCompactedRows:function(t,e,o,a,i,r,n,s){var c=r-i,u=.25*c,h=i+.5*c,p=i+u,d=r-u,f=l.clone(this.rowsForTargetRowAspectRatio(l.clone(t),p,n)),y=l.clone(this.rowsForTargetRowAspectRatio(l.clone(t),d,n)),k=this.getAspectRatioOfAllRows(l.clone(f),a),S=this.getAspectRatioOfAllRows(l.clone(y),a),L=g.LockupUtils.percentageDiff(o,k),m=g.LockupUtils.percentageDiff(o,S);return c<.2?L<m?f:y:L<=m?this.getOptimalCompactedRows(l.clone(t),e,o,a,i,h,n,s):this.getOptimalCompactedRows(l.clone(t),e,o,a,h,r,n,s)},getWordForAutoMethod:function(t,e,o,i,r){var n=a.useCharStyleForAutoMethod(o,i,r),l=n?e:t,s=n?t:e;return l.complementaryStyleAspectRatio=s.aspectRatio,l.complementaryStyleSpaceAspectRatio=s.spaceAspectRatio,l},rowsForTargetRowAspectRatioAutoRows:function(t,e,o,a,i,r){var n=[];n.push(new u.LockupRowInfo);for(var s=0,c=0,h=!0,p=t.length,f=0,y=0;f<p;){var k=n[s],S=this.getWordForAutoMethod(t[f],e[f],s,f==p-1,r);if(S.isNewLine)k.appendable=!1,n[s]=k,f+=1;else{for(var L=k.aspectRatio,m=S.aspectRatio+S.spaceAspectRatio,C=f;C+1<p&&!t[C].canBreak;)m+=t[C+=1].aspectRatio+t[C].spaceAspectRatio;var v=f>0&&t[f-1].canBreak,A=k.appendable&&(h||!v);if(A&&c>0){var w=L+m;if(this.capToTargetAspectRatio&&w>a)A=!1;else{var R=g.LockupUtils.percentageDiff(a,L);A=g.LockupUtils.percentageDiff(a,w)<R}}if(A){if(!i)for(;!S.canBreak&&f<p;)k.addWord(S),(f+=1)<p&&(S=this.getWordForAutoMethod(t[f],e[f],s,f==p-1,r));k.addWord(S),c+=1,n[s]=k}else{s+=1,y=f,S=this.getWordForAutoMethod(t[f],e[f],s,f==p-1,r),c=1;var b=new u.LockupRowInfo;if(i)h=!(f>0&&!t[f-1].canBreak);else for(;!S.canBreak&&f<p;)b.addWord(S),(f+=1)<p&&(S=this.getWordForAutoMethod(t[f],e[f],s,f==p-1,r));b.addWord(S),n.push(b)}f+=1}}if(r==d.HighlightMethod.Bracket||r==d.HighlightMethod.InsideBracket){for(var D=new u.LockupRowInfo,T=l.iter(l.range(y,p,!1));!T.done;T.next()){f=T.value;var x=this.getWordForAutoMethod(t[f],e[f],s,!0,r);D.addWord(x)}n[n.length-1]=D}return n},getOptimalCompactedAutoRows:function(t,e,o,a,i,r,n,c,u,h){s.CoreAssert.isTrue(t.length==e.length,void 0,"EvenRowHeightsLayoutStrategy.getOptimalCompactedAutoRows","EvenRowHeightsLayoutStrategy.swift",937);var p=n-r,d=.25*p,f=r+.5*p,y=r+d,k=n-d,S=l.clone(this.rowsForTargetRowAspectRatioAutoRows(l.clone(t),l.clone(e),i,y,c,h)),L=l.clone(this.rowsForTargetRowAspectRatioAutoRows(l.clone(t),l.clone(e),i,k,c,h)),m=this.getAspectRatioOfAllRows(l.clone(S),i),C=this.getAspectRatioOfAllRows(l.clone(L),i);if(u){if(m>a&&C<a)return L;if(C>a&&m<a)return S}var v=g.LockupUtils.percentageDiff(a,m),A=g.LockupUtils.percentageDiff(a,C);return p<.2?v<A?S:L:v<=A?this.getOptimalCompactedAutoRows(l.clone(t),l.clone(e),o,a,i,r,f,c,u,h):this.getOptimalCompactedAutoRows(l.clone(t),l.clone(e),o,a,i,f,n,c,u,h)},reflow:function(t,e,o,i){if(l.opt(e,(function(t){return.5!=t.y})))return null;if(a.usesVariableCharacterSizes(o))return null;var r,s,c,u=o.style,h=l.clone(i.itemsForReflow);if((r=l.opt(u.font,(function(t){return t.fontData})))&&(s=l.first(h))&&null!=(c=s.rowPointSize)){var g=o.text;return f.TypeLockupUtils.isTextRightToLeft(g)&&(h=l.reverse(h)),new n.ReflowHelper(this.alignment,g,o.highlightMethod,u,r,i.typographicBoundingRatios,t.width,l.clone(h),c,o.useOptimization,o.forceLetterForma).perform()}return i}}}),a),n.ReflowHelper=(i=function(t,e,o,a,i,r,s,c,u,h,g){this.alignment=t,this.text=e,this.highlightMethod=o,this.style=a,this.font=i,this.typographicBoundingRatios=r,this.items=l.clone(c),this.canonicalFontSize=u,this.useOptimization=h,this.forceLetterForma=g,this.maxWidth=s;for(var p=l.iter(c);!p.done;p.next()){var d=p.value;null!=this.primaryStyleItem||d.hasCharacterStyle||(this.primaryStyleItem=d),null==this.charStyleItem&&d.hasCharacterStyle&&(this.charStyleItem=d),this.maxWidth=Math.max(this.maxWidth,d.size.width)}this.rowHeight=u*r.heightRatio,this.leadingHeight=a.spacing*n.spacingScalar*this.rowHeight,this.accumulatedHeight=0,this.slugs=[],this.yValues=[]},l.defineClass({name:"ReflowHelper",ctor:i,props:{perform:function(){for(var t=this.createSlug(),e=l.iter(l.toSequence(this.items));!e.done;e.next()){var o,a=e.value,i=a.offset,r=a.element;if(null!=(o=l.opt(r.rangeInLockup,(function(t){return t.start})))){var n=i==this.items.length-1,c=this.shouldForceCharStyle(n);!(o>0&&"\n"==this.text.substr(o-1,1))&&t.appendItem(r,c)||(s.CoreAssert.isFalse(t.isEmpty,"Could not fit even one word?","ReflowHelper.perform","EvenRowHeightsLayoutStrategy.swift",1197),this.appendSlug(t),t=this.createSlug(),c=this.shouldForceCharStyle(n),t.appendItem(r,c)||s.CoreAssert.fail("Could not fit a word in an empty slug?","ReflowHelper.perform","EvenRowHeightsLayoutStrategy.swift",1205))}}return this.highlightMethod!=d.HighlightMethod.Bracket&&this.highlightMethod!=d.HighlightMethod.InsideBracket||(t=t.harmonizeStyleForBracketing()),this.appendSlug(t,!0),this.slugsToResults()},slugsToResults:function(){var t,e,o=this.slugs.map((function(t){return t.width}),this),a=(t=l.max(o))||null!=t?t:0,i=this.accumulatedHeight,r=this.canonicalFontSize*(this.typographicBoundingRatios.textVerticalOffsetRatio-this.font.capRatio),s=0;null!=(e=l.opt(this.charStyleItem,(function(t){return t.pointSize})))&&(s=f.TypeLockupUtils.getCharFontYAdjust(this.style,this.canonicalFontSize,e));for(var u=[],h=l.iter(l.toSequence(this.slugs));!h.done;h.next()){var g=h.value,d=g.offset,y=g.element,S=n.EvenRowHeightsLayoutStrategy.calcNonCombiningItemCount(this.text.length,y.numItems,this.slugs.length);y.output(u,d,r+this.yValues[d],s,a,this.alignment,S,this.useOptimization,this.forceLetterForma)}return new c.LayoutResults(l.clone(u),new k.TheoSize(a,i),p.Matrix2D.Identity,this.typographicBoundingRatios,a/this.rowHeight)},createSlug:function(){return new n.Slug(this.maxWidth,this.canonicalFontSize,this.typographicBoundingRatios,this.primaryStyleItem,this.charStyleItem)},appendSlug:function(t,e){void 0===e&&(e=!1),this.slugs.push(t),this.yValues.push(this.accumulatedHeight),this.accumulatedHeight+=t.height,e||(this.accumulatedHeight+=this.leadingHeight)},shouldForceCharStyle:function(t){return n.EvenRowHeightsLayoutStrategy.isAutoHighlightMethod(this.highlightMethod)?n.EvenRowHeightsLayoutStrategy.useCharStyleForAutoMethod(this.slugs.length,t,this.highlightMethod):null}}}),i),n.Slug=(r=function(t,e,o,a,i){this.items=[],this.lastItemSpaceWidth=0,this.xValues=[],this.width=0,void 0===a&&(a=null),void 0===i&&(i=null),this.maxWidth=t,this.canonicalFontSize=e,this.typographicBoundingRatios=o,this.primaryStyleItem=a,this.charStyleItem=i},l.defineClass({name:"Slug",ctor:r,props:{appendItem:function(t,e){var o;void 0===e&&(e=null);var a,i,r=t;if(null!=e&&t.hasCharacterStyle!=e&&(r=this.flipItemStyle(t)||t),null!=(a=r.pointSize)&&(i=r.font)){var n=r.size.width,l=(o=r.spaceWidth)||null!=o?o:a*i.spaceWidthRatio,s=this.width+this.lastItemSpaceWidth+n;return!!(this.isEmpty||s<=this.maxWidth)&&(this.items.push(r),this.width+=this.lastItemSpaceWidth,this.xValues.push(this.width),this.width+=n,this.lastItemSpaceWidth=l,!0)}return!0},output:function(t,e,o,a,i,r,s,u,g){for(var d=l.iter(l.toSequence(this.items));!d.done;d.next()){var f,y,k,S,L=d.value,m=L.offset,C=L.element;if(null!=(f=C.pointSize)&&null!=(y=C.text)&&(k=C.font)&&(S=C.rangeInLockup)){var v=this.xValues[m];r!=h.LockupAlignment.Center&&r!=h.LockupAlignment.Right||(v+=(i-this.width)/(r==h.LockupAlignment.Center?2:1));var A,w=o+(C.hasCharacterStyle&&this.canonicalFontSize!=f?a:0),R=c.LockupItem.init_38d4(C.hasPrimaryColor,C.characterStyle,C.size,p.Matrix2D.translationXY(v,w),y,k,f,this.canonicalFontSize,this.typographicBoundingRatios,e,S,void 0,C.spaceWidth,C.complementaryStyleWordWidth,C.complementaryStyleSpaceWidth);(A=l.last(t))&&(A.canAppendNext=n.EvenRowHeightsLayoutStrategy.canCombineItemPair(A,R,u,g,m,this.numItems,s)),t.push(R)}}},harmonizeStyleForBracketing:function(){if(this.items.length<2)return this;var t,e=new r(1e5,this.canonicalFontSize,this.typographicBoundingRatios,this.primaryStyleItem,this.charStyleItem);if(null!=(t=l.opt(l.last(this.items),(function(t){return t.hasCharacterStyle}))))for(var o=l.iter(this.items);!o.done;o.next()){var a=o.value,i=e.appendItem(a,t);s.CoreAssert.isTrue(i,"Could not fit a word in a super wide slug?","Slug.harmonizeStyleForBracketing","EvenRowHeightsLayoutStrategy.swift",1451)}return e},flipItemStyle:function(t){var e,o,a,i,r,n,l,s;if(null!=(a=t.text)&&(i=t.rangeInLockup)&&null!=(r=t.rowIndex)&&(n=t.hasCharacterStyle?this.primaryStyleItem:this.charStyleItem)&&(l=n.font)&&null!=(s=n.pointSize)){var u=t.hasCharacterStyle?"":d.TypeLockupController.HIGHLIGHT_STYLE,h=t.size.width,g=new k.TheoSize((e=t.complementaryStyleWordWidth)||null!=e?e:h,t.size.height),p=h,f=t.spaceWidth,y=(o=t.complementaryStyleSpaceWidth)||null!=o?o:f,S=f;return c.LockupItem.init_38d4(t.hasPrimaryColor,u,g,t.placement,a,l,s,this.canonicalFontSize,this.typographicBoundingRatios,r,i,void 0,y,p,S)}return null},height:{get:function(){return this.canonicalFontSize*this.typographicBoundingRatios.heightRatio}},isEmpty:{get:function(){return 0==this.items.length}},numItems:{get:function(){return this.items.length}}}}),r)},JgVS:function(t,e,o){var a,i,r=e,n=o("oAGj"),l=o("SpAV");r.DecorationResults=(a=function(t){this.items=n.clone(t)},n.defineClass({name:"DecorationResults",ctor:a}),a),r.LockupDecorationStrategy=n.defineProtocol("LockupDecorationStrategy",{supportsConfiguration:"(LockupConfiguration) -> Boolean",decorate:"(LockupConfiguration, LayoutResults) -> DecorationResults"}),r.BaseDecorationStrategy=(i=function(){},n.defineClass({name:"BaseDecorationStrategy",ctor:i,statics:{getHorizontalOffsetForItalicAngle:function(t,e){var o=Math.abs(e),a=(180-o-90)*Math.PI/180,i=o*Math.PI/180,r=t/Math.sin(a)*Math.sin(i);return(r>t||r<0)&&(r=t/2),r},_implements:function(t){return"LockupDecorationStrategy"==t}},props:{supportsConfiguration:function(t){return l.CoreAssert.fail("Implement in subclass","BaseDecorationStrategy.supportsConfiguration","LockupDecorationStrategy.swift",31),!1},decorate:function(t,e){return l.CoreAssert.fail("Implement in subclass","BaseDecorationStrategy.decorate","LockupDecorationStrategy.swift",36),new r.DecorationResults([])}}}),i)},KdeS:function(t,e,o){var a,i=e,r=o("oAGj"),n=o("1NAc");i.LockupWordInfo=(a=function(t,e,o,a,i,r,l,s,c){this.complementaryStyleAspectRatio=null,this.complementaryStyleSpaceAspectRatio=null,void 0===c&&(c=n.TheoSize.Zero),this.text=t,this.aspectRatio=e,this.spaceAspectRatio=o,this.characterStyle=a,this.characterHeightRatio=i,this.isNewLine=r,this.canBreak=l,this.rangeInLockup=s,this.relativeMargins=c},r.defineClass({name:"LockupWordInfo",ctor:a}),a)},PXlJ:function(t,e,o){var a,i=e,r=o("oAGj"),n=o("JgVS"),l=o("cEEQ"),s=o("c+uM"),c=o("tGKA"),u=o("JKVa"),h=o("8t9B"),g=o("sIWg");i.LetterDecorationStrategy=(a=function(){n.BaseDecorationStrategy.call(this)},r.defineClass({name:"LetterDecorationStrategy",ctor:a,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{supportsConfiguration:function(t){return s.LockupStyle.isLetterGrid(t.style.layout)},decorate:function(t,e){var o,a,i=[];if(0==e.items.length)return new n.DecorationResults(r.clone(i));var u,p,d,f,y=t.style,k=r.opt(y.font,(function(t){return t.fontData}));y.backing==s.LockupBacking.SVGBackground&&(u=y.backingArtworkID);var S,L,m,C=null;if(0==!t.characterStyleRanges.length&&(S=y.characterStyles[h.TypeLockupController.HIGHLIGHT_STYLE])&&(p=r.opt(S.font,(function(t){return t.fontData})),(d=S.backing)!=s.LockupBacking.UNSET&&(C=S.padding),d==s.LockupBacking.SVGBackground&&(f=S.backingArtworkID)),null==u&&null==f)return new n.DecorationResults(r.clone(i));for(var v=r.iter(r.toSequence(e.items));!v.done;v.next()){var A=v.value,w=A.offset,R=A.element,b=k,D=null,T=!1;if(R.characterStyle==h.TypeLockupController.HIGHLIGHT_STYLE?(T=!0,b=p||b,D=d==s.LockupBacking.UNSET?u:f):D=u,null!=D){var x,I,B,O,F=g.TheoRect.fromXYWH(R.placement.tx,R.placement.ty,R.size.width,R.size.height).outsetXY((o=r.opt(R.margins,(function(t){return t.width})))||null!=o?o:0,(a=r.opt(R.margins,(function(t){return t.height})))||null!=a?a:0),E=T?m:L;if(null==E&&(E=this.getSVGConfig(t.style,T?C:null,e,D,R,F),T?m=E:L=E),null!=(x=r.opt(b,(function(t){return t.capRatio})))&&null!=(I=R.pointSize)&&null!=(B=E)&&null!=(O=D)){var _=(e.typographicBoundingRatios.textVerticalOffsetRatio-x)*I,W=c.Matrix2D.translation(B.frame.origin).translate(F.origin).translateXY(0,-_);i.push(l.LockupItem.init_9cc6(!1,B.frame.size,W,O,B.preScale,w+e.numberOfLines,R.characterStyle))}}}return new n.DecorationResults(r.clone(i))},getSVGConfig:function(t,e,o,a,i,n){var c,h,g=new l.LayoutResults([i],n.size,o.placement,o.typographicBoundingRatios,o.avgRowAspect),p=t;return null!=(c=e)&&(h=r.as(p.clone(),s.LockupStyle))&&(h.padding=c,p=h),new u.SVGBackgroundDecorationStrategy(a).calcSVGConfiguration(p,g)}}}),a)},TkOd:function(t,e,o){var a,i,r,n,l,s,c,u,h,g,p,d,f,y,k=e,S=o("oAGj"),L=o("0wFF"),m=o("cZuM"),C=o("6h7+"),v=o("SpAV"),A=o("yhkb"),w=o("gXiO"),R=o("C42b"),b=o("YSlt"),D=o("Ohrj"),T=o("ascj"),x=o("FNB+"),I=o("lq1z"),B=o("G1DZ"),O=o("iCxV"),F=o("3lr5"),E=o("VDg0"),_=o("c+uM"),W=o("hb8m"),P=o("3DEm"),U=o("jcfx"),M=o("Zifs"),N=o("35Q0"),H=o("p+tC"),V=o("UqVc"),G=o("EoOi"),K=o("umUn"),z=o("T6jX"),Y=o("8t9B"),j=o("3UhB"),q=o("oKlP"),X=o("oKI3");k.kColorPairDistanceThreshold=10,k.kPuffyTextThreshold=.12,S.gvar(k,"BACKING_SHAPES_BASIC",(function(){return N.ShapeLibrary.NonSvgBackingShapeIDs})),S.gvar(k,"BACKING_SHAPES_SVG",(function(){return N.ShapeLibrary.BrowsableBackingShapes})),S.gvar(k,"ALLOWED_BACKING_VALUES",(function(){return k.BACKING_SHAPES_BASIC.concat(k.BACKING_SHAPES_SVG)})),S.gvar(k,"BACKING_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_BACKING_VALUES.length)})),S.gvar(k,"ALLOWED_LAYOUT_VALUES",(function(){return["left","right","center","fill"]})),S.gvar(k,"LAYOUT_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_LAYOUT_VALUES.length)})),S.gvar(k,"ALLOWED_OPACITY_VALUES",(function(){return["full","mediumBacking","faintBacking","medium","faint"]})),S.gvar(k,"OPACITY_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_OPACITY_VALUES.length)})),S.gvar(k,"ALLOWED_SHADOWANGLE_VALUES",(function(){return[45,135,225,315]})),S.gvar(k,"SHADOWANGLE_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_SHADOWANGLE_VALUES.length)})),S.gvar(k,"ALLOWED_PADDING_VALUES",(function(){return[0,.33,.66,1]})),S.gvar(k,"PADDING_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_PADDING_VALUES.length)})),S.gvar(k,"ALLOWED_SPACING_VALUES",(function(){return[0,.5,1]})),S.gvar(k,"SPACING_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_SPACING_VALUES.length)})),S.gvar(k,"ALLOWED_TRACKING_VALUES",(function(){return[-.1,0,.5]})),k.LockupStyleAttributes=(a=function(){this.font=0,this.layout="fill",this.backing="none",this.opacity="useLockupOpacities",this.textOpacity=1,this.backingOpacity=1,this.primaryColor="themeColor0",this.secondaryColor="themeColor1",this.shadowAngle=135,this.spacing=.35,this.tracking=0,this.padding=.35,this.textLook="fill",this.shadowOffset=_.LockupStyle.DEFAULT_SHADOWOFFSET,this.strokeWeight=_.LockupStyle.DEFAULT_STROKEWEIGHT,this.layoutVariation=G.TypographyVariation.Unset,this.wheelUsed=!1},S.defineClass({name:"LockupStyleAttributes",ctor:a,props:{clone:function(){var t=new a;return t.font=this.font,t.layout=this.layout,t.backing=this.backing,t.opacity=this.opacity,t.textOpacity=this.textOpacity,t.backingOpacity=this.backingOpacity,t.primaryColor=this.primaryColor,t.secondaryColor=this.secondaryColor,t.shadowAngle=this.shadowAngle,t.spacing=this.spacing,t.tracking=this.tracking,t.padding=this.padding,t.textLook=this.textLook,t.shadowOffset=this.shadowOffset,t.strokeWeight=this.strokeWeight,t.wheelUsed=this.wheelUsed,t}}}),a),k.getFontPairingMatrix=function(t){for(var e={},o=t.count,a=S.iter(S.range(0,o,!1));!a.done;a.next()){for(var i=a.value,r=t.fontAt(i),n=r.postScriptName,l={},s=S.iter(S.range(0,o,!1));!s.done;s.next()){var c=s.value,u=t.fontAt(c),h=u.postScriptName,g=i==c,p=1;p+=1+S.toDouble(10-P.MathUtils.absInt(r.formality-u.formality)),p+=1+S.toDouble(10-P.MathUtils.absInt(r.width-u.width)),p+=1+S.toDouble(P.MathUtils.absInt(r.blackness-u.blackness));var d=S.toDouble(r.drama-u.drama);p+=d,d<-1&&(p*=.1),r.square==u.square&&(p*=2),r.geometric==u.geometric&&(p*=2),r.italic==u.italic&&(p*=2),r.handdrawn&&u.handdrawn&&(p*=2);var f=r.slab&&u.slab,y=0==(r.slab||u.slab);f&&(p*=2);var k=r.serif&&u.serif;k&&y&&(p*=2),0==(r.serif||u.serif)&&(p*=2),k&&r.slab!=u.slab&&(p*=0);var L=r.decorative&&u.decorative;0==g&&L&&(p*=0),r.calligraphic&&u.calligraphic&&0==g&&(p*=0),l[h]=p}e[n]=S.clone(l)}return e},k.getFontPairScore=function(t,e,o){var a,i;if((a=t[e])&&null!=(i=a[o]))return i;return 0},k.hasSufficientLegibilityContrast=function(t,e){return t.contrasts(e,!1)},k.needsContrastingColor=function(t,e,o){return e!=_.LockupTextLook.Fill&&e!=_.LockupTextLook.KnockoutOnly||o},k.getTextOpacity=function(t){switch(t.opacity){case"medium":return E.kOpacityRuleMediumAlpha;case"faint":return E.kOpacityRuleFaintAlpha;case"useLockupOpacities":return t.textOpacity;default:return 1}},k.getBackingOpacity=function(t){switch(t.opacity){case"medium":case"mediumBacking":return E.kOpacityRuleMediumAlpha;case"faint":case"faintBacking":return E.kOpacityRuleFaintAlpha;case"useLockupOpacities":return t.backingOpacity;default:return 1}},k.getTextLook=function(t){var e;switch(t.textLook){case"fill":e=_.LockupTextLook.Fill;break;case"knockoutOnly":e=_.LockupTextLook.KnockoutOnly;break;case"knockoutAndOutline":e=_.LockupTextLook.KnockoutAndOutline;break;case"outlineOnly":e=_.LockupTextLook.OutlineOnly;break;case"fillAndOutline":e=_.LockupTextLook.FillAndOutline;break;case"fillAndOutline2":e=_.LockupTextLook.FillAndOutline2;break;case"shadow":e=_.LockupTextLook.Shadow;break;case"shadowAndOutline":e=_.LockupTextLook.ShadowAndOutline;break;case"knockoutAndShadow":e=_.LockupTextLook.KnockoutAndShadow;break;default:e=_.LockupTextLook.Fill}return e},k.InterestingLockupData=(i=function(t){var e,o,a,i,r,n,l,s,c,u,h,g,p,d,f,y,L,m,C,v,A,w,R;(A=S.as(t.style,_.LockupStyle))&&(g=k.lockupStyleToLockupStyleAttributes(A,t.page.document),u=S.opt(A.font,(function(t){return t.fontData.postScriptName})),(w=S.as(t.controller,Y.TypeLockupController))&&(h=w.getCurrentFontSize()),v=k.lockupStyleToLockupStyleAttributes(A,t.page.document).backing),(w=S.as(t.controller,Y.TypeLockupController))&&((R=w.size)&&(m=R.width,C=R.height,p=S.toDouble(R.width/R.height)),d=S.clone(t.totalPlacement.transformPoints(S.clone(t.bounds.points))),f=w.text.length,y=w.text,L=w.wordCount()),this.id=t.formaID,this.width=(e=m)||null!=e?e:100,this.height=(o=C)||null!=o?o:100,this.font=(a=u)||null!=a?a:"BebasNeue",this.lineHeight=(i=h)||null!=i?i:1,this.styleAttributes=g||new k.LockupStyleAttributes,this.aspectRatio=(r=p)||null!=r?r:1,this.pts=S.clone(d||[]),this.wordCount=(n=L)||null!=n?n:1,this.charCount=(l=f)||null!=l?l:1,this.originalBacking=(s=v)||null!=s?s:"",this.lockupString=(c=y)||null!=c?c:""},S.defineClass({name:"InterestingLockupData",ctor:i}),i),k.InterestingPageData=(r=function(t){this.colorsBehindSelectedLockup=[],this.numImages=0,this.shapeCount=0,this.selectedLockup=new k.InterestingLockupData(t);var e=this.selectedLockup,o=[this.selectedLockup],a=10,i=1e3,r=1e3;if(t.page.hasRoot()){var n,l;i=t.page.pageSize.width,r=t.page.pageSize.height,(n=S.as(t.controller,Y.TypeLockupController))&&(this.colorsBehindSelectedLockup=S.clone(n.getBackgroundColors()),a=n.getBackgroundLightnessSpread(S.clone(this.colorsBehindSelectedLockup)),this.shapeCount=n.shapeCount()),0==this.colorsBehindSelectedLockup.length&&(l=t.page.root.style.colors.fieldPrimary)&&this.colorsBehindSelectedLockup.push(l);for(var s=S.clone(t.page.root.filterWithCallback((function(t){return t.isTypeLockup()}))),c=S.iter(s);!c.done;c.next())if((t=c.value).formaID!=this.selectedLockup.id){var u=new k.InterestingLockupData(t);u.lineHeight>e.lineHeight&&(e=u),o.push(u)}}this.height=r,this.width=i,this.numImages=t.root.filterWithCallback((function(t){return t.isBackgroundImage()})).length,this.lockups=S.clone(o),this.largestLineHeightLockup=e,0==this.colorsBehindSelectedLockup.length&&this.colorsBehindSelectedLockup.push(M.SolidColor.BLACK),this.lightnessSpreadBehindSelectedLockup=a},S.defineClass({name:"InterestingPageData",ctor:r,props:{isColorVisibleAgainstBackground:function(t){for(var e=S.iter(this.colorsBehindSelectedLockup);!e.done;e.next()){var o=e.value;if(!k.hasSufficientLegibilityContrast(t,o))return!1}return!0},ensureCorrectBackgroundColors:function(t){var e,o,a=[];(e=S.as(t.controller,Y.TypeLockupController))&&(a=S.clone(e.getBackgroundColors())),0==a.length&&(o=t.page.root.style.colors.fieldPrimary)&&a.push(o),a.length>0&&(this.colorsBehindSelectedLockup=S.clone(a))}}}),r),k.getBackingStringForBackingEnumAndArtworkId=function(t,e){var o="none";switch(t){case 0:o="none";break;case 2:o="row";break;case 9:o="bannerHorizontal";break;case 8:o="bannerVertical";break;case 11:o="knockout";break;case 4:o="none";break;default:null!=e&&(o=e)}return o},k.getBackingEnumAndArtworkIdForBackingString=function(t){var e,o=null;switch(t){case"none":e=_.LockupBacking.None;break;case"row":e=_.LockupBacking.Rows;break;case"bannerHorizontal":e=_.LockupBacking.BannerHorizontal;break;case"bannerVertical":e=_.LockupBacking.BannerVertical;break;case"knockout":e=_.LockupBacking.Knockout;break;default:e=_.LockupBacking.SVGBackground,o=t}return{backing:e,artworkID:o}},k.lockupStyleToLockupStyleAttributes=function(t,e){var o,a=new k.LockupStyleAttributes,i=O.Host.fontProvider.getIncludedFonts(e);a.shadowAngle=t.shadowAngle;var r,n,l,s,c,u=-1;switch((r=t.font)&&(u=(o=i.indexOf(r.fontData))||null!=o?o:-1),a.font=u,a.spacing=t.spacing,a.tracking=t.tracking,a.padding=t.padding,a.textLook=t.textLookAsString,a.shadowOffset=t.shadowOffset,a.strokeWeight=t.strokeWeight,null!=(n=t.colors.colorID(T.ColorRole.FieldPrimary))&&(a.primaryColor=n),null!=(l=t.colors.colorID(T.ColorRole.FieldSecondary))&&(a.secondaryColor=l),t.opacityRule){case 1:s="mediumBacking";break;case 2:s="faintBacking";break;case 3:s="medium";break;case 4:s="faint";break;case 0:s="full";break;default:s="useLockupOpacities"}a.opacity=s,a.textOpacity=t.textOpacity,a.backingOpacity=t.backingOpacity,a.layoutVariation=t.layoutVariation;var h=t.layout;if(_.LockupStyle.isLetterGrid(h)||h==_.LockupLayout.Standard){var g=_.LockupStyle.isLetterGrid(h)?"letter-grid-":"";switch(t.alignment){case 0:c=g+"left";break;case 1:c=g+"right";break;case 2:c=g+"center";break;default:v.CoreAssert.fail("Unexpected alignment: "+t.alignment,"lockupStyleToLockupStyleAttributes","LockupStyleController.swift",664),c=g+"left"}}else if(_.LockupStyle.isAutoLayout(h))c="auto";else if(_.LockupStyle.isPath(h)){c="path"+t.pathID}else c="fill";return a.layout=c,a.backing=k.getBackingStringForBackingEnumAndArtworkId(t.backing,t.backingArtworkID),a.wheelUsed=t.wheelUsed,a},k.lockupStyleAttributesToLockupStyle=function(t,e,o){var a,i,r=null,n=t.font;(v.CoreAssert.isTrue(n>-1,"lockupStyleAttributesToLockupStyle called with no font. It is valid for a character style to have no font but this function doesn't work for character styles ","lockupStyleAttributesToLockupStyle","LockupStyleController.swift",705),n>-1)&&((i=O.Host.fontProvider.getIncludedFonts(o).fontAt(n))&&(r=j.TypeLockupUtils.createTheoFont(i,O.Host.brandkitManager.brandkitForDocument(o))));var l,s,c=T.ColorTable.init_25f6([{key:T.ColorRole.FieldPrimary,value:t.primaryColor},{key:T.ColorRole.FieldSecondary,value:t.secondaryColor}]);switch(t.opacity){case"mediumBacking":l=_.OpacityRule.MediumBacking;break;case"faintBacking":l=_.OpacityRule.FaintBacking;break;case"medium":l=_.OpacityRule.Medium;break;case"faint":l=_.OpacityRule.Faint;break;case"full":l=_.OpacityRule.Full;break;default:l=_.OpacityRule.UseLockupOpacities}var u,h,g=_.LockupAlignment.UNSET,p=X.TextPathID.UNSET,d=null;if(t.layout.startsWith("path"))s=_.LockupLayout.Path,null!=(u=S.toInt(t.layout.substr("path".length)))&&(p=(a=X.TextPathID.toCaseValue(u))||null!=a?a:X.TextPathID.UNSET)==X.TextPathID.Custom&&(h=e.customPath)&&(d=h);else switch(t.layout){case"auto":s=_.LockupLayout.Auto,g=_.LockupAlignment.Auto;break;case"left":s=_.LockupLayout.Standard,g=_.LockupAlignment.Left;break;case"right":s=_.LockupLayout.Standard,g=_.LockupAlignment.Right;break;case"center":s=_.LockupLayout.Standard,g=_.LockupAlignment.Center;break;case"letter-grid-left":s=_.LockupLayout.LetterGrid,g=_.LockupAlignment.Left;break;case"letter-grid-right":s=_.LockupLayout.LetterGrid,g=_.LockupAlignment.Right;break;case"letter-grid-center":s=_.LockupLayout.LetterGrid,g=_.LockupAlignment.Center;break;case"fill":default:s=_.LockupLayout.FitJustified}var f=k.getBackingEnumAndArtworkIdForBackingString(t.backing),y=k.getTextLook(t),L=t.wheelUsed,m=_.LockupStyle.init_2885(t.textOpacity,t.backingOpacity,c,r,t.spacing,t.tracking,t.padding,f.backing,f.artworkID,t.shadowAngle,s,g,t.layoutVariation,l,y,t.shadowOffset,t.strokeWeight,p,d,L);return m.setCharacterStyles(S.clone(e.characterStyles)),m},k.randomDbl=function(){return S.toDouble(R.CoreRandom.nextInt)/S.toDouble(R.CoreRandom.randMax)},k.getWeightedIndex=function(t,e){for(var o=t.length,a=e*k.randomDbl(),i=0,r=0,n=S.iter(S.range(0,o,!1));!n.done;n.next()){var l=n.value;if((i+=t[l])>=a){r=l;break}}return r},k.selectWeightedValue=function(t,e,o,a,i){var r,n=a,l=S.clone(o);return null!=(r=S.indexOf(e,t))&&o[r]>0&&(l[r]+=n*i,n+=n*i),e[k.getWeightedIndex(S.clone(l),n)]},k.WeightedAttributeSelector=S.defineProtocol("WeightedAttributeSelector",{inertiaRatio:"Double",forma:"Forma",pageData:"InterestingPageData",values:"Array<TypeAlias>",weights:"Array<Double>",weightSum:"Double",scoreValue:"(TypeAlias) -> Double",updateWeights:"(InterestingPageData) -> Void",select:"(LockupStyleAttributes, Boolean, Boolean, Boolean, Boolean) -> TypeAlias"}),k.WeightedFontSelector=(n=function t(e,o){this.inertiaRatio=1,this.weights=[],this.weightSum=0,this.machineRecommend=!0;var a=this;this.forma=e,this.pageData=o,this.listOfFonts=O.Host.fontProvider.getIncludedFonts(e.page.document),this.values=S.toArray(S.range(0,this.listOfFonts.count,!1));var i=this.listOfFonts.revisionNumber,r=this.listOfFonts.fontSetID;i==t.cacheRevisionNumber&&r==t.cacheFontSetID?this.fontPairingMatrix=S.clone(t.fontPairingMatrixCache):(this.fontPairingMatrix={},t.fontPairingMatrixCache={},S.each(k.getFontPairingMatrix(this.listOfFonts),(function(e,o){a.fontPairingMatrix[e]=S.clone(o),t.fontPairingMatrixCache[e]=S.clone(o)})),t.cacheRevisionNumber=i,t.cacheFontSetID=r)},S.defineClass({name:"WeightedFontSelector",ctor:n,statics:{cacheRevisionNumber:0,cacheFontSetID:"charlie",_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t;var e=!1;if(this.values.length!=O.Host.fontProvider.getIncludedFonts(this.forma.page.document).count&&(this.listOfFonts=O.Host.fontProvider.getIncludedFonts(this.forma.page.document),this.values=S.toArray(S.range(0,this.listOfFonts.count,!1)),e=!0),this.machineRecommend){var o,a=new I.FontSuggester;(o=a.getFontFeatures(t,this.forma))?(e&&a.clearCache(),this.weights=S.clone(a.getScores(this.listOfFonts,o))):this.weights=this.values.map(this.scoreValue,this)}0!=this.machineRecommend&&1!=(new V.SuggestionUtils).weightsEqualNaNOrEmpty(S.clone(this.weights))||(this.weights=this.values.map(this.scoreValue,this)),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},getTopFonts:function(t){v.CoreAssert.isTrue(t<this.listOfFonts.count,"cannot get top fonts more than total number","WeightedFontSelector.getTopFonts","LockupStyleController.swift",1006);for(var e=[],o=S.iter(S.toSequence(this.weights));!o.done;o.next()){var a=o.value,i=a.offset,r=a.element;e.push([r,i])}e=S.sort(e,(function(t,e){return t[0]>e[0]}));for(var n=[],l=0,s=S.iter(e);!s.done;s.next()){var c=s.value;if(!(l<t))break;n.push(this.listOfFonts.fontAt(c[1])),l+=1}return n},scoreValue:function(t){return this.manuallyScoreValue(t)},manuallyScoreValue:function(t){var e=this.listOfFonts.fontAt(t),o=e.postScriptName,a=O.Host.fontProvider.descriptorForPostScriptName(o,F.ANY_DOCUMENT),i=this.pageData.selectedLockup.lineHeight;if(!O.Host.fontProvider.getSuggestableFonts(S.opt(this.forma,(function(t){return t.page.document}))).contains(e))return 0;for(var r=.1,n=S.iter(this.pageData.lockups);!n.done;n.next()){var l=n.value;if(l.id!=this.pageData.selectedLockup.id){var s=P.MathUtils.absDouble(i-l.lineHeight)/i,c=l.lineHeight>i,u=c?l.font:o,h=c?o:l.font;r+=k.getFontPairScore(S.clone(this.fontPairingMatrix),u,h),o==l.font&&(r*=2,s<.5&&(r*=2))}}return r*=a.popularity,j.TypeLockupUtils.createTheoFont(e,O.Host.brandkitManager.brandkitForDocument(this.forma.page.document)).isSparkFont()&&(r*=2),i<40&&0==a.bodyAllowed&&(r=0),i>150&&0==a.displayAllowed&&(r=0),r},select:function(t,e,o,a,i){void 0===a&&(a=!1),void 0===i&&(i=!0);var r=t.font,n=o?this.inertiaRatio:0;return k.selectWeightedValue(r,S.clone(this.values),S.clone(this.weights),this.weightSum,n)}}}),n),k.WeightedLayoutSelector=(l=function(t,e){this.inertiaRatio=0,this.values=k.ALLOWED_LAYOUT_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedLayoutSelector",ctor:l,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=1,o=this.pageData.selectedLockup.aspectRatio,a=this.pageData.selectedLockup.wordCount,i=this.pageData.selectedLockup.id;"left"!=t&&"right"!=t||(a<=1||o>4?e=0:e*=.05),0==this.pageData.lockups.length&&("fill"==t&&(e*=5),"center"==t&&(e*=4)),"fill"==t&&this.pageData.selectedLockup.wordCount>10&&(e*=4/S.toDouble(this.pageData.selectedLockup.wordCount));var r=[];z.TheoDocumentUtils.enableFastHeuristicsForComplexPage(this.forma.page)||(r=S.clone(m.AlignmentDetector.init_a05b(this.forma).detectFormaAlignments(20)));for(var n=!1,l=!1,s=S.iter(r);!s.done;s.next()){var c=s.value;c.line.type==m.AlignmentType.Left&&(n=!0),c.line.type==m.AlignmentType.Right&&(l=!0)}n&&!l&&"left"==t&&(e=2.5),l&&!n&&"right"==t&&(e=2.5);for(var u=S.iter(this.pageData.lockups);!u.done;u.next()){var h=u.value;h.id!=i&&t==h.styleAttributes.layout&&(e*=k.LAYOUT_COUNT_SCALE/2)}return e},select:function(t,e,o,a,i){void 0===a&&(a=!1),void 0===i&&(i=!0);var r=t.layout,n=o?this.inertiaRatio:0;return k.selectWeightedValue(r,S.clone(this.values),S.clone(this.weights),this.weightSum,n)}}}),l),k.WeightedBackingSelector=(s=function(t,e){this.inertiaRatio=1,this.values=k.ALLOWED_BACKING_VALUES,this.weights=[],this.weightSum=0,this.machineRecommend=!0,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedBackingSelector",ctor:s,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){if(this.pageData=t,1==this.machineRecommend){var e=new H.ShapeSuggester,o=S.clone(e.getShapeSuggesterFeatures(t,this.forma));this.weights=S.clone(e.getScores(S.clone(this.values),S.clone(o)))}0!=this.machineRecommend&&1!=(new V.SuggestionUtils).weightsEqualNaNOrEmpty(S.clone(this.weights))||(this.weights=this.values.map(this.scoreValue,this)),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=this.pageData.selectedLockup,o=this.pageData.largestLineHeightLockup,a=e.lineHeight,i=o.id==e.id,r=N.ShapeLibrary.shapeDictionary[t]||N.ShapeLibrary.shapeDictionary.none,n=1;if(r.premium)return 0;if(N.ShapeLibrary.NonSuggestableBackingShapes.includes(t))return 0;this.pageData.lockups.length>0&&k.BACKING_SHAPES_SVG.includes(t)&&(n*=.1);for(var l=S.iter(this.pageData.lockups);!l.done;l.next()){var s,c=l.value;c.id!=e.id&&(P.MathUtils.absDouble(a-c.lineHeight)/a<.4&&(n*=3),(s=N.ShapeLibrary.shapeDictionary[c.styleAttributes.backing])&&(n*=(11-S.toDouble(P.MathUtils.absInt(r.formality-s.formality)))/2,n*=(11-S.toDouble(P.MathUtils.absInt(r.drama-s.drama)))/2))}var u,h=P.MathUtils.maxDouble(e.width/this.pageData.width,e.height/this.pageData.height);if(r.maxScale<1&&h>r.maxScale&&(n=0),(r.maxAspect<e.aspectRatio||r.minAspect>e.aspectRatio)&&(n=0),0==i&&(u=N.ShapeLibrary.shapeDictionary[o.styleAttributes.backing])){var g=u.drama;r.drama<g&&(n*=2)}return"none"==t&&(n*=10),"row"==t&&(n*=10),this.pageData.lightnessSpreadBehindSelectedLockup>=20&&0==r.filled&&(n*=.01),n},select:function(t,e,o,a,i){void 0===a&&(a=!1),void 0===i&&(i=!0);var r=this.values.length,n=S.clone(this.weights),l=t.layout,s="center"==l||"fill"==l,c=!1,u=O.Host.fontProvider.getIncludedFonts(this.forma.page.document).fontAt(t.font),h=this.pageData.selectedLockup.width/this.pageData.selectedLockup.height,g=!0,p=this.pageData.selectedLockup.originalBacking;"none"!=p&&"shadow"!=p&&"row"!=p||(g=!1),"knockout"==t.backing&&(g=!1);for(var d=S.iter(this.pageData.lockups);!d.done;d.next()){var f,y=d.value,L=y.styleAttributes.backing;y.id!=this.pageData.selectedLockup.id&&("none"!=L&&(c=!0),t.font==y.styleAttributes.font&&null!=(f=S.indexOf(k.ALLOWED_BACKING_VALUES,L))&&(n[f]*=5))}for(var m=S.iter(S.range(0,r,!1));!m.done;m.next()){var C,v=m.value,A=this.values[v];if(C=N.ShapeLibrary.shapeDictionary[A]){s&&1==C.centered&&(n[v]*=5),h>4&&C.category==N.ShapeCategory.Circle&&(n[v]*=0),h<4&&C.category==N.ShapeCategory.Banner&&(n[v]*=0),C.category!=N.ShapeCategory.Cutout&&C.category!=N.ShapeCategory.Avoid||(n[v]*=0),"knockoutOnly"!=t.textLook||"none"!=A&&"shadow"!=A||(n[v]*=0);var w=S.toDouble(10-P.MathUtils.absInt(u.formality-C.formality));n[v]*=w/5;var R=S.toDouble(10-P.MathUtils.absInt(u.drama-C.drama));n[v]*=R/5,c&&"row"!=A&&"none"!=A&&(n[v]/=5)}}var b=t.backing,D=o?this.inertiaRatio:0,T=n.reduce((function(t,e){return t+e}),0);return b=1==g?k.selectWeightedValue(b,S.clone(this.values),S.clone(n),T,D):p}}}),s),k.WeightedShadowAngleSelector=(c=function(t,e){this.inertiaRatio=1,this.values=k.ALLOWED_SHADOWANGLE_VALUES,this.weights=[],this.weightSum=0,this.foo=4,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedShadowAngleSelector",ctor:c,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){return 1},select:function(t,e,o,a,i){void 0===a&&(a=!1),void 0===i&&(i=!0);var r=t.shadowAngle,n=o?this.inertiaRatio:0;return k.selectWeightedValue(r,S.clone(this.values),S.clone(this.weights),this.weightSum,n)}}}),c),k.WeightedOpacitySelector=(u=function(t,e){this.inertiaRatio=1,this.values=k.ALLOWED_OPACITY_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedOpacitySelector",ctor:u,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=1,o=this.pageData.selectedLockup.width*this.pageData.selectedLockup.height,a=this.pageData.width*this.pageData.height;return"full"==t&&o>.5*a&&(e*=.1),"faint"==t&&(o<.5*a?e=0:e*=.5),e},select:function(t,e,o,a,i){void 0===a&&(a=!1),void 0===i&&(i=!0);var r=t.opacity,n=S.clone(this.weights);(N.ShapeLibrary.shapeDictionary[t.backing]||N.ShapeLibrary.shapeDictionary.none).filled?(n[S.indexOf(k.ALLOWED_OPACITY_VALUES,"faint")]=0,n[S.indexOf(k.ALLOWED_OPACITY_VALUES,"medium")]=0):(n[S.indexOf(k.ALLOWED_OPACITY_VALUES,"faintBacking")]=0,n[S.indexOf(k.ALLOWED_OPACITY_VALUES,"mediumBacking")]=0);var l=o?this.inertiaRatio:0,s=n.reduce((function(t,e){return t+e}),0);return k.selectWeightedValue(r,S.clone(this.values),S.clone(n),s,l)}}}),u),k.WeightedPaddingSelector=(h=function(t,e){this.inertiaRatio=1,this.values=k.ALLOWED_PADDING_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedPaddingSelector",ctor:h,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=this.pageData.selectedLockup,o=1,a=1;if(0==this.pageData.lockups.length)a=P.MathUtils.absDouble(t-_.LockupStyle.DEFAULT_PADDING);else for(var i=S.iter(this.pageData.lockups);!i.done;i.next()){var r=i.value;a=P.MathUtils.minDouble(a,P.MathUtils.absDouble(t-r.styleAttributes.padding))}o*=P.MathUtils.maxDouble(1/(a+.1),.05);var n=P.MathUtils.maxDouble(e.width/this.pageData.width,e.height/this.pageData.height)+t;return o/=4*P.MathUtils.absDouble(n-1)},select:function(t,e,o,a,i){void 0===a&&(a=!1),void 0===i&&(i=!0);var r=t.padding,n=o?this.inertiaRatio:0;return k.selectWeightedValue(r,S.clone(this.values),S.clone(this.weights),this.weightSum,n)}}}),h),k.WeightedSpacingSelector=(g=function(t,e){this.inertiaRatio=1,this.values=k.ALLOWED_SPACING_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedSpacingSelector",ctor:g,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=1,o=1;if(0==this.pageData.lockups.length)o=P.MathUtils.absDouble(t-_.LockupStyle.DEFAULT_SPACING);else for(var a=S.iter(this.pageData.lockups);!a.done;a.next()){var i=a.value;o=P.MathUtils.minDouble(o,P.MathUtils.absDouble(t-i.styleAttributes.spacing))}return e*=P.MathUtils.maxDouble(1/(o+.1),.05)},select:function(t,e,o,a,i){void 0===a&&(a=!1),void 0===i&&(i=!0);var r=t.spacing,n=o?this.inertiaRatio:0;return k.selectWeightedValue(r,S.clone(this.values),S.clone(this.weights),this.weightSum,n)}}}),g),k.PrimaryColorSelector=(p=function t(e,o){this.inertiaRatio=1,this.weights=[],this.weightSum=0,this.forma=e,this.pageData=o,this.values=S.clone(t.updateColorValues(e))},S.defineClass({name:"PrimaryColorSelector",ctor:p,statics:{updateColorValues:function(t){var e;return(e=t)?e.page.colorLibraryController.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS).concat(e.page.colorLibraryController.getProfilingColorKeys()):[]},_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.values=S.clone(p.updateColorValues(this.forma)),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){return"themeDerivedDark"==t?.1:1},select:function(t,e,o,a,i){void 0===a&&(a=!1),void 0===i&&(i=!0);var r=(N.ShapeLibrary.shapeDictionary[t.backing]||N.ShapeLibrary.shapeDictionary.none).filled||"fill"!=t.textLook;this.values=S.clone(p.updateColorValues(this.forma));for(var n=this.values.length,l=t.primaryColor,s=S.clone(this.weights),c=new b.ColorRankSuggester,u=[],h=S.iter(S.range(0,n,!1));!h.done;h.next()){var g,d=h.value;(g=this.forma.page.colorLibraryController.getSolidColorForKey(this.values[d]))&&u.push(g)}if(v.CoreAssert.isTrue(n==u.length,"not all value colors were added.","PrimaryColorSelector.select","LockupStyleController.swift",2089),n!=u.length)return l;var f=[];if(0==r){this.pageData.ensureCorrectBackgroundColors(this.forma);for(var y=S.iter(this.pageData.colorsBehindSelectedLockup);!y.done;y.next()){var L=y.value;f.push(S.clone(b.ColorForComparison.init_c063(L,1)))}}else{var m;(m=this.forma.page.colorLibraryController.getSolidColorForKey(t.secondaryColor))&&f.push(S.clone(b.ColorForComparison.init_c063(m,1)))}a&&(m=this.forma.page.colorLibraryController.getSolidColorForKey(t.primaryColor))&&f.push(S.clone(b.ColorForComparison.init_c063(m,.33))),s=S.clone(c.weightedColorContrastRanker(S.clone(f),S.clone(u),i));var C=(s=S.clone((new V.SuggestionUtils).normalizedWeights(S.clone(s)))).reduce((function(t,e){return t+e}),0),A=o?this.inertiaRatio:0;return k.selectWeightedValue(l,S.clone(this.values),S.clone(s),C,A)}}}),p),k.SecondaryColorSelector=(d=function t(e,o){this.inertiaRatio=0,this.weights=[],this.weightSum=0,this.forma=e,this.pageData=o,this.values=S.clone(t.updateColorValues(e))},S.defineClass({name:"SecondaryColorSelector",ctor:d,statics:{updateColorValues:function(t){var e;return(e=t)?e.page.colorLibraryController.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS):[]},_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.values=S.clone(d.updateColorValues(this.forma)),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){return 1},select:function(t,e,o,a,i){void 0===a&&(a=!1),void 0===i&&(i=!0);var r=t.secondaryColor,n=(N.ShapeLibrary.shapeDictionary[t.backing]||N.ShapeLibrary.shapeDictionary.none).filled;this.values=S.clone(d.updateColorValues(this.forma));for(var l=this.values.length,s=S.clone(this.weights),c=new b.ColorRankSuggester,u=[],h=S.iter(S.range(0,l,!1));!h.done;h.next()){var g,p=h.value;(g=this.forma.page.colorLibraryController.getSolidColorForKey(this.values[p]))?u.push(g):v.CoreAssert.isTrue(!1,"failed to get SolidColor for key "+this.values[p]+". colorCount:"+l+". num color keys:"+this.forma.page.colorLibraryController.getNumThemeColorKeys(),"SecondaryColorSelector.select","LockupStyleController.swift",2209)}if(v.CoreAssert.isTrue(l==u.length,"not all value colors were added.","SecondaryColorSelector.select","LockupStyleController.swift",2212),l!=u.length)return r;var f=[];if(a&&n){var y;(y=this.forma.page.colorLibraryController.getSolidColorForKey(t.secondaryColor))&&f.push(S.clone(b.ColorForComparison.init_c063(y,1)))}else{this.pageData.ensureCorrectBackgroundColors(this.forma);for(var L=S.iter(this.pageData.colorsBehindSelectedLockup);!L.done;L.next()){var m=L.value;f.push(S.clone(b.ColorForComparison.init_c063(m,1)))}}s=S.clone(c.weightedColorContrastRanker(S.clone(f),S.clone(u),i));var C=(s=S.clone((new V.SuggestionUtils).normalizedWeights(S.clone(s)))).reduce((function(t,e){return t+e}),0),A=o?this.inertiaRatio:0;return k.selectWeightedValue(r,S.clone(this.values),S.clone(s),C,A)}}}),d),k.LockupStyleController=(f=function(t){this._sessionAttrs=new k.SessionAttrs,this.hasScoresForAttributes=!1,this.loggedDesignIngredientColorChanged=!1,this.forma=t,this.targetedLockupStyleName_="",this.pageData=new k.InterestingPageData(t),this.fontSelector=new k.WeightedFontSelector(t,this.pageData),this.layoutSelector=new k.WeightedLayoutSelector(t,this.pageData),this.backingSelector=new k.WeightedBackingSelector(t,this.pageData),this.opacitySelector=new k.WeightedOpacitySelector(t,this.pageData),this.primaryColorSelector=new k.PrimaryColorSelector(t,this.pageData),this.profilingBackgroundColorSelector=new D.ProfilingBackgroundColorSelector(t,!0),this.profilingPrimaryColorSelector=new D.ProfilingPrimaryColorSelector(t,!1),this.secondaryColorSelector=new k.SecondaryColorSelector(t,this.pageData),this.shadowAngleSelector=new k.WeightedShadowAngleSelector(t,this.pageData),this.spacingSelector=new k.WeightedSpacingSelector(t,this.pageData),this.paddingSelector=new k.WeightedPaddingSelector(t,this.pageData),w.CoreObject.call(this)},S.defineClass({name:"LockupStyleController",ctor:f,superName:"CoreObject",props:{targetedLockupStyleName:{get:function(){var t;return((t=S.opt(S.opt(S.opt(this.forma,(function(t){return t.page.document})),(function(t){return t.controller})),(function(t){return t.selection.inCharStyleMode})))||null!=t)&&t?Y.TypeLockupController.HIGHLIGHT_STYLE:""}},targetedLockupStyle:{get:function(){return""!=this.targetedLockupStyleName?this.forma.controller.getCharacterStyle(this.targetedLockupStyleName):this.forma.style}},targetedFont:{get:function(){var t;return(t=this.targetedLockupStyle.font)?t:this.forma.style.font}},targetedShadowAngle:{get:function(){return this.forma.style.shadowAngle},set:function(t){this.forma.style.shadowAngle=t}},targetedShadowOffset:{get:function(){return this.forma.style.shadowOffset},set:function(t){this.forma.style.shadowOffset=t}},targetedStrokeWeight:{get:function(){return this.forma.style.strokeWeight},set:function(t){this.forma.style.strokeWeight=t}},targetedTextLook:{get:function(){return this.targetedLockupStyle.textLook!=_.LockupTextLook.UNSET?this.targetedLockupStyle.textLook:this.forma.style.textLook}},updateScoring:function(){this.pageData=new k.InterestingPageData(this.forma),this.fontSelector.updateWeights(this.pageData),this.layoutSelector.updateWeights(this.pageData),this.backingSelector.updateWeights(this.pageData),this.opacitySelector.updateWeights(this.pageData),this.primaryColorSelector.updateWeights(this.pageData),this.secondaryColorSelector.updateWeights(this.pageData),this.shadowAngleSelector.updateWeights(this.pageData),this.spacingSelector.updateWeights(this.pageData),this.paddingSelector.updateWeights(this.pageData),this.profilingPrimaryColorSelector.updateBackgroundColors(S.clone(this.pageData.colorsBehindSelectedLockup)),this.profilingBackgroundColorSelector.updateBackgroundColors(S.clone(this.pageData.colorsBehindSelectedLockup)),this.hasScoresForAttributes=!0},getRecommendedFonts:function(){return this.fontSelector.getTopFonts(10)},onlineLearning:function(t){var e,o=new I.FontSuggester;(e=o.getFontFeatures(this.pageData,this.forma))&&o.onlineLearning(t,e)},getDominantColorRole:function(){var t,e=k.lockupStyleToLockupStyleAttributes(this.targetedLockupStyle,this.forma.page.document).backing,o=T.ColorRole.FieldPrimary;return(t=N.ShapeLibrary.shapeDictionary[e])&&1==t.filled&&(o=T.ColorRole.FieldSecondary),o},fixUpSecondaryColor:function(){var t;if((t=S.as(this.forma.controller,Y.TypeLockupController))&&t.secondaryColorVisible()&&this.targetedLockupStyle.textBacked&&this.targetedLockupStyle.backing!=_.LockupBacking.UNSET){var e=this.targetedLockupStyle.colors.colorID(T.ColorRole.FieldPrimary),o=this.targetedLockupStyle.colors.colorID(T.ColorRole.FieldSecondary),a=this.calculateContrastingSecondaryColorID();null!=a&&a!=o&&a!=e&&null!=this.forma.page.colorLibraryController.getSolidColorForKey(a)&&this.targetedLockupStyle.colors.setColorId(T.ColorRole.FieldSecondary,a)}},calculateContrastingSecondaryColorID:function(){var t,e=this.targetedLockupStyle.colors.colorID(T.ColorRole.FieldPrimary),o=this.targetedLockupStyle.colors.colorID(T.ColorRole.FieldSecondary);if(null!=e&&e==o&&(t=this.forma.page.colorLibraryController.getSolidColorForKey(e)))for(var a=S.iter(this.forma.page.colorLibraryController.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS));!a.done;a.next()){var i,r=a.value;if(r!=e&&(i=this.forma.page.colorLibraryController.getSolidColorForKey(r))&&i.contrasts(t,!1)){o=r;break}}return o},fixUpBackingShape:function(){var t,e,o=this.forma.style;if((t=N.ShapeLibrary.shapeDictionary[k.getBackingStringForBackingEnumAndArtworkId(o.backing,o.backingArtworkID)])&&(e=N.ShapeLibrary.shapeDictionary[k.getBackingStringForBackingEnumAndArtworkId(this.targetedLockupStyle.backing,this.targetedLockupStyle.backingArtworkID)])){if(_.LockupStyle.isKnockoutLook(this.targetedLockupStyle.textLook)){(this.targetedLockupStyle===this.forma.style?t.filled:_.LockupStyle.isLetterGrid(o.layout)?(this.targetedLockupStyle.backing!=_.LockupBacking.None?e:t).filled:t.filled||e.filled)||(S.opt(S.as(this.forma.controller,Y.TypeLockupController),(function(t){return t.beginBlockedUpdate()})),this.targetedLockupStyle.backing=_.LockupBacking.SVGBackground,this.targetedLockupStyle.backingArtworkID="square_001",S.opt(S.as(this.forma.controller,Y.TypeLockupController),(function(t){return t.endBlockedUpdate()})),S.opt(S.as(this.forma.controller,Y.TypeLockupController),(function(t){return t.styleChanged()})))}!e.filled||this.targetedLockupStyle.textLook!=_.LockupTextLook.Shadow&&this.targetedLockupStyle.textLook!=_.LockupTextLook.ShadowAndOutline&&this.targetedLockupStyle.textLook!=_.LockupTextLook.FillAndOutline&&this.targetedLockupStyle.textLook!=_.LockupTextLook.FillAndOutline2&&this.targetedLockupStyle.textLook!=_.LockupTextLook.OutlineOnly||1!=this.targetedLockupStyle.backingOpacity||(this.targetedLockupStyle.opacityRule=_.OpacityRule.UseLockupOpacities,this.targetedLockupStyle.backingOpacity=.5)}},getKnockoutColor:function(){var t,e,o=this.forma.style;return this.targetedLockupStyle!==this.forma.style&&(t=N.ShapeLibrary.shapeDictionary[k.getBackingStringForBackingEnumAndArtworkId(o.backing,o.backingArtworkID)])&&(e=N.ShapeLibrary.shapeDictionary[k.getBackingStringForBackingEnumAndArtworkId(this.targetedLockupStyle.backing,this.targetedLockupStyle.backingArtworkID)])&&(e.filled||!t.filled)?this.targetedLockupStyle.colors.fieldSecondary:o.colors.fieldSecondary},getTextLookForUI:function(){return this.targetedTextLook==_.LockupTextLook.FillAndOutline2||this.targetedTextLook==_.LockupTextLook.OutlineOnly?_.LockupTextLook.FillAndOutline:this.targetedTextLook},getStrokeWeightPercentForUI:function(){return 99*this.targetedStrokeWeight+1},getShadowOffsetPercentForUI:function(){return 99*this.targetedShadowOffset+1},setTextLook:function(t){this.targetedLockupStyle!==this.forma.style&&t==this.forma.style.textLook?this.targetedLockupStyle.textLook=_.LockupTextLook.UNSET:(this.targetedLockupStyle.textLook=t,this.targetedLockupStyle.textLook==_.LockupTextLook.KnockoutAndShadow&&(135==this.targetedShadowAngle&&225==this.targetedShadowAngle||(this.targetedShadowAngle=135)),this.targetedLockupStyle.textLook==_.LockupTextLook.ShadowAndOutline?this.targetedShadowOffset=_.LockupStyle.DEFAULT_SHADOWOFFSET/2:this.targetedShadowOffset=_.LockupStyle.DEFAULT_SHADOWOFFSET,this.targetedLockupStyle.textLook==_.LockupTextLook.KnockoutAndOutline?this.targetedStrokeWeight=0:this.targetedStrokeWeight=_.LockupStyle.DEFAULT_STROKEWEIGHT),this.fixUpSecondaryColor(),this.fixUpBackingShape(),this.forma.controller.styleChanged()},applyBacking:function(t,e){var o,a,i,r,n,l;if((o=this.forma)&&(a=o.parent)&&(i=o.root)&&(r=o.page.document)&&(n=S.as(o.style,_.LockupStyle))&&(l=S.as(o.controller,Y.TypeLockupController))){l.beginBlockedUpdate();var s,c=k.getBackingStringForBackingEnumAndArtworkId(t,e);if(null!=(s=o.source)&&B.FormaSourceUtils.isDesignIngredient(s)){var u=C.BadgeFacade.getDesignIngredientIDAndType(s),h=u.id,g=u.type;S.opt(O.Host.logging,(function(t){return t.logToAnalytics(L.AnalyticsConstants.kDesignIngredientBackingShapeChanged,{contextualData1:"designIngredientId:"+h,contextualData2:"designIngredientType:"+g,contextualData12:"shapeName:"+c})}))}var p,d=k.lockupStyleToLockupStyleAttributes(this.targetedLockupStyle,r),f=!1,y=!1,m=this.targetedLockupStyle.currentBackingOpacity,A=this.targetedLockupStyle.textLook;if(t==_.LockupBacking.Knockout){_.LockupStyle.isKnockoutLook(A)||(A=_.LockupTextLook.KnockoutOnly,d.textLook="knockoutOnly"),i.visitAll(x.FormaTraversal.PreOrder,(function(t){var e;(e=S.as(t.style,_.LockupStyle))&&e.backing==_.LockupBacking.Knockout&&(e.backing=_.LockupBacking.None,e.textLook=_.LockupTextLook.Fill)}));var w=S.clone(a.filterWithCallback((function(t){return(t.isBackgroundImage()||t.isShape())&&S.opt(t.controller,(function(t){return 0==t.floating}))}),x.FormaTraversal.JustChildren));a.insertChildAt(o,w.length)}this.targetedLockupStyle!==n&&((H=this.targetedLockupStyle).backing==_.LockupBacking.UNSET&&(v.CoreAssert.isTrue(_.LockupStyle.isLetterGrid(n.layout),"LockupBacking.UNSET in secondary styles for non-letter-grid layouts?","LockupStyleController.applyBacking","LockupStyleController.swift",2835),H.padding=n.padding),t==_.LockupBacking.None||t==_.LockupBacking.Rows||t==_.LockupBacking.SVGBackground?(H.backing=t,H.backingArtworkID=e):t==_.LockupBacking.Knockout&&(H.backing=_.LockupBacking.UNSET,A=_.LockupTextLook.KnockoutOnly),d=k.lockupStyleToLockupStyleAttributes(H,r),c=k.getBackingStringForBackingEnumAndArtworkId(H.backing,H.backingArtworkID),A=H.textLook),d.backing!=c&&(p=N.ShapeLibrary.shapeDictionary[c])&&(f=k.needsContrastingColor(c,A,p.filled),p.filled||A==_.LockupTextLook.FillAndOutline||A==_.LockupTextLook.FillAndOutline2||(y=!0),p.filled||(m=1)),d.backing=c,t!=_.LockupBacking.None||A!=_.LockupTextLook.KnockoutOnly&&A!=_.LockupTextLook.KnockoutAndOutline||(d.textLook="none");var R=this.updateOpacityAttributes(m,d);if(f&&(W=o.page.colorLibraryController.getSolidColorForKey(d.secondaryColor))&&(E=o.page.colorLibraryController.getSolidColorForKey(d.primaryColor))){var b=k.getBackingOpacity(d);b==_.LockupStyle.OPACITY_UNSET&&(b=k.getBackingOpacity(k.lockupStyleToLockupStyleAttributes(n,r)));for(var D=!0,T=S.iter(this.pageData.colorsBehindSelectedLockup);!T.done;T.next()){var I=T.value.blend(W,b);if(!k.hasSufficientLegibilityContrast(E,I)){D=!1;break}}if(!D){var F=this.getContrastingColorKey(d.secondaryColor,d.primaryColor);R.secondaryColor=F}}if(y){var E,W,P,U=d.primaryColor,M=d.secondaryColor;(E=o.page.colorLibraryController.getSolidColorForKey(U))&&(this.pageData.isColorVisibleAgainstBackground(E)||(W=o.page.colorLibraryController.getSolidColorForKey(M))&&(this.pageData.isColorVisibleAgainstBackground(W)&&!S.opt(N.ShapeLibrary.shapeDictionary[c],(function(t){return t.category==N.ShapeCategory.Cutout}))?(R.primaryColor=M,R.secondaryColor=U):null!=(P=this.getThemeColorContrastingWithBackground())&&(R.primaryColor=P)))}if(this.targetedLockupStyle!==n){var H;(H=this.targetedLockupStyle).textOpacity!=_.LockupStyle.OPACITY_UNSET&&(H.textOpacity=R.textOpacity),H.backingOpacity!=_.LockupStyle.OPACITY_UNSET&&(H.backingOpacity=R.backingOpacity),this.pickVisibleColorsForCharStyle()}else{var V=k.lockupStyleAttributesToLockupStyle(R,n,r);if(V.shapeSupportsKnockout)_.LockupStyle.doesLookColorMatchShapeColor(V.textLook)&&1==V.backingOpacity&&(V.backingOpacity=.5);else{_.LockupStyle.isKnockoutLook(V.textLook)&&(V.textLook=_.LockupTextLook.Fill);for(var G=S.iter(V.characterStyles);!G.done;G.next()){var K=G.value;!K.shapeSupportsKnockout&&_.LockupStyle.isKnockoutLook(K.textLook)&&(K.textLook=_.LockupTextLook.UNSET)}}o.applyStyle(V)}l.endBlockedUpdate(),l.styleChanged(),this.onBackingShapeChanged()}},switchPrimaryColorAndSecondaryColor:function(){var t,e=!1;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),_.LockupStyle)){var o=k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),a=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),i=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);if(null!=a&&null!=i){var r=o.primaryColor;o.primaryColor=o.secondaryColor,o.secondaryColor=r;var n=k.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document);this.forma.applyStyle(n),e=!0}}return e},getContrastingThemeColorBasedOnSolidColor:function(t,e){if(void 0===e&&(e=null),null==t)return null;for(var o=this.forma.page.colorLibraryController,a=S.iter(o.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS));!a.done;a.next()){var i,r=a.value;if((i=o.getSolidColorForKey(r))&&i.contrasts(t,!1)&&!i.isEqual(e))return r}return null},getThemeColorContrastingWithBackground:function(t){void 0===t&&(t=null);for(var e=this.forma.page.colorLibraryController,o=S.iter(e.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS));!o.done;o.next()){var a,i=o.value;if((a=e.getSolidColorForKey(i))&&(null==t||!a.isEqual(t))){for(var r=!0,n=S.iter(this.pageData.colorsBehindSelectedLockup);!n.done;n.next()){var l=n.value;if(!a.contrasts(l,!1)){r=!1;break}}if(r)return i}}return null},doesLockupContrastWithBackground:function(){var t,e=!0;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),_.LockupStyle)){var o=k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),a=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),i=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);t.secondaryColorVisible?t.textBacked?null!=a&&null!=i&&(e=this.pageData.isColorVisibleAgainstBackground(i)&&a.contrasts(i,!1)):null!=a&&null!=i&&(e=this.pageData.isColorVisibleAgainstBackground(a)&&this.pageData.isColorVisibleAgainstBackground(i)):null!=a&&(e=this.pageData.isColorVisibleAgainstBackground(a))}return e},pickVisibleColorsForLockup:function(){var t=this.pickVisibleColorsForTextAndShape(),e=this.pickVisibleColorsForCharStyle(),o=t||e;return o&&this.forma.controller.styleChanged(),o},pickVisibleColorsForTextAndShape:function(){if(this.doesLockupContrastWithBackground())return!1;if(this.switchPrimaryColorAndSecondaryColor()){if(this.doesLockupContrastWithBackground())return!0;this.switchPrimaryColorAndSecondaryColor()}var t,e=!1;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),_.LockupStyle)){var o=k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),a=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),i=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);if(t.secondaryColorVisible){if(t.textBacked){if(null!=a&&null!=i)if(this.pageData.isColorVisibleAgainstBackground(i))a.contrasts(i,!1)||null!=(r=this.getContrastingThemeColorBasedOnSolidColor(i))&&(o.primaryColor=r,e=!0);else if(null!=(l=this.getThemeColorContrastingWithBackground())){o.secondaryColor=l;var r,n=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);e=!0,k.hasSufficientLegibilityContrast(a,n)||null!=(r=this.getContrastingThemeColorBasedOnSolidColor(n))&&(o.primaryColor=r)}}else if(null!=a&&null!=i){var l;this.pageData.isColorVisibleAgainstBackground(a)||null!=(l=this.getThemeColorContrastingWithBackground())&&(o.primaryColor=l,e=!0),this.pageData.isColorVisibleAgainstBackground(i)||(a.isEqual(i)?(o.secondaryColor=o.primaryColor,e=!0):null!=(l=this.getThemeColorContrastingWithBackground(a))?(o.secondaryColor=l,e=!0):(o.secondaryColor=o.primaryColor,e=!0))}}else null!=a&&(this.pageData.isColorVisibleAgainstBackground(a)||null!=(l=this.getThemeColorContrastingWithBackground())&&(o.primaryColor=l,e=!0));if(e){var s=k.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document);this.forma.applyStyle(s)}}return e},pickVisibleColorsForCharStyle:function(){var t,e=!1;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),_.LockupStyle)){if(0==S.count(t.characterStyles))return e;for(var o=_.LockupStyle.isKnockoutLook(t.textLook)?"":t.colors.colorID(T.ColorRole.FieldPrimary),a=t.textBacked?t.colors.colorID(T.ColorRole.FieldSecondary):"",i=this.forma.page.colorLibraryController,r=[],n=S.iter(i.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS));!n.done;n.next()){var l,s=n.value;(l=i.getSolidColorForKey(s))&&this.pageData.isColorVisibleAgainstBackground(l)&&r.push(s)}for(var c=S.iter(t.characterStyles);!c.done;c.next()){var u=c.value,h=u.colors.colorID(T.ColorRole.FieldPrimary),g=u.secondaryColorVisible?u.colors.colorID(T.ColorRole.FieldSecondary):"";if(u.secondaryColorVisible&&u.backing!=_.LockupBacking.UNSET){var p,d=!1;if(""==a&&(p=i.getSolidColorForKey(g))&&(this.pageData.isColorVisibleAgainstBackground(p)||(d=!0)),d)for(var f=S.iter(r);!f.done;f.next())(b=f.value)!=a&&(u.colors.setColorId(T.ColorRole.FieldSecondary,b),e=!0);else if(g==a)for(var y=S.iter(i.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS));!y.done;y.next())(s=y.value)!=a&&(u.colors.setColorId(T.ColorRole.FieldSecondary,s),e=!0)}var k=!1,L=h!=o,m=i.getSolidColorForKey(t.colors.colorID(T.ColorRole.FieldPrimary));if(null==m)return e;if(!u.textBacked){var C=i.getSolidColorForKey(h);L&&""!=o&&(L=C.contrasts(m,!1)),""!=a||this.pageData.isColorVisibleAgainstBackground(C)||(k=!0)}if((u.backing!=_.LockupBacking.None&&u.backing!=_.LockupBacking.UNSET||L&&h!=a)&&!k){if(u.textBacked&&h==u.colors.colorID(T.ColorRole.FieldSecondary))for(var v=S.iter(i.getThemeColorKeys());!v.done;v.next())if((s=v.value)!=u.colors.colorID(T.ColorRole.FieldSecondary)){u.colors.setColorId(T.ColorRole.FieldPrimary,s),e=!0;break}}else for(var w=S.iter(r);!w.done;w.next()){var R=w.value,b=i.getSolidColorForKey(R),D=""==o||b.contrasts(m,!1);if(R!=o&&R!=a&&(!D&&e||u.colors.setColorId(T.ColorRole.FieldPrimary,R),e=!0,D))break}}}return e},getBrandkitColorsInUse:function(){for(var t=[],e=this.forma.page.colorLibraryController,o=S.iter(e.getColorThemeAsArrayOfTheoColors());!o.done;o.next()){var a=o.value;a.isBrandkitColor()&&t.push(a)}return t},getAllColorsFromDocumentBrandkit:function(){var t=[],e=O.Host.brandkitManager.brandkitForDocument(this.forma.page.document);if(null!=e)for(var o=S.iter(e.colors);!o.done;o.next()){var a=o.value,i=K.TheoColor.init_bb45(a);t.push(i)}return t},getBaseSuggestableColors:function(){for(var t=this.forma.page.colorLibraryController,e=S.clone(t.getColorThemeAsArrayOfTheoColors()),o=S.clone(t.getThemeDerivedColorsAsArrayOfTheoColors()),a=S.clone(t.getSuggestedColorsAsArraysOfTheoColors()),i=e.concat(a).concat(o),r=[],n=S.clone(this.getAllColorsFromDocumentBrandkit()),l=S.iter(i);!l.done;l.next()){var s=l.value;if(!s.isBrandkitColor()){for(var c=!0,u=S.iter(r);!u.done;u.next()){var h=u.value;if(s.rgbColor.distanceTo(h)<20){c=!1;break}}for(var g=S.iter(n);!g.done;g.next()){var p=g.value;if(s.rgbColor.distanceTo(p.rgbColor)<20){c=!1;break}}if(c&&r.push(s.rgbColor),r.length>=10)break}}return r},getSuggestableSingleColors:function(){for(var t=S.clone(this.getBaseSuggestableColors()),e=k.getTextOpacity(this.pageData.selectedLockup.styleAttributes),o=[],a=S.iter(t);!a.done;a.next()){for(var i=a.value,r=i.withAlphaOf(e),n=!0,l=S.iter(this.pageData.colorsBehindSelectedLockup);!l.done;l.next()){var s=l.value;if(!k.hasSufficientLegibilityContrast(r,s)){n=!1;break}}n&&o.push(i)}return o},getSuggestableColors:function(){var t=S.clone(this.getSuggestableColorPairs());if(0==t.length)for(var e=S.clone(this.getSuggestableSingleColors()),o=S.iter(e);!o.done;o.next()){var a=o.value;t.push([a])}for(var i=[],r=S.iter(t);!r.done;r.next()){for(var n=r.value,l=[],s=S.iter(n);!s.done;s.next()){var c=s.value;l.push(this.forma.page.colorLibraryController.getTheoColorForSolidColor(c))}i.push(S.clone(l))}return i},isCurrentlyShowingMultipleColors:function(){var t;return!((t=S.as(this.forma.controller,Y.TypeLockupController))&&(!t.secondaryColorVisible()||this.targetedLockupStyle.textLook==_.LockupTextLook.KnockoutOnly||this.targetedLockupStyle.textLook==_.LockupTextLook.OutlineOnly))},getSuggestableColorPairs:function(){var t=[];if(!this.isCurrentlyShowingMultipleColors())return t;var e=this.targetedLockupStyle,o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),a=(N.ShapeLibrary.shapeDictionary[o.backing]||N.ShapeLibrary.shapeDictionary.none).filled,i=k.getBackingOpacity(o);i==_.LockupStyle.OPACITY_UNSET&&(i=k.getBackingOpacity(k.lockupStyleToLockupStyleAttributes(this.forma.style,this.forma.page.document)));var r=S.clone(this.getBaseSuggestableColors()),n=r.length;if(0==n)return t;for(var l={},s=S.toArray(S.range(0,n,!1)),c=S.clone(S.shuffle(s)),u=S.iter(this.pageData.lockups);!u.done;u.next()){var h=u.value;if(h.id!=this.forma.formaID&&"none"!=h.styleAttributes.backing){var g=this.forma.page.colorLibraryController.getSolidColorForKey(h.styleAttributes.primaryColor),p=this.forma.page.colorLibraryController.getSolidColorForKey(h.styleAttributes.secondaryColor);if(null!=g&&null!=p&&k.hasSufficientLegibilityContrast(g,p)){for(var d=-1,f=-1,y=S.iter(S.range(0,r.length,!1));!y.done;y.next()){var L=y.value;r[L].distanceTo(g)<.1&&(d=L),r[L].distanceTo(p)<.1&&(f=L)}null==l[w=S.toString(P.MathUtils.maxInt(d,f))+" "+S.toString(P.MathUtils.minInt(d,f))]&&(t.push([g,p]),l[w]=!0)}}}for(var m=S.iter(S.range(0,2,!0));!m.done;m.next()){for(var C=S.iter(c);!C.done;C.next()){d=C.value;for(var v=S.clone(S.shuffle(s)),A=S.iter(v);!A.done;A.next()){var w;if(f=A.value,t.length>=10)break;if(null==l[w=S.toString(P.MathUtils.maxInt(d,f))+" "+S.toString(P.MathUtils.minInt(d,f))]){var R=r[d],b=r[f],D=R,T=b;R.lightness<b.lightness&&(D=b,T=R);var x=[];x=this.pageData.colorsBehindSelectedLockup[0].lightness>D.lightness?[T,D]:[D,T],a&&(x=S.reverse(x));for(var I=x[0],B=!0,O=S.iter(this.pageData.colorsBehindSelectedLockup);!O.done;O.next()){var F=O.value.blend(x[1],i),E=I.distanceTo(x[1]);if(!k.hasSufficientLegibilityContrast(I,F)||E<k.kColorPairDistanceThreshold){B=!1;break}}B&&(l[w]=!0,t.push(S.clone(x)))}}if(t.length>=10)break}if(t.length>=10)break}return t},applyColors:function(t,e){var o=this.targetedLockupStyle,a=this.forma.page.colorLibraryController;if(0!=t.length){var i;if(null!=(i=S.opt(this.forma,(function(t){return t.source})))&&!this.loggedDesignIngredientColorChanged&&B.FormaSourceUtils.isDesignIngredient(i)){var r=C.BadgeFacade.getDesignIngredientIDAndType(i),n=r.id,l=r.type;S.opt(O.Host.logging,(function(t){return t.logToAnalytics(L.AnalyticsConstants.kDesignIngredientColorChanged,{contextualData1:"designIngredientId:"+n,contextualData2:"designIngredientType:"+l})})),this.loggedDesignIngredientColorChanged=!0}var s=S.clone(a.addColorsToTheme(S.clone(t),this.targetedLockupStyle!==this.forma.style?null:this.forma));if(1==t.length)this.applyColor(e,s[0]);else{var c=e==T.ColorRole.FieldPrimary?T.ColorRole.FieldSecondary:T.ColorRole.FieldPrimary;o.colors.setColorIDs([{key:e,value:s[0]},{key:c,value:s[1]}])}this.targetedLockupStyle!==this.forma.style&&(this.forma.style.colorTableBeforeChanged(),this.forma.style.colorTableAfterChanged(),this.forma.controller.styleChanged())}},applyColor:function(t,e){var o=this.targetedLockupStyle,a=k.lockupStyleToLockupStyleAttributes(o,this.forma.page.document),i=(N.ShapeLibrary.shapeDictionary[a.backing]||N.ShapeLibrary.shapeDictionary.none).filled,r=k.needsContrastingColor(a.backing,o.textLook,i),n=this.getContrastingColorKey(e,null);switch(t){case 1:a.primaryColor=e,a.secondaryColor=r?n:e;break;case 2:a.secondaryColor=e,a.primaryColor=r?n:e;break;default:return}o.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:a.primaryColor},{key:T.ColorRole.FieldSecondary,value:a.secondaryColor}])},getContrastingColorKey:function(t,e){var o,a=this.forma.page.colorLibraryController.getTheoColorForKey(t);if(null==a)return"";null!=e&&(o=this.forma.page.colorLibraryController.getTheoColorForKey(e));var i=this.forma.page.colorLibraryController,r="";if(a.isBrandkitColor())for(var n=S.clone(this.getBrandkitColorsInUse()),l=a.getBrandkitShadeRole(),s=S.iter(n);!s.done;s.next()){var c=s.value,u=c.getBrandkitShadeRole();if((null==l&&(u==K.TheoColor.SPARK_COLOR_ROLE_SHADE0||u==K.TheoColor.SPARK_COLOR_ROLE_SHADE6)||null!=l&&(u==K.TheoColor.SPARK_COLOR_ROLE_SHADE1||u==K.TheoColor.SPARK_COLOR_ROLE_SHADE5))&&c.rgbColor.distanceTo(a.rgbColor)>30&&(null==o||c.rgbColor.distanceTo(o.rgbColor)>30)){r=i.getKeyOfColorInTheme(c);break}}return""==r&&null!=a&&(r=i.setLightnessContrastColorAndReturnKey(t,a)),r},setContrastingColor:function(t,e,o,a,i){var r=t.contrastWithColor(e),n=A.ColorLibraryController.getBackgroundContrastKey(a);return this.forma.page.colorLibraryController.setTheoColorToLibrary(K.TheoColor.init_5344(r,null,null),n),i.colors.setColorIDs([{key:o,value:n}]),n},backgroundContrastCheck:function(t){void 0===t&&(t=!0),0==this.hasScoresForAttributes&&this.updateScoring();var e=this.targetedLockupStyle,o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),a=N.ShapeLibrary.shapeDictionary[o.backing],i=S.count(e.characterStyles)>0;if(null!=a){var r=a.filled;if(!r||e.textLook==_.LockupTextLook.KnockoutOnly||i){for(var n,l,s=e.textLook==_.LockupTextLook.KnockoutOnly,c=e.strokeWeight>.15,u=s||c?T.ColorRole.FieldSecondary:T.ColorRole.FieldPrimary,h=!1,g=S.iter(this.forma.style.characterStyles);!g.done;g.next())(L=g.value).colors.colorID(u)==e.colors.colorID(u)&&(h=!0);if((n=S.as(this.forma.controller,Y.TypeLockupController))&&(l=n.getBackgroundColor())){var p=e.colors.color(u);if(null!=p&&!p.contrasts(l,t)){var d=this.getContrastingColorKey(e.colors.colorID(u),null);e.colors.setColorId(u,d),this.forma.controller.styleChanged()}if(i&&!h)for(var f=S.iter(this.forma.style.characterStyles);!f.done;f.next()){var y,L=f.value;if(y=r?e.colors.color(T.ColorRole.FieldSecondary):l){var m=L.colors.color(u);if(null!=m&&!m.contrasts(y,t)){var C=L.colors.colorID(u);d=this.getContrastingColorKey(C,null),L.colors.setColorId(u,d)}}}}}}else v.CoreAssert.fail("shape is not set up in ShapeLibrary.shapeDictionary","LockupStyleController.backgroundContrastCheck","LockupStyleController.swift",3841)},shuffleColorAssignment:function(){this.updateScoring();var t=S.as(this.forma.controller,Y.TypeLockupController);null!=t&&t.beginBlockedUpdate();var e=this.targetedLockupStyle,o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),a=_.LockupStyle.isOutlineLook(e.textLook)||_.LockupStyle.isShadowLook(e.textLook),i=!1;a||(i=N.ShapeLibrary.shapeDictionary[o.backing].filled),("none"!=o.backing||a)&&(o.secondaryColor=this.profilingBackgroundColorSelector.selectColorForGlobalRecolor(!0));var r,n=null;(i||a)&&(r=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor))&&(n=S.clone(b.ColorForComparison.init_c063(r,a?.7:1)));var l=!i;l&&this.pageData.lockups.length<=2?o.primaryColor=this.profilingPrimaryColorSelector.selectColorForIndividualRecolor(l,S.clone(n),!1):o.primaryColor=this.profilingPrimaryColorSelector.selectColorForGlobalRecolor(l,S.clone(n),!0),this.setSecondaryMultiStyleLockupColors(e,o),e.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:o.primaryColor},{key:T.ColorRole.FieldSecondary,value:o.secondaryColor}]),null!=t&&t.endBlockedUpdate(),this.forma.controller.styleChanged()},shuffleMultiStyleLockupColors:function(){this.pageData=new k.InterestingPageData(this.forma),this.profilingPrimaryColorSelector.updateBackgroundColors(S.clone(this.pageData.colorsBehindSelectedLockup)),this.profilingBackgroundColorSelector.updateBackgroundColors(S.clone(this.pageData.colorsBehindSelectedLockup));var t=this.targetedLockupStyle,e=k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document);this.setSecondaryMultiStyleLockupColors(t,e)},setSecondaryMultiStyleLockupColors:function(t,e,o){void 0===o&&(o=!0);for(var a=S.iter(t.characterStyles);!a.done;a.next()){var i=a.value,r=S.eq(M._equality_SolidColor_SolidColor,t.colors.fieldPrimary,t.colors.fieldSecondary);if(i.backing!=_.LockupBacking.None&&i.backing!=_.LockupBacking.UNSET&&!r&&S.eq(M._equality_SolidColor_SolidColor,i.colors.fieldPrimary,t.colors.fieldSecondary)&&S.eq(M._equality_SolidColor_SolidColor,i.colors.fieldSecondary,t.colors.fieldPrimary)&&o)i.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:e.secondaryColor},{key:T.ColorRole.FieldSecondary,value:e.primaryColor}]);else{for(var n=S.clone(this.getStylePrimarySecondaryColorForMSL(e,i,!0)),l=S.iter(S.range(0,5,!0));!l.done&&n[0]==n[1];l.next())n=S.clone(this.getStylePrimarySecondaryColorForMSL(e,i,!0));i.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:n[0]},{key:T.ColorRole.FieldSecondary,value:n[1]}])}}},getStylePrimarySecondaryColor:function(t){var e=t.clone();e.secondaryColor=this.secondaryColorSelector.select(e,!1,!0,!1,!1),e.primaryColor=this.primaryColorSelector.select(e,!1,!0,!1,!1);for(var o=S.iter(S.range(0,5,!0));!o.done&&e.primaryColor==e.secondaryColor;o.next())e.secondaryColor=this.secondaryColorSelector.select(e,!1,!0,!1,!1),e.primaryColor=this.primaryColorSelector.select(e,!1,!0,!1,!1);return[e.primaryColor,e.secondaryColor]},getStylePrimarySecondaryColorForMSL:function(t,e,o){var a,i=this.secondaryColorSelector.select(t,!0,!1,!0,o),r=!0;if(e.backing!=_.LockupBacking.None||_.LockupStyle.isOutlineLook(e.textLook)||_.LockupStyle.isShadowLook(e.textLook)){var n=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document);n.secondaryColor=i,a=this.primaryColorSelector.select(n,!0,!1,!1,o)}else r=!1,a=this.primaryColorSelector.select(t,!1,!1,!0,o);var l,s,c=(new U.ProfilingColorMap).overridePaletteMappingDueToContrast(i,this.forma.formaID+U.ProfilingColorMap.lockupMSLBackingColorKey),u=(new U.ProfilingColorMap).overridePaletteMappingDueToContrast(a,this.forma.formaID+U.ProfilingColorMap.lockupMSLPrimaryColorKey);return(l=this.forma.page.colorLibraryController.getSolidColorForKey(u))&&(s=this.forma.page.colorLibraryController.getSolidColorForKey(c))&&(r&&!s.contrasts(l)||(i=c,a=u)),[a,i]},generateAndApplyInitialStyleAttributes:function(){0==this.hasScoresForAttributes&&this.updateScoring();for(var t=this.forma.style,e=k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),o=["Lato-Light","Lora-Regular","Montserrat-Regular","PlayfairDisplay-Regular","CantataOne-Regular","FuturaPT-Medium"],a=["square_001","row"],i=o[R.CoreRandom.nextIntUniform(o.length)],r=O.Host.fontProvider.getIncludedFonts(this.forma.page.document),n=S.iter(S.range(0,r.count,!1));!n.done;n.next()){var l=n.value;S.opt(r.fontAt(l),(function(t){return t.postScriptName==i}))&&(e.font=l)}e.layout=this.layoutSelector.select(e,!1,!1,!1,!1),"fill"!=e.layout&&"right"!=e.layout||(e.layout="center");var s=R.CoreRandom.nextIntUniform(a.length);e.backing=a[s],e.padding=0,"row"==e.backing&&(e.spacing=1,e.padding=.33),e.textOpacity=1,e.backingOpacity=1,e=this.setNewStyleColors(e,t);var c=k.lockupStyleAttributesToLockupStyle(e,this.forma.style,this.forma.page.document);this.forma.applyStyle(c)},setNewStyleColors:function(t,e){var o,a=t.clone(),i=N.ShapeLibrary.shapeDictionary[a.backing].filled,r=_.LockupStyle.isOutlineLook(e.textLook)||_.LockupStyle.isShadowLook(e.textLook),n=null,l=!i;return("none"!=a.backing||r)&&(a.secondaryColor=this.profilingBackgroundColorSelector.selectColorForGlobalRecolor(!0,void 0,!0),(o=this.forma.page.colorLibraryController.getSolidColorForKey(a.secondaryColor))&&(n=S.clone(b.ColorForComparison.init_c063(o,r?.7:1)))),a.primaryColor=this.profilingPrimaryColorSelector.selectColorForIndividualRecolor(l,S.clone(n),!0),a},getNewStyleAttributes:function(t,e,o){void 0===t&&(t=!0),0==this.hasScoresForAttributes&&this.updateScoring();var a,i,r=this.forma.style,n=k.lockupStyleToLockupStyleAttributes(r,this.forma.page.document);return n.font=this.fontSelector.select(n,!1,t,!1,!1),n.layout=this.layoutSelector.select(n,!1,t,!1,!1),n.backing=this.backingSelector.select(n,!1,t,!1,!1),o||(n.secondaryColor=this.secondaryColorSelector.select(n,!1,t,!1,!1),n.primaryColor=this.primaryColorSelector.select(n,!1,t,!1,!1),this.setSecondaryMultiStyleLockupColors(r,n,!1)),n.shadowAngle=this.shadowAngleSelector.select(n,!1,t,!1,!1),n.spacing=this.spacingSelector.select(n,!1,t,!1,!1),n.wheelUsed=!0,o?(a=k.lockupStyleAttributesToLockupStyle(n,r,this.forma.page.document),a=this.updateLockupStyleWithNewColors(a),(i=e)&&(a=i.lockupStyleEvaluator.styleEvaluatedWithReadability(a))):(a=k.lockupStyleAttributesToLockupStyle(n,r,this.forma.page.document),(i=e)&&i.lockupStyleEvaluator.initializeReadabilityInformation(a)),a},evaluateLockupStyleWithReadability:function(t){return new W.LockupStyleEvaluator(this.forma).styleEvaluatedWithReadability(t)},updateLockupStyleWithNewColors:function(t){(new U.ProfilingColorMap).eraseCurrentPaletteMappingDictionary();var e=k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),o=S.clone(this.getStylePrimarySecondaryColor(e));return e.primaryColor=o[0],e.secondaryColor=o[1],t.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:o[0]},{key:T.ColorRole.FieldSecondary,value:o[1]}]),this.setSecondaryMultiStyleLockupColors(t,e,!1),t},updateOpacityAttributes:function(t,e){var o=(N.ShapeLibrary.shapeDictionary[e.backing]||N.ShapeLibrary.shapeDictionary.none).filled,a=e.clone();return a.opacity="useLockupOpacities",o?(k.getTextLook(a)==_.LockupTextLook.KnockoutAndOutline?a.textOpacity=t:a.textOpacity=1,a.backingOpacity=t):(a.textOpacity=t,a.backingOpacity=t),a},setOpacity:function(t){var e=this.targetedLockupStyle,o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),a=this.updateOpacityAttributes(t,o);this.targetedLockupStyle===this.forma.style?this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(a,this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.opacityRule=_.OpacityRule.UseLockupOpacities,this.targetedLockupStyle.textOpacity=a.textOpacity,this.targetedLockupStyle.backingOpacity=a.backingOpacity,this.forma.controller.styleChanged())},getOpacityValue:function(){return this.targetedLockupStyle.opacityRule!=_.OpacityRule.UNSET?this.targetedLockupStyle.currentBackingOpacity:this.forma.style.currentBackingOpacity},hasSpacingOptions:function(){var t,e;return!(!(t=S.opt(S.opt(this.forma,(function(t){return t.controller})),(function(t){return t.enableChildMove})))&&null==t||!t||this.targetedLockupStyle!==this.forma.style||!(e=S.as(this.forma.controller,Y.TypeLockupController))||!(e.numLines()>1||0==e.numLines()))},hasPaddingOptions:function(){var t;if(!(t=S.opt(S.opt(this.forma,(function(t){return t.controller})),(function(t){return t.enableChildMove})))&&null==t||!t)return!1;var e=this.targetedLockupStyle;return e.backing!=_.LockupBacking.None&&e.backing!=_.LockupBacking.Knockout&&e.backing!=_.LockupBacking.UNSET},areSpacingAndPaddingOptionsAvailable:function(){return this.hasSpacingOptions()||this.hasPaddingOptions()},setNextSpacingAndPaddingOption:function(){var t,e;if(this.targetedLockupStyle===this.forma.style){var o=this.hasPaddingOptions(),a=this.hasSpacingOptions();if(o||a){var i=this.forma.style,r=k.lockupStyleToLockupStyleAttributes(i,this.forma.page.document),n=k.ALLOWED_PADDING_VALUES.length,l=k.ALLOWED_SPACING_VALUES.length,s=n*l,c=(t=S.indexOf(k.ALLOWED_PADDING_VALUES,r.padding))||null!=t?t:0,u=(e=S.indexOf(k.ALLOWED_SPACING_VALUES,r.spacing))||null!=e?e:0,h=(o?u*n+c:c*l+u)+1;h%=s;var g=o?S.toInt(h/n):h%l,p=o?h%n:S.toInt(h/l);r.padding=k.ALLOWED_PADDING_VALUES[p],r.spacing=k.ALLOWED_SPACING_VALUES[g],this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(r,this.forma.style,this.forma.page.document))}}else this.setNextPaddingOption()},setNextSpacingOption:function(){var t,e=this.forma.style,o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),a=((t=S.indexOf(k.ALLOWED_SPACING_VALUES,o.spacing))||null!=t?t:0)+1;a>=k.ALLOWED_SPACING_VALUES.length&&(a=0),o.spacing=k.ALLOWED_SPACING_VALUES[a],this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document))},setSpacingFromSlider:function(t){this.setSpacing(z.TheoDocumentUtils.sliderToSpacingPaddingMapping(t))},setSpacing:function(t){var e,o=this.forma.style,a=k.lockupStyleToLockupStyleAttributes(o,this.forma.page.document),i=((e=S.indexOf(k.ALLOWED_SPACING_VALUES,a.spacing))||null!=e?e:0)+1;i>=k.ALLOWED_SPACING_VALUES.length&&(i=0),a.spacing=t,this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(a,this.forma.style,this.forma.page.document))},setNextPaddingOption:function(){var t;if(this.hasPaddingOptions()){var e=this.targetedLockupStyle;this.targetedLockupStyle!=this.forma.style&&this.targetedLockupStyle.backing==_.LockupBacking.Rows&&this.forma.style.backing==_.LockupBacking.Rows&&(e=this.forma.style);var o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),a=((t=S.indexOf(k.ALLOWED_PADDING_VALUES,o.padding))||null!=t?t:0)+1;a>=k.ALLOWED_PADDING_VALUES.length&&(a=0),o.padding=k.ALLOWED_PADDING_VALUES[a],e===this.forma.style?this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.padding=o.padding,this.forma.controller.styleChanged())}},setPaddingFromSlider:function(t){this.setPadding(z.TheoDocumentUtils.sliderToSpacingPaddingMapping(t))},setPadding:function(t){if(this.hasPaddingOptions()){var e=this.targetedLockupStyle;this.targetedLockupStyle!=this.forma.style&&this.targetedLockupStyle.backing==_.LockupBacking.Rows&&this.forma.style.backing==_.LockupBacking.Rows&&(e=this.forma.style);var o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document);o.padding=t,e===this.forma.style?this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.padding=o.padding,this.forma.controller.styleChanged())}},setNextTrackingOption:function(){var t=this.forma.style,e=k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document);e.tracking+=.2,e.tracking>.9&&(e.tracking=0),this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(e,this.forma.style,this.forma.page.document))},setTrackingFromSlider:function(t){var e;if(e=S.as(S.opt(this.forma,(function(t){return t.controller})),Y.TypeLockupController)){var o=e.getCurrentFontSize();this.targetedLockupStyle.tracking=t;var a=S.opt(e.getPin(!0,!0),(function(t){return t.pinPoint}))||q.TheoPoint.ZERO;e.setSizeSliderValue(o,[],a)}},setNextShadowAngle:function(){var t;if(_.LockupStyle.isShadowLook(this.targetedLockupStyle.textLook)){var e=this.forma.style,o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),a=((t=S.indexOf(k.ALLOWED_SHADOWANGLE_VALUES,o.shadowAngle))||null!=t?t:0)+1;a>=k.ALLOWED_SHADOWANGLE_VALUES.length&&(a=0),o.shadowAngle=k.ALLOWED_SHADOWANGLE_VALUES[a],this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document))}},legacyColorConversion:function(){if(null==this.forma)return O.Host.logging.info("forma has been de-alloc'd"),void v.CoreAssert.isTrue(!1,void 0,"LockupStyleController.legacyColorConversion","LockupStyleController.swift",4581);for(var t=this.forma.style,e=[T.ColorRole.FieldPrimary,T.ColorRole.FieldSecondary],o=S.iter(e);!o.done;o.next()){var a=o.value,i=t.colors.color(a),r=t.colors.colorID(a),n=null!=r&&A.ColorLibraryController.keyFromImage(r);if(null!=i&&null==r||n){var l=this.forma.page.colorLibraryController.addUnlinkedColor(i);t.colors.setColorId(a,l)}}},onTrackingChanged:function(){var t;(t=S.as(S.opt(this.forma,(function(t){return t.style})),_.LockupStyle))&&this._sessionAttrs.setTracking(t.tracking,t.layout)},onSpacingChanged:function(){var t;(t=S.as(S.opt(this.forma,(function(t){return t.style})),_.LockupStyle))&&this._sessionAttrs.setSpacing(t.spacing,t.layout)},onBackingShapeChanged:function(){var t;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),_.LockupStyle)){var e=k.getBackingStringForBackingEnumAndArtworkId(t.backing,t.backingArtworkID);this._sessionAttrs.setBackingShape(e,t.layout,t.pathID)}},onLayoutChanged:function(t){var e=t.layout,o=t.pathID,a=this.forma.style,i=a.layout,r=a.pathID;if(this._sessionAttrs.needsUpdate(e,o,i,r)){var n,l;this._sessionAttrs.setTracking(a.tracking,e),this._sessionAttrs.setSpacing(a.spacing,e),null!=(n=this._sessionAttrs.getTracking(i))&&(a.tracking=n),null!=(l=this._sessionAttrs.getSpacing(i))&&(a.spacing=l);var s=k.getBackingStringForBackingEnumAndArtworkId(a.backing,a.backingArtworkID);this._sessionAttrs.recordInitialBackingShape(s,e,o);for(var c=!1,u=S.iter(this._sessionAttrs.getPotentialBackingShapes(i,r,s));!u.done;u.next()){var h=u.value,g=k.getBackingEnumAndArtworkIdForBackingString(h),p=g.backing,d=g.artworkID;if(N.ShapeLibrary.isBackingShapeStyleCompatible(a,p,d)){a.backing=p,a.backingArtworkID=d,c=!0;break}}c||(a.backing=_.LockupBacking.None,a.backingArtworkID=null)}},endSession:function(){this._sessionAttrs.reset()}}}),f),k.SessionAttrs=(y=function(){this._attrsDict={},this._hasBackingShapeEntry=!1,this.reset()},S.defineClass({name:"SessionAttrs",ctor:y,statics:{TRACKING_KEY:"tracking",SPACING_KEY:"spacing",BACKING_KEY:"backing"},props:{reset:function(){this._attrsDict={},this._hasBackingShapeEntry=!1,this.setTracking(0,_.LockupLayout.Standard),this.setSpacing(.35,_.LockupLayout.Standard),this.setTracking(.35,_.LockupLayout.LetterGrid),this.setSpacing(.35,_.LockupLayout.LetterGrid),this.setTracking(.15,_.LockupLayout.Path),this.setSpacing(.35,_.LockupLayout.Path),this.setTracking(0,_.LockupLayout.Auto),this.setSpacing(.35,_.LockupLayout.Auto)},needsUpdate:function(t,e,o,a){return this.getLayoutClass("",t,e)!=this.getLayoutClass("",o,a)},getTracking:function(t){return S.as(this._attrsDict[this.getSessionAttrsKey(y.TRACKING_KEY,t)],"Double")},setTracking:function(t,e){this._attrsDict[this.getSessionAttrsKey(y.TRACKING_KEY,e)]=t},getSpacing:function(t){return S.as(this._attrsDict[this.getSessionAttrsKey(y.SPACING_KEY,t)],"Double")},setSpacing:function(t,e){this._attrsDict[this.getSessionAttrsKey(y.SPACING_KEY,e)]=t},getBackingShape:function(t,e,o){return void 0===o&&(o=null),S.as(this._attrsDict[this.getSessionAttrsKey(y.BACKING_KEY,e,o)],"String")},setBackingShape:function(t,e,o){void 0===o&&(o=null),this._attrsDict[this.getSessionAttrsKey(y.BACKING_KEY,e,o)]=t,this._hasBackingShapeEntry=!0},recordInitialBackingShape:function(t,e,o){void 0===o&&(o=null),this._hasBackingShapeEntry||this.setBackingShape(t,e,o)},getPotentialBackingShapes:function(t,e,o){void 0===e&&(e=null);for(var a=this,i=[],r=[],n=S.iter(this._attrsDict);!n.done;n.next()){var l=n.key,s=n.value;l.includes(y.BACKING_KEY)&&(S.as(s,"String")==o?i.push(o):r.push(l))}return S.sortInPlace(r,(function(o,i){return a.getBackingShapeKeyDistance(o,t,e)<a.getBackingShapeKeyDistance(i,t,e)})),i.concat(r.map((function(t){return a._attrsDict[t]}),this))},getBackingShapeKeyDistance:function(t,e,o){var a;if(void 0===o&&(o=null),null!=(a=this.extractLayoutClass(y.BACKING_KEY,t))){var i=this.getLayoutClass(y.BACKING_KEY,e,o);return a==i?0:a==k.LayoutClass.PathDefault&&i==k.LayoutClass.PathAsymmetric||a==k.LayoutClass.PathAsymmetric&&i==k.LayoutClass.PathDefault?1:a==k.LayoutClass.Default?2:3+i}return 1e4},getLayoutClass:function(t,e,o){var a;return void 0===o&&(o=null),_.LockupStyle.isLetterGrid(e)?k.LayoutClass.LetterGrid:_.LockupStyle.isAutoLayout(e)?k.LayoutClass.Auto:_.LockupStyle.isPath(e)?t==y.SPACING_KEY||t==y.TRACKING_KEY?k.LayoutClass.PathDefault:X.TextPathLibrary.isPathSymmetric((a=o)||null!=a?a:X.TextPathID.Circle)?k.LayoutClass.PathDefault:k.LayoutClass.PathAsymmetric:k.LayoutClass.Default},extractLayoutClass:function(t,e){if(e.startsWith(t)){var o,a=e.substr(t.length);if(null!=(o=S.toInt(a)))return k.LayoutClass.toCaseValue(o)}return null},getSessionAttrsKey:function(t,e,o){return void 0===o&&(o=null),t+this.getLayoutClass(t,e,o)}}}),y),k.LayoutClass=S.defineEnum("LayoutClass",{Default:0,LetterGrid:1,PathDefault:2,PathAsymmetric:3,Auto:4})},UB0O:function(t,e,o){var a,i=e,r=o("oAGj"),n=o("SpAV"),l=o("cEEQ"),s=o("9kak"),c=o("c+uM"),u=o("GFAD"),h=o("tGKA"),g=o("8t9B"),p=o("3UhB"),d=o("uUew"),f=o("1NAc");i.EvenRowWidthsLayoutStrategy=(a=function(){this.paddingScalar=.6,this.spacingScalar=.75,l.BaseLockupLayoutStrategy.call(this)},r.defineClass({name:"EvenRowWidthsLayoutStrategy",ctor:a,superName:"BaseLockupLayoutStrategy",statics:{getCombinedAspectOfAllRows:function(t,e){for(var o=0,a=r.iter(t);!a.done;a.next())o+=1/a.value.aspectRatio;return e>0?1/(r.toDouble(t.length-1)*(1/e)+o):1/o},getCombinedAspectOfAllRowsFinal:function(t,e){for(var o=0,a=r.iter(t);!a.done;a.next()){var i=a.value,n=i.rowHeightAdjustRatio<1?i.rowHeightAdjustRatio:1;o+=1/i.aspectRatio*(n*n)}return 0!=e?1/(r.toDouble(t.length-1)*(1/e)+o):1/o},getAverageRowAspect:function(t){for(var e=0,o=r.iter(r.range(0,t.length,!1).reversed());!o.done;o.next())e+=t[o.value].aspectRatio;return e/r.toDouble(t.length)},getTallestRowPairIndex:function(t){for(var e=5e3,o=t.length,a=null,i=r.iter(r.range(0,o-1,!1));!i.done;i.next()){var n=i.value,l=t[n];if(l.appendable){var s=t[n+1],c=l.aspectRatio+s.aspectRatio;c<e&&(e=c,a=n)}}return a},aspectDifference:function(t,e){return 1/(1/t-1/e)},aspectStacked:function(t,e){return 1/(1/t+1/e)},mergeRows:function(t,e,o){var a=r.clone(t);n.CoreAssert.isTrue(e<o,void 0,"EvenRowWidthsLayoutStrategy.mergeRows","EvenRowWidthsLayoutStrategy.swift",592);var i=a[e].words.concat(a[o].words),l=new s.LockupRowInfo(r.clone(i),a[o].appendable);return a.splice(o,1),a.splice(e,1),a.splice(e,0,l),a},mergeAutoRows:function(t,e,o,i,n,l){for(var s=r.clone(a.mergeRows(r.clone(t),e,o)),c=l==g.HighlightMethod.EvenRows?0:1,u=0,h=r.iter(r.range(0,s.length,!1));!h.done;h.next()){for(var p=h.value,d=0,f=r.iter(r.range(0,s[p].words.length,!1));!f.done;f.next()){for(var y=f.value;i[u].isNewLine;)u+=1;var k=p%2==c?n[u]:i[u];s[p].words[y]=k,d+=k.aspectRatio,y-1>=0&&(d+=s[p].words[y-1].spaceAspectRatio),u+=1}s[p].aspectRatio=d}return s},compactRowsIntoAspect:function(t,e,o){var i=t.length;if(i<=1)return t;var n=a.getCombinedAspectOfAllRows(r.clone(t),0),l=a.getTallestRowPairIndex(r.clone(t));if(null==l)return t;for(var s=l+1,c=t[l],h=t[s],g=c.aspectRatio,p=h.aspectRatio,d=g+p,f=0,y=0,k=r.iter(r.toSequence(t));!k.done;k.next()){var S=k.value,L=S.offset,m=S.element;f+=m.aspectRatio,L==l?y+=d:L!=s&&(y+=m.aspectRatio)}var C=f/r.toDouble(i),v=y/r.toDouble(i)/o,A=C/o/r.toDouble(i-1),w=v/r.toDouble(i-2),R=a.aspectStacked(a.aspectDifference(n,a.aspectStacked(p,g)),d),b=a.aspectStacked(w,R),D=a.aspectStacked(A,n);if(u.LockupUtils.percentageDiff(e,D)<=u.LockupUtils.percentageDiff(e,b))return t;var T=r.clone(a.mergeRows(r.clone(t),l,s));return a.compactRowsIntoAspect(r.clone(T),e,o)},compactAutoRowsIntoAspect:function(t,e,o,i,n,l){var s=t.length;if(s<=1)return t;var c=a.getCombinedAspectOfAllRows(r.clone(t),0),h=a.getTallestRowPairIndex(r.clone(t));if(null==h)return t;for(var g=h+1,p=t[h],d=t[g],f=p.aspectRatio,y=d.aspectRatio,k=f+y,S=0,L=0,m=r.iter(r.toSequence(t));!m.done;m.next()){var C=m.value,v=C.offset,A=C.element;S+=A.aspectRatio,v==h?L+=k:v!=g&&(L+=A.aspectRatio)}var w=S/r.toDouble(s),R=L/r.toDouble(s)/o,b=w/o/r.toDouble(s-1),D=R/r.toDouble(s-2),T=a.aspectStacked(a.aspectDifference(c,a.aspectStacked(y,f)),k),x=a.aspectStacked(D,T),I=a.aspectStacked(b,c);if(u.LockupUtils.percentageDiff(e,I)<=u.LockupUtils.percentageDiff(e,x))return t;var B=r.clone(a.mergeAutoRows(r.clone(t),h,g,r.clone(i),r.clone(n),l));return a.compactAutoRowsIntoAspect(r.clone(B),e,o,r.clone(i),r.clone(n),l)},getOptimalCompactedAutoRows:function(t,e,o,i,n,l){var s=t.length;if(s<=1)return t;var c=a.getCombinedAspectOfAllRows(r.clone(t),0),h=a.getTallestRowPairIndex(r.clone(t));if(null==h)return t;for(var g=h+1,p=t[h],d=t[g],f=p.aspectRatio,y=d.aspectRatio,k=f+y,S=0,L=0,m=r.iter(r.toSequence(t));!m.done;m.next()){var C=m.value,v=C.offset,A=C.element;S+=A.aspectRatio,v==h?L+=k:v!=g&&(L+=A.aspectRatio)}var w=S/r.toDouble(s),R=L/r.toDouble(s)/n,b=w/n/r.toDouble(s-1),D=R/r.toDouble(s-2),T=a.aspectStacked(a.aspectDifference(c,a.aspectStacked(y,f)),k),x=a.aspectStacked(D,T),I=a.aspectStacked(b,c);if(u.LockupUtils.percentageDiff(i,I)<=u.LockupUtils.percentageDiff(i,x))return t;var B=r.clone(a.mergeAutoRows(r.clone(t),h,g,r.clone(e),r.clone(o),l));return a.compactAutoRowsIntoAspect(r.clone(B),i,n,r.clone(e),r.clone(o),l)},_implements:function(t){return"LockupLayoutStrategy"==t}},props:{supportsConfiguration:function(t){return t.style.layout==c.LockupLayout.FitJustified},layout:function(t){var e=t.text,o=t.style.font.fontData,i=t.containerSize,s=i.width,u=i.height,y=t.style,k=y.spacing*this.spacingScalar,S=s,L=u,m=S/L,C=r.clone(t.characterStyleRanges);y.alignment!=c.LockupAlignment.UNSET&&n.CoreAssert.warning("Unexpected alignment "+y.alignment+" for fit-justified text");var v=o.allCapsAllowed?e.toUpperCase():e,A=l.getTypographicBoundingRatiosOfString(v,o),w=g.TypeLockupController.HIGHLIGHT_STYLE,R=r.opt(r.opt(y.characterStyles[w],(function(t){return t.font})),(function(t){return t.fontData})),b=p.TypeLockupUtils.getCharFontAdjust(y,A.hasUppercase),D=!1;t.characterStyleRanges.length>0&&null!=y.characterStyles[w]&&-1!=y.characterStyles[w].spacing&&0!=y.characterStyles[w].spacing&&y.characterStyles[w].spacing>1&&((y=t.style.clone()).characterStyles[w].spacing=b,C=r.clone(p.TypeLockupUtils.invertRanges(r.clone(t.characterStyleRanges),e.length)),D=!0,null!=R&&(R=o,o=y.characterStyles[w].font.fontData,y.characterStyles[w].font=y.font));for(var T=r.clone(p.TypeLockupUtils.computeLockupMeasurements(v,o,A.heightRatio,o.allCapsAllowed,t.forceLetterForma,y.tracking,r.clone(C),r.clone(y.characterStyles),b,t.forceLetterForma)),x=r.clone(this.getUncompactedRows(r.clone(T),!1)),I=r.clone(a.compactRowsIntoAspect(r.clone(x),m,k)),B=0,O=r.iter(T);!O.done;O.next())B+=(ct=O.value).isNewLine?0:1;if(null!=t.rowWordLengths&&t.rowWordLengths.reduce((function(t,e){return t+e}),0)==B&&(!t.allowFewerLineBreaks||I.length>=t.rowWordLengths.length)&&(I=r.clone(this.getPrecomputedRows(r.clone(T),r.clone(t.rowWordLengths)))),T.length>1&&(t.highlightMethod==g.HighlightMethod.EvenRows||t.highlightMethod==g.HighlightMethod.OddRows)&&""!=w&&null!=y.characterStyles[w]&&null!=R){var F=r.clone(p.TypeLockupUtils.computeLockupMeasurements(v,o,A.heightRatio,o.allCapsAllowed,!1,y.tracking,r.clone([]),r.clone({}))),E=[new d.TextRange(0,r.chars(e).length)],_=r.clone(p.TypeLockupUtils.computeLockupMeasurements(v,R,A.heightRatio,o.allCapsAllowed,!1,y.tracking,r.clone(E),r.clone(y.characterStyles),b)),W=r.clone(this.getUncompactedAutoRows(r.clone(F),r.clone(_),!1,t.highlightMethod));I=r.clone(a.getOptimalCompactedAutoRows(r.clone(W),r.clone(F),r.clone(_),m,k,t.highlightMethod))}if(0==I.length)return new l.LayoutResults([],new f.TheoSize(0,0),h.Matrix2D.Identity,A,0);var P=a.getAverageRowAspect(r.clone(I)),U=P/k,M=a.getCombinedAspectOfAllRowsFinal(r.clone(I),U);M<m?S=L*M:L=S/M;for(var N=S/U,H=L,V=S,G=0,K=0,z=[],Y=r.iter(r.range(0,I.length,!1));!Y.done;Y.next()){var j=Y.value,q=I[j],X=q.rowHeightAdjustRatio<1?q.rowHeightAdjustRatio:1,J=S/(isFinite(q.aspectRatio)?q.aspectRatio:1)*X,Q=l.getTypographicBoundingRatiosOfString(q.text,o);K=0,X<1&&(K+=(S-q.aspectRatio*J)/2);for(var Z=J/A.heightRatio,$=Z*b,tt=Z*o.capRatio,et=A.textVerticalOffsetRatio,ot=A.heightRatio,at=Q.textVerticalOffsetRatio,it=et-(ot/2-Q.heightRatio/2)-at,rt=p.TypeLockupUtils.getCharFontYAdjust(y,Z,$),nt=(A.textVerticalOffsetRatio-o.capRatio-it)*Z,lt=G+0,st=r.iter(r.range(0,q.words.length,!1));!st.done;st.next()){var ct,ut=st.value,ht=(ct=q.words[ut]).aspectRatio*J,gt=ct.spaceAspectRatio*J,pt=K,dt=o.allCapsAllowed?ct.text.toUpperCase():ct.text,ft=r.isEmpty(ct.characterStyle)?Z:$,yt=r.isEmpty(ct.characterStyle)||1!=X?0:rt,kt=r.isEmpty(ct.characterStyle)?null:ct.characterStyle;D&&(kt=r.isEmpty(ct.characterStyle)?w:null);var St=l.LockupItem.init_38d4(!0,kt,new f.TheoSize(ht,tt),h.Matrix2D.translationXY(pt,lt+nt+yt),dt,r.isEmpty(ct.characterStyle)?o:R||o,ft,Z,Q,j,ct.rangeInLockup);z.push(St),K+=ht+gt}G+=X<1?$*A.heightRatio+N:J+N}return new l.LayoutResults(r.clone(z),new f.TheoSize(V,H),h.Matrix2D.translationXY(0,0),A,P)},calculateTracking:function(t,e){var o=t.text,i=t.style.font.fontData,n=t.containerSize,s=n.width,c=n.height,u=t.style,h=u.spacing*this.spacingScalar,f=c,y=i.allCapsAllowed?o.toUpperCase():o,k=l.getTypographicBoundingRatiosOfString(y,i),S=0,L=g.TypeLockupController.HIGHLIGHT_STYLE,m=r.opt(r.opt(u.characterStyles[L],(function(t){return t.font})),(function(t){return t.fontData})),C=1;null!=m&&(C=k.hasUppercase?i.capRatio/m.capRatio:i.meanRatio/m.meanRatio);var v=r.clone(p.TypeLockupUtils.computeLockupMeasurements(y,i,k.heightRatio,!1,!0,u.tracking,r.clone(t.characterStyleRanges),r.clone(u.characterStyles),C,t.forceLetterForma));if(0==v.length)return t.style.tracking;var A=r.clone(this.getUncompactedRows(r.clone(v),!1)),w=e.width/e.height,R=r.clone(a.compactRowsIntoAspect(r.clone(A),w,h));if(v.length>1&&(t.highlightMethod==g.HighlightMethod.EvenRows||t.highlightMethod==g.HighlightMethod.OddRows)&&""!=L&&null!=u.characterStyles[L]&&null!=m){var b=r.clone(p.TypeLockupUtils.computeLockupMeasurements(y,i,k.heightRatio,i.allCapsAllowed,!0,u.tracking,r.clone([]),r.clone({}),void 0,t.forceLetterForma)),D=[new d.TextRange(0,r.chars(o).length)],T=r.clone(p.TypeLockupUtils.computeLockupMeasurements(y,m,k.heightRatio,i.allCapsAllowed,!0,u.tracking,r.clone(D),r.clone(u.characterStyles),C,t.forceLetterForma)),x=r.clone(this.getUncompactedAutoRows(r.clone(b),r.clone(T),!1,t.highlightMethod));R=r.clone(a.getOptimalCompactedAutoRows(r.clone(x),r.clone(b),r.clone(T),w,h,t.highlightMethod))}if(0==R.length)return t.style.tracking;if(u.tracking>0)for(var I=r.iter(r.range(0,R.length,!1));!I.done;I.next()){var B=I.value;R[B].aspectRatio=0;for(var O=r.iter(r.range(0,R[B].words.length,!1));!O.done;O.next()){var F=O.value;R[B].aspectRatio+=R[B].words[F].aspectRatio,R[B].words[F].canBreak&&F!=R[B].words.length-1?(R[B].words[F].spaceAspectRatio=i.spaceWidthRatio/k.heightRatio,R[B].aspectRatio+=R[B].words[F].spaceAspectRatio):R[B].words[F].spaceAspectRatio=0}}var E=a.getAverageRowAspect(r.clone(R))/h,_=f*a.getCombinedAspectOfAllRows(r.clone(R),E)/(isFinite(R[0].aspectRatio)?R[0].aspectRatio:1),W=R[0].aspectRatio*_;if(W<s)if(R[0].words.length<=1)S=0;else{var P=(s-W)/r.toDouble(R[0].words.length-1);S=P<1?0:P/(_/k.heightRatio)}else S=-W;return S},calculateLeading:function(t,e){var o=t.text,i=t.style.font.fontData,n=t.containerSize,s=n.width,c=n.height,u=t.style,h=0,f=i.allCapsAllowed?o.toUpperCase():o,y=l.getTypographicBoundingRatiosOfString(f,i),k=u.tracking,S=g.TypeLockupController.HIGHLIGHT_STYLE,L=r.opt(r.opt(u.characterStyles[S],(function(t){return t.font})),(function(t){return t.fontData})),m=1;null!=L&&(m=y.hasUppercase?i.capRatio/L.capRatio:i.meanRatio/L.meanRatio);var C=r.clone(p.TypeLockupUtils.computeLockupMeasurements(f,i,y.heightRatio,!1,!0,k,r.clone(t.characterStyleRanges),r.clone(u.characterStyles),m,t.forceLetterForma));if(0==C.length)return t.style.spacing;var v=r.clone(this.getUncompactedRows(r.clone(C),!1)),A=e.width,w=e.height,R=A/w,b=r.clone(a.compactRowsIntoAspect(r.clone(v),R,t.style.spacing));if(C.length>1&&(t.highlightMethod==g.HighlightMethod.EvenRows||t.highlightMethod==g.HighlightMethod.OddRows)&&""!=S&&null!=u.characterStyles[S]&&null!=L){var D=r.clone(p.TypeLockupUtils.computeLockupMeasurements(f,i,y.heightRatio,i.allCapsAllowed,!0,u.tracking,r.clone([]),r.clone({}),void 0,t.forceLetterForma)),T=[new d.TextRange(0,r.chars(o).length)],x=r.clone(p.TypeLockupUtils.computeLockupMeasurements(f,L,y.heightRatio,i.allCapsAllowed,!0,u.tracking,r.clone(T),r.clone(u.characterStyles),m,t.forceLetterForma)),I=r.clone(this.getUncompactedAutoRows(r.clone(D),r.clone(x),!1,t.highlightMethod));b=r.clone(a.getOptimalCompactedAutoRows(r.clone(I),r.clone(D),r.clone(x),R,h,t.highlightMethod))}if(b.length<=1)return u.spacing;var B=a.getAverageRowAspect(r.clone(b))/h;if((w=A/a.getCombinedAspectOfAllRows(r.clone(b),B))<c){var O=s/((c-w)/(r.toDouble(b.length)-1));h=b[0].aspectRatio/O/this.spacingScalar}else h=-w;return h},getUncompactedRows:function(t,e){for(var o=[],a=0;a<t.length;){var i=t[a],r=new s.LockupRowInfo;if(i.isNewLine)o.length>0&&(o[o.length-1].appendable=!1);else{if(!e)for(;!i.canBreak&&a<t.length;)r.addWord(i),(a+=1)<t.length&&(i=t[a]);r.addWord(i),o.push(r)}a+=1}return o},getUncompactedAutoRows:function(t,e,o,a){n.CoreAssert.isTrue(t.length==e.length,void 0,"EvenRowWidthsLayoutStrategy.getUncompactedAutoRows","EvenRowWidthsLayoutStrategy.swift",812);for(var i=[],r=0,l=a==g.HighlightMethod.EvenRows?0:1,c=0;c<t.length;){var u=r%2==l?e[c]:t[c],h=new s.LockupRowInfo;if(u.isNewLine)i.length>0&&(i[i.length-1].appendable=!1);else{if(!o)for(;!u.canBreak&&c<t.length;)h.addWord(u),(c+=1)<t.length&&(u=t[c]);h.addWord(u),i.push(h),r+=1}c+=1}return i}}}),a)},VDg0:function(t,e,o){var a,i=e,r=o("oAGj"),n=o("8t9B");i.kOpacityRuleFaintAlpha=.5,i.kOpacityRuleMediumAlpha=.7,i.LockupConfiguration=(a=function(t,e,o,a,i,r,l,s){this.characterStyleRanges=[],this.highlightMethod=n.HighlightMethod.Manual,this.rowWordLengths=null,this.allowFewerLineBreaks=!1,this.preferredFontSize=null,void 0===a&&(a=null),void 0===i&&(i=null),void 0===r&&(r=!1),void 0===l&&(l=!1),void 0===s&&(s=null),this.text=t,this.style=e,this.containerSize=o,this.placement=a,this.parentBounds=i,this.useOptimization=r,this.forceLetterForma=l,this.preferredFontSize=s},r.defineClass({name:"LockupConfiguration",ctor:a}),a)},Zc5V:function(t,e,o){var a,i=e,r=o("oAGj");i.GridArrangementUtils=(a=function(){},r.defineClass({name:"GridArrangementUtils",ctor:a,statics:{MAX_COLS:100,ASPECT_RATIO_EPSILON:.005,getArrangement:function(t,e,o,i){var n=r.max(i),l=t*r.toDouble(o)/r.toDouble(n),s=a.getBestFittingArrangement(l,e,n),c=s.numCols,u=a.evaluateAllSegments(t,e,o,r.clone(i),c),h=u.penalty,g=u.aspectRatioDelta;if(0!=h)for(var p=a.getColumnCountSearchRange(o,c),d=r.iter(r.range(p.start,p.end,!0));!d.done;d.next()){var f=d.value;if(f!=s.numCols){var y=(u=a.evaluateAllSegments(t,e,o,r.clone(i),f)).penalty,k=u.aspectRatioDelta;(y<h||y==h&&k<g)&&(c=f,h=y,g=k)}}return{numRows:a.getNumRows(o,c),numCols:c}},getNumRows:function(t,e){return r.toInt(t/e)+(t%e==0?0:1)},getGridAspectRatio:function(t,e,o){var i=a.getNumRows(e,o);return r.toDouble(o)/r.toDouble(i)*t},getBestFittingArrangement:function(t,e,o,i,n){var l,s;void 0===i&&(i=1),void 0===n&&(n=a.MAX_COLS);var c=Math.min(o,n);if(i<c){l=r.toInt((i+c)/2),s=a.getGridAspectRatio(e,o,l);var u=Math.abs(t-s);if(u>a.ASPECT_RATIO_EPSILON){var h,g=(h=s<t?a.getBestFittingArrangement(t,e,o,l+1,c):a.getBestFittingArrangement(t,e,o,i,l-1)).numCols,p=h.aspectRatio;Math.abs(t-p)<u&&(l=g,s=p)}}else s=a.getGridAspectRatio(e,o,l=i);return{numCols:l,aspectRatio:s}},evaluateAllSegments:function(t,e,o,i,n){for(var l=0,s=0,c=r.iter(i);!c.done;c.next()){var u=c.value;a.evaluateOneSegment(u,n)||(l+=1),s+=1/a.getGridAspectRatio(e,u,n)}return s=1/s,{penalty:l,aspectRatioDelta:Math.abs(t-s)}},evaluateOneSegment:function(t,e){if(t<=e)return!0;var o=t%e;0==o&&(o=e);var i=r.toDouble(o)/r.toDouble(e),n=.5;return e>4&&a.getNumRows(t,e)>2&&(n=.25),i>=n},getColumnCountSearchRange:function(t,e){var o=Math.min(2,r.toInt(t/6));return{start:Math.max(1,e-o),end:Math.min(e+o,t)}}}}),a)},cEEQ:function(t,e,o){var a,i,r,n,l=e,s=o("oAGj"),c=o("SpAV"),u=o("9kak"),h=o("tGKA"),g=o("1NAc");l.LockupItemType=s.defineEnum("LockupItemType",{Text:0,Path:1,Artwork:2}),l.LockupItem=(a=function(){this.spaceWidth=null,this.complementaryStyleWordWidth=null,this.complementaryStyleSpaceWidth=null,this.canAppendNext=!1,this.isFullCanvas=!1},s.defineClass({name:"LockupItem",ctor:a,props:{init_447b:function(t){this.type=t.type,this.hasPrimaryColor=t.hasPrimaryColor,this.size=t.size,this.placement=t.placement,this.text=t.text,this.font=t.font,this.pointSize=t.pointSize,this.rowPointSize=t.rowPointSize,this.rowIndex=t.rowIndex,this.margins=t.margins,this.typographicBoundingRatios=t.typographicBoundingRatios,this.characterStyle=t.characterStyle,this.rangeInLockup=t.rangeInLockup,this.spaceWidth=t.spaceWidth,this.complementaryStyleWordWidth=t.complementaryStyleWordWidth,this.complementaryStyleSpaceWidth=t.complementaryStyleSpaceWidth,this.canAppendNext=t.canAppendNext,this.path=t.path,this.artworkID=t.artworkID,this.preScale=t.preScale,this.isFullCanvas=t.isFullCanvas},init_38d4:function(t,e,o,a,i,r,n,s,c,u,h,g,p,d,f,y){void 0===g&&(g=null),void 0===p&&(p=null),void 0===d&&(d=null),void 0===f&&(f=null),void 0===y&&(y=!1),this.type=l.LockupItemType.Text,this.hasPrimaryColor=t,this.characterStyle=e,this.size=o,this.placement=a,this.text=i,this.font=r,this.pointSize=n,this.rowPointSize=s,this.typographicBoundingRatios=c,this.rowIndex=u,this.rangeInLockup=h,this.margins=g,this.spaceWidth=p,this.complementaryStyleWordWidth=d,this.complementaryStyleSpaceWidth=f,this.canAppendNext=y},init_708e:function(t,e,o,a,i,r,n){void 0===i&&(i=null),void 0===r&&(r=!1),void 0===n&&(n=null),this.type=l.LockupItemType.Path,this.hasPrimaryColor=t,this.size=e,this.placement=o,this.path=a,this.rowIndex=i,this.isFullCanvas=r,this.characterStyle=n},init_9cc6:function(t,e,o,a,i,r,n){void 0===r&&(r=null),void 0===n&&(n=null),this.type=l.LockupItemType.Artwork,this.hasPrimaryColor=t,this.size=e,this.placement=o,this.artworkID=a,this.preScale=i,this.rowIndex=r,this.characterStyle=n},clone:function(){return a.init_447b(this)},hasCharacterStyle:{get:function(){var t;return!(!(t=s.isEmpty(this.characterStyle))&&null==t||t)}},append:function(t){var e,o,a,i,r;if(c.CoreAssert.isTrue(this.type==l.LockupItemType.Text&&t.type==l.LockupItemType.Text,"Only text lockup items support appending","LockupItem.append","LockupLayoutStrategy.swift",164),c.CoreAssert.isTrue(this.canAppendNext,"Asked to append to an item that does not support it","LockupItem.append","LockupLayoutStrategy.swift",165),null!=(e=this.text)&&(o=this.rangeInLockup)&&null!=(a=t.text)&&(i=t.rangeInLockup)&&null!=(r=t.spaceWidth)){var n=0==r?"":" ";this.text=e+n+a,this.rangeInLockup=o.unionWith(i),this.size=new g.TheoSize(this.size.width+r+t.size.width,Math.max(this.size.height,t.size.height)),this.canAppendNext=t.canAppendNext}}}}),a),l.descenderCharacters="gjqpyQ",l.shortCharacters=" qweryuopasg;zxcvnm,.*-~",l.tallSpecialsThatAreNotCaps="!^'",l.TypographicBoundingRatios=(i=function(t,e,o,a,i,r){this.sideInsetRatio=t,this.textVerticalOffsetRatio=e,this.backingVerticalOffsetRatio=o,this.heightRatio=a,this.heightFromBaselineRatio=i,this.hasUppercase=r},s.defineClass({name:"TypographicBoundingRatios",ctor:i}),i),l.getTypographicBoundingRatiosOfString=function(t,e,o){void 0===o&&(o=!0);for(var a=t.split("\n").join(),i=!1,r=!1,n=!1,c=!1,u=!1,h=!1,g=!1,p=!1,d=!1,f=e.meanRatio,y=0,k=0,S=0,L=0,m=0,C=0,v=s.iter(s.chars(a));!v.done;v.next()){var A=v.value,w=!1,R=!1;" "!=A&&(k+=1,w||null==e.upperCaseCharsDict[A]?R||null==e.lowerCaseCharsDict[A]||(R=!0):w=!0,!i&&w?i=!0:!r&&R&&(r=!0),null!=e.meanCharsDict[A]?S+=e.meanRatio:null!=e.capCharsDict[A]?(u=!0,S+=e.capRatio):null!=e.ascentCharsDict[A]?(c=!0,S+=e.ascentRatio):null!=e.meanAccentCharsDict[A]?(h=!0,S+=e.meanAccentRatio):null!=e.capAccentCharsDict[A]?(n=!0,S+=e.capAccentRatio):(u=!0,S+=e.capRatio),w&&(k+=1,S+=e.capRatio),w||R||""==A||""==A||""==A||(d=!0),null!=e.tailCharsDict[A]?(g=!0,L+=e.tailRatio):null!=e.descentCharsDict[A]&&(p=!0,L+=e.descentRatio))}if(d&&(f=1),n&&(f=Math.max(f,e.capAccentRatio)),c&&(f=Math.max(f,e.ascentRatio)),u&&(f=Math.max(f,e.capRatio)),h&&(f=Math.max(f,e.meanAccentRatio)),g&&(y=Math.max(y,e.tailRatio)),p&&(y=Math.max(y,e.descentRatio)),k>0&&(m=S/k,C=L/k),o){var b=f-(i?e.capRatio:e.meanRatio);m=f+=Math.max(0,y-b),C=y}var D=y/2,T=e.baselineOffsetRatio+f,x=.8*(f-m-y+C),I=f+y;return new l.TypographicBoundingRatios(D,T,x,I,f,i)},l.LayoutResults=(r=function t(e,o,a,i,r){this.itemsForReflow_=s.clone(e),this.items_=s.clone(t.optimize(s.clone(e)));for(var n=0,c=0,u=0,h=1e5,g=0,p=0,d=0,f={},y=s.iter(this.items_);!y.done;y.next()){var k=y.value;k.type==l.LockupItemType.Text&&(n+=k.size.height,c+=k.pointSize,u+=1,k.rowIndex<h&&(h=k.rowIndex),k.rowIndex>g&&(g=k.rowIndex),null==f[k.rowIndex]&&(p+=k.pointSize,f[k.rowIndex]=!0),k.pointSize>d&&(d=k.pointSize))}this.size=o,this.placement=a,this.numberOfLines=g<h?0:g-h+1,this.avgLinePointSize=p/s.toDouble(this.numberOfLines),this.avgTextItemHeight=n/u,this.avgTextPointSize=c/u,this.largestPointSize=d,this.typographicBoundingRatios=i,this.avgRowAspect=r},s.defineClass({name:"LayoutResults",ctor:r,statics:{optimize:function(t){for(var e=[],o=null,a=s.iter(t);!a.done;a.next()){var i,r=a.value.clone();r.canAppendNext&&null==o?o=r:(i=o)?(i.append(r),r.canAppendNext||(e.push(i),o=null)):e.push(r)}return(i=o)&&(c.CoreAssert.fail("Why does the last lockup item claim to be appendable?","LayoutResults.optimize","LockupLayoutStrategy.swift",484),e.push(i)),e},mirrorItems:function(t,e){for(var o=[],a=s.iter(t);!a.done;a.next()){var i=a.value;i.placement=h.Matrix2D.scalingXY(-1,1).translateXY(i.size.width,0).concat(i.placement.scaleXY(-1,1)).translateXY(e,0),o.splice(0,0,i)}return o}},props:{items:{get:function(){return this.items_}},itemsForReflow:{get:function(){return this.itemsForReflow_}},flipForRightToLeft:function(){var t=this.size.width;this.items_=s.clone(r.mirrorItems(s.clone(this.items_),t)),this.itemsForReflow_=s.clone(r.mirrorItems(s.clone(this.itemsForReflow_),t))}}}),r),l.LockupLayoutStrategy=s.defineProtocol("LockupLayoutStrategy",{supportsConfiguration:"(LockupConfiguration) -> Boolean",layout:"(LockupConfiguration) -> LayoutResults",reflow:"(TheoSize, TheoPoint, LockupConfiguration, LayoutResults) -> LayoutResults",calculateTracking:"(LockupConfiguration, TheoSize) -> Double",calculateLeading:"(LockupConfiguration, TheoSize) -> Double",adjustHeightForLeading:"(TheoRect, LayoutResults, Double, Double) -> Double",adjustWidthForTracking:"(String, LayoutResults, Double, Double) -> Double"}),l.LockupLayoutStrategyFactory=s.defineProtocol("LockupLayoutStrategyFactory",{supportsConfiguration:"(LockupConfiguration) -> Boolean",createForConfiguration:"(LockupConfiguration) -> LockupLayoutStrategy"}),l.BaseLockupLayoutStrategy=(n=function(){},s.defineClass({name:"BaseLockupLayoutStrategy",ctor:n,statics:{_implements:function(t){return"LockupLayoutStrategy"==t}},props:{supportsConfiguration:function(t){return c.CoreAssert.fail("Implement in subclass","BaseLockupLayoutStrategy.supportsConfiguration","LockupLayoutStrategy.swift",595),!1},layout:function(t){return c.CoreAssert.fail("implement in subclass","BaseLockupLayoutStrategy.layout","LockupLayoutStrategy.swift",600),new l.LayoutResults([],new g.TheoSize(0,0),h.Matrix2D.Identity,new l.TypographicBoundingRatios(0,1,0,1,1,!1),0)},reflow:function(t,e,o,a){return null},calculateTracking:function(t,e){return c.CoreAssert.fail("implement in subclass","BaseLockupLayoutStrategy.calculateTracking","LockupLayoutStrategy.swift",629),0},calculateLeading:function(t,e){return c.CoreAssert.fail("implement in subclass","BaseLockupLayoutStrategy.calculateLeading","LockupLayoutStrategy.swift",636),0},adjustHeightForLeading:function(t,e,o,a){var i=a-o;return s.toDouble(e.numberOfLines-1)*(t.width/e.avgRowAspect)*(.75*i)},adjustWidthForTracking:function(t,e,o,a){var i=0,r=a-o;if(0!=r){for(var n=-1,l=0,c=0,u=0,h=0,g=t,p=s.iter(e.items);!p.done;p.next()){var d=p.value;d.rowIndex!=n?(u>h&&(h=u,i=l),c=d.placement.tx,l=0):l+=r*d.pointSize,l+=r*d.pointSize*s.toDouble(d.text.length-1),u=d.placement.tx+d.size.width-c,d.rangeInLockup.start>0&&" "==g.substr(d.rangeInLockup.start-1,1)&&c!=d.placement.tx&&(a<0?l-=r*d.pointSize:l+=r*d.pointSize),n=d.rowIndex}u>h&&(h=u,i=l)}return i},getPrecomputedRows:function(t,e){var o=[];if(0==t.length||0==e.length)return o;for(var a=new u.LockupRowInfo,i=0,r=0,n=s.iter(t);!n.done;n.next()){var l=n.value;l.isNewLine||(r>=e[i]&&(o.push(a),a=new u.LockupRowInfo,i+=1,r=0),a.addWord(l),r+=1)}return o.push(a),o}}}),n)},d3iY:function(t,e,o){var a,i,r=e,n=o("oAGj"),l=o("Zc5V"),s=o("iCxV"),c=o("cEEQ"),u=o("9kak"),h=o("c+uM"),g=o("KdeS"),p=o("tGKA"),d=o("8t9B"),f=o("3UhB"),y=o("uUew"),k=o("1NAc");r.LetterGridLayoutStrategy=(a=function(){this.trackingScalar=3,this.spacingScalar=3,c.BaseLockupLayoutStrategy.call(this)},n.defineClass({name:"LetterGridLayoutStrategy",ctor:a,superName:"BaseLockupLayoutStrategy",statics:{_implements:function(t){return"LockupLayoutStrategy"==t}},props:{supportsConfiguration:function(t){return h.LockupStyle.isLetterGrid(t.style.layout)},layout:function(t){var e=[],o=0,a=0,i=0,r=this.getWireframeLayout(t),l=r.typographicBoundingRatios,s=n.clone(r.rows);if(0==!s.length){var u,h,g,y,S=r.horizontalPaddingRatio,L=r.verticalPaddingRatio,m=this.getCombinedAspectRatio(n.clone(s),S,L),C=t.style,v=r.font;null!=(y=t.preferredFontSize)?(h=(u=y)*l.heightRatio,g=(a=(o=r.constraintWidth)/m)/n.toDouble(s.length)):(m<r.constraintAspectRatio?(a=r.constraintHeight,o=r.constraintHeight*m):(o=r.constraintWidth,a=r.constraintWidth/m),u=(h=(g=a/n.toDouble(s.length))/(1+L))/l.heightRatio);var A=L*h,w=S*h;r.charFontAdjustRatio>1&&(u/=r.charFontAdjustRatio);for(var R=u*v.capRatio,b=u*l.textVerticalOffsetRatio-R,D=n.opt(n.opt(C.characterStyles[d.TypeLockupController.HIGHLIGHT_STYLE],(function(t){return t.font})),(function(t){return t.fontData}))||v,T=u*r.charFontAdjustRatio,x=f.TypeLockupUtils.getCharFontYAdjust(C,u,T),I=A/2+b,B=n.iter(n.toSequence(s));!B.done;B.next()){var O=B.value,F=O.offset,E=O.element;if(0==!E.words.length)for(var _=n.first(E.words).aspectRatio*h,W=_+w,P=w/2+E.colOffsetLeft*W,U=n.iter(E.words);!U.done;U.next()){var M=U.value,N=M.characterStyle,H=N==d.TypeLockupController.HIGHLIGHT_STYLE,V=H?D:v,G=H?T:u,K=M.relativeMargins.multiply(h),z=K.width,Y=P+z,j=I+(H?x:0),q=c.LockupItem.init_38d4(!0,N,new k.TheoSize(_-2*z,R),p.Matrix2D.translationXY(Y,j),M.text,V,G,u,l,F,M.rangeInLockup,K);e.push(q),P+=W}I+=g}i=this.getWidestRowAndAspectRatio(n.clone(s),S,L).aspectRatio}return new c.LayoutResults(n.clone(e),new k.TheoSize(o,a),p.Matrix2D.Identity,l,i)},getCharacterStyle:function(t,e,o){for(var a=n.iter(t);!a.done;a.next()){var i=a.value;if(e>=i.start&&e<i.end)return d.TypeLockupController.HIGHLIGHT_STYLE}return""},getWireframeLayout:function(t,e){var o;void 0===e&&(e=null);for(var a=t.text.toUpperCase(),i=t.style,h=i.alignment,p=t.containerSize,S=(e||p).width,L=(e||p).height,m=S/L,C=i.spacing*this.spacingScalar,v=i.tracking*this.trackingScalar,A=i.font.fontData,w=c.getTypographicBoundingRatiosOfString(a,A,!1),R=0,b=0,D=[],T=(o=t.preferredFontSize)||null!=o?o:32,x=n.opt(n.opt(i.characterStyles[d.TypeLockupController.HIGHLIGHT_STYLE],(function(t){return t.font})),(function(t){return t.fontData}))||A,I=f.TypeLockupUtils.getCharFontAdjust(i,w.hasUppercase,!1),B=T*I,O=[],F=n.iter(n.toSequence(n.chars(a)));!F.done;F.next()){var E=F.value,_=E.offset,W=E.element,P=n.toString(W);if(f.TypeLockupUtils.isWhiteSpace(P)){if("\n"==P){var U=b;b=_-R,D.push(b-U)}R+=1}var M=this.getCharacterStyle(n.clone(t.characterStyleRanges),_,_+1)==d.TypeLockupController.HIGHLIGHT_STYLE,N=M?x:A,H=M?B:T,V=s.Host.textModelUtils.measureInkBounds(P,N,H);O.push(V.width)}var G=O.length-R;D.push(G-b);var K,z=Math.max(T,B)*w.heightRatio,Y=n.max(O)/z,j=(Y+v)/(1+C);K=null!=t.preferredFontSize?n.toInt(Math.floor(S/(n.max(O)+v*z))):l.GridArrangementUtils.getArrangement(m,j,G,n.clone(D)).numCols;for(var q=new u.LockupRowInfo,X=[],J=(_=0,n.iter(n.chars(a)));!J.done;J.next()){if(W=J.value,P=n.toString(W),f.TypeLockupUtils.isWhiteSpace(P))"\n"==W&&(this.commitRow(X,q,K,h),q=new u.LockupRowInfo);else{P=n.toString(W);var Q=(Y-O[_]/z)/2,Z=new g.LockupWordInfo(P,Y,0,this.getCharacterStyle(n.clone(t.characterStyleRanges),_,_+1),1,!1,!0,new y.TextRange(_,_+1),new k.TheoSize(Q,0));q.words.length==K&&(this.commitRow(X,q,K,h),q=new u.LockupRowInfo),q.addWord(Z)}_+=1}return this.commitRow(X,q,K,h),r.WireframeLayout.init_c604(A,w,I,S,L,m,v,C,n.clone(X),K)},commitRow:function(t,e,o,a){var i=n.toDouble(o-e.words.length);a==h.LockupAlignment.Right?e.colOffsetLeft=i:a==h.LockupAlignment.Center&&(e.colOffsetLeft=i/2,e.colOffsetRight=i/2),t.push(e)},calculateTracking:function(t,e){var o=this.getWireframeLayout(t,e),a=n.clone(o.rows);if(0==a.length)return t.style.tracking;var i=this.getCombinedAspectRatio(n.clone(a),0,o.verticalPaddingRatio),r=o.constraintHeight*i,l=t.containerSize.width;if(r<l){var s=n.toDouble(a.length);return(l-r)/n.toDouble(o.numCols)/(o.constraintHeight/s/(1+o.verticalPaddingRatio))/this.trackingScalar}return-r},calculateLeading:function(t,e){var o=this.getWireframeLayout(t,e),a=n.clone(o.rows);if(0==a.length)return t.style.spacing;var i=this.getCombinedAspectRatio(n.clone(a),o.horizontalPaddingRatio,0),r=o.constraintWidth/i,l=t.containerSize.height;if(r<l){var s=n.toDouble(a.length),c=r/s;return(l/s-c)/c/this.spacingScalar}return-r},adjustHeightForLeading:function(t,e,o,a){if(0==!e.items.length){var i=a-o,r=n.first(e.items);return n.toDouble(e.numberOfLines)*r.rowPointSize*r.typographicBoundingRatios.heightRatio*i*this.spacingScalar}return 0},adjustWidthForTracking:function(t,e,o,a){var i=this.getNumColsInLayout(e);if(i>0){var r=a-o,l=n.first(e.items);return l.rowPointSize*l.typographicBoundingRatios.heightRatio*r*this.trackingScalar*n.toDouble(i)}return 0},getNumColsInLayout:function(t){for(var e=0,o=0,a=-1,i=n.iter(t.items);!i.done;i.next()){var r=i.value;a!=r.rowIndex?(a=r.rowIndex,o=1):o+=1,e=Math.max(e,o)}return e},calculateRowAspectRatio:function(t,e,o,a){var i=n.toDouble(t.words.length),r=i+n.toDouble(a),l=t.aspectRatio*r/i;return(l+=r*e)/(1+o)},getWidestRowAndAspectRatio:function(t,e,o){for(var a,i=0,r=n.iter(t);!r.done;r.next()){var l=r.value,s=this.calculateRowAspectRatio(l,e,o,n.toInt(l.colOffsetLeft+l.colOffsetRight));s>i&&(a=l,i=s)}return{row:a,aspectRatio:i}},getCombinedAspectRatio:function(t,e,o){return this.getWidestRowAndAspectRatio(n.clone(t),e,o).aspectRatio/n.toDouble(t.length)}}}),a),r.WireframeLayout=(i=function(){},n.defineClass({name:"WireframeLayout",ctor:i,props:{init_c604:function(t,e,o,a,i,r,l,s,c,u){this.font=t,this.typographicBoundingRatios=e,this.charFontAdjustRatio=o,this.constraintWidth=a,this.constraintHeight=i,this.constraintAspectRatio=r,this.horizontalPaddingRatio=l,this.verticalPaddingRatio=s,this.rows=n.clone(c),this.numCols=u},init_implicit:function(t,e,o,a,i,r,l,s,c,u){this.font=t,this.typographicBoundingRatios=e,this.charFontAdjustRatio=o,this.constraintWidth=a,this.constraintHeight=i,this.constraintAspectRatio=r,this.horizontalPaddingRatio=l,this.verticalPaddingRatio=s,this.rows=n.clone(c),this.numCols=u}}}),i)},fGVU:function(t,e,o){var a,i=e,r=o("oAGj"),n=o("NkBu"),l=o("RkYL"),s=o("sW6f"),c=o("zjod");i.VideoController=(a=function(t,e,o){n.ImageController.call(this,t,e,o)},r.defineClass({name:"VideoController",ctor:a,superName:"ImageController",statics:{KIND:{get:function(){return"video"}}},props:{replaceable:{get:function(){return!0}},duplicatable:{get:function(){return!1}},canMultiSelect:{get:function(){return!1}},contentNode:{get:function(){var t=r.opt(r.as(this.forma,c.VideoForma),(function(t){return t.videoContentID}));return null==t?null:r.as(r.opt(r.opt(this.forma,(function(t){return t.page.document})),(function(e){return e.content.nodeByID(t)})),s.VideoContentNode)}},videoDuration:{get:function(){return r.opt(this.contentNode,(function(t){return t.duration}))||l.TheoTime.Zero}}}}),a)}}]);
//# sourceMappingURL=vendors_npm_spark_eed0fd33-ea29c4b0.js.map