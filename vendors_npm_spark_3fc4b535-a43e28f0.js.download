(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[15],{"01gE":function(e,t,n){var a,r=t,o=n("oAGj"),i=n("Nk+Q"),l=n("CMNw"),s=n("PSFa"),c=n("elwG"),d=n("qUXk"),u=n("u+mS"),f=n("eLsM"),p=n("hsXA"),h=n("JU+l"),m=n("9X7Y");r.GroupSelectionDesignController=(a=function(e,t){d.DesignController.call(this),this.handles=new p.StandardHandlesHandler(e,t,this),this.drag=new u.MultiObjectDragHandler(e,t,this),this.click=new c.StandardClickHandler(e),this.resize=new h.MultiObjectResizeHandler(e,t,o.clone(e.selection.asFormaArray()),this),this.actions=new l.StandardActionHandler(e),this.rotate=new m.StandardRotateHandler(e,t,this),this.attributes=new s.StandardAttributesHandler(e),this.featureSets=new f.StandardFeatureSetHandler(e),this.actionFeedback=new i.StandardActionFeedbackHandler(t)},o.defineClass({name:"GroupSelectionDesignController",ctor:a,superName:"DesignController"}),a)},"25Jq":function(e,t,n){var a,r=t,o=n("oAGj"),i=n("Nk+Q"),l=n("CMNw"),s=n("PSFa"),c=n("elwG"),d=n("qUXk"),u=n("u+mS"),f=n("eLsM"),p=n("hsXA"),h=n("G9CY"),m=n("JU+l"),g=n("9X7Y");r.SingleSelectionDesignController=(a=function(e,t){d.DesignController.call(this),this.handles=new p.StandardHandlesHandler(e,t,this),this.drag=new u.DragFacadeBasedDragHandler(e,t,this),this.click=new c.StandardClickHandler(e),this.resize=new m.SingleItemResizeHandler(e,t,e.selection.formaAt(0),this),this.move=new h.StandardMoveHandler(e,t,this),this.rotate=new g.StandardRotateHandler(e,t,this),this.actions=new l.StandardActionHandler(e),this.attributes=new s.StandardAttributesHandler(e),this.featureSets=new f.StandardFeatureSetHandler(e),this.actionFeedback=new i.StandardActionFeedbackHandler(t)},o.defineClass({name:"SingleSelectionDesignController",ctor:a,superName:"DesignController"}),a)},"3nOH":function(e,t,n){var a,r=t,o=n("oAGj"),i=n("Nk+Q"),l=n("CMNw"),s=n("PSFa"),c=n("elwG"),d=n("qUXk"),u=n("u+mS"),f=n("eLsM"),p=n("hsXA"),h=n("JU+l");r.MultiSelectionDesignController=(a=function(e,t){d.DesignController.call(this),this.handles=new p.StandardHandlesHandler(e,t,this),this.drag=new u.MultiObjectDragHandler(e,t,this),this.click=new c.StandardClickHandler(e),this.resize=new h.MultiObjectResizeHandler(e,t,o.clone(e.selection.asFormaArray()),this),this.actions=new l.StandardActionHandler(e),this.attributes=new s.StandardAttributesHandler(e),this.featureSets=new f.StandardFeatureSetHandler(e),this.actionFeedback=new i.StandardActionFeedbackHandler(t)},o.defineClass({name:"MultiSelectionDesignController",ctor:a,superName:"DesignController"}),a)},"5+WR":function(e,t,n){var a,r,o,i=t,l=n("oAGj"),s=n("KgU+"),c=n("PSFa"),d=n("KSe6"),u=n("AnBp");i.AnimationStyleAttribute=(a=function(e,t,n,a){this.selected=l.clone(n),this.page=t,this.options=l.clone(a),u.EditorAttributeBase.call(this,e)},l.defineClass({name:"AnimationStyleAttribute",ctor:a,superName:"EditorAttributeBase",statics:{PAGE_LEVEL_KEY:"animationStyle-page",sameArray:function(e,t){if(e.length==t.length){for(var n=l.iter(l.range(0,e.length,!1));!n.done;n.next()){var a=n.value;if(!e[a].equals(t[a]))return!1}return!0}return!1},_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;return!!(t=l.as(e,a))&&this.key==t.key&&a.sameArray(l.clone(this.selected),l.clone(t.selected))&&a.sameArray(l.clone(this.options),l.clone(t.options))},createAction:function(e){if(1==this.selected.length&&e.name==this.selected[0].name){var t=this.page.animationLibrary.getNextAnimationStyleOfSameType(this.selected[0]);return new s.ApplyAnimationStyleAction(t,this.page)}return new s.ApplyAnimationStyleAction(e,this.page)}}}),a),i.AnimationAttributesHandler=(r=function(){c.AttributeHandlerBase.call(this)},o={},l.defineClass({name:"AnimationAttributesHandler",ctor:r,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t;if(t=l.opt(l.opt(e,(function(e){return e.document})),(function(e){return e.firstPage}))){var n=l.clone(d.AnimationLibrary.getDisplayableAnimationStyles(t.root)),a=t.animationController.animationStyle||t.animationLibrary.getNoneStyle();return[new i.AnimationStyleAttribute(i.AnimationStyleAttribute.PAGE_LEVEL_KEY,t,[a],l.clone(n))]}return[]}}}),r)},"7S/6":function(e,t,n){var a,r=t,o=n("oAGj"),i=n("SpAV"),l=n("H3ZP"),s=n("nQ/X"),c=n("qUXk"),d=n("01gE"),u=n("3nOH"),f=n("QLFD"),p=n("25Jq");r.DesignControllerFactory=(a=function(){},o.defineClass({name:"DesignControllerFactory",ctor:a,props:{getNewDesignController:function(e){var t,n,a,r;return(r=this.owner)?a=0==r.selection.selectedCount?new f.NoSelectionDesignController(r,e):r.selection.inCharStyleMode?new s.CharStyleModeDesignController(r,e):1==r.selection.selectedCountInDocument?r.selection.inCropMode?new l.CropModeDesignController(r,e):!(t=o.opt(o.opt(r.selection.formaAt(0),(function(e){return e.controller})),(function(e){return e.userGroupMember})))&&null==t||!t||r.enableMoveableChildren&&(!(n=o.opt(o.opt(r.selection.formaAt(0),(function(e){return e.controller})),(function(e){return e.userGroup})))&&null==n||!n)?new p.SingleSelectionDesignController(r,e):new d.GroupSelectionDesignController(r,e):new u.MultiSelectionDesignController(r,e):(i.CoreAssert.fail("owner has gone out of scope, yet we are still asking to create design controllers","DesignControllerFactory.getNewDesignController","DesignControllerFactory.swift",44),a=new c.DesignController),a}}}),a)},"7siz":function(e,t,n){var a,r,o=t,i=n("oAGj"),l=n("McK+"),s=n("90dd"),c=n("ZoS2");o.IEditorModel=i.defineProtocol("IEditorModel",{attributes:"IAttributesModel",handles:"IHandlesModel",activeSwap:"IActiveSwapModel",snapLines:"ISnapLinesModel",featureSets:"IFeatureSetsModel",actionFeedback:"IActionFeedbackModel"}),o.IMutableEditorModel=i.defineProtocol("IMutableEditorModel",{attributes:"AttributesState",handles:"HandlesState",activeSwap:"ActiveSwapState",snapLines:"SnapLinesState",featureSets:"FeatureSetsState",actionFeedback:"ActionFeedbackState"}),o.EditorModel=(a=function(){this.updateDepth_=0,this.state_=new l.EditorModelState,this.startingState_=new l.EditorModelState,c.TheoPublishingObject.call(this)},i.defineClass({name:"EditorModel",ctor:a,superName:"TheoPublishingObject",statics:{_implements:function(e){return"IEditorModel"==e||"TheoMessagePublisher"==e}},props:{attributes:{get:function(){return this.state_.attributes}},handles:{get:function(){return this.state_.handles}},activeSwap:{get:function(){return this.state_.activeSwap}},snapLines:{get:function(){return this.state_.snapLines}},featureSets:{get:function(){return this.state_.featureSets}},actionFeedback:{get:function(){return this.state_.actionFeedback}},mutable:{get:function(){return this.state_}},beginUpdates:function(){this.updateDepth_+=1,1==this.updateDepth_&&(this.startingState_=this.state_.clone()),this.state_.mutable=!0},updatesComplete:function(){if(this.updateDepth_-=1,0==this.updateDepth_){this.state_.mutable=!1;var e=i.clone(this.state_.calculateChanges(this.startingState_));e.length>0&&this.publish(new o.EditorModelChangedMessage(this,i.clone(e)))}}}}),a),o.EditorModelChangedMessage=(r=function e(t,n){this.changes=i.clone(n),s.TheoMessage.call(this,e.TYPE,t)},i.defineClass({name:"EditorModelChangedMessage",ctor:r,superName:"TheoMessage",statics:{CHG_ATTRIBUTE_PREFIX:"attribute:",CHG_HANDLES:"handles",CHG_SWAP_STATE:"swapState",CHG_SNAPLINES:"snaplines",CHG_FEATURE_SET_PREFIX:"feature-set:",CHG_ACTION_FEEDBACK_STATE:"action-feedback",TYPE:"EditorModelChangedMessage"}}),r)},"9X7Y":function(e,t,n){var a,r,o,i=t,l=n("oAGj"),s=n("Tq01"),c=n("H1Z2"),d=n("lmwz");i.IRotateHandler=l.defineProtocol("IRotateHandler",{beginRotate:"(BoxReference) -> Void",updateRotate:"(BoxReference, Double, Boolean) -> Void",endRotate:"(BoxReference) -> Void"}),i.NullRotateHandler=(a=function(){},r={},l.defineClass({name:"NullRotateHandler",ctor:a,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new a),r.instance}},_implements:function(e){return"IRotateHandler"==e}},props:{beginRotate:function(e){},updateRotate:function(e,t,n){void 0===n&&(n=!0)},endRotate:function(e){}}}),a),i.StandardRotateHandler=(o=function(e,t,n){this.formaUnderRotation=null,this.initialImagePlacement=null,this.lastAppliedTotalDeltaRadians=0,this.dc=e,this.model=t,this.delegate=n,this.actionScope=null},l.defineClass({name:"StandardRotateHandler",ctor:o,statics:{_implements:function(e){return"IRotateHandler"==e}},props:{beginRotate:function(e){this.lastAppliedTotalDeltaRadians=0},updateRotate:function(e,t,n){var a;if(void 0===n&&(n=!0),null==this.actionScope){if(Math.abs(t)>0){var r,o;l.opt(this.dc,(function(e){return e.undoRedoMgr.beginGesture()})),this.actionScope=l.opt(this.dc,(function(e){return e.undoRedoMgr.gestureScope})),this.formaUnderRotation=l.opt(this.dc,(function(e){return e.selection.formaAt(0)})),((a=l.opt(this.dc,(function(e){return e.selection.inCropMode})))||null!=a)&&a&&(r=d.ImageFacade.getImageFormaForForma(this.formaUnderRotation))&&(this.formaUnderRotation=r,this.initialImagePlacement=l.opt(this.formaUnderRotation,(function(e){return e.placement}))),(o=l.opt(this.formaUnderRotation,(function(e){return e.controller})))&&o.userGroupChild&&!o.enableChildMove&&(this.formaUnderRotation=o.userGroupRoot,this.initialImagePlacement=l.opt(this.formaUnderRotation,(function(e){return e.placement}))),this.applyRotation(e,t,n)}}else this.applyRotation(e,t,n)},endRotate:function(e){var t;(t=this.model)&&(t.beginUpdates(),t.mutable.snapLines.clear(),t.updatesComplete()),null!=this.actionScope&&(l.opt(this.dc,(function(e){return e.undoRedoMgr.endGesture(!0)})),this.actionScope=null)},applyRotation:function(e,t,n){void 0===n&&(n=!0);var a=this,r=this.lastAppliedTotalDeltaRadians;if(t!=this.lastAppliedTotalDeltaRadians){var o,i=t-this.lastAppliedTotalDeltaRadians;if(this.lastAppliedTotalDeltaRadians=t,o=this.formaUnderRotation){var d=e.placement.transformPoint(e.bounds.center);l.opt(this.dc,(function(e){return e.doActionWithCompletion(new c.RotateHandleAction(o,i,d,a.initialImagePlacement,n),(function(e,t){var n,o,i=[];if((n=l.as(e,s.PlacementActionResult))&&(o=n.snapResult)){var c,d,u;if((c=o.snapLines)&&(i=l.clone(c)),d=o.movement){var f=d.transformValues;a.lastAppliedTotalDeltaRadians+=Math.atan2(f.rotSine,f.rotCosine)}(u=a.model)&&(u.beginUpdates(),u.mutable.snapLines.setAll(l.clone(i)),r!=a.lastAppliedTotalDeltaRadians&&l.opt(a.delegate,(function(e){return e.handles.updateHandles(u.mutable.handles)})),u.updatesComplete())}}))}))}}}}}),o)},CMNw:function(e,t,n){var a,r,o,i=t,l=n("oAGj"),s=n("Tq01"),c=n("Dz6V"),d=n("SpAV"),u=n("yvDn"),f=n("yGNn");i.IActionHandler=l.defineProtocol("IActionHandler",{canDoAction:"(Action) -> Boolean",doActionWithCallback:"(Action, (ActionResult, Any) -> Void) -> Void",doAction:"(Action) -> CorePromise"}),i.NullActionHandler=(a=function(){},r={},l.defineClass({name:"NullActionHandler",ctor:a,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new a),r.instance}},_implements:function(e){return"IActionHandler"==e}},props:{canDoAction:function(e){return!1},doActionWithCallback:function(e,t){t(null,null)},doAction:function(e){return f.CorePromise.resolve(null)}}}),a),i.StandardActionHandler=(o=function(e){this.actionQueue=[],this.executingAction=null,this.dc=e},l.defineClass({name:"StandardActionHandler",ctor:o,statics:{_implements:function(e){return"IActionHandler"==e}},props:{canDoAction:function(e){var t;return(t=this.dc)?e.canDo(t):(d.CoreAssert.fail("Still calling actions when the controller has been destroyed","StandardActionHandler.canDoAction","ActionHandler.swift",47),!1)},finishAction:function(){this.executingAction=null,l.opt(this.dc,(function(e){return e.designController.actionFeedback.reportActionFeedback(c.ActionFeedback.NONE)}));var e=l.first(this.actionQueue);null!=e&&(this.actionQueue.shift(),this.doActionWithCallback(e[0],e[1]))},doActionWithCallback:function(e,t){var n,a=this;null!=this.executingAction?this.actionQueue.push([e,t]):(n=this.dc)?l.opt(n.document,(function(r){return r.firstPage.animationController.stopWithCallback((function(){a.executingAction=e;var r=null,o=e.getUserAction(n);if(e.executionOptions.showWaitingFeedback!=c.ActionFeedbackWaitingType.None&&n.designController.actionFeedback.reportActionFeedback(new c.ActionFeedback(e.type,e.executionOptions.showWaitingFeedback)),o.undoable)n.undoRedoMgr.beginUserActionAsync(o).then((function(t){return e.execute(n)})).finished((function(i,l){r=i;var c=a.processResult(e,i);n.undoRedoMgr.endUserActionAsync().then((function(t){return e.updateSelection(n)})).then((function(e){return l?t(s.ActionResult.fromPromiseAny(r),null):t(null,r),null})).finished((function(e,t){a.finishAction(),c||t||d.CoreAssert.fail("Failed in complete callback for action that's not expected to fail "+o.description,"StandardActionHandler.doActionWithCallback","ActionHandler.swift",109)})),c||l||d.CoreAssert.fail("Failed to execute undoable action that's not expected to fail "+o.description,"StandardActionHandler.doActionWithCallback","ActionHandler.swift",113)}));else{var i=l.opt(n.document,(function(e){return e.beginTransaction(o.description)}));e.execute(n).then((function(t){return r=t,a.processResult(e,t),l.opt(i,(function(e){return e.end()})),i=null,t})).then((function(t){return e.updateSelection(n)})).then((function(e){return t(s.ActionResult.fromPromiseAny(r),null)})).fail((function(n){return a.processResult(e,n)||d.CoreAssert.fail("Failed to execute non-undoable action that's not expected to fail "+o.description,"StandardActionHandler.doActionWithCallback","ActionHandler.swift",147),l.opt(i,(function(e){return e.rollback()})),t(null,n),null})).finished((function(e,t){return a.finishAction()}))}}))})):d.CoreAssert.fail("Still calling actions when the controller has been destroyed","StandardActionHandler.doActionWithCallback","ActionHandler.swift",163)},doAction:function(e){var t=this;return new f.CorePromise((function(n,a){return t.doActionWithCallback(e,(function(e,t){var r;null!=(r=t)?a(r):n(e)}))}))},processResult:function(e,t){var n,a=e.executionOptions,r=!1,o=null;return(n=l.as(t,u.CoreErrorObject))&&(r=n.isAllowedError,a.showMessageFeedback!=c.ActionFeedbackMessageType.None&&(o=n)),l.opt(this.dc,(function(t){return t.designController.actionFeedback.reportActionFeedback(new c.ActionFeedback(e.type,c.ActionFeedbackWaitingType.None,a.showMessageFeedback,o))})),r}}}),o)},Cl7N:function(e,t,n){var a,r=t,o=n("oAGj"),i=n("7siz");r.ISnapLinesModel=o.defineProtocol("ISnapLinesModel",{getAll:"() -> Array<AlignmentLine>"}),r.SnapLinesState=(a=function(e){void 0===e&&(e=null),this.snaplines=o.clone(e||[])},o.defineClass({name:"SnapLinesState",ctor:a,superName:"EditorStateMember",statics:{_implements:function(e){return"ISnapLinesModel"==e}},props:{clone:function(){return new a(o.clone(this.snaplines))},getAll:function(){return this.snaplines},clear:function(){this.setAll([])},setAll:function(e){this.beforeChange(),this.snaplines=o.clone(e),this.afterChange()},diff:function(e){if(e.snaplines.length!=this.snaplines.length)return[i.EditorModelChangedMessage.CHG_SNAPLINES];for(var t=o.iter(o.range(0,this.snaplines.length,!1));!t.done;t.next()){var n=t.value;if(!e.snaplines.includes(this.snaplines[n]))return[i.EditorModelChangedMessage.CHG_SNAPLINES]}return[]}}}),a)},D89E:function(e,t,n){var a,r=t,o=n("oAGj"),i=n("1HsO"),l=n("tGKA");r.SwapModeHandleGenerator=(a=function(){this.swapTarget=null},o.defineClass({name:"SwapModeHandleGenerator",ctor:a,statics:{_implements:function(e){return"IHandleGenerator"==e}},props:{setSwapTargetForma:function(e){this.swapTarget=e},clearSwapTargetForma:function(){this.swapTarget=null},addHandles:function(e){var t=null;return null!=this.swapTarget&&(t=this.swapTarget.finalFrame),null==t?[]:[new i.BoxTransformHandles(new i.BoxReference(l.Matrix2D.Identity,t),[i.TransformType.Translate],[],i.TransformType.None,"")]}}}),a)},Dz6V:function(e,t,n){var a,r,o,i=t,l=n("oAGj"),s=n("7siz");i.IActionFeedbackModel=l.defineProtocol("IActionFeedbackModel",{getActionFeedback:"() -> ActionFeedback"}),i.ActionFeedbackWaitingType=l.defineEnum("ActionFeedbackWaitingType",{None:0,Loading:1}),i.ActionFeedbackMessageType=l.defineEnum("ActionFeedbackMessageType",{None:0,Error:1,Info:2}),i.ActionFeedback=(a=function(e,t,n,a){void 0===t&&(t=i.ActionFeedbackWaitingType.None),void 0===n&&(n=i.ActionFeedbackMessageType.None),void 0===a&&(a=null),this.actionType=e,this.showWaiting=t,this.messageType=n,this.message=a},r={},l.defineClass({name:"ActionFeedback",ctor:a,superName:"CoreObject",statics:{NONE:{get:function(){return void 0===r.NONE&&(r.NONE=new a(null,i.ActionFeedbackWaitingType.None,i.ActionFeedbackMessageType.None,null)),r.NONE}}},props:{equals:function(e){var t;return!!(t=e)&&this.actionType==t.actionType&&this.showWaiting==t.showWaiting&&this.messageType==t.messageType&&(null==this.message&&null==t.message||null!=this.message&&this.message.equals(t.message))}}}),a),i.ActionFeedbackState=(o=function(e){void 0===e&&(e=i.ActionFeedback.NONE),this.feedback=e},l.defineClass({name:"ActionFeedbackState",ctor:o,superName:"EditorStateMember",statics:{_implements:function(e){return"IActionFeedbackModel"==e}},props:{clone:function(){return new o(this.feedback)},getActionFeedback:function(){return this.feedback},setActionFeedback:function(e){this.beforeChange(),this.feedback=e,this.afterChange()},diff:function(e){return this.feedback.equals(e.feedback)?[]:[s.EditorModelChangedMessage.CHG_ACTION_FEEDBACK_STATE]}}}),o)},G9CY:function(e,t,n){var a,r,o,i=t,l=n("oAGj"),s=n("Tq01"),c=n("H1Z2"),d=n("oKlP");i.IMoveHandler=l.defineProtocol("IMoveHandler",{beginMove:"(BoxReference) -> Void",updateMove:"(BoxReference, TheoPoint, Double) -> Void",endMove:"(BoxReference) -> Void"}),i.NullMoveHandler=(a=function(){},r={},l.defineClass({name:"NullMoveHandler",ctor:a,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new a),r.instance}},_implements:function(e){return"IMoveHandler"==e}},props:{beginMove:function(e){},updateMove:function(e,t,n){},endMove:function(e){}}}),a),i.StandardMoveHandler=(o=function(e,t,n){this.formaUnderMove=null,this.lastAppliedTotalDelta=d.TheoPoint.ZERO,this.dc=e,this.model=t,this.delegate=n,this.actionScope=null},l.defineClass({name:"StandardMoveHandler",ctor:o,statics:{_implements:function(e){return"IMoveHandler"==e}},props:{beginMove:function(e){this.lastAppliedTotalDelta=d.TheoPoint.ZERO},updateMove:function(e,t,n){var a;null==this.actionScope?t.isEqual(d.TheoPoint.ZERO)||(l.opt(this.dc,(function(e){return e.undoRedoMgr.beginGesture()})),this.actionScope=l.opt(this.dc,(function(e){return e.undoRedoMgr.gestureScope})),this.formaUnderMove=l.opt(this.dc,(function(e){return e.selection.formaAt(0)})),(a=l.opt(this.formaUnderMove,(function(e){return e.controller})))&&a.userGroupChild&&!this.dc.enableMoveableChildren&&(this.formaUnderMove=l.opt(this.formaUnderMove,(function(e){return e.parent}))),this.applyMove(e,t,n)):this.applyMove(e,t,n)},endMove:function(e){var t;(t=this.model)&&(t.beginUpdates(),t.mutable.snapLines.clear(),t.updatesComplete(),null!=this.actionScope&&(l.opt(this.dc,(function(e){return e.undoRedoMgr.endGesture(!0)})),this.actionScope=null))},applyMove:function(e,t,n){var a=this,r=this.lastAppliedTotalDelta;if(!t.isEqual(this.lastAppliedTotalDelta)){var o,i=d._minus_TheoPoint_TheoPoint(t,this.lastAppliedTotalDelta);if(this.lastAppliedTotalDelta=t,o=this.formaUnderMove){var u=e.placement.transformPoint(e.bounds.center);l.opt(this.dc,(function(e){return e.doActionWithCompletion(new c.MoveHandleAction(o,i,u,n),(function(e,t){var n,o,i=[];if((n=l.as(e,s.PlacementActionResult))&&(o=n.snapResult)){var c,u,f;if((c=o.snapLines)&&(i=l.clone(c)),u=o.movement){var p=u.transformValues;a.lastAppliedTotalDelta=a.lastAppliedTotalDelta.add(new d.TheoPoint(p.tx,p.ty))}(f=a.model)&&(f.beginUpdates(),f.mutable.snapLines.setAll(l.clone(i)),r!=a.lastAppliedTotalDelta&&l.opt(a.delegate,(function(e){return e.handles.updateHandles(f.mutable.handles)})),f.updatesComplete())}}))}))}}}}}),o)},H3ZP:function(e,t,n){var a,r=t,o=n("oAGj"),i=n("Nk+Q"),l=n("elwG"),s=n("u+mS"),c=n("25Jq");r.CropModeDesignController=(a=function(e,t){c.SingleSelectionDesignController.call(this,e,t),this.drag=new s.CroppingDragFacadeBasedDragHandler(e,t,this),this.click=new l.CropModeClickHandler(e),this.actionFeedback=new i.StandardActionFeedbackHandler(t)},o.defineClass({name:"CropModeDesignController",ctor:a,superName:"SingleSelectionDesignController"}),a)},"JU+l":function(e,t,n){var a,r,o,i,l=t,s=n("oAGj"),c=n("SpAV"),d=n("wNKJ"),u=n("FNB+"),f=n("Pil/"),p=n("P83h"),h=n("ZK0l"),m=n("pnSN"),g=n("H1Z2"),v=n("NkBu"),b=n("MYNe"),S=n("tGKA"),A=n("JFv5"),H=n("voLh"),C=n("T6jX"),F=n("oKlP"),T=n("sIWg");l.IResizeHandler=s.defineProtocol("IResizeHandler",{handleBeginSelectionBoxResize:"(BoxReference, TheoPoint) -> Void",handleSelectionBoxResize:"(BoxReference, TheoPoint, TheoPoint, Double) -> Void",handleEndSelectionBoxResize:"(BoxReference, TheoPoint) -> Void"}),l.NullResizeHandler=(a=function(){},r={},s.defineClass({name:"NullResizeHandler",ctor:a,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new a),r.instance}},_implements:function(e){return"IResizeHandler"==e}},props:{handleBeginSelectionBoxResize:function(e,t){},handleSelectionBoxResize:function(e,t,n,a){},handleEndSelectionBoxResize:function(e,t){}}}),a),l.locate=function(e,t,n){return new F.TheoPoint((e.x-t.x)/(n.x-t.x),(e.y-t.y)/(n.y-t.y))},l.eval=function(e,t,n){return new F.TheoPoint((1-e.x)*t.x+e.x*n.x,(1-e.y)*t.y+e.y*n.y)},l.SingleItemResizeHandler=(o=function(e,t,n,a){this.dc=e,this.model=t,this.forma=n,this.delegate=a},s.defineClass({name:"SingleItemResizeHandler",ctor:o,statics:{_implements:function(e){return"IResizeHandler"==e}},props:{handleBeginSelectionBoxResize:function(e,t){var n=this;s.opt(this.dc,(function(e){return e.undoRedoMgr.beginGesture()})),s.opt(this.forma.controller,(function(e){return e.onEvent(new f.BeginFormaResizeEvent(n.forma,t))}))},handleSelectionBoxResize:function(e,t,n,a){var r,o=this,i=Math.sqrt(Math.abs(e.placement.determinant))*Math.abs(a),c=new F.TheoPoint(1-t.x,1-t.y),d=e.bounds,u=e.placement.inverse.transformPoint(n),f=l.locate(u,e.bounds.eval(c),e.bounds.eval(t));if(!(isFinite(f.x)&&f.x<0||isFinite(f.y)&&f.y<0)){var p;p=.5==t.x?T.TheoRect.fromPoints(d.evalXY(0,c.y),new F.TheoPoint(d.maxX,u.y)):.5==t.y?T.TheoRect.fromPoints(d.evalXY(c.x,0),new F.TheoPoint(u.x,d.maxY)):T.TheoRect.fromPoints(d.eval(c),u);var h=this.forma.placement.extractedScale;p=p.scaleXY(h.scale.x,h.scale.y);var m=50/i,b=10/i;this.forma.controller instanceof v.ImageController&&(m=100/i,b=100/i);var S=d.width+d.height,A=p.width+p.height;p.width<d.width&&p.width<b||p.height<d.height&&p.height<b||A<S&&A<m||s.opt(this.dc,(function(e){return e.doActionWithCompletion(new g.ResizeHandleAction(o.forma,t,c,p,!(!(r=s.opt(o.dc,(function(e){return e.selection.inSpacingMode})))&&null==r)&&r),(function(e,t){var n,a;(n=o.model)&&(a=o.delegate)&&(n.beginUpdates(),a.handles.updateHandles(n.mutable.handles),n.updatesComplete())}))}))}},handleEndSelectionBoxResize:function(e,t){var n=this;s.opt(this.dc,(function(e){return e.undoRedoMgr.endGesture(!0)}));var a=s.opt(s.opt(this.dc,(function(e){return e.document})),(function(e){return e.beginTransaction("finish_resize")}));s.opt(this.forma.controller,(function(e){return e.onEvent(new f.EndFormaResizeEvent(n.forma))})),d.DragFacade.rescueFormaToPageBounds(this.forma),s.opt(a,(function(e){return e.mergeWithPrevious()}))}}}),o),l.MultiObjectResizeHandler=(i=function(e,t,n,a){this.group_=null,this.passedARThreshold_=!1,this.dc=e,this.model=t,this.formae_=b.LayerFacade.sortInZOrder(s.clone(n)).filter((function(e){return null!=e.controller}),this),this.delegate=a},s.defineClass({name:"MultiObjectResizeHandler",ctor:i,statics:{_implements:function(e){return"IResizeHandler"==e}},props:{handleBeginSelectionBoxResize:function(e,t){var n,a;if(0!=this.formae_.length){var r=s.opt(s.opt(this.dc,(function(e){return e.document})),(function(e){return e.beginTransaction("create_resize_group")}));this.passedARThreshold_=!1;for(var o,i,l,d,p,g,v=!0,b=null,F=s.iter(this.formae_);!F.done;F.next()){var w=F.value;((n=s.opt(w.controller,(function(e){return e.userGroupMember})))||null!=n)&&n?null==b?b=w.controller.enableChildMove?w.controller.userGroup?s.as(w,m.GroupForma):w.parent:w.controller.userGroupRoot||s.as(w,m.GroupForma):b!=w.parent&&(v=!1):v=!1}if(v&&(o=b)&&(i=o.finalFrame))return this.group_=o,this.startSize_=i.size,(p=o.controller).preferredResizeType=A.ResizeLayoutType.Proportional,p.preserveResizeController=!0,s.opt(r,(function(e){return e.end()})),void s.opt(this.dc,(function(e){return e.undoRedoMgr.beginGesture()}));if(this.group_=s.as(s.opt(this.formae_[0].parent,(function(e){return e.page.createFormaWithController(m.GroupForma.KIND,h.GroupController.KIND)})),m.GroupForma),(l=this.formae_[0].parent)&&(d=this.group_)&&(p=s.as(d.controller,h.GroupController))&&(g=C.TheoDocumentUtils.unionFinalFrame(s.clone(this.formae_)))){var D=(a=l.indexOfChild(this.formae_[0]))||null!=a?a:l.childCount;l.insertChildAt(d,D),p.preferredResizeType=A.ResizeLayoutType.Proportional,p.preserveResizeController=!0,d.placement=S.Matrix2D.translationXY(g.minX,g.minY),d.bounds=T.TheoRect.fromSize(g.size),d.intent=u.Forma.INTENT_INFERRED_TEMP_GROUP;for(var M=s.iter(this.formae_);!M.done;M.next())w=M.value,d.appendChild(w,!0);s.opt(s.as(p.resizeLayoutController,H.ProportionalLayoutController),(function(e){return e.setInitBounds()})),this.startSize_=g.size,p.onEvent(new f.BeginFormaResizeEvent(d,t)),s.opt(this.dc,(function(e){return e.selection.selectForma(d,!1)}))}s.opt(r,(function(e){return e.end()})),s.opt(this.dc,(function(e){return e.undoRedoMgr.beginGesture()}))}else c.CoreAssert.fail("no children to multi-select resize","MultiObjectResizeHandler.handleBeginSelectionBoxResize","ResizeHandler.swift",179)},handleSelectionBoxResize:function(e,t,n,a){var r=this;if(null!=this.group_){var o=Math.sqrt(Math.abs(e.placement.determinant))*Math.abs(a),i=new F.TheoPoint(1-t.x,1-t.y),c=e.bounds,d=e.placement.inverse.transformPoint(n),u=l.locate(d,e.bounds.eval(i),e.bounds.eval(t));if(!(isFinite(u.x)&&u.x<0||isFinite(u.y)&&u.y<0)){var f,h=50/o,m=10/o;if(!((f=.5==t.x?T.TheoRect.fromPoints(c.evalXY(0,i.y),new F.TheoPoint(c.maxX,d.y)):.5==t.y?T.TheoRect.fromPoints(c.evalXY(i.x,0),new F.TheoPoint(d.x,c.maxY)):T.TheoRect.fromPoints(c.eval(i),d)).width<m||f.height<m||f.width+f.height<h)){var v=f.size;if(null!=this.startSize_){var b=this.startSize_.similarity(v);b<.04?(b<.01&&(this.passedARThreshold_=!1),this.passedARThreshold_||(v=this.startSize_.myAspectRatioClosestCorner(v))):this.passedARThreshold_=!0}var S=new p.FormaAnimationTransactionEvent(this.group_);S.duration=0,this.group_.beginUpdate(S),s.opt(this.dc,(function(e){return e.doActionWithCompletion(new g.ResizeHandleAction(r.group_,t,i,T.TheoRect.fromSize(v)),(function(e,t){var n,a,o;(n=r.group_)&&n.endUpdate(S),(a=r.model)&&(o=r.delegate)&&(a.beginUpdates(),o.handles.updateHandles(a.mutable.handles),a.updatesComplete())}))}))}}}},handleEndSelectionBoxResize:function(e,t){var n,a,r=this;s.opt(this.dc,(function(e){return e.undoRedoMgr.endGesture(!0)}));var o=s.opt(s.opt(this.dc,(function(e){return e.document})),(function(e){return e.beginTransaction("create_resize_group")}));if(s.opt(s.opt(this.group_,(function(e){return e.controller})),(function(e){return e.onEvent(new f.EndFormaResizeEvent(r.group_))})),!(n=s.opt(s.opt(this.group_,(function(e){return e.controller})),(function(e){return e.userGroup})))&&null==n||!n){s.opt(this.dc,(function(e){return e.selection.deselectForma(r.group_,!1)}));for(var i=s.iter(this.formae_);!i.done;i.next()){var l=i.value,c=(a=this.group_.parent.indexOfChild(this.group_))||null!=a?a:this.group_.childCount;this.group_.parent.insertChildAt(l,c,!0)}s.opt(this.group_,(function(e){return e.removeFromParent()})),this.group_=null}s.opt(o,(function(e){return e.mergeWithPrevious()}))}}}),i)},"McK+":function(e,t,n){var a,r,o=t,i=n("oAGj"),l=n("Dz6V"),s=n("bccX"),c=n("mD2h"),d=n("SpAV"),u=n("gXiO"),f=n("QLmq"),p=n("d820"),h=n("Cl7N");o.EditorModelState=(a=function(e,t,n,a,r,o){this.mutable_=!1,void 0===e&&(e=new s.AttributesState),void 0===t&&(t=new f.FeatureSetsState),void 0===n&&(n=new p.HandlesState),void 0===a&&(a=new c.ActiveSwapState),void 0===r&&(r=new h.SnapLinesState),void 0===o&&(o=new l.ActionFeedbackState),this.attributes=e,this.featureSets=t,this.handles=n,this.activeSwap=a,this.snapLines=r,this.actionFeedback=o},i.defineClass({name:"EditorModelState",ctor:a,statics:{_implements:function(e){return"IMutableEditorModel"==e}},props:{clone:function(){return new a(this.attributes.clone(),this.featureSets.clone(),this.handles.clone(),this.activeSwap.clone(),this.snapLines.clone(),this.actionFeedback.clone())},calculateChanges:function(e){var t=[];return i.append(t,this.attributes.diff(e.attributes)),i.append(t,this.featureSets.diff(e.featureSets)),i.append(t,this.handles.diff(e.handles)),i.append(t,this.activeSwap.diff(e.activeSwap)),i.append(t,this.snapLines.diff(e.snapLines)),i.append(t,this.actionFeedback.diff(e.actionFeedback)),t},mutable:{get:function(){return this.mutable_},set:function(e){e!=this.mutable_&&(this.mutable_=e,this.attributes.mutable=e,this.featureSets.mutable=e,this.handles.mutable=e,this.activeSwap.mutable=e,this.snapLines.mutable=e,this.actionFeedback.mutable=e)}}}}),a),o.EditorStateMember=(r=function(){this.mutable=!1,u.CoreObject.call(this)},i.defineClass({name:"EditorStateMember",ctor:r,superName:"CoreObject",props:{beforeChange:function(){d.CoreAssert.isTrue(this.mutable,"editor state is read-only","EditorStateMember.beforeChange","EditorModelState.swift",99)},afterChange:function(){}}}),r)},Mr7n:function(e,t,n){var a,r=t,o=n("oAGj"),i=n("Pil/"),l=n("1HsO"),s=n("oKlP");r.StandardHandleProcessor=(a=function(e){this.model=e},o.defineClass({name:"StandardHandleProcessor",ctor:a,statics:{_implements:function(e){return"IHandleProcessor"==e}},props:{updateHandles:function(e){this.model.beginUpdates(),e.updateHandles(this.model.mutable.handles),this.model.updatesComplete()},handleTransformEvent:function(e,t){var n,a,r,i,s;if(n=o.as(t.handle,l.BoxTransformHandles))if(a=o.as(t,l.MoveTransformEvent))switch(a.stage){case 0:e.activeTransform=l.TransformType.Translate,o.opt(e.delegate,(function(e){return e.move.beginMove(n.reference)})),this.updateHandles(e);break;case 1:o.opt(e.delegate,(function(e){return e.move.updateMove(n.reference,a.totalDelta,a.viewportScale)}));break;case 2:e.activeTransform=l.TransformType.None,o.opt(e.delegate,(function(e){return e.move.endMove(n.reference)})),this.updateHandles(e)}else if(r=o.as(t,l.RotateAboutCenterTransformEvent))switch(r.stage){case 0:e.activeTransform=l.TransformType.RotateAboutCenter,o.opt(e.delegate,(function(e){return e.rotate.beginRotate(n.reference)})),this.updateHandles(e);break;case 1:o.opt(e.delegate,(function(e){return e.rotate.updateRotate(n.reference,r.totalDeltaRadians,r.doSnapping)}));break;case 2:e.activeTransform=l.TransformType.None,o.opt(e.delegate,(function(e){return e.rotate.endRotate(n.reference)})),this.updateHandles(e)}else if(i=o.as(t,l.CornerTranslateTransformEvent)){var c=this.canonicalPointForTransformType(i.transformType);switch(i.stage){case 0:e.activeTransform=i.transformType,o.opt(e.delegate,(function(e){return e.resize.handleBeginSelectionBoxResize(n.reference,c)})),this.updateHandles(e);break;case 1:o.opt(e.delegate,(function(e){return e.resize.handleSelectionBoxResize(n.reference,c,i.position,i.viewportScale)}));break;case 2:e.activeTransform=l.TransformType.None,o.opt(e.delegate,(function(e){return e.resize.handleEndSelectionBoxResize(n.reference,c)})),this.updateHandles(e)}}else if(s=o.as(t,l.SideTranslateTransformEvent))switch(c=this.canonicalPointForTransformType(s.transformType),s.stage){case 0:e.activeTransform=s.transformType,o.opt(e.delegate,(function(e){return e.resize.handleBeginSelectionBoxResize(n.reference,c)})),this.updateHandles(e);break;case 1:o.opt(e.delegate,(function(e){return e.resize.handleSelectionBoxResize(n.reference,c,s.position,s.viewportScale)}));break;case 2:e.activeTransform=l.TransformType.None,o.opt(e.delegate,(function(e){return e.resize.handleEndSelectionBoxResize(n.reference,c)})),this.updateHandles(e)}return!0},handleFormaDragEvents:function(e,t){return t instanceof i.BeginFormaDragEvent&&(e.activeTransform=l.TransformType.Translate,this.updateHandles(e)),o.opt(e.delegate,(function(e){return e.drag.handleFormaDragEvents(t)})),t instanceof i.EndFormaDragEvent&&(e.activeTransform=l.TransformType.None,this.updateHandles(e)),!0},canonicalPointForTransformType:function(e){switch(e){case 4:return new s.TheoPoint(0,0);case 5:return new s.TheoPoint(1,0);case 6:return new s.TheoPoint(0,1);case 7:return new s.TheoPoint(1,1);case 10:return new s.TheoPoint(.5,0);case 11:return new s.TheoPoint(.5,1);case 8:return new s.TheoPoint(0,.5);case 9:case 12:return new s.TheoPoint(1,.5);case 13:return new s.TheoPoint(.5,1);default:return s.TheoPoint.ZERO}}}}),a)},"Nk+Q":function(e,t,n){var a,r,o,i=t,l=n("oAGj");i.IActionFeedbackHandler=l.defineProtocol("IActionFeedbackHandler",{reportActionFeedback:"(ActionFeedback) -> Void"}),i.NullActionFeedbackHandler=(a=function(){},r={},l.defineClass({name:"NullActionFeedbackHandler",ctor:a,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new a),r.instance}},_implements:function(e){return"IActionFeedbackHandler"==e}},props:{reportActionFeedback:function(e){}}}),a),i.StandardActionFeedbackHandler=(o=function(e){this.model=e},l.defineClass({name:"StandardActionFeedbackHandler",ctor:o,statics:{_implements:function(e){return"IActionFeedbackHandler"==e}},props:{reportActionFeedback:function(e){l.opt(this.model,(function(e){return e.beginUpdates()})),l.opt(this.model,(function(t){return t.mutable.actionFeedback.setActionFeedback(e)})),l.opt(this.model,(function(e){return e.updatesComplete()}))}}}),o)},PSFa:function(e,t,n){var a,r,o,i=t,l=n("oAGj"),s=n("5+WR"),c=n("ascj"),d=n("AnBp"),u=n("FNB+"),f=n("lmwz"),p=n("37nf"),h=n("T8w7"),m=n("umUn");i.IAttributesHandler=l.defineProtocol("IAttributesHandler",{updateAttributes:"(AttributesState) -> Void"}),i.NullAttributesHandler=(a=function(){},r={},l.defineClass({name:"NullAttributesHandler",ctor:a,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new a),r.instance}},_implements:function(e){return"IAttributesHandler"==e}},props:{updateAttributes:function(e){}}}),a),i.IAttributeHandler=l.defineProtocol("IAttributeHandler",{calculate:"(DocumentController) -> Array<IEditorAttribute>"}),i.AttributeHandlerBase=(o=function(){},l.defineClass({name:"AttributeHandlerBase",ctor:o}),o),i.ImageAttributeHandler=function(){var e=function(){i.AttributeHandlerBase.call(this)},t={};return l.defineClass({name:"ImageAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=[];return l.opt(e,(function(e){return e.selection.forEachSelected((function(e){var n=f.ImageFacade.getImageStyleForForma(e);if(null!=n){for(var a=!1,r=l.iter(t);!r.done;r.next()){var o=r.value;if(n.equals(o)){a=!0;break}}a||t.push(n)}}))})),[new d.ImageAttribute(l.clone(t))]}}}),e}(),i.OpacityAttributeHandler=function(){var e=function(){i.AttributeHandlerBase.call(this)},t={};return l.defineClass({name:"OpacityAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=[];return l.opt(e,(function(e){return e.selection.forEachSelected((function(e){var n=h.OpacityFacade.getOpacityForForma(e);t.includes(n)||t.push(n)}))})),[new d.OpacityAttribute(l.clone(t))]}}}),e}(),i.ControllerSettingAttributeHandler=function(){var e=function(){i.AttributeHandlerBase.call(this)},t={};return l.defineClass({name:"ControllerSettingAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=[];return l.opt(e,(function(e){return e.selection.forEachSelected((function(e){var n=l.opt(e.controller,(function(e){return e.settings}));null!=n&&t.push(n)}))})),[new d.ControllerSettingAttribute(l.clone(t))]}}}),e}(),i.MediaMetadataAttributeHandler=function(){var e=function(){i.AttributeHandlerBase.call(this)},t={};return l.defineClass({name:"MediaMetadataAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=[];return l.opt(e,(function(e){return e.selection.forEachSelected((function(e){var n=p.ImageUtils.getMediaMetadataForForma(e);null!=n&&t.push(n)}))})),[new d.MediaMetadataAttribute(l.clone(t))]}}}),e}(),i.ColorAttributeHandler=function(){var e=function(){i.AttributeHandlerBase.call(this)},t={};return l.defineClass({name:"ColorAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=l.clone(l.opt(e,(function(e){return e.selection.IDs}))||[]),n=[];if(0==t.length);else if(1==t.length){var a,r,o;if(a=l.opt(l.opt(e,(function(e){return e.document})),(function(e){return e.firstPage.formaByID(t[0])})))if(null!=(r=a.style.colors.colorID(c.ColorRole.FieldPrimary)))(o=a.page.colorLibraryController.getTheoColorForKey(r))?n.push(o):n.push(null);else n.push(null)}else{var i=!0;if(l.opt(e,(function(e){return e.selection.forEachSelected((function(e){e.hasIntent(u.Forma.INTENT_GRID_CELL)||"Root"==e.kind||(i=!1)}))})),i){n=[];var s=[];l.opt(e,(function(e){return e.selection.forEachSelected((function(e){var t,a;null!=(t=e.style.colors.colorID(c.ColorRole.FieldPrimary))?(a=e.page.colorLibraryController.getTheoColorForKey(t))?n.push(a):n.push(null):n.push(null)}))})),n.length>0&&s.push(n[0]);for(var f=l.iter(l.range(0,n.length-1,!0));!f.done;f.next()){var p=f.value;if(!l.eq(m._equality_TheoColor_TheoColor,s[0],n[p])){s[0]=null;break}}n=l.clone(s)}}return[new d.ColorAttribute(l.clone(n))]}}}),e}(),i.StandardAttributesHandler=function(){var e=function(e){this.dc=e},t={};return l.defineClass({name:"StandardAttributesHandler",ctor:e,statics:{handlers:{get:function(){return void 0===t.handlers&&(t.handlers=e.allHandlers()),t.handlers}},allHandlers:function(){var e=[];return e.push(i.OpacityAttributeHandler.instance),e.push(i.MediaMetadataAttributeHandler.instance),e.push(i.ImageAttributeHandler.instance),e.push(i.ColorAttributeHandler.instance),e.push(i.ControllerSettingAttributeHandler.instance),e.push(s.AnimationAttributesHandler.instance),e},_implements:function(e){return"IAttributesHandler"==e}},props:{updateAttributes:function(t){this.updateFrom(t,l.clone(e.handlers))},updateFrom:function(e,t){e.clear();for(var n=l.iter(t);!n.done;n.next())for(var a=n.value,r=l.clone(a.calculate(this.dc)),o=l.iter(r);!o.done;o.next()){var i=o.value;e.add(i)}}}}),e}()},QLFD:function(e,t,n){var a,r=t,o=n("oAGj"),i=n("Nk+Q"),l=n("CMNw"),s=n("PSFa"),c=n("elwG"),d=n("qUXk"),u=n("u+mS"),f=n("eLsM"),p=n("hsXA"),h=n("JU+l");r.NoSelectionDesignController=(a=function(e,t){d.DesignController.call(this),this.handles=new p.StandardHandlesHandler(e,t,this),this.drag=new u.DragFacadeBasedDragHandler(e,t,this),this.click=new c.StandardClickHandler(e),this.resize=h.NullResizeHandler.instance,this.actions=new l.StandardActionHandler(e),this.attributes=new s.StandardAttributesHandler(e),this.featureSets=new f.StandardFeatureSetHandler(e),this.actionFeedback=new i.StandardActionFeedbackHandler(t)},o.defineClass({name:"NoSelectionDesignController",ctor:a,superName:"DesignController"}),a)},QLmq:function(e,t,n){var a,r=t,o=n("oAGj"),i=n("7siz");r.IFeatureSetsModel=o.defineProtocol("IFeatureSetsModel",{find:"(String) -> IFeatureSet"}),r.FeatureSetsState=(a=function(e){void 0===e&&(e=null),this.featureSets=o.clone(e||{})},o.defineClass({name:"FeatureSetsState",ctor:a,superName:"EditorStateMember",statics:{_implements:function(e){return"IFeatureSetsModel"==e}},props:{clone:function(){return new a(o.clone(this.featureSets))},find:function(e){return this.featureSets[e]},clear:function(){this.beforeChange(),o.removeAll(this.featureSets),this.afterChange()},add:function(e){this.beforeChange(),this.featureSets[e.key]=e,this.afterChange()},remove:function(e){this.beforeChange(),o.removeKey(this.featureSets,e),this.afterChange()},diff:function(e){for(var t=[],n=o.iter(this.featureSets);!n.done;n.next()){var a,r=n.key,l=n.value;(a=e.featureSets[r])&&l.isEqualTo(a)||t.push(i.EditorModelChangedMessage.CHG_FEATURE_SET_PREFIX+r)}for(var s=o.iter(e.featureSets);!s.done;s.next())r=s.key,null==this.featureSets[r]&&t.push(i.EditorModelChangedMessage.CHG_FEATURE_SET_PREFIX+r);return t}}}),a)},bccX:function(e,t,n){var a,r=t,o=n("oAGj"),i=n("7siz");r.IAttributesModel=o.defineProtocol("IAttributesModel",{find:"(String) -> IEditorAttribute"}),r.AttributesState=(a=function(e){void 0===e&&(e=null),this.attributes=o.clone(e||{})},o.defineClass({name:"AttributesState",ctor:a,superName:"EditorStateMember",statics:{_implements:function(e){return"IAttributesModel"==e}},props:{clone:function(){return new a(o.clone(this.attributes))},find:function(e){return this.attributes[e]},add:function(e){this.beforeChange(),this.attributes[e.key]=e,this.afterChange()},remove:function(e){this.beforeChange(),o.removeKey(this.attributes,e),this.afterChange()},clear:function(){this.beforeChange(),o.removeAll(this.attributes),this.afterChange()},diff:function(e){for(var t=[],n=o.iter(this.attributes);!n.done;n.next()){var a,r=n.key,l=n.value;(a=e.attributes[r])&&l.isEqualTo(a)||t.push(i.EditorModelChangedMessage.CHG_ATTRIBUTE_PREFIX+r)}for(var s=o.iter(e.attributes);!s.done;s.next())r=s.key,null==this.attributes[r]&&t.push(i.EditorModelChangedMessage.CHG_ATTRIBUTE_PREFIX+r);return t}}}),a)},d820:function(e,t,n){var a,r=t,o=n("oAGj"),i=n("7siz");r.IHandlesModel=o.defineProtocol("IHandlesModel",{getAll:"() -> Array<BaseHandle>"}),r.IMutableHandlesModel=o.defineProtocol("IMutableHandlesModel",{clear:"() -> Void",setAll:"(Array<BaseHandle>) -> Void"}),r.HandlesState=(a=function(e){void 0===e&&(e=null),this.handles=o.clone(e||[])},o.defineClass({name:"HandlesState",ctor:a,superName:"EditorStateMember",statics:{_implements:function(e){return"IMutableHandlesModel"==e||"IHandlesModel"==e}},props:{clone:function(){return new a(o.clone(this.handles))},getAll:function(){return this.handles},clear:function(){this.setAll([])},setAll:function(e){this.beforeChange(),this.handles=o.clone(e),this.afterChange()},diff:function(e){return[i.EditorModelChangedMessage.CHG_HANDLES]}}}),a)},eLsM:function(e,t,n){var a,r,o,i=t,l=n("oAGj"),s=n("cmoc"),c=n("G/OM"),d=n("fdtz"),u=n("lmwz"),f=n("37nf"),p=n("djAF"),h=n("8t9B"),m=n("zjod");i.IFeatureSetHandler=l.defineProtocol("IFeatureSetHandler",{updateFeatureSets:"(FeatureSetsState) -> Void"}),i.NullFeatureSetHandler=(a=function(){},r={},l.defineClass({name:"NullFeatureSetHandler",ctor:a,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new a),r.instance}},_implements:function(e){return"IFeatureSetHandler"==e}},props:{updateFeatureSets:function(e){}}}),a),i.StandardFeatureSetHandler=(o=function(e){this.dc=e},l.defineClass({name:"StandardFeatureSetHandler",ctor:o,statics:{_implements:function(e){return"IFeatureSetHandler"==e}},props:{updateFeatureSets:function(e){var t,n,a,r,o,i,f,g,v,b,S=this,A=0,H=0,C=0,F=0,T=0,w=0,D=!1,M=!1,y=!1,k=!1,E=0,R=!1,P=!1,_=!1,N=!1,I=!1,x=!1,G=0,B=0,L=0,z=(t=l.opt(this.dc,(function(e){return e.selection.selectedCount})))||null!=t?t:0,O=!1;if((b=l.opt(this.dc,(function(e){return e.document})))&&(L=b.firstPage.root.filterWithCallback((function(e){return!(!(n=l.opt(e.controller,(function(e){return e.canMultiSelect})))&&null==n)&&n})).length),l.opt(this.dc,(function(e){return e.selection.forEachSelected((function(e){var t;e.isTypeLockup()&&(A+=1),(e instanceof d.ImageForma||e instanceof s.FrameForma)&&(C+=1),e instanceof m.VideoForma?F+=1:(t=l.as(e,s.FrameForma))&&t.childAt(0)instanceof m.VideoForma&&(F+=1),e instanceof p.ShapeForma&&(T+=1),((a=l.opt(e.controller,(function(e){return e.moveable})))||null!=a)&&a&&(H+=1),((r=l.opt(e.controller,(function(e){return e.opacityChangeable})))||null!=r)&&r&&(B+=1),((o=l.opt(e.controller,(function(e){return e.canGroup})))||null!=o)&&o&&(w+=1),((i=l.opt(e.controller,(function(e){return e.userGroupMember})))||null!=i)&&i&&(e.controller.userGroup&&!e.controller.userGroupChild?D=!0:e.controller.userGroup||(D=!e.controller.enableChildMove)),((f=l.opt(e.controller,(function(e){return e.deleteable})))||null!=f)&&f&&(E+=1),((g=l.opt(e.controller,(function(e){return e.duplicatable})))||null!=g)&&g&&(G+=1),O=O||e.isShape()||e.isTypeLockup(),1==z&&(S.hasLicenseInfo(e)&&(M=!0),l.opt(e.controller,(function(e){return null!=e.settings}))&&(y=!0),((v=l.opt(e.controller,(function(e){return e.replaceable})))||null!=v)&&v&&(R=!0),e.controller instanceof h.TypeLockupController&&(k=!0),P=u.ImageFacade.canCropImage(e),_=u.ImageFacade.canSetBackgroundImage(e),N=u.ImageFacade.canSetFloatingImage(e),I=u.ImageFacade.canApplyBackgroundColor(e),x=u.ImageFacade.canApplyCutout(e))}))})),C>0&&(O=!1),e.clear(),1==A&&1==z&&e.add(new c.TextFrameAttributesFeature),H==z&&H>1&&e.add(new c.AlignSpacingAttributesFeature(!0,H>2,!0,!0)),B==z&&B>0&&e.add(new c.OpacityAttributesFeature),z>0&&e.add(new c.FormaEditFeature(L>1,G==z,w==z&&w>1,D,O,E==z,y,k)),C+T==z){var U=new c.ImageFeature(C==z&&C>0,R,M,P,_,N,I,x);e.add(U)}F==z&&e.add(new c.VideoAttributesFeature)},hasLicenseInfo:function(e){var t=f.ImageUtils.getMediaMetadataForForma(e);return!(null==t||!t.sourceHasLicense())}}}),o)},elwG:function(e,t,n){var a,r,o,i,l=t,s=n("oAGj"),c=n("0wFF"),d=n("FNB+"),u=n("iCxV"),f=n("lmwz"),p=n("6Tzw");l.IClickHandler=s.defineProtocol("IClickHandler",{handleClick:"(FormaClickEvent) -> Void",handleDoubleClick:"(FormaDoubleClickEvent) -> Void"}),l.NullClickHandler=(a=function(){},r={},s.defineClass({name:"NullClickHandler",ctor:a,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new a),r.instance}},_implements:function(e){return"IClickHandler"==e}},props:{handleClick:function(e){},handleDoubleClick:function(e){}}}),a),l.StandardClickHandler=(o=function(e){this.dc=e},s.defineClass({name:"StandardClickHandler",ctor:o,statics:{_implements:function(e){return"IClickHandler"==e}},props:{nearestSelectable:function(e,t){var n,a,r=null;if(r=((n=s.opt(s.opt(e,(function(e){return e.controller})),(function(e){return e.selectable})))||null!=n)&&n?e:s.opt(e,(function(e){return e.visit(d.FormaTraversal.NearestAncestor,(function(e,t,n){return!(!(a=s.opt(e.controller,(function(e){return e.selectable})))&&null==a)&&a}))})),this.dc.selection.inCharStyleMode)return r;var o,i,l=1==t.modifierKeys.shift||1==t.modifierKeys.command||1==t.modifierKeys.control;if((o=s.opt(r,(function(e){return e.controller})))&&(i=o.userGroupRoot)){if(l&&this.dc.selection.isSelected(i))return r=i;for(var c=[i],u=s.clone(i.filterWithCallback((function(e){return null!=e.controller}))),f=[],p=s.iter(u);!p.done;p.next()){var h,m,g,v=p.value;if((h=v.totalPlacement.inverse)&&(m=v.bounds)&&(g=t.clickLocation)){var b=h.transformPoint(g);!m.containsPoint(b)||!v.controller.selectable||v.controller.userGroup&&!this.dc.enableMoveableChildren||s.containsEq(c,v,d._equality_Forma_Forma)||(v.controller.userGroup?c.push(v):f.splice(0,0,v))}}c=c.concat(f);var S=!1;if(r=s.first(c),c.length>1)for(var A=s.iter(s.range(0,c.length,!1));!A.done;A.next()){var H=A.value;this.dc.selection.isSelected(c[H])&&(r=c[T=H==c.length-1?0:H+1],S=!0)}if(!S)for(var C=s.iter(this.dc.selection.asFormaArray());!C.done;C.next()){var F=C.value;if(F.isDescendent(i))if(this.dc.enableMoveableChildren){for(var T=0,w=s.iter(s.range(0,c.length,!1));!w.done;w.next())H=w.value,F.isDescendent(c[H])&&(T=Math.min(H+1,c.length-1));r=c[T]}else r=s.last(c)}}return r},handleClick:function(e){var t,n=this;if(t=this.nearestSelectable(e.forma,e)){var a,r=1==e.modifierKeys.shift||1==e.modifierKeys.command||1==e.modifierKeys.control;a=u.Host.platform.isWeb?"Web":u.Host.platform.isIOS?"iOS":u.Host.platform.isAndroid?"Android":"Unknown",r&&!this.dc.selection.inCharStyleMode?this.dc.selection.isSelected(t)?(this.dc.selection.deselectForma(t),s.opt(u.Host.logging,(function(e){return e.logToAnalytics(c.AnalyticsConstants.kAnalyticsEventClickOccured,{contextualData2:"New selected count: "+s.toString(n.dc.selection.selectedCount),contextualData3:"Did deselect: yes",contextualData4:"Platform: "+a})}))):this.canAddToSelection(t)&&(p.SelectionFacade.selectFormae([t]),s.opt(u.Host.logging,(function(e){return e.logToAnalytics(c.AnalyticsConstants.kAnalyticsEventClickOccured,{contextualData2:"New selected count: "+s.toString(n.dc.selection.selectedCount),contextualData3:"Did deselect: no",contextualData4:"Platform: "+a})}))):this.dc.selection.isSelected(t)?u.Host.platform.isWeb||this.dc.selection.inCropMode||this.dc.selection.deselectForma(t):s.opt(u.Host.platform,(function(e){return 1==e.isWeb||n.dc.selection.selectedCount<2||t.controller.canMultiSelect}))&&!this.dc.selection.inCropMode&&(this.dc.selection.inCharStyleMode=!1,this.dc.selection.replaceSelection(t),this.dc.controllerSettingsState.settings=null)}s.opt(this.dc,(function(t){return t.notifyClick(e)}))},canAddToSelection:function(e){var t,n,a;if(s.opt(this.dc,(function(e){return 0==e.selection.selectedCount})))return!0;if(a=s.opt(this.dc,(function(e){return e.selection.formaAt(0)}))){var r=e;return r.isImage()&&(r=f.ImageFacade.getFrameFormaForForma(r)||e),!(!(t=s.opt(r.controller,(function(e){return e.moveable})))&&null==t)&&t&&!(!(n=s.opt(a.controller,(function(e){return e.moveable})))&&null==n)&&n}return!0},handleDoubleClick:function(e){s.opt(e.forma.controller,(function(t){return t.onEvent(e)})),s.opt(this.dc,(function(t){return t.notifyDoubleClick(e)}))}}}),o),l.CropModeClickHandler=(i=function(e){l.StandardClickHandler.call(this,e)},s.defineClass({name:"CropModeClickHandler",ctor:i,superName:"StandardClickHandler",statics:{_implements:function(e){return"IClickHandler"==e}},props:{handleDoubleClick:function(e){}}}),i)},hsXA:function(e,t,n){var a,r,o,i,l=t,s=n("oAGj"),c=n("1HsO"),d=n("t1qz"),u=n("Mr7n");l.IHandlesHandler=s.defineProtocol("IHandlesHandler",{handleTransformEvent:"(HandleTransformEvent) -> Void",handleFormaDragEvents:"(PSMFormaDragControllerEvent) -> Void",updateHandles:"(IMutableHandlesModel) -> Void"}),l.NullHandlesHandler=(a=function(){},r={},s.defineClass({name:"NullHandlesHandler",ctor:a,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new a),r.instance}},_implements:function(e){return"IHandlesHandler"==e}},props:{handleTransformEvent:function(e){},handleFormaDragEvents:function(e){},updateHandles:function(e){}}}),a),l.IHandleGenerator=s.defineProtocol("IHandleGenerator",{addHandles:"(BaseHandlesHandler) -> Array<BaseHandle>"}),l.IHandleProcessor=s.defineProtocol("IHandleProcessor",{handleTransformEvent:"(BaseHandlesHandler, HandleTransformEvent) -> Boolean",handleFormaDragEvents:"(BaseHandlesHandler, PSMFormaDragControllerEvent) -> Boolean"}),l.BaseHandlesHandler=(o=function(e,t){this.dc=null,this.model=null,this.delegate=null,this.activeTransform=c.TransformType.None,this.handleGenerators=[],this.handleProcessors=[],this.dc=e,this.delegate=t},s.defineClass({name:"BaseHandlesHandler",ctor:o,superName:"CoreObject",statics:{_implements:function(e){return"IHandlesHandler"==e}},props:{handleTransformEvent:function(e){for(var t=s.iter(this.handleProcessors);!t.done&&!t.value.handleTransformEvent(this,e);t.next());},handleFormaDragEvents:function(e){for(var t=s.iter(this.handleProcessors);!t.done&&!t.value.handleFormaDragEvents(this,e);t.next());},updateHandles:function(e){for(var t=[],n=s.iter(this.handleGenerators);!n.done;n.next()){var a=n.value;s.append(t,a.addHandles(this))}e.setAll(s.clone(t))},addHandleGenerator:function(e){this.handleGenerators.push(e)},removeHandleGenerator:function(e){this.handleGenerators=this.handleGenerators.filter((function(t){return t!==e}),this)},clearHandleGenerators:function(){this.handleGenerators=[]},addHandleProcessor:function(e){this.handleProcessors.push(e)},removeHandleProcessor:function(e){this.handleProcessors=this.handleProcessors.filter((function(t){return t!==e}),this)},clearHandleProcessors:function(){this.handleProcessors=[]}}}),o),l.StandardHandlesHandler=(i=function(e,t,n){l.BaseHandlesHandler.call(this,e,n),this.addHandleGenerator(d.StandardHandleGenerator.instance),this.addHandleProcessor(new u.StandardHandleProcessor(t))},s.defineClass({name:"StandardHandlesHandler",ctor:i,superName:"BaseHandlesHandler",statics:{_implements:function(e){return"IHandlesHandler"==e}}}),i)},mD2h:function(e,t,n){var a,r,o,i=t,l=n("oAGj"),s=n("7siz"),c=n("FNB+");i.IActiveSwapModel=l.defineProtocol("IActiveSwapModel",{getActive:"() -> ActiveSwap"}),i.ActiveSwap=(a=function(e,t){this.swapThumbnailForma=e,this.swapThumbnailLocation=t},r={},l.defineClass({name:"ActiveSwap",ctor:a,superName:"CoreObject",statics:{NONE:{get:function(){return void 0===r.NONE&&(r.NONE=new a(null,null)),r.NONE}}}}),a),i.ActiveSwapState=(o=function(e){void 0===e&&(e=null),this.activeSwap=e||i.ActiveSwap.NONE},l.defineClass({name:"ActiveSwapState",ctor:o,superName:"EditorStateMember",statics:{_implements:function(e){return"IActiveSwapModel"==e}},props:{clone:function(){return new o(this.activeSwap)},getActive:function(){return this.activeSwap},setActive:function(e){this.beforeChange(),this.activeSwap=e,this.afterChange()},diff:function(e){return l.eq(c._equality_Forma_Forma,this.activeSwap.swapThumbnailForma,e.activeSwap.swapThumbnailForma)&&this.activeSwap.swapThumbnailLocation==e.activeSwap.swapThumbnailLocation?[]:[s.EditorModelChangedMessage.CHG_SWAP_STATE]}}}),o)},"nQ/X":function(e,t,n){var a,r=t,o=n("oAGj"),i=n("Nk+Q"),l=n("CMNw"),s=n("PSFa"),c=n("elwG"),d=n("qUXk"),u=n("u+mS"),f=n("eLsM"),p=n("hsXA");r.CharStyleModeDesignController=(a=function(e,t){this.dc=e,d.DesignController.call(this),this.handles=new p.BaseHandlesHandler(e,this),this.drag=new u.DragFacadeBasedDragHandler(e,t,this),this.click=new c.StandardClickHandler(e),this.actions=new l.StandardActionHandler(e),this.attributes=new s.StandardAttributesHandler(e),this.featureSets=new f.StandardFeatureSetHandler(e),this.actionFeedback=new i.StandardActionFeedbackHandler(t)},o.defineClass({name:"CharStyleModeDesignController",ctor:a,superName:"DesignController"}),a)},qUXk:function(e,t,n){var a,r,o,i=t,l=n("oAGj"),s=n("Nk+Q"),c=n("CMNw"),d=n("PSFa"),u=n("elwG"),f=n("gXiO"),p=n("u+mS"),h=n("eLsM"),m=n("hsXA"),g=n("G9CY"),v=n("JU+l"),b=n("9X7Y");i.HandlerFactory=(a=function(){},l.defineClass({name:"HandlerFactory",ctor:a,props:{drag:{get:function(){return p.NullDragHandler.instance}},click:{get:function(){return u.NullClickHandler.instance}},resize:{get:function(){return v.NullResizeHandler.instance}},rotate:{get:function(){return b.NullRotateHandler.instance}},actions:{get:function(){return c.NullActionHandler.instance}},handles:{get:function(){return m.NullHandlesHandler.instance}},attributes:{get:function(){return d.NullAttributesHandler.instance}},featureSets:{get:function(){return h.NullFeatureSetHandler.instance}}}}),a),i.DesignController=(r=function(){this.click=u.NullClickHandler.instance,this.drag=p.NullDragHandler.instance,this.resize=v.NullResizeHandler.instance,this.move=g.NullMoveHandler.instance,this.rotate=b.NullRotateHandler.instance,this.actions=c.NullActionHandler.instance,this.handles=m.NullHandlesHandler.instance,this.attributes=d.NullAttributesHandler.instance,this.featureSets=h.NullFeatureSetHandler.instance,this.actionFeedback=s.NullActionFeedbackHandler.instance,f.CoreObject.call(this)},o={},l.defineClass({name:"DesignController",ctor:r,superName:"CoreObject",statics:{NullController:{get:function(){return void 0===o.NullController&&(o.NullController=new r),o.NullController}}},props:{configureEditorModel:function(e){this.handles.updateHandles(e.mutable.handles),this.attributes.updateAttributes(e.mutable.attributes),this.featureSets.updateFeatureSets(e.mutable.featureSets)}}}),r)},t1qz:function(e,t,n){var a,r,o=t,i=n("oAGj"),l=n("SpAV"),s=n("FNB+"),c=n("cmoc"),d=n("iCxV"),u=n("1HsO"),f=n("c+uM"),p=n("tGKA"),h=n("8t9B");o.StandardHandleGenerator=(a=function(){},r={},i.defineClass({name:"StandardHandleGenerator",ctor:a,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new a),r.instance}},_implements:function(e){return"IHandleGenerator"==e}},props:{addHandles:function(e){var t,n;if(n=i.opt(e.dc,(function(e){return e.selection}))){var a=i.clone(n.asFormaArray());return 0==a.length?this.handleNoSelectionCase(e):n.inCharStyleMode?this.handleCharStyleSelectionCase(e,i.clone(a)):1==a.length?n.inCropMode||!(t=i.opt(a[0].controller,(function(e){return e.userGroupMember})))&&null==t||!t?this.handleSingleSelectionCase(e,a[0]):this.handleGroupSelectionCase(e,a[0]):this.handleMultiSelectionCase(e,i.clone(a))}return[]},handleNoSelectionCase:function(e){return[]},handleSingleSelectionCase:function(e,t){var n,a,r,o,l,d,p,m=[];if((d=t.controller)&&(p=t.bounds)){var g=[],v=[];d.moveable&&(g.push(u.TransformType.Translate),t.isShape()&&!t.hasIntent(s.Forma.INTENT_ICON)||v.push(u.BoxHandleDisplayHint.ThinOutline));var b,S=!(!(n=i.opt(d.owner,(function(e){return e.selection.inSpacingMode})))&&null==n)&&n;t.isTypeLockup()&&(v.push(u.BoxHandleDisplayHint.TextFrame),(b=i.as(d,h.TypeLockupController))&&(b.text.length>300&&v.push(u.BoxHandleDisplayHint.SuppressResizeAnimation),f.LockupStyle.isKnockoutLook(b.lockupStyle.textLook)&&v.push(u.BoxHandleDisplayHint.SuppressResizeAnimation)));var A=!(!(a=i.opt(d.owner,(function(e){return e.selection.inCropMode})))&&null==a)&&a;if(A&&v.push(u.BoxHandleDisplayHint.CropMode),!d.rotateable||S||A||(g.push(u.TransformType.RotateAboutCenter),t instanceof c.FrameForma&&!d.moveable&&v.push(u.BoxHandleDisplayHint.SuppressRotationHandle)),!d.userGroupChild||((r=i.opt(d.owner,(function(e){return e.enableMoveableChildren})))||null!=r)&&r){if(d.floating&&!t.isGridCell()){g.push(u.TransformType.TopLeftCornerTranslate);var H=i.as(t.style,f.LockupStyle);null!=H&&S&&!f.LockupStyle.isPath((o=i.opt(H,(function(e){return e.layout})))||null!=o?o:f.LockupLayout.Standard)?(g.push(u.TransformType.LetterSpacing),g.push(u.TransformType.LineSpacing)):(g.push(u.TransformType.TopRightCornerTranslate),g.push(u.TransformType.BottomLeftCornerTranslate),g.push(u.TransformType.BottomRightCornerTranslate),((l=i.opt(i.as(d,h.TypeLockupController),(function(e){return e.canResizeHorizontally})))||null!=l)&&l&&(g.push(u.TransformType.LeftSideTranslate),g.push(u.TransformType.RightSideTranslate),i.opt(H,(function(e){return e.alignment==f.LockupAlignment.Right}))&&v.push(u.BoxHandleDisplayHint.PreferLeftSideHandle)))}for(var C=i.iter(d.visibleSelectionHandlePositions);!C.done;C.next()){var F=C.value;.5==F.x?0==F.y?g.push(u.TransformType.TopSideTranslate):g.push(u.TransformType.BottomSideTranslate):.5==F.y&&(0==F.x?g.push(u.TransformType.LeftSideTranslate):g.push(u.TransformType.RightSideTranslate))}}m.push(new u.BoxTransformHandles(new u.BoxReference(t.totalPlacement,p),i.clone(g),i.clone(v),e.activeTransform,t.formaID))}return m},handleGroupSelectionCase:function(e,t){var n=[],a=[u.TransformType.RotateAboutCenter,u.TransformType.TopLeftCornerTranslate,u.TransformType.TopRightCornerTranslate,u.TransformType.BottomLeftCornerTranslate,u.TransformType.BottomRightCornerTranslate];if(l.CoreAssert.isTrue(t.controller.userGroupMember,void 0,"StandardHandleGenerator.handleGroupSelectionCase","StandardHandleGenerator.swift",165),t.controller.userGroupChild){var r=[];e.dc.enableMoveableChildren?(r.push(u.BoxHandleDisplayHint.ThinOutline),t.controller.userGroup&&r.push(u.BoxHandleDisplayHint.GroupOutlineColor)):(r.push(u.BoxHandleDisplayHint.SuppressTranslationHandle),r.push(u.BoxHandleDisplayHint.WideOutline));var o=i.clone(e.dc.enableMoveableChildren?a:[u.TransformType.Translate]);n.push(new u.BoxTransformHandles(new u.BoxReference(t.totalPlacement,t.bounds),i.clone(o),i.clone(r),e.activeTransform,t.formaID));var s=e.dc.enableMoveableChildren?t.parent:t.controller.userGroupRoot,c=s.bounds,f=[u.BoxHandleDisplayHint.GroupOutlineColor];e.dc.enableMoveableChildren?f.push(u.BoxHandleDisplayHint.WideOutline):(f.push(u.BoxHandleDisplayHint.SuppressTranslationHandle),f.push(u.BoxHandleDisplayHint.ThinOutline),c=c.outsetXY(8,8)),n.splice(0,0,new u.BoxTransformMultipleFormae(new u.BoxReference(s.totalPlacement,c),i.clone(e.dc.enableMoveableChildren?[]:a),i.clone(f),e.activeTransform,d.Host.platform.isIOS?t.formaID:s.formaID,[s.formaID]))}else n.push(new u.BoxTransformMultipleFormae(new u.BoxReference(t.totalPlacement,t.bounds),i.clone(a),[u.BoxHandleDisplayHint.ThinOutline,u.BoxHandleDisplayHint.GroupOutlineColor],e.activeTransform,t.formaID,[t.formaID]));return n},handleMultiSelectionCase:function(e,t){var n=[],a=[];a.push(u.BoxHandleDisplayHint.ThinOutline);for(var r=[],o=null,l=i.iter(t);!l.done;l.next()){var c=l.value,d=c.finalFrame,f=c.formaID;if(o=null==o?d:o.unionWith(d),c.hasIntent(s.Forma.INTENT_INFERRED_TEMP_GROUP)){o=c.finalFrame;break}r.includes(f)||r.push(f)}if(i.sortInPlace(r),null==o)return[];var h=[u.TransformType.Translate,u.TransformType.TopLeftCornerTranslate,u.TransformType.TopRightCornerTranslate,u.TransformType.BottomLeftCornerTranslate,u.TransformType.BottomRightCornerTranslate];return n.push(new u.BoxTransformMultipleFormae(new u.BoxReference(p.Matrix2D.Identity,o),i.clone(h),i.clone(a),e.activeTransform,r.reduce((function(e,t){return e+"/"+t}),""),i.clone(r))),n},handleCharStyleSelectionCase:function(e,t){return[]}}}),a)},"u+mS":function(e,t,n){var a,r,o,i,l,s=t,c=n("oAGj"),d=n("Tq01"),u=n("0wFF"),f=n("mD2h"),p=n("pjjd"),h=n("wNKJ"),m=n("FNB+"),g=n("Pil/"),v=n("cmoc"),b=n("iCxV"),S=n("H1Z2"),A=n("hsXA"),H=n("lmwz"),C=n("D89E");s.IDragHandler=c.defineProtocol("IDragHandler",{handleFormaDragEvents:"(PSMFormaDragControllerEvent) -> Void"}),s.NullDragHandler=(a=function(){},r={},c.defineClass({name:"NullDragHandler",ctor:a,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new a),r.instance}},_implements:function(e){return"IDragHandler"==e}},props:{handleFormaDragEvents:function(e){},isDragging:function(){return!1}}}),a),s.DragFacadeBasedDragHandler=(o=function(e,t,n){this.dragging=!1,this.swappableFormae=[],this.swapTargetForma=null,this.inSwapMode=!1,this.originalPlacement=null,this.swapModeHandleGenerator=new C.SwapModeHandleGenerator,this.originalHandleGenerators=[],this.dc=e,this.model=t,this.delegate=n},c.defineClass({name:"DragFacadeBasedDragHandler",ctor:o,statics:{_implements:function(e){return"IDragHandler"==e}},props:{updateHandles:function(){var e,t;(e=this.model)&&(t=this.delegate)&&(e.beginUpdates(),t.handles.updateHandles(e.mutable.handles),e.updatesComplete())},handleFormaDragEvents:function(e){var t,n,a,r,o,i,l=this;if((t=this.dc)&&(n=this.model)&&(a=this.delegate))if(r=c.as(e,g.BeginFormaDragEvent)){(M=c.as(a.handles,A.BaseHandlesHandler))&&(this.originalHandleGenerators=c.clone(M.handleGenerators)),this.swappableFormae=c.clone(h.DragFacade.getSwappableFormae(r)),null!=c.first(e.dragDelegate.draggedFormae)&&(this.originalPlacement=c.opt(c.first(e.dragDelegate.draggedFormae),(function(e){return e.placement}))),t.undoRedoMgr.beginBranch();var s=c.clone(e.dragDelegate.draggedFormae),v=s.filter((function(e){return c.opt(e.controller,(function(e){return 1==e.duplicatable}))}),this).length>0;1==e.dragDelegate.modifierKeys.alt&&1==v&&t.doAction(new p.DuplicateAction(c.clone(s),!1,!1,!0)),t.undoRedoMgr.beginGesture();var H=c.opt(t.document,(function(e){return e.beginTransaction("begin_forma_drag")}));h.DragFacade.processBeginFormaDrag(r),c.opt(H,(function(e){return e.end()})),this.updateHandles()}else if(o=c.as(e,g.FormaDragEvent)){var C=this.swapTargetForma;if(t.designControllerHandlesSwap){var F=c.opt(t.document,(function(e){return e.beginTransaction("enter_swap_mode")})),T=h.DragFacade.getSwapState(o,c.clone(this.swappableFormae),C,this.inSwapMode,this.originalPlacement),w=T[0],D=T[1];this.inSwapMode=w,this.swapTargetForma=D,c.opt(F,(function(e){return e.end()}))}if(null==(y=this.getDraggedFormaForEvent(e)))return;if(!c.eq(m._equality_Forma_Forma,this.swapTargetForma,C)){var M=c.as(a.handles,A.BaseHandlesHandler);c.opt(M,(function(e){return e.clearHandleGenerators()})),null==this.swapTargetForma||c.eq(m._equality_Forma_Forma,this.swapTargetForma,y)?(c.opt(M,(function(e){return e.removeHandleGenerator(l.swapModeHandleGenerator)})),this.swapModeHandleGenerator.clearSwapTargetForma()):(c.opt(M,(function(e){return e.addHandleGenerator(l.swapModeHandleGenerator)})),this.swapModeHandleGenerator.setSwapTargetForma(this.swapTargetForma))}this.inSwapMode||t.doActionWithCompletion(new S.DragAction(o,null),(function(e,t){var a,r;(a=c.as(e,d.DragActionResult))&&(r=a.snapLines)&&(n.beginUpdates(),n.mutable.snapLines.setAll(c.clone(r)),n.updatesComplete())})),this.inSwapMode&&(n.beginUpdates(),n.mutable.activeSwap.setActive(new f.ActiveSwap(y,o.drag.pointers[0].currentLocation)),n.updatesComplete()),this.updateHandles()}else if(i=c.as(e,g.EndFormaDragEvent)){c.opt(b.Host.logging,(function(n){return n.logToAnalytics(u.AnalyticsConstants.kAnalyticsFormaeDragged,{contextualData1:"Selected count: "+t.selection.selectedCount,contextualData2:"Dragged count: "+e.dragDelegate.draggedFormae.length})})),n.beginUpdates(),n.mutable.snapLines.clear(),n.updatesComplete();var y=this.getDraggedFormaForEvent(e);if(this.inSwapMode){if(M=c.as(a.handles,A.BaseHandlesHandler)){M.clearHandleGenerators();for(var k=c.iter(this.originalHandleGenerators);!k.done;k.next()){var E=k.value;M.addHandleGenerator(E)}}if(n.beginUpdates(),n.mutable.activeSwap.setActive(new f.ActiveSwap(null,null)),n.updatesComplete(),null==y)return t.selection.clearSelection(),this.updateHandles(),this.swapTargetForma=null,this.inSwapMode=!1,this.originalPlacement=null,t.undoRedoMgr.endGesture(!1),void t.undoRedoMgr.endBranch(!1);null==this.swapTargetForma||c.eq(m._equality_Forma_Forma,this.swapTargetForma,y)?(t.selection.replaceSelection(y),this.updateHandles(),this.swapTargetForma=null,this.inSwapMode=!1,this.originalPlacement=null,t.undoRedoMgr.endGesture(!1),t.undoRedoMgr.endBranch(!1)):t.doActionWithCompletion(new S.DragAction(i,this.swapTargetForma),(function(e,n){t.selection.replaceSelection(y),l.updateHandles(),l.swapTargetForma=null,l.inSwapMode=!1,l.originalPlacement=null,t.undoRedoMgr.endGesture(!0),t.undoRedoMgr.endBranch(!0)}))}else t.doActionWithCompletion(new S.DragAction(i,null),(function(e,n){l.updateHandles(),l.swapTargetForma=null,l.inSwapMode=!1,l.originalPlacement=null,t.undoRedoMgr.endGesture(!0),t.undoRedoMgr.endBranch(!0)}))}},getDraggedFormaForEvent:function(e){var t,n;return 0==!e.dragDelegate.draggedFormae.length&&(n=c.first(e.dragDelegate.draggedFormae),((t=c.opt(n,(function(e){return e.isImage()})))||null!=t)&&t&&(n=c.opt(n,(function(e){return e.parent})))),n}}}),o),s.CroppingDragFacadeBasedDragHandler=(i=function(e,t,n){s.DragFacadeBasedDragHandler.call(this,e,t,n)},c.defineClass({name:"CroppingDragFacadeBasedDragHandler",ctor:i,superName:"DragFacadeBasedDragHandler",statics:{_implements:function(e){return"IDragHandler"==e}},props:{getDraggedFormaForEvent:function(e){var t,n=s.DragFacadeBasedDragHandler.prototype.getDraggedFormaForEvent.call(this,e);return c.opt(n,(function(e){return e.kind==v.FrameForma.KIND}))&&(t=H.ImageFacade.getImageFormaForForma(n))&&(n=t),n}}}),i),s.MultiObjectDragHandler=(l=function(e,t,n){this.startPlacements={},this.basePlacements={},this.dragging=!1,this.dc=e,this.model=t,this.delegate=n},c.defineClass({name:"MultiObjectDragHandler",ctor:l,statics:{_implements:function(e){return"IDragHandler"==e}},props:{updateHandles:function(){var e,t;(e=this.model)&&(t=this.delegate)&&(e.beginUpdates(),t.handles.updateHandles(e.mutable.handles),e.updatesComplete())},handleFormaDragEvents:function(e){var t,n,a,r,o,i=this;if((t=this.dc)&&(n=this.model))if(a=c.as(e,g.BeginFormaDragEvent)){for(var l=c.clone(e.dragDelegate.draggedFormae),s=!0,f=c.iter(l);!f.done;f.next()){var m=f.value;c.opt(m.controller,(function(e){return 0==e.duplicatable}))&&(s=!1)}t.undoRedoMgr.beginBranch(),1==e.dragDelegate.modifierKeys.alt&&1==s&&t.doAction(new p.DuplicateAction(c.clone(l),!1,!1,!0)),h.DragFacade.processBeginFormaDrag(a),t.undoRedoMgr.beginGesture(),this.updateHandles()}else(r=c.as(e,g.FormaDragEvent))?t.doActionWithCompletion(new S.DragAction(r,null),(function(e,t){var a,r;(a=c.as(e,d.DragActionResult))&&(r=a.snapLines)&&(n.beginUpdates(),n.mutable.snapLines.setAll(c.clone(r)),n.updatesComplete(),i.updateHandles())})):(o=c.as(e,g.EndFormaDragEvent))&&(c.opt(b.Host.logging,(function(n){return n.logToAnalytics(u.AnalyticsConstants.kAnalyticsFormaeDragged,{contextualData1:"Selected count: "+t.selection.selectedCount,contextualData2:"Dragged count: "+e.dragDelegate.draggedFormae.length})})),n.beginUpdates(),n.mutable.snapLines.clear(),n.updatesComplete(),t.doActionWithCompletion(new S.DragAction(o,null),(function(e,n){i.updateHandles(),t.undoRedoMgr.endGesture(!0),t.undoRedoMgr.endBranch(!0)})),this.updateHandles())},isDragging:function(){return this.dragging}}}),l)},yHU1:function(e,t,n){var a,r,o,i=t,l=n("oAGj"),s=n("SpAV"),c=n("gXiO"),d=n("quOg"),u=n("FNB+"),f=n("Pil/"),p=n("fWxZ"),h=n("P83h"),m=n("iCxV"),g=n("1HsO"),v=n("lmwz"),b=n("g8Fi"),S=n("KIfs"),A=n("6Tzw"),H=n("mxdD");i.BeginPointerTrackingResponseEnum=l.defineEnum("BeginPointerTrackingResponseEnum",{TrackAsGroup:0,TrackWithinGroup:1,DoNotTrack:2}),i.IPSMDelegate=l.defineProtocol("IPSMDelegate",{handleEvent:"(PSMFormaControllerEvent) -> Void"}),i.nearestFormaWithController=function(e){return null==e?(l.opt(m.Host.logging,(function(e){return e.error("nearestFormaWithController nil startingForma")})),null):l.opt(e,(function(e){return e.visit(u.FormaTraversal.NearestAncestor,(function(e,t,n){return null!=e.controller}))}))},i.getNearestActionableController=function(e){return null==e?(l.opt(m.Host.logging,(function(e){return e.error("getNearestActionableController nil startingForma")})),null):e.visit(u.FormaTraversal.NearestAncestor,(function(e,t,n){var a;return!!(a=e.controller)&&(a.selectable||a.moveable)}))},i.targetForma=function(e,t,n){if(null==t)return[null,null];for(var a=i.getNearestActionableController(t),r=t;null!=a;){if(null==a.controller)return s.CoreAssert.fail("PSMpD getNearest calls failed","targetForma","FormaDrag.swift",79),[null,r];var o,l=f.BeginPointerTrackingEvent.init_bef7(a,[r],n);if(e.handleEvent(l),l.trackingResponse!=i.BeginPointerTrackingResponseEnum.TrackAsGroup)return l.trackingResponse==i.BeginPointerTrackingResponseEnum.TrackWithinGroup?[a.controller,r]:(s.CoreAssert.isTrue(l.trackingResponse==i.BeginPointerTrackingResponseEnum.DoNotTrack,void 0,"targetForma","FormaDrag.swift",105),[null,r]);if(!(o=a.parent))return[null,r];r=a,a=i.nearestFormaWithController(o),s.CoreAssert.isTrue(null!=a,"nearestFormaWithController unexpectedly returned nil for forma kind:"+o.kind,"targetForma","FormaDrag.swift",92)}return[null,r]},i.FormaState=(a=function(e,t){this.draggedForma_=e,this.startPlacement_=t},l.defineClass({name:"FormaState",ctor:a,props:{update:function(){this.startPlacement_=this.draggedForma_.placement},clone:function(){return new a(this.draggedForma_,this.startPlacement_)}}}),a),i.FormaPageDragDelegate=(r=function(e,t,n){this.draggedFormae_=[],this.delegate=e,this.dragController=t,this.modifierKeys={},c.CoreObject.call(this);for(var a=l.iter(n);!a.done;a.next()){var r=a.value;this.targetNewForma(r)}},l.defineClass({name:"FormaPageDragDelegate",ctor:r,superName:"CoreObject",statics:{_implements:function(e){return"ActiveDragDelegateProtocol"==e}},props:{draggedFormae:{get:function(){return this.draggedFormae_.map((function(e){return e.draggedForma_}),this)}},updateModifierKeys:function(e){e.pointers.length>0&&(this.modifierKeys=l.clone(e.pointers[0].modifierKeys))},targetNewForma:function(e){this.draggedFormae_.push(l.clone(new i.FormaState(e,e.placement)))},startPlacementObsolete:{get:function(){return l.first(this.draggedFormae_).startPlacement_}},forEachDraggedForma:function(e){for(var t=l.iter(this.draggedFormae_);!t.done;t.next()){var n=t.value;e(n.draggedForma_,n.startPlacement_)}},activeDragDidBegin:function(e){var t=new f.BeginFormaDragEvent(e);this.delegate.handleEvent(t)},activeDragDidActivate:function(e){return 1!=e.pointers.length||e.pointers[0].type!=b.PointerTypeEnum.Mouse},activeDragDidDeactivate:function(e,t){if(t){var n=new h.FormaAlignmentChangedEvent(l.first(this.draggedFormae),[],null);l.first(this.draggedFormae).beginUpdate(n),l.first(this.draggedFormae).endUpdate(n)}},activeDragClaimNewPointers:function(e,t,n){var a=[],r=[],o=e.pointers.length;s.CoreAssert.isTrue(o>0&&t.length>0,void 0,"FormaPageDragDelegate.activeDragClaimNewPointers","FormaDrag.swift",222);for(var i=!0,c=l.iter(this.draggedFormae);!c.done;c.next()){var d;if((d=c.value.controller)&&!d.rotateable){i=!1;break}}for(var u=l.iter(t);!u.done;u.next()){var f=u.value;n?a.push(f):i?r.push(f):a.push(f)}return e.commitWithNewPointers(r,!0),a=a.concat(r)},activeDragDidCommit:function(e){for(var t=l.iter(l.range(0,this.draggedFormae_.length,!1));!t.done;t.next()){var n=t.value;this.draggedFormae_[n].update()}},activeDragDidMove:function(e,t){var n=new f.FormaDragEvent(e);this.delegate.handleEvent(n),this.updateModifierKeys(e)},activeDragDidChangePace:function(e,t,n){},activeDragHeldPointerEndedAsTap:function(e,t){},activeDragDidEnd:function(e,t,n){if(t){var a=new f.EndFormaDragEvent(e);this.delegate.handleEvent(a)}else for(var r=l.opt(e.pointerStateMachine,(function(e){return e.owner})).selection,o=l.iter(n);!o.done;o.next()){var s=o.value;if(!s.cancelled){var c,d,u=l.opt(l.as(s.currentPage,p.FormaPage),(function(e){return e.formaAtPoint(s.startLocation,void 0,null)}));if(null==u)return;(c=i.getNearestActionableController(u))&&(s.tapCount%2==1?((d=new f.FormaClickEvent(c)).clickLocation=s.startLocation,d.modifierKeys=l.clone(e.activeDragDelegate.modifierKeys),!m.Host.platform.isWeb&&A.SelectionFacade.enableAdditionalMultiSelectGestures()&&null!=c.controller&&c.controller.canMultiSelect&&(r.selectedCount>1||n.length>1)&&(d.modifierKeys.shift=!0),this.delegate.handleEvent(d)):((d=new f.FormaDoubleClickEvent(c)).clickLocation=s.startLocation,d.modifierKeys=l.clone(e.activeDragDelegate.modifierKeys),this.delegate.handleEvent(d)))}}}}}),r),i.FormaPagePointerStateMachineDelegate=(o=function(e){this.myDrags=[],this.delegate=e,c.CoreObject.call(this)},l.defineClass({name:"FormaPagePointerStateMachineDelegate",ctor:o,superName:"CoreObject",statics:{_implements:function(e){return"PointerStateMachineDelegateProtocol"==e}},props:{activeDragDidFinish:function(e,t){l.remove(this.myDrags,t)},formaeInFlight:function(){for(var e=[],t=l.iter(this.myDrags);!t.done;t.next()){var n=t.value.activeDragDelegate;e=e.concat(n.draggedFormae)}return e},createDragsForPointers:function(e,t,n,a){for(var r=l.clone(t),o=l.clone(this.newDragsForPointers(e,r,n,a)),i=l.iter(o);!i.done;i.next()){var s=i.value;e.appendDrag(s),this.myDrags.push(s)}return r},newDragsForPointers:function(e,t,n,a){var r=[];if(0==t.length)return r;var o=l.as(e.owner,d.DocumentController),s=l.opt(o,(function(e){return e.selection})),c=function(e,t){var n,a;return(n=l.opt(e,(function(e){return e.viewportTransform})))?Math.sqrt(Math.abs(n.determinant)):(n=l.opt(l.opt(t,(function(e){return e.page.view})),(function(e){return e.getViewportTransform()})))?Math.sqrt(Math.abs(n.determinant)):null!=(a=l.opt(o,(function(e){return e.viewScale})))?a:1},f=!0;if(m.Host.platform.isWeb&&!s.inCropMode){f=!1;for(var h=l.iter(t);!h.done;h.next())if(h.value.type==b.PointerTypeEnum.Touch){f=!0;break}if(!f&&(A.SelectionFacade.isMultiSelect(s)||A.SelectionFacade.isGroupSelect(s))&&1==t.length&&t[0].type==b.PointerTypeEnum.Mouse){var C=l.clone(o.model.handles.getAll());if(C.length>0&&null!=l.as(C[0],g.BoxTransformHandles)){var F=C[0],T=F.reference.bounds,w=F.reference.placement.inverse.transformPoint(t[0].currentLocation);f=T.containsPoint(w)}}}var D,M=null,y=[];if(D=l.opt(s,(function(e){return e.asFormaArray()})))for(var k=l.iter(D);!k.done;k.next()){var E,R,P,_=k.value,N=_;l.opt(s,(function(e){return 1==e.inCropMode&&v.ImageFacade.isFrame(_)}))?(E=v.ImageFacade.getImageFormaForForma(_))&&(N=E):((R=H.VideoFacade.getVideoFormaForForma(_))&&(N=R),(P=v.ImageFacade.getImageFormaForForma(_))&&(P.isLogo()||(N=P)));var I=i.targetForma(this.delegate,N,s),x=I[0],G=I[1];(U=x)&&(j=G)&&(null==M?(M=U,y.push(j)):l.opt(M,(function(e){return e.kind==U.kind}))&&y.push(j))}if(f&&null!=M&&0==a){(J=new i.FormaPageDragDelegate(this.delegate,M,l.clone(y))).modifierKeys=l.clone(t[0].modifierKeys);for(var B=!0,L=l.iter(y);!L.done;L.next()){var z=L.value;if((U=z.controller)&&!U.rotateable){B=!1;break}}if(!B)for(;t.length>1;)t.pop();var O=new S.ActiveDrag(e,J,t,null,c(null,null));r.push(O)}for(;t.length>0;){var U,j,W=t.pop(),q=(N=l.opt(l.as(W.currentPage,p.FormaPage),(function(e){return e.formaAtPoint(W.startLocation,void 0,null)})),i.targetForma(this.delegate,N,s));if(x=q[0],G=q[1],(U=x)&&(j=G)){for(var K=l.iter(r);!K.done;K.next()){var V=K.value,X=V.activeDragDelegate,Y=X.dragController==U&&l.eq(u._equality_Forma_Forma,l.first(X.draggedFormae),j);if(!n||Y){if(j.controller.rotateable){var Q=[W];V.commitWithNewPointers(Q,!0)}O=V;break}}if(null==O){if(!n&&a+r.length>0)break;var J;(J=M==U&&l.containsEq(y,j,u._equality_Forma_Forma)&&a+r.length==0?new i.FormaPageDragDelegate(this.delegate,U,l.clone(y)):new i.FormaPageDragDelegate(this.delegate,U,[j])).modifierKeys=l.clone(W.modifierKeys),Q=[W],O=new S.ActiveDrag(e,J,Q,null,c(W,j)),r.push(O)}}}return r}}}),o)}}]);
//# sourceMappingURL=vendors_npm_spark_3fc4b535-a43e28f0.js.map