(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{1048:function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}},1049:function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},1050:function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},2503:function(e,t,i){var a=i(2504);"string"==typeof a&&(a=[[e.i,a,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};i(92)(a,n);a.locals&&(e.exports=a.locals)},2504:function(e,t,i){(e.exports=i(91)(!1)).push([e.i,".ccx-share-sheet-container .spark-web div.spectrum.spectrum--light{background:transparent}.ccx-share-sheet-container .ccx-ss-dialog{background:#fff}.ccx-share-sheet-container .ccx-ss-dialog .ccx-ss-dialog-title{line-height:inherit}.ccx-share-sheet-container .ccx-ss-dialog .ccx-ss-dialog-title span{font-size:18pt;font-weight:800}.ccx-share-sheet-container .ccx-ss-dialog .ccx-ss-flex-input-children .spectrum-Tags-itemLabel{font-size:13px;font-weight:400;line-height:21px}.ccx-share-sheet-container .ccx-ss-dialog .ccx-ss-invite-footer-cta-container button span{font-weight:800}",""])},438:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return k}));var a=i(619),n=i.n(a),r=i(23),o=i.n(r),s=i(20),l=i.n(s),c=i(1),d=i.n(c),g=i(4),m=i.n(g),v=i(7),u=i.n(v),h=i(9),p=i.n(h),f=i(16),w=i.n(f),b=i(64),y=i.n(b);i(2503);function _(e){if(e&&e.startsWith("mailto")){var t=e.lastIndexOf("@");return t>0?"mailto:REDACT".concat(e.substring(t)):"mailto:xxx"}return e}var k=function(){function e(){o()(this,e)}return l()(e,[{key:"_handleClose",value:function(e){window.marvel.logger.traceflow("collaboration:invitations","_handleClose: ".concat(JSON.stringify(e))),this._hideShareSheet(),this._cleanupDOM(),this._summarizeResults(),this.defer.resolve(e||[])}},{key:"_handlePermissionRevoked",value:function(){var e=this.docId;this._handleClose("PERMISSION REVOKED"),window.marvel.navigate("/shared",{trigger:!0}),window.marvel.events.trigger("show-app-toast-message",{message:w.a.formatMessage("organizer-user-self-removed"),variant:"info"}),y.a.load().then((function(t){t.ACPSparkController.deleteProjectLocal(t.ACPSparkController.getLocalProjectById(e)),window.marvel.events.trigger("organizer-reload-datasource")})).catch((function(t){return marvel.logger.warn("CollabUI handlePermissionRevoked folder cleanup failed",{docId:e,err:t})}))}},{key:"_hideShareSheet",value:function(){this&&this.targetElement&&this.targetElement.classList&&this.targetElement.classList.add("hide")}},{key:"_cleanupDOM",value:function(){if(this._hideShareSheet(),this&&this.targetElement){var e=this.targetElement.children&&this.targetElement.children[0];e&&(this.ReactDOM.unmountComponentAtNode(e),this.targetElement.removeChild(e))}}},{key:"_parseCollaborationResponse",value:function(e){return[].concat(n()(e.collaborators.map((function(e){return e.email}))),n()(e.invitations.map((function(e){return e.recipientEmail}))))}},{key:"_summarizeAdditions",value:function(e,t){var i=[];if(this._inviteFulfilled){var a,n,r,o,s={n:0},l=[];if(e.forEach((function(e){var t=Math.floor(e.statusCode/100),n=e.recipientDisplayName||e.recipientEmail;2===t?s.user1?s.user2?s.n++:s.user2=n:s.user1=n:409===e.statusCode?l.push(n):"403.1"===e.errorSubcode||(400===e.statusCode&&"Cannot invite yourself"===e.statusText?a=w.a.formatMessage("organizer-item-invite-warn-cannot-invite-self"):t>=4&&(window.marvel.logger.traceflow("collaboration:invitations","_summarizeAdditions - error sending invite: ".concat(JSON.stringify(e))),i.push(n)))})),a&&window.marvel.events.trigger("show-app-toast-message",{message:a,variant:"warning"}),l.length>0)n=1===l.length?w.a.formatMessage("organizer-item-invite-warn-already-collaborating",{user:l[0]}):w.a.formatMessage("organizer-item-invite-warn-already-collaborating-multiple",{userList:l.join(", ")}),window.marvel.events.trigger("show-app-toast-message",{message:n,variant:"warning"});if(s.n>0?(r="organizer-3+-user-invited",o=s.n+2):s.user2?(r="organizer-2-user-invited",o=2):s.user1&&(r="organizer-1-user-invited",o=1),r){var c=w.a.formatMessage(r,s);window.marvel.events.trigger("show-app-toast-message",c),window.marvel.logger.traceflow("collaboration:invitations","sending inviteSent analytics for ".concat(o," users")),p.a.trackEvent("collab:inviteSent",{sparkFormat:this.sparkFormat,contextualData1:"numRecipients:"+o,contextualData11:"messageAdded:"+t,contextualData12:"inviteType:project"})}}return i}},{key:"_summarizeRemovals",value:function(e){var t=e.length;if(t){window.marvel.logger.traceflow("collaboration:invitations","sending inviteRemoved analytics for ".concat(t," users")),p.a.trackEvent("collab:inviteRemoved",{contextualData1:t,contextualData12:"inviteType:project"});var i,a={user1:e[0]&&(e[0].name||e[0].email||""),user2:e[1]&&(e[1].name||e[1].email||""),n:t-2};i=t>2?"organizer-3+-user-removed":2===t?"organizer-2-user-removed":"organizer-1-user-removed";var n=w.a.formatMessage(i,a);window.marvel.events.trigger("show-app-toast-message",n)}}},{key:"_summarizeResults",value:function(){var e=this._summarizeAdditions(this.addedUsers||[],this.inviteIncludedMessage?"yes":"no");if(e&&e.length){window.marvel.logger.error("Failed to send invitations for ".concat(e.length," users!"));var t=w.a.formatMessage("organizer-item-invite-failure",{userList:e.join(", ")});window.marvel.events.trigger("show-app-toast-message",{message:t,variant:"error"}),p.a.trackEvent("collab:inviteFailed",{contextualData12:"inviteType:project"})}this._summarizeRemovals(this.removedUsers||[])}},{key:"_handleInviteSubmit",value:function(e){this.possiblePromiseResolution=this._getCollaboratorsFromInviteResults(e),this.addedUsers=e&&e.recipients,window.marvel.logger.traceflow("collaboration:invitations","_handleInviteSubmit: ".concat(JSON.stringify(e)))}},{key:"_filterPII",value:function(e,t){if(!["recipientEmail","email","displayName","senderName","recipientDisplayName"].includes(e))return"name"===e?this.mimeType?t:void 0:"recipient"===e?_(t):t}},{key:"_logEvent",value:function(e,t){try{window.marvel.logger.info(e,JSON.parse(JSON.stringify(t,this._filterPII)))}catch(i){window.marvel.logger.info(e,t)}}},{key:"_handleDialogChange",value:function(e){window.marvel.logger.traceflow("collaboration:invitations","_handleDialogChange: ".concat(JSON.stringify(e))),e&&e.event&&("inviteFulfilled"===e.event?(this._inviteFulfilled=!0,this._handleClose(this.possiblePromiseResolution),this._logEvent("collaborators invited",e)):"inviteRejected"===e.event?this._handleClose([]):"removeFulfilled"===e.event?(this.removedUsers=[].concat(n()(this.removedUsers?this.removedUsers:[]),n()(e.data?e.data:[])),this._logEvent("collaborators removed",e)):"inviteSent"===e.event&&(this.inviteIncludedMessage=e.message,this._logEvent("invites sent",Object.assign({},e,{recipients:e.recipients.map(_)}))))}},{key:"_handleValidationRequiredToast",value:function(e){var t=w.a.formatMessage("organizer-item-invite-error-unverified"),i=w.a.formatMessage("organizer-item-invite-error-unverified-resend-button");window.marvel.events.trigger("show-app-toast-message",{message:t,timeout:0,variant:"error",actionLabel:i,closeOnAction:!0,onClose:this._closeToast.bind(this),onAction:this._resendInvite.bind(this,e)})}},{key:"_handleSharingRestrictionToast",value:function(e){var t=this.addedUsers.reduce((function(e,t){return"403.1"===t.errorSubcode&&e.push(t.recipientDisplayName||t.recipientEmail),e}),[]),i=t.join(", "),a=t.length>1?"organizer-item-invite-error-sharing-restriction":"organizer-item-invite-error-sharing-restriction-single",n=w.a.formatMessage(a,{userList:i}),r=w.a.formatMessage("organizer-item-invite-error-sharing-restriction-learnmore-button");window.marvel.events.trigger("show-app-toast-message",{message:n,timeout:0,variant:"error",actionLabel:r,closeOnAction:!0,onClose:this._closeToast.bind(this),onAction:this._learnMore.bind(this,e)})}},{key:"_handleDialogRequest",value:function(e){if(window.marvel.logger.traceflow("collaboration:invitations","_handleDialogRequest, data=".concat(JSON.stringify(e))),"error"===e.state){var t=!1;e.actions&&e.actions.validationNeeded&&(t=!0,this._handleValidationRequiredToast(e.actions.validationNeeded.href)),e.actions&&e.actions.learnMore&&(t=!0,this._handleSharingRestrictionToast(e.actions.learnMore.href)),t||(window.marvel.logger.error("collabUI unhandled error returned",e),window.marvel.events.trigger("show-app-toast-message",{message:w.a.formatMessage("organizer-collaboration-error-description"),variant:"error"}))}}},{key:"_closeToast",value:function(e){window.marvel.logger.traceflow("collaboration:invitations","in _closeToast")}},{key:"_resendInvite",value:function(e){window.marvel.logger.traceflow("collaboration:invitations","_resendInvite, url=".concat(e)),u.a.ajax({type:"GET",url:e,headers:{"x-api-key":m.a.key}}).then((function(e){window.marvel.events.trigger("show-app-toast-message",w.a.formatMessage("organizer-item-invite-resend-verification"))})).fail((function(e){window.marvel.events.trigger("show-app-toast-message",{message:w.a.formatMessage("organizer-item-invite-resend-failed"),variant:"error"}),window.marvel.logger.error("Resend verification email failed",e)}))}},{key:"_learnMore",value:function(e){window.marvel.logger.traceflow("collaboration:invitations","_learnMore, url=".concat(e)),window.open(e,"_blank")}},{key:"_getCollaboratorsFromInviteResults",value:function(e){return e&&e.recipients?e.recipients.reduce((function(e,t){return 201===t.statusCode&&e.push(t.recipientEmail),e}),[]):[]}},{key:"abortDialog",value:function(){this._handleClose([])}},{key:"handleCollabUI",value:function(e){var t=this;return this.defer=d.a.defer(),this.docId=e.get("id"),Promise.all([Promise.all([i.e("m-react-spectrum"),i.e(2),i.e(3),i.e("vendors~brandswitcher~ccx-share-sheet~missingfontsmodal~non-editor-search-react~react-personalizer"),i.e("ccx-share-sheet")]).then(i.t.bind(null,2847,7)),Promise.all([i.e("m-react-spectrum"),i.e(2),i.e(3),i.e("vendors~brand-kit-controller~brand-kit-editor~logged-in-app~react~search-controller~slate-app-ac-theme-editor"),i.e("react")]).then(i.t.bind(null,503,7)),Promise.all([i.e("m-react-spectrum"),i.e(2),i.e(3),i.e("vendors~brand-kit-controller~brand-kit-editor~logged-in-app~react~search-controller~slate-app-ac-theme-editor"),i.e("react")]).then(i.t.bind(null,519,7)),e.getURN(),u.a.getAccessToken()]).then((function(i){var a=i[0].ShareSheetProvider,n=i[0].ShareSheetDialog,r=i[1];t.ReactDOM=i[2];var o=i[3],s=i[4],l=(window.location.origin||window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""))+"/sp/accept-invite/"+window.encodeURIComponent(o),c=window.adobeIMS.getUserProfile(),d=window.platform&&window.platform.os&&"function"==typeof window.platform.os.toString?window.platform.os.toString():"unknown",g=w.a.formatMessage("collaboration-invite-collaborators"),v={assetData:{id:e.assetId||e.get&&e.get("id")||"",name:e.name||e.get&&e.get("name")||"",mimeType:e.type||e.get&&e.get("type")||"",resourceId:e.getStorageURL(),resourceViewUrl:l},analyticsData:{consumer:{client_id:m.a.key,name:"Spark",os_version:d,version:m.a&&m.a.buildVersion||"1.0",platform:"Web"}},imsData:{token:s,id:c.userId,email:c.email,isVerified:"true"===c.emailVerified},idpClientId:m.a.key,invitationServiceApiKey:m.a.key,peopleGraphApiKey:m.a.key,environment:m.a.ccxShareSheetEnvironment,locale:w.a.getLocale(),onClose:t._handleClose.bind(t),onDialogChange:t._handleDialogChange.bind(t),onMessageRequest:t._handleDialogRequest.bind(t),onPermissionRevoked:t._handlePermissionRevoked.bind(t),openedDialog:"invite",theme:"light",title:g},u={inviteDialogData:{allowRemoveAll:!0,defaultUserRole:"editor",emailNotification:{acceptance:{editor:"cc_collab_spark_share"}},inviteCreateAnsNotification:{},inviteCreateUseMounts:!0,inviteCreateAcceptanceRequired:!0,messageConfig:{placeholder:w.a.getString("collab-invite-dialog-placeholder-text")}},native:!1,showCloseButton:!0,showHeader:!0,tabletMode:!1,peopleGraphActive:!0,onClose:t._handleClose.bind(t),onInviteSubmit:t._handleInviteSubmit.bind(t)};t.sparkFormat=e.getMyApp().typeName,t.targetElement=document.getElementsByClassName("ccx-share-sheet-overlay")[0];var h=document.createElement("div");h.id="ccx-share-sheet-div",t.targetElement.appendChild(h),t.targetElement.classList.remove("hide"),t.ReactDOM.render(r.createElement("div",{className:"mrvl-overlay-overlay-bg"},r.createElement(a,v,r.createElement("div",{className:"ccx-share-sheet-container"},r.createElement(n,u)))),h)})).catch((function(e){window.marvel.logger.error("Exception bringing up ccx-share-sheet: ".concat(e)),t._cleanupDOM(),t.defer.reject("failed to initialize or display ccx-share-sheet: ".concat(e))})),this.defer.promise}}]),e}()},619:function(e,t,i){var a=i(1048),n=i(1049),r=i(1050);e.exports=function(e){return a(e)||n(e)||r()}}}]);
//# sourceMappingURL=11-ab3bab46.js.map