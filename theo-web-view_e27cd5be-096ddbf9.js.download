(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[86,71,79],{"4pbt":function(e,t,o){var n,a;n=[o("xeH2"),o("UFvF"),o("YLtl"),o("Uwho"),o("gBAB"),o("2ofD"),o("Na8G"),o("tY4j"),o("zTjw"),o("bBG2"),o("MGCh"),o("l+ZV"),o("+Ltv"),o("ZLL8"),o("8DU0"),o("Dcjk"),o("3xdQ"),o("3xm6"),o("Avqh"),o("KFmL"),o("+VG/"),o("WPh2"),o("sggK"),o("2Fsf"),o("0VUy"),o("5eso"),o("TW0n"),o("C8IR"),o("W1Jy"),o("M1RA"),o("NgGw"),o("tpS0"),o("0gXD"),o("z4rR"),o("7LIx"),o("/Elb"),o("r30K"),o("KQv+"),o("FIWz"),o("UXma"),o("mYMA"),o("vdJz"),o("e8qH"),o("wRAw"),o("GN+k"),o("W3p6"),o("mTyn"),o("7VrH"),o("uZvm"),o("efk3"),o("ZXGz"),o("jo99"),o("HPKp"),o("FpXA"),o("OI2j"),o("UzQk"),o("lulf"),o("dcsN"),o("Ctaw"),o("Exk9"),o("+gTl"),o("a8ov"),o("TdwW"),o("O0ct"),o("QX4k"),o("1geK"),o("WpJZ"),o("I/Z9"),o("GnB6"),o("2PxR"),o("mwMu"),o("qnb0"),o("8VGm"),o("b2xK"),o("pVEn"),o("pEL3"),o("/nf9"),o("hSNs"),o("Pbp+"),o("GSfz"),o("fuLW"),o("d/MO"),o("dO52"),o("kdSY"),o("Ww1C"),o("3Jkv"),o("rjtT"),o("TY/+"),o("ynbG"),o("tQ0N"),o("Mbmg"),o("q6ln"),o("4hMT"),o("UNP3"),o("XR60")],void 0===(a=function(e,t,n,a,r,i,s,l,d,c,p,u,g,m,b,h,f,w,v,T,k,I,P,S,B,C,x,y,D,A,E,L,M,F,W,N,R,z,U,G,O,j,H,_,V,K,$,q,X,Y,Q,Z,J,ee,te,oe,ne,ae,re,ie,se,le,de,ce,pe,ue,ge,me,be,he,fe,we,ve,Te,ke,Ie,Pe,Se,Be,Ce,xe,ye,De,Ae,Ee,Le,Me,Fe,We,Ne,Re,ze,Ue,Ge,Oe){const je=le.default,He=ve.default,_e=Re.default,Ve=c.default,Ke=pe.default,$e=ze.default,qe=Ue.default,Xe=ne.default,Ye=b.default,Qe=ae.default,Ze=We.default,Je=Oe.default,et=ue.default,tt=u.default,ot={STALE_SESSION:"Stale Session"};Be.init();var nt,at,rt,it,st=Ae(),lt=p.channel("controller"),dt={},ct=!0,pt=!1,ut={errorDialogs:{}},gt=[],mt=-1,bt=t.defer(),ht=t.defer();ht.resolve();var ft,wt,vt,Tt,kt,It,Pt,St,Bt,Ct,xt=!1,yt=!1,Dt=null,At={DOCUMENT:1,TEMPLATE:2},Et=new Xe,Lt=new Qe(Et),Mt="app.kDefaultDocName",Ft="app.kDefaultTemplateName",Wt=["showFacebookUploadButton","showImageModalPanelOnload","showShareButton","showDownloadButton"],Nt={default:{isDefault:!0,showShareButton:!0,showDownloadButton:!0},"facebook-cover-image-design":{showFacebookUpdateCoverButton:!0,showNoProfilePic:!1,showImageModalPanelOnload:!0},"facebook-holiday-ad-design":{showFacebookUploadButton:!0,showImageModalPanelOnload:!0},"twitter-design":{showTwitterUpload:!0}},Rt=!1,zt=!1,Ut="",Gt="",Ot="";if(dt.enabled=!1,window.newrelic&&window.newrelic.setCustomAttribute){const e=window.adobeIMS.getUserProfile().userId;window.newrelic.setCustomAttribute("adobeId",e)}function jt(){g.inPremiumTemplateOnboardingFlow=!0,Jt()}function Ht(e){ut.collabStatusButton.$el.toggleClass("shared-document",!!e)}function _t(e){i.currentDoc===e.composite&&(Ht(e.collab.collaborators.length+e.collab.invitations.length>0),ut.brandIndicator&&ut.brandIndicator.update({collaborationStatus:i.currentDoc.getCollaboration()||"NONE"}))}function Vt(e){Sa(e.authContext).then(()=>{ut.brandIndicator.events.publish("brand-switch-complete")}).done()}function Kt(){if(St&&St.newTemplateId){var e="design-edit-template/post/"+St.contextId+"/"+St.newTemplateId;marvel.navigate(e,{trigger:!1,replace:!0})}}function $t(e){var t="design/post/"+e;marvel.navigate(t,{trigger:!1,replace:!0})}var qt=!1;function Xt(){ut.addContentPopUp.$el.addClass("slide-right-fade-out"),ut.addContentButton.$el.removeClass("rotate"),qt=!1,ut.postEditorView.$el.off("click",Xt),setTimeout((function(){ut.addContentPopUp.hide(),ut.addContentPopUp.$el.removeClass("slide-right-fade-out")}),300)}function Yt(e){qt?Xt():(Ve.publish("editor:addPressed"),ut.addContentPopUp.$el.addClass("slide-left-fade-in"),ut.addContentPopUp.show(),ut.addContentButton.$el.addClass("rotate"),ut.addContentButton.$el.removeClass("large"),qt=!0,t.resolve().then((function(){ut.postEditorView.$el.on("click",Xt)})),setTimeout((function(){ut.addContentPopUp.$el.removeClass("slide-left-fade-in")}),300))}function Qt(){const e=at.hasAnimationStyle();dt.isImageV2Enabled=Et.featureEnabled("post-enable-server-rendering")&&st;const t=dt.webAnimationEnabled()&&e?[{label:w.translate("app.downloadOptions.mp4Video720p.kButtonLabel"),filetype:"mp4_SEVEN_TWENTY_P",betaflag:!0,tooltipMessage:w.translate("app.downloadOptions.mp4Video.kTooltip")}]:[],o=dt.isImageV2Enabled?[{label:w.translate("app.downloadOptions.pngImgV2.kButtonLabel"),filetype:"img_png_v2",betaflag:!0,tooltipMessage:w.translate("app.downloadOptions.pngImgV2.kTooltip")}]:[],n=dt.isImageV2Enabled?[{label:w.translate("app.downloadOptions.jpgImgV2.kButtonLabel"),filetype:"img_jpeg_v2",betaflag:!0,tooltipMessage:w.translate("app.downloadOptions.jpgImgV2.kTooltip")}]:[];return{downloadOptionsList:[...t,{label:w.translate("app.downloadOptions.pngImg.kButtonLabel"),filetype:"img_png",tooltipMessage:w.translate("app.downloadOptions.pngImg.kTooltip")},{label:w.translate("app.downloadOptions.jpgImg.kButtonLabel"),filetype:"img_jpg",tooltipMessage:w.translate("app.downloadOptions.jpgImg.kTooltip")},...o,...n,{label:w.translate("app.downloadOptions.printPdf.kButtonLabel"),filetype:"pdf",betaflag:!0,tooltipMessage:w.translate("app.downloadOptions.printPdf.kTooltip")}],selectedOption:dt.webAnimationEnabled()&&e?"mp4_SEVEN_TWENTY_P":"img_png"}}async function Zt(){pt=!0;var e=ft===At.TEMPLATE?"template-mode main-toolbar toolbar":"main-toolbar toolbar";if(ut.postEditorView=new D({id:"PostEditorContent",layout:"rows",parent:ut.windowPanel,panels:[{id:"PostTopBar",class:e,size:"66px"},{id:"PostApp",size:"auto"}]}),ut.topColorStrip=new v({parent:"PostTopBar",id:"colorStrip",tag:"DIV"}),ft!==At.TEMPLATE?(ut.postAppSection=new D({layout:"columns",panels:[{id:"PostCanvasSection",size:"auto"},{id:"PostControlSection",size:"280px"},{id:"PostNavStrip",size:"80px"}],parent:"PostApp"}),ut.postControlStrip=new D({layout:"rows",panels:[{id:"PostBrandIndicatorContainer",size:"50px"},{id:"PostSidebar",size:"auto"}],parent:"PostControlSection"}),ut.brandIndicator=new F({collaborationStatus:i.currentDoc.getCollaboration(),height:50,id:"PostBrandIndicator",isEntitled:Et.featureEnabled("entitle-brand-kit"),parent:"PostBrandIndicatorContainer",navigateToCreateBrandMethod:Aa,width:280})):ut.postAppSection=new D({layout:"columns",parent:"PostApp",panels:[{id:"PostCanvasSection",size:"auto"},{id:"PostSidebar",size:"280px"},{id:"PostNavStrip",size:"80px"}]}),ut.postContentSection=new D({layout:"rows",parent:"PostCanvasSection",panels:[{id:"PostContentSection",size:"auto"},{id:"PostActionsStrip",size:"0px"}]}),ut.canvasInteractionLayer=new B({id:"canvasInteractionLayer",parent:"PostCanvasSection",onPointerDown:function(e){var t=eo(e.x,e.y);at.handlePointerChanged({updateType:"pointerDown",x:t.x,y:t.y,pointerType:e.pointerType,pointerId:e.pointerId,tapCount:e.tapCount,modifierKeys:e.modifierKeys})},onPointerUp:function(e){var t=eo(e.x,e.y);at.handlePointerChanged({updateType:"pointerUp",x:t.x,y:t.y,pointerType:e.pointerType,pointerId:e.pointerId,tapCount:e.tapCount,modifierKeys:e.modifierKeys})},onPointerMove:function(e){var t=eo(e.x,e.y);at.handlePointerChanged({updateType:"pointerMove",x:t.x,y:t.y,pointerType:e.pointerType,pointerId:e.pointerId,tapCount:e.tapCount,modifierKeys:e.modifierKeys})}}),ut.imageWrapper=new y({id:"PosterImageWrapper",parent:ut.canvasInteractionLayer,aspect:1,margin:40,marginLeft:70,marginRight:70,minTop:100}),Et.featureEnabled("post-enable-zendesk-widget")&&(xe.loadZendeskWidget(),ut.feebackButton=new k({parent:ut.canvasInteractionLayer,class:"feedback-button",width:40,height:40,onClick:function(){window.zE.activate({hideOnClose:!0})}})),ft===At.TEMPLATE&&ut.imageWrapper.$el.on("click",(function(){ut.docNameInput.blur()})),ut.poster=new te({parent:ut.imageWrapper,watermarkEnabled:ct}),oe.Host.setPosterView(ut.poster),dt.webAnimationEnabled()&&(ut.animationPlayButton=new Ne({parent:ut.imageWrapper,class:"animation-playback-button",hidden:!at.hasAnimationStyle(),poster:ut.poster,playAnimation:function(e){Oa(e)},pauseAnimation:function(e){ja(e)}})),ut.postTopBarLeft=new S({parent:"PostTopBar",id:"PostTopBarLeft",class:"application-options",height:"auto",width:ft===At.TEMPLATE?"auto":495}),ut.postTopBarMid=new S({parent:"PostTopBar",id:"PostTopBarMid",class:"document-options",template:"",height:"auto",width:"auto"}),ut.postTopBarRight=new S({parent:"PostTopBar",id:"PostTopBarRight",class:"editor-options",height:"auto",left:"auto",width:360}),ft===At.TEMPLATE?(ut.saveTemplateButton=new T({parent:"PostTopBarLeft",class:"pill pill-primary-on-light",hidden:!1,label:"i18n.common.kSave",onClick:no}),ut.cancelTemplateButton=new T({parent:"PostTopBarLeft",class:"pill pill-secondary-on-light",hidden:!1,label:"i18n.common.kCancel",onClick:ao})):(ut.hamburgerMenu=new T({parent:"PostTopBarLeft",class:"hamburgerButton mrvl-hamburger-menu",attributes:{"data-auto":"mrvl-hamburger-menu"},label:" ",tag:"div",onClick:function(){window.marvel&&window.marvel.events.trigger("mrvl-show-global-nav")}}),ut.homeButton=new T({parent:"PostTopBarLeft",class:"homeButton",id:"PostHomeButton",label:" ",tag:"div",onClick:Da}),ut.postLogo=new S({parent:"PostTopBarLeft",id:"PostLogo",template:"i18n.app.kPost",class:"name"}),ut.navCrumbs=new S({parent:"PostTopBarLeft",id:"PostTopBarNavCrumbs"}),ut.backToProjects=new T({class:"post-top-bar-crumb",parent:ut.navCrumbs,label:"i18n.app.kProjects",onClick:Ea}),ut.carrotOne=new v({class:"post-top-bar-carrot",parent:ut.navCrumbs})),ut.docNameInput=new ke({parent:ft===At.TEMPLATE?"PostTopBarLeft":ut.navCrumbs,onFocusOut:function(){var e=ut.docNameInput.getText();if(e.trim().length<1){e="";var t=ft===At.TEMPLATE?Ft:Mt,o=w.translate(t);ut.docNameInput.setText(o),ut.docNameInput.$el.addClass("placeholder"),ut.docNameInput.$el.removeClass("named")}else{(ft===At.TEMPLATE?ie.getTemplateName(Pt):i.currentDoc.getProjectName())!==e?Ve.publish("renameDocument",{}):Ve.publish("renameDocumentCancelled",{}),ut.docNameInput.$el.removeClass("placeholder"),ut.docNameInput.$el.addClass("named")}!function(e){ft===At.TEMPLATE?ie.setTemplateName(Pt,e):i.currentDoc.setProjectName(e);at.requestSave()}(e),ut.editNameButton.$el.css("visibility","visible")},onFocus:function(){Ve.publish("renameDocumentClicked",{}),at.deselect(),ut.editNameButton.$el.css("visibility","hidden"),ut.docNameInput.$el.hasClass("placeholder")&&(ut.docNameInput.setText(""),ut.docNameInput.$el.removeClass("placeholder"),ut.docNameInput.$el.addClass("named"))},attributes:{"data-i18n":"[aria-label]app.kPostNameInputLabel"}}),ut.editNameButton=new k({parent:ft===At.TEMPLATE?"PostTopBarLeft":ut.navCrumbs,class:"edit-name-button",width:16,height:16,onClick:function(){ut.docNameInput.focus(),ut.editNameButton.$el.css("visibility","hidden")}}),ut.savingIndicator=new v({id:"PostSavingIndicator",parent:"PostTopBarLeft",template:"i18n.app.kSaving",hidden:!0}),ut.undo=new T({parent:"PostTopBarMid",id:"PostUndoButton",tag:"div",hoverLabel:"i18n.app.kUndo",hoverLabelPosition:"below",label:"i18n.app.kUndo",onClick:to}),ut.redo=new T({parent:"PostTopBarMid",id:"PostRedoButton",tag:"div",hoverLabel:"i18n.app.kRedo",hoverLabelPosition:"below",label:"i18n.app.kRedo",onClick:oo}),Et.featureEnabled("post-enable-debug-menu")&&(ut.debugMenu=new T({parent:"PostTopBarMid",id:"PostDebugMenuButton",tag:"div",label:"Debug",onClick:function(){ut.debugView.show()}}),ut.debugView=new N({id:"PostDebugView",parent:"PostCanvasSection"})),ft!==At.TEMPLATE){ut.collabStatusButton=new k({parent:"PostTopBarRight",class:"collabStatusButton",width:50,height:63,onClick:function(){lo("projectHeader")}}),Ht(i.currentDoc.attributes.collaboration&&"NONE"!==i.currentDoc.attributes.collaboration);const{downloadOptionsList:e,selectedOption:t}=Qt(),o={selectedOption:t,parent:"PostTopBarRight",id:"downloadButton",name:"filetype",label:w.translate("app.kDownload"),submitButtonLabel:w.translate("app.kStartDownload"),optionsList:e,onIMGDownload:po,onIMGDownloadV2:dt.isImageV2Enabled?uo:void 0,onMP4Download720p:dt.webAnimationEnabled()?mo:void 0,onPDFDownload:go,onOptionsShown:bo};ut.downloadButton=new ye(o);const n={parent:"PostTopBarRight",id:"postShareMenu",menutitle:w.translate("app.kShare"),onClick:co,icon:"/images/sp-editor-share.svg",menuitems:[{icon:"/marvel-core/images/share/sp-editor-publish.svg",menuItemText:w.translate("app.shareMenuItems.publish.kMenuItemText"),tooltipMessage:w.translate("app.shareMenuItems.publish.kTooltip"),id:"sharemenu-publish"},{icon:"/marvel-core/images/share/sp-editor-invite.svg",menuItemText:w.translate("app.shareMenuItems.invite.kMenuItemText"),tooltipMessage:w.translate("app.shareMenuItems.invite.kTooltip"),id:"sharemenu-invite"}]};ut.sharePostButton=new De(n),Le.getAccountType().then((function(e){Le.shouldShowNewBadge().then((function(t){const o=[...n.menuitems],a=t?w.translate("app.shareMenuItems.lms.kMenuItemTag"):"";"teacher"===e&&o.push({icon:"/marvel-core/images/share/sp-editor-canvas-lms.svg",menuItemText:w.translate("app.shareMenuItems.lms.kAttachText"),id:"sharemenu-lms-attach",menuItemTag:a}),"student"===e&&o.push({icon:"/marvel-core/images/share/sp-editor-canvas-lms.svg",menuItemText:w.translate("app.shareMenuItems.lms.kTurninText"),id:"sharemenu-lms-attach",menuItemTag:a}),ut.sharePostButton.update({menuitems:o,menutitle:n.menutitle,icon:n.icon}),t&&(ut.lmsCoachmark||(ut.lmsCoachmark=new Ie({parent:"postShareMenu",id:"lmsCoachmark",message:"i18n.components.coachmarks.lms.kMessage",arrowDirection:"top-right",closeButtonType:"icon",height:52,width:330,top:66,hidden:!0,left:"calc(100% - 330px)",priority:10,anchorElement:ut.sharePostButton})),setTimeout(()=>{ut.lmsCoachmark.show()},0))}))}))}ut.facebookUploadButton=new T({parent:"PostTopBarMid",class:"button uploadButton facebookUploadButton",id:"FacebookUploadButton",hidden:!0,tag:"div",label:"i18n.app.kShareFacebook",onClick:ho}),ut.facebookUpdateCover=new T({parent:"PostTopBarMid",class:"button uploadButton facebookUploadButton",id:"facebookUpdateCoverButton",hidden:!0,tag:"div",label:"i18n.app.kUpdateFacebookCover",onClick:ho}),ut.twitterUpload=new T({parent:"PostTopBarMid",class:"button uploadButton twitterUploadButton",id:"TwitterUploadButton",hidden:!0,tag:"div",label:"i18n.app.kUploadTwitter",onClick:fo}),ut.addContentRegion=new S({parent:"PostNavStrip",id:"PostAddContentRegion",height:80,width:80}),ut.addContentButton=new k({parent:"PostAddContentRegion",id:"PostAddContentButton",height:"auto",width:"auto",label:"i18n.components.buttons.kAdd",iconTemplate:"<i class='circle-button'></i>",onClick:Yt}),ut.addContentPopUp=new A({id:"PostAddContentPopUp",parent:"PostAddContentRegion",focusScrim:!1,hidden:!0,iconCount:4,carrot:!0,preventDefaultAnimation:!0}),ut.addContentTextButton=new k({parent:"PostAddContentPopUp",class:"pop-up-icon-left",id:"PostAddContentPopUpText",label:"i18n.components.buttons.kText",width:60,height:60,onClick:qo}),ut.addContentImageButton=new k({parent:"PostAddContentPopUp",class:"pop-up-icon-mid",id:"PostAddContentPopUpImage",width:60,height:60,label:"i18n.components.buttons.kPhoto",onClick:Vo}),ut.colorPicker=new W({id:"colorPicker",parent:ut.postEditorView,top:180,left:10,width:250,height:350,hideBrandkit:!Et.featureEnabled("entitle-brand-kit")}),ut.sidebarGlobal=new E({parent:"PostSidebar",hidden:!1}),ut.sidebarTheme=new H({parent:ut.sidebarGlobal,hidden:!1,visibilityGroup:"main-sidebar",showMerchPopup:!Et.featureEnabled("entitle-brand-kit")}),ut.sidebarPalette=new _({parent:ut.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar",colorPicker:ut.colorPicker}),ut.sidebarResize=new j({parent:ut.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar"}),dt.webAnimationEnabled()&&(ut.sidebarAnimation=new Y({parent:ut.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar",class:"post-panel-scrollable"})),ft!==At.TEMPLATE&&(ut.sidebarTemplates=new X({waitForSaveMethod:za,deletingCurrentDoc:ra,imageWrapper:ut.imageWrapper,parent:ut.sidebarGlobal,poster:ut.poster,hidden:!0,visibilityGroup:"main-sidebar",showResizeOption:Et.featureEnabled("post-templates-show-resize"),getDocSize:ua})),ut.sidebarLayout=new O({parent:ut.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar"}),ut.sidebarGlobal.registerSidebarTabWithId(ut.sidebarTheme,"theme"),ut.sidebarGlobal.registerSidebarTabWithId(ut.sidebarPalette,"palette"),ut.sidebarGlobal.registerSidebarTabWithId(ut.sidebarLayout,"layout"),ut.sidebarGlobal.registerSidebarTabWithId(ut.sidebarResize,"resize"),ut.sidebarAnimation&&ut.sidebarGlobal.registerSidebarTabWithId(ut.sidebarAnimation,"animation"),ut.sidebarTemplates&&ut.sidebarGlobal.registerSidebarTabWithId(ut.sidebarTemplates,"templates"),ut.sidebarText=new G({parent:"PostSidebar",hidden:!0,entitleBrandKit:Et.featureEnabled("entitle-brand-kit"),wheelImprovementsEnabled:Et.featureEnabled("post-wheel-improvements"),colorPicker:ut.colorPicker}),ut.sidebarBackground=new U({parent:"PostSidebar",hidden:!0,enablePixiRenderer:Et.featureEnabled("post-pgm-poster"),colorPicker:ut.colorPicker,disableImageFrames:Kn(),cutoutEnabled:Et.featureEnabled("post-enable-remove-background")}),ut.sidebarLogo=new V({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar"}),ut.sidebarIcon=new K({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar",colorPicker:ut.colorPicker}),ut.sidebarMultiselect=new $({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar",alignmentTypes:at.getAlignmentTypes(),distributeTypes:at.getDistributeTypes()}),ut.sidebarGroup=new q({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar"}),ut.addTextSidebar=new Z({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar",onAddText:ko}),ut.sidebarCrop=new J({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar"}),ut.navStripTabsWrapper=new v({parent:"PostNavStrip",id:"PostNavStripTabsWrapper"}),ut.globalTabsWrapper=new P({parent:"PostNavStripTabsWrapper",id:"PostGlobalTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"global-tabs",defaultActive:!0,rememberLastTab:!0,onShown:kn}),ft!==At.TEMPLATE&&(ut.tabButtonTemplates=new I({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kTemplates",id:"sectionTabTemplates",group:"global-sidebar-tabs",defaultSelected:!1,onSelect:Nn}),ut.globalTabsWrapper.registerTab(ut.tabButtonTemplates)),ft!==At.TEMPLATE&&(ut.tabButtonTheme=new I({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kDesign",id:"sectionTabTheme",group:"global-sidebar-tabs",defaultSelected:!0,onSelect:Rn}),ut.globalTabsWrapper.registerTab(ut.tabButtonTheme)),ut.tabButtonPalette=new I({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kColors",id:"sectionTabPalette",group:"global-sidebar-tabs",onSelect:zn}),ut.globalTabsWrapper.registerTab(ut.tabButtonPalette),ut.tabButtonLayout=new I({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kLayout",id:"sectionTabLayout",group:"global-sidebar-tabs",defaultSelected:!1,onSelect:Mn}),ut.globalTabsWrapper.registerTab(ut.tabButtonLayout),ut.tabButtonResize=new I({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kResize",id:"sectionTabResize",group:"global-sidebar-tabs",defaultSelected:!1,isPremium:Et.featureEnabled("post-resize-is-paid-feature")&&ft!==At.TEMPLATE,isEntitled:Lt.isEntitledToFeature("postResizeButton"),onTrySelect:Fn,onSelect:Wn}),ut.globalTabsWrapper.registerTab(ut.tabButtonResize),dt.webAnimationEnabled()&&(ut.tabButtonAnimation=new I({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kAnimation",id:"sectionTabAnimation",group:"global-sidebar-tabs",defaultSelected:!1,onSelect:Hn}),ut.globalTabsWrapper.registerTab(ut.tabButtonAnimation)),ut.textTabsWrapper=new P({parent:"PostNavStripTabsWrapper",id:"PostTextTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"text-tabs",defaultActive:!1,onHidden:function(){ut.sidebarText.hide(),at&&at.exitCharStyleMode()},onShown:Cn}),ut.tabButtonTextType=new I({parent:"PostTextTabsWrapper",label:"i18n.components.buttons.kType",id:"sectionTabText",group:"text-tabs",onSelect:function(e){Un({tabId:"type"}),e&&Ve.publish("editor:typePressed")}}),ut.textTabsWrapper.registerTab(ut.tabButtonTextType),ut.tabButtonTextColor=new I({parent:"PostTextTabsWrapper",label:"i18n.components.buttons.kColor",id:"sectionTabTextColor",group:"text-tabs",onSelect:function(){Un({tabId:"color"})}}),ut.textTabsWrapper.registerTab(ut.tabButtonTextColor),ut.tabButtonTextShape=new I({parent:"PostTextTabsWrapper",label:"i18n.components.buttons.kShape",id:"sectionTabTextShape",group:"text-tabs",onSelect:function(){Un({tabId:"shape"})}}),ut.textTabsWrapper.registerTab(ut.tabButtonTextShape),ut.tabButtonTextEffects=new I({parent:"PostTextTabsWrapper",label:"i18n.components.buttons.kEffects",id:"sectionTabTextEffects",group:"text-tabs",onSelect:function(){Un({tabId:"effects"})}}),ut.textTabsWrapper.registerTab(ut.tabButtonTextEffects),ut.tabButtonTextStyle=new I({parent:"PostTextTabsWrapper",label:"i18n.components.buttons.kStyle",id:"sectionTabTextStyle",group:"text-tabs",onSelect:function(){Un({tabId:"style"})}}),ut.textTabsWrapper.registerTab(ut.tabButtonTextStyle),ut.addTextTabsWrapper=new P({parent:"PostNavStripTabsWrapper",id:"PostAddTextTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"add-text-tabs",defaultActive:!1,onHidden:In,onShown:Pn}),ut.tabButtonAddText=new I({parent:"PostAddTextTabsWrapper",label:"i18n.components.buttons.kText",id:"sectionTabAddText",group:"local-sidebar-tabs"}),ut.addTextTabsWrapper.registerTab(ut.tabButtonAddText),ut.cropTabsWrapper=new P({parent:"PostNavStripTabsWrapper",id:"PostCropTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"crop-tabs",defaultActive:!1,onHidden:Sn}),ut.tabButtonCrop=new I({parent:"PostCropTabsWrapper",label:"i18n.components.buttons.kImage",id:"sectionTabCrop",group:"local-sidebar-tabs"}),ut.cropTabsWrapper.registerTab(ut.tabButtonCrop),ut.backgroundTabsWrapper=new P({parent:"PostNavStripTabsWrapper",id:"PostBackgroundTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"background-tabs",defaultActive:!1,onHidden:ut.sidebarBackground.hide,onShown:Bn}),ut.tabButtonBackgroundImage=new I({parent:"PostBackgroundTabsWrapper",label:"i18n.components.buttons.kImage",id:"sectionTabBackground",group:"local-sidebar-tabs",onSelect:function(){Gn({tabId:"image"});var e=at.getSelectedForma();e&&!e.isImage()&&$o({disallowClose:!0,setHome:!0})}}),ut.backgroundTabsWrapper.registerTab(ut.tabButtonBackgroundImage),ut.tabButtonBackgroundLooks=new I({parent:"PostBackgroundTabsWrapper",label:"i18n.components.buttons.kFilters",id:"sectionTabBackgroundLooks",group:"local-sidebar-tabs",onSelect:function(){Gn({tabId:"looks"});var e=at.getSelectedForma();e&&!e.isImage()&&$o({disallowClose:!0,setHome:!0})}}),ut.backgroundTabsWrapper.registerTab(ut.tabButtonBackgroundLooks),ut.tabButtonBackgroundColor=new I({parent:"PostBackgroundTabsWrapper",label:"i18n.components.buttons.kBackgroundColor",id:"sectionTabBackgroundColor",group:"local-sidebar-tabs",onSelect:function(){Gn({tabId:"color"})}}),ut.backgroundTabsWrapper.registerTab(ut.tabButtonBackgroundColor),ut.logoTabsWrapper=new P({parent:"PostNavStripTabsWrapper",id:"PostLogoTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"logo-tabs",defaultActive:!1,onHidden:ut.sidebarLogo.hide,onShown:xn}),ut.tabButtonLogo=new I({parent:"PostLogoTabsWrapper",label:"i18n.components.buttons.kLogo",id:"sectionTabLogo",group:"local-sidebar-tabs",onSelect:On}),ut.logoTabsWrapper.registerTab(ut.tabButtonLogo),ut.iconTabsWrapper=new P({parent:"PostNavStripTabsWrapper",id:"PostIconTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"icon-tabs",defaultActive:!1,onHidden:ut.sidebarIcon.hide,onShown:yn}),Et.featureEnabled("post-language-switcher")&&(ut.LanguageSwitcher=new Se({parent:"PostNavStrip",id:"PostLanguageSwitcher"}));let t="i18n.components.buttons.kIcon";Be.run("IconShapeExperiment",{shape_for_icon_label:function(e){t="i18n.components.buttons.kShape"},control:function(e){}}).then((function(e){ut.tabButtonIcon=new I({parent:"PostIconTabsWrapper",label:t,id:"sectionTabIcon",group:"local-sidebar-tabs",onSelect:function(){jn({tabId:"icon"})}}),ut.iconTabsWrapper.registerTab(ut.tabButtonIcon),ut.tabButtonIconColor=new I({parent:"PostIconTabsWrapper",label:"i18n.components.buttons.kColor",id:"sectionTabIconColor",group:"local-sidebar-tabs",onSelect:function(){jn({tabId:"color"})}}),ut.iconTabsWrapper.registerTab(ut.tabButtonIconColor),ut.addContentIconButton=new k({parent:"PostAddContentPopUp",class:"pop-up-icon-mid",id:"PostAddContentPopUpIcon",width:60,height:60,label:t,onClick:_o}),ut.addContentLogoButton=new k({parent:"PostAddContentPopUp",class:"pop-up-icon-right",id:"PostAddContentPopUpLogo",width:60,height:60,label:"i18n.components.buttons.kLogo",onClick:Yo}),ga()})).done(),ut.multiselectTabsWrapper=new P({parent:"PostNavStripTabsWrapper",id:"PostMultiselectTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"multiselect-tabs",defaultActive:!1,onHidden:ut.sidebarMultiselect.hide,onShown:Dn}),ut.tabButtonMultiselect=new I({parent:"PostMultiselectTabsWrapper",label:"i18n.components.buttons.kMultipleObjects",id:"sectionTabMultiple",group:"multiselect-tabs",onSelect:function(){var e,t;t=(e=(e={tabId:"multiple"})||{}).tabId||"multiple",ut.sidebarMultiselect.showSidebarWithId(e.tabId),Ln({component:ut.sidebarMultiselect}),"multiple"===t&&Ve.publish("multiselectSidebarDisplayed:align")}}),ut.multiselectTabsWrapper.registerTab(ut.tabButtonMultiselect),ut.groupTabsWrapper=new P({parent:"PostNavStripTabsWrapper",id:"PostGroupTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"group-tabs",defaultActive:!1,onHidden:ut.sidebarGroup.hide,onShown:An}),ut.tabButtonGroup=new I({parent:"PostGroupTabsWrapper",label:"i18n.components.buttons.kGroup",id:"sectionTabGroup",group:"group-tabs",onSelect:function(){var e,t;t=(e=(e={tabId:"group"})||{}).tabId||"group",ut.sidebarGroup.showSidebarWithId(e.tabId),Ln({component:ut.sidebarGroup}),"group"===t&&Ve.publish("groupSidebarDisplayed:group")}}),ut.groupTabsWrapper.registerTab(ut.tabButtonGroup),ut.changeImageModalPanel=new D({layout:"rows",parent:"PostSidebar",hidden:!0,panels:[{id:"PostImagePicker",size:"auto"}]}),ut.changeImageModalPanel.remove=function(){ut.changeImageModalPanel.$el.hide()};var o=!1;ut.changeImageModalPanel.insert=function(){o?ut.changeImageModalPanel.$el.show():(ut.changeImageModalPanel.parent.$el.append(ut.changeImageModalPanel.$el),o=!0)},ut.imagePicker=new Q({parent:"PostImagePicker",waitForSaveMethod:za,onClose:function(){ut.changeImageModalPanel.hide(),!at.getSelectedForma()&&Ot.length?(at.selectFormaById({formaId:Ot}),Ot=""):(at.deselect(),pa())}}),ut.changeIconModalPanel=new D({layout:"rows",parent:"PostSidebar",hidden:!0,panels:[{id:"PostIconPicker",size:"auto"}]}),ut.changeIconModalPanel.remove=function(){ut.changeIconModalPanel.$el.hide()};var n=!1;ut.changeIconModalPanel.insert=function(){n?ut.changeIconModalPanel.$el.show():(ut.changeIconModalPanel.parent.$el.append(ut.changeIconModalPanel.$el),n=!0)},ut.iconPicker=new Q({parent:"PostIconPicker",waitForSaveMethod:za,sources:[],assetType:"vector",image_filter:[".svg","image/svg+xml"],label:"Choose icon",onClose:function(){ut.changeIconModalPanel.hide(),!at.getSelectedForma()&&Ot.length?(at.selectFormaById({formaId:Ot}),Ot=""):(at.deselect(),pa())}}),ut.textCapture=new z({parent:ut.windowPanel,hidden:!0,coreWrapper:at}),ut.posterAdornments=new ee({poster:ut.poster,background:ut.postContentSection,pageElement:nt}),ut.watermarkUI=new Ze(ct,Bt,ut.imageWrapper,ut.poster,at,at.requestSave),ut.noProfilePic=new x({id:"PostNoProfilePic",parent:ut.imageWrapper,hidden:!0})}function Jt(){ut.premiumTemplateTextTooltip=new Ie({parent:"PostApp",id:"textTooltip",message:"i18n.components.coachmarks.premiumText.kMessage",arrowDirection:"left",showCloseButton:!1,anchorElement:this.parent,height:"auto",width:130,offsetY:250,offsetX:5,priority:1,hidden:!0}),ut.premiumTemplateTextTooltip.show()}function eo(e,t){var o=ut.poster.getViewScale(),n=ut.poster.$el.offset();return{x:(e-n.left)/o,y:(t-n.top)/o}}function to(){if(at.canUndo()){var e=at.getUndoDescription();Ve.publish("undoApplied",{actionDescription:e}),at.undo()}}function oo(){if(at.canRedo()){var e=at.getRedoDescription();Ve.publish("redoApplied",{actionDescription:e}),at.redo()}}function no(){ut.posterAdornments.hideSelectionBox(),za().done((function(){marvel.navigate("/branding/"+St.contextId,{trigger:!0})}))}function ao(){ut.posterAdornments.hideSelectionBox();var e=t.defer();ut.poster.disable(),ut.posterAdornments.hideSelectionBox(),at.undoToInitialState(),ie.setTemplateName(Pt,vt.templateName);var o=at.getDocumentSize(),a=o.width/o.height;ut.imageWrapper.update({aspect:a}),n.delay((function(){ut.poster.update({core:at}),ut.poster.enable(),e.resolve()}),250),e.promise.done((function(){at.requestSave(),za("Please wait...").done((function(){marvel.navigate("/branding/"+St.contextId,{trigger:!0})}))}))}function ro(e){ut.sidebarTheme.setDesigns({aspectRatio:at.getPageAspectRatio(),wordCount:at.getLockupWordCount(),iconCount:at.getIconCount(),imageCount:at.getPotentialBackgroundImageCount(),isInitialLoad:e||!1,manifest:at.getManifestData(),docId:at.getDocumentCCID()})}function io(e){var t=at.getColorPalette();ut.sidebarPalette.setCurrentPalette(t,e)}function so(){ut.sidebarAnimation&&ut.sidebarAnimation.update()}function lo(e){$e.invite(i.currentDoc,e,"post:editor")}function co(e){ut.lmsCoachmark&&!ut.lmsCoachmark.isHidden()&&ut.lmsCoachmark.hide(),za().done((function(){return"sharemenu-publish"===e?(Ve.publish("shareButtonPressed"),void kt.publish(a,at.requestSave)):"sharemenu-invite"===e?lo("project"):"sharemenu-lms-turnin"===e||"sharemenu-lms-attach"===e?(Le.showModal({type:"adobe-theo",id:i.currentDoc.id},{syncInProgress:!1}),null):""===e?(ut.downloadButton.el.hideDownloadList(),null):(console.warn("handleShareMenuClick called with unrecognized menuItemId",e),null)}))}function po(e){const t=e.originalEvent.detail.mediaType.split("_")[1];Ve.publish("downloadButtonPressed"),"string"==typeof t&&Ve.publish("downloadImgButtonPressed:"+t),kt.downloadImg({coreWrapper:at,mediaType:t,isWatermarkEnabled:ct,MarvelSettings:a,docName:ut.docNameInput.getText(),requestSaveMethod:at.requestSave})}function uo(e){const t=e.originalEvent.detail.mediaType.split("_")[1];za().done((function(){kt.downloadImgV2(i,a,t).done()}))}function go(){za().done((function(){Ve.publish("downloadPDFButtonPressed"),kt.downloadPDF(i,a,at.requestSave)}))}function mo(){za().done((function(){Ve.publish("downloadMP4_720pButtonPressed"),kt.downloadMP4(i,a,at,1280,at.requestSave)}))}function bo(){ut.sharePostButton.el.hideMenuDropdown()}function ho(){za().done((function(){kt.uploadToFacebook()}))}function fo(){za().done((function(){kt.uploadToTwitter()}))}function wo(){var e=at.getSelectedForma();e&&e.isTypeLockup()&&oe.LockupStyle.isPath(e.style.layout)&&(ut.tabButtonTextShape.isSelected&&ut.tabButtonTextType.select(),ut.tabButtonTextShape.disable())}function vo(){ut.tabButtonTextShape.isEnabled()||ut.tabButtonTextShape.enable()}function To(){var e=at.getTextForSelectedLockup();if(e){var o=at.getSelectedForma();ut.textCapture.prompt(e).then((function(n){if(n&&n!==e){var a=n.length.toString(),r=o.source;if(oe.FormaSourceUtils.isDesignIngredient(r)){var i=oe.BadgeFacade.getDesignIngredientIDAndType(r);Ve.publish("designIngredient:textEdited",{contextualData1:"id:"+i.id,contextualData2:"type:"+i.type,contextualData7:"lengthOfText:"+a})}else{var s=o.style,l=s.font.fontData.postScriptName,d=function(e){switch(e.backing){case oe.LockupBacking.None:return"none";case oe.LockupBacking.Rows:return"row";case oe.LockupBacking.BannerHorizontal:return"bannerHorizontal";case oe.LockupBacking.BannerVertical:return"bannerVertical";case oe.LockupBacking.Knockout:return"knockout";case oe.LockupBacking.LegacyShadow:return"none";default:if(e.backingArtworkID)return e.backingArtworkID}return"none"}(s);Ve.publish("customTextEdited",{contextualData7:"lengthOfText:"+a,contextualData10:"fontName:"+l,contextualData12:"shapeName:"+d})}return at.setTextForSelectedLockup(n)}return t.resolve()})).done(ut.posterAdornments.showSelectionBox)}}function ko(){var e=!1;Xt(),at.downloadNewLockupRandomFontsAsync(),ut.textCapture.prompt("").then((function(o){if(o){var n=o.length.toString();return Ve.publish("customTextAdded",{contextualData7:"lengthOfText:"+n}),e=!0,at.addNewLockup(o,{select:!0})}return t.resolve()})).done((function(){e&&(ut.tabButtonTextType.select(),ut.posterAdornments.showSelectionBox())}))}function Io(){var e,t=at.getAllSelectedFormas();t&&(e=t,at.canDuplicateFormae(e)?at.duplicateFormae(e).done():Ho())}function Po(t){Ve.publish("editImage:cropPressed"),e("#PostApp").addClass("crop-scrim"),e("#PostTopBar").addClass("crop-scrim").append('<div class="full-scrim"></div>'),e("#PostTopBar").find(".full-scrim").on("click",(function(e){Co()})),at.enterCropMode().then((function(){ut.tabButtonCrop.select(),ut.sidebarCrop.show(),ut.sidebarCrop.moveToSection(t)}))}function So(e){at.applyAspectRatioCropToImage(e).done()}function Bo(e){at.applyShapeMaskToImage(e).done()}function Co(){xo(),at.exitCropMode().then((function(){ut.tabButtonBackgroundImage.select(),ut.sidebarBackground.show()}))}function xo(){e("#PostApp").removeClass("crop-scrim"),e("#PostTopBar").removeClass("crop-scrim"),e("#PostTopBar").find(".full-scrim").remove()}function yo(e){let{messageType:t,messageObj:o}=e;ut.errorDialogs.actionFeedbackModal&&ut.errorDialogs.actionFeedbackModal.hide();let n=o.message,a=null;t===oe.ActionFeedbackMessageType.Error&&null!=o.type&&null!=o.message?o.type===oe.HostNetworkErrorType.NoInternetConnection?(n=w.translate("dialogs.networkError.kOfflineErrorTitle"),a=w.translate("dialogs.networkError.kOfflineErrorText")):(n=w.translate("dialogs.networkError.kGenericErrorTitle"),a="".concat(w.translate("dialogs.networkError.kGenericErrorText")).concat(o.message)):o instanceof oe.HostCutoutMaskError&&(n=w.translate("dialogs.networkError.kGenericErrorTitle"),a=w.translate("dialogs.networkError.kCutoutMaskErrorText")),n&&a&&(ut.errorDialogs.actionFeedbackModal=new L({headerText:n,contentText:a,dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"OK",onClick:function(){ut.errorDialogs.actionFeedbackModal.hide()}}]}),ut.errorDialogs.actionFeedbackModal.show())}function Do(){Ve.publish("editImage:layerSelected",{contextualData1:"imageLayer:floating"}),at.setImageAsForeground().done()}function Ao(){Ve.publish("editImage:layerSelected",{contextualData1:"imageLayer:background"}),at.setImageAsBackground().done()}function Eo(){var e=at.getSelectedForma();Mo(oe.AnalyticsConstants.kAnalyticsDataEditImageReturnBackgroundPressed,e),at.setImageCutout(e,new oe.CutoutStyle(oe.CutoutMode.Off)).done()}function Lo(){var e=at.getSelectedForma();Mo(oe.AnalyticsConstants.kAnalyticsDataEditImageRemoveBackgroundPressed,e),at.setImageCutout(e,new oe.CutoutStyle(oe.CutoutMode.BackgroundRemoval)).done()}function Mo(e,t){const o=oe.ImageFacade.getImageContentForForma(t);let n="unknown";o&&o.mediaMetadata&&o.mediaMetadata.sourceName&&(n=o.mediaMetadata.sourceName);const a=t.isBackgroundImage()?"background":"floating";Ve.publish(e,{contextualData1:"imageSource:".concat(n),contextualData2:"imageType:".concat(a)})}function Fo(){var e=at.getAllSelectedFormas();if(e){var t=at.getDeleteInfo(e);if(t.isDeleteable&&t.isBackgroundImage)var o=new L({headerText:"i18n.dialogs.delete.kHeaderText",contentText:"i18n.dialogs.delete.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.delete.kDeleteContentButtonLabel",onClick:function(){at.replaceImagesWithColors(null,[]).done(),o.hide()}},{class:"pill pill-primary-on-light",label:"i18n.dialogs.delete.kDeletePhotoSectionLabel",onClick:function(){Ro(e),o.hide()}},{class:"pill pill-secondary-on-light",label:"i18n.common.kCancel",onClick:function(){o.hide()}}]});else t.isBackgroundImage?at.replaceImagesWithColors(null,[]).done():t.isDeleteable&&Ro(e)}}function Wo(e){const t=at.getAllSelectedFormas();at.groupItems(t,!0,e.method)}function No(e){const t=at.getAllSelectedFormas();at.ungroupItems(t,!0,e.method)}function Ro(e){e=e||at.getAllSelectedFormas(),at.deleteFormae(e).done()}function zo(t,o){var n=e("#swapCellThumbnail");if(n.length)n.css({top:o.y+5+"px",left:o.x-50+"px"});else{var a=e('<div id="swapCellThumbnail"></div>').css({position:"absolute",top:o.y+5+"px",left:o.x-50+"px",opacity:.5,"box-shadow":"0px 0px 4px 0px"});if(e("body").append(a),t.isBackgroundImage()){var r=at.getImagePreviewData(t),i=e('<img src="'+r.url+'">').css({"max-height":"100px","max-width":"100px"});a.append(i)}else{var s=t.style.colors.fieldPrimary;if(s){var l=de.rgb2hex(de.solidColor2Rgba(s)),d=t.frame.width>t.frame.height;a.css({background:"#"+l,height:d?t.frame.height/t.frame.width*100+"px":"100px",width:d?"100px":t.frame.width/t.frame.height*100+"px"})}}}}function Uo(){e("#swapCellThumbnail").remove()}function Go(t){e("#swapScrim").remove();var o=t.finalFrame,n=ut.poster.getViewScale(),a=ut.poster.$el.offset(),r=a.top+o.minY*n,i=a.left+o.minX*n,s=(o.maxY-o.minY)*n,l=(o.maxX-o.minX)*n,d=e('<div id="swapScrim"></div>').css({background:"rgba(0,0,0,.25)",outline:"solid white 4px",top:r,left:i,height:s,width:l,position:"absolute"});e("body").append(d)}function Oo(){e("body").find("#swapScrim").remove()}function jo(){ut.sidebarCrop.recordFormaResize()}function Ho(){var e=new L({headerText:"i18n.dialogs.tooManyImages.kHeaderText",contentText:"i18n.dialogs.tooManyImages.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"OK",onClick:function(){e.hide()}}]});e.show()}function _o(e){e=e||{},ut.posterAdornments.hideSelectionBox(),Ot=at.getSelectedFormaId()||"",at.deselect({silent:!0}),ut.tabButtonIcon.select(),ut.tabButtonIconColor.hide({silent:!0,preventSelection:!0}),e.setHome=!0,yt||(e.context=e.context||{},e.context.class_name="DooploImagePickerContext",e.context.search_string=function(){let e=["badge","fun","spark","circle","singer","arrow","heart","star","flower","rectangle","love","party","triangle","square","oval","phone","food","sun"];Et.featureEnabled("use-translation-service-for-icon-search")&&(e=["iconSearch.kBadge","iconSearch.kFun","iconSearch.kSpark","iconSearch.kCircle","iconSearch.kSinger","iconSearch.kArrow","iconSearch.kHeart","iconSearch.kStar","iconSearch.kFlower","iconSearch.kRectangle","iconSearch.kLove","iconSearch.kParty","iconSearch.kTriangle","iconSearch.kSquare","iconSearch.kOval","iconSearch.kPhone","iconSearch.kFood","iconSearch.kSun"]);var t=Math.floor(Math.random()*(e.length+1));return w.translate(e[t])}(),yt=!0),e.label="Add icon",Xo(e),Xt(),Ve.publish("editor:addIconPressed")}function Vo(e){Ve.publish("editor:addImagePressed"),e=e||{},at.canAddMoreImages(1)?(xt=!1,ut.posterAdornments.hideSelectionBox(),Ot=at.getSelectedFormaId()||"",at.deselect({silent:!0}),ut.tabButtonBackgroundImage.select(),ut.tabButtonBackgroundColor.hide({silent:!0,preventSelection:!0}),ut.tabButtonBackgroundLooks.hide({silent:!0,preventSelection:!0}),e.setHome=!0,e.label="Add photo",e.disallowClose=at.backgroundImageFormas().length<1,$o(e),ut.changeIconModalPanel.hide(),Xt()):Ho()}function Ko(e){e=e||{},xt=!0;var t=at.getSelectedForma();t&&(at.isIcon(t)?(ut.tabButtonIcon.select(),e.label="Replace icon","dooplo"===t.contentNode.mediaMetadata.searchSource&&(e.context=e.context||{},e.context.class_name="DooploImagePickerContext",e.context.search_string=t.contentNode.mediaMetadata.searchTerm),Xo(e)):(e.label="Replace photo",t.isImage()&&t.childCount>0&&t.childAt(0).contentNode.mediaMetadata&&"dooplo"===t.childAt(0).contentNode.mediaMetadata.searchSource&&(e.context=e.context||{},e.context.class_name="DooploImagePickerContext",e.context.search_string=t.childAt(0).contentNode.mediaMetadata.searchTerm),$o(e)))}function $o(e){if("boolean"!=typeof(e=e||{}).disallowClose){var t=at.getSelectedForma();t&&(t.isImage()||t.isGridCell())?e.disallowClose=!1:e.disallowClose=at.imageFormas().length<1}ut.imagePicker.show(e),ut.changeImageModalPanel.show(e),ut.imagePicker.removeSelection(),e.label&&ut.imagePicker.setTitle(e.label),e.setHome&&ut.imagePicker.home(),ut.imagePicker.setCloseButtonVisibility(!e.disallowClose)}function qo(){Ve.publish("editor:addTextPressed",{sparkFormat:"post"}),at.triggerTextSidebarDisplayed(),ut.tabButtonAddText.select(),ut.addTextSidebar.show(),Ve.publish("addTextSidebarDisplayed"),Xt()}function Xo(e){e=e||{},ut.iconPicker.show(e),ut.changeIconModalPanel.show(e),ut.iconPicker.removeSelection(),e.label&&ut.iconPicker.setTitle(e.label),e.setHome&&ut.iconPicker.home(),ut.iconPicker.setCloseButtonVisibility(!e.disallowClose)}function Yo(){Ve.publish("editor:addLogoPressed"),Et.featureEnabled("entitle-brand-kit")?(Xt(),ut.tabButtonLogo.select(),ut.changeImageModalPanel.hide(),ut.changeIconModalPanel.hide()):s.showMerchPopover({$element:ut.addContentButton.$el,position:"bottom-left",width:320,positionOffset:-4,touchpointName:"postLogoButton"})}function Qo(){Ve.publish("uploadNewLogoSelected"),ut.posterAdornments.hideSelectionBox(),Xt()}var Zo=n.throttle((function(e,t){at.applyGridStyle(e,t).done(),Ve.publish("layoutSelected",{layoutID:e.gridStyle.name})}),40);function Jo(e){if("Original"===e.id){var t=at.getOriginalImageSize();if(!t)return;e=oe.DesignSizeLibrary.getOriginalSize(t.width,t.height)}return ut.poster.disable(),ut.watermarkUI.updateWatermarkCoachmarkVisibility(!1),ut.posterAdornments.hideSelectionBox(),at.setPageSizeFromDesignSize(e).then((function(){ut.imageWrapper.update({aspect:e.aspectRatio||1}),ut.sidebarBackground.updateFilters({tileAspect:e.aspectRatio||1}),n.delay((function(){ut.poster.enable()}),50),ut.watermarkUI.handleWatermarkFootprintChanged(),Ve.publish("canvasSizeSelected",{aspectRatio:e.aspectRatio||1,targetId:e.id})}))}var en=n.throttle((function(e){"Custom"===e.id?function(){var e=at.getPageExportData(),t=e.pixelDimensions,o=at.getDocumentSizeId(),n=e.format,a=e.ppi;"Custom"===o&&(n=at.getPageCustomSizeFormat(),a=at.getPageCustomSizePPI());var r=new M({currentExportSize:t,currentFormat:n,currentPPI:a});r.events.subscribe("submit",(function(e){e.exportData.format===n&&t.width===e.exportData.pixelWidth&&t.height===e.exportData.pixelHeight||(Jo(oe.DesignSizeLibrary.getCustomSize(e.exportData.width,e.exportData.height,e.exportData.format,e.exportData.ppi)),Ve.publish("customSizeSet",{dimensions:e.exportData.width+"x"+e.exportData.height+" "+e.exportData.format}))})),r.events.subscribe("cancel",(function(){ut.sidebarResize.selectDocumentSizeWithId(at.getDocumentSizeId(),{silent:!0}),Ve.publish("customSizeCancelled")}))}():Jo(e)}),40);function tn(t,o,n){n.silent||!e(n.target).closest("[class*='tile-shuffle-button']").length&&0!==o||(0===o?at.setColorPalette(t,{shuffle:!0}).done():at.shuffleColorPalette().done())}function on(e){e=e||{};var t,o=at.getDocumentSizeId();o===Ut&&"Custom"!==o||(Ut=o,ut.imageWrapper.update({aspect:at.getPageAspectRatio()}),ut.sidebarResize.selectDocumentSizeWithId(at.getDocumentSizeId(),{silent:!0})),ut.tabButtonPalette&&ut.tabButtonPalette.isSelected()&&io(),ut.tabButtonTheme&&(t=at.getThemeId())!==Gt&&(ut.sidebarTheme.selectThemeWithid(t,{silent:!0}),Gt=t),e.formaAdded&&dn(),ut.sidebarAnimation&&so(),ut.animationPlayButton&&ut.animationPlayButton.update({hidden:!at.hasAnimationStyle()}),Rt=!0}var nn=n.throttle((function(e,t){e.manifestPromise().then((function(e){return at.applyDesignTheme(e,t)})).then((function(){Ve.publish("designVariationSelected",{contextualData1:"variationTemplateDocumentId:"+e.assetId,contextualData2:"numShuffles:"+t})}))}),40),an=n.throttle((function(e){e.manifestPromise().done((function(t){at.addBadge(t,e.assetId).done()}))}),40);function rn(e){e.data.forma.isTypeLockup()&&ut.tabButtonTheme&&ut.tabButtonTheme.isSelected()&&ut.sidebarTheme.setDesigns({aspectRatio:at.getPageAspectRatio(),wordCount:at.getLockupWordCount(),iconCount:at.getIconCount(),imageCount:at.getPotentialBackgroundImageCount(),manifest:at.getManifestData(),docId:at.getDocumentCCID()}),e.selected&&!ut.sidebarBackground.isHidden()&&ut.sidebarBackground.updateFilters({whilePanelVisibleOnly:!0,image:at.getImagePreviewData(at.getSelectedForma())})}function sn(e){e.duplicatedImage&&at.updateConstrainedImages(),dn()}function ln(e){cn(),ut.posterAdornments.dismissPopUp(),e.deletedImage&&at.updateConstrainedImages()}function dn(){cn()}function cn(){ut.tabButtonTheme&&ut.tabButtonTheme.isSelected()&&ro()}function pn(e){var t;at.isMultiSelect()?(t=at.getSettableFeatures(),ut.sidebarMultiselect.update({attributes:t}),ut.multiselectTabsWrapper.isActive()||ut.tabButtonMultiselect.select()):at.isGroupSelect()?function(){var e=at.getSettableFeatures();ut.sidebarGroup.update({attributes:e}),ut.groupTabsWrapper.isActive()||ut.tabButtonGroup.select()}():function(e){ut.downloadButton&&ut.downloadButton.el.hideDownloadList();ut.sharePostButton&&ut.sharePostButton.el.hideMenuDropdown();Array.isArray(e.forma)&&(e.forma=e.forma[0]);if(ut.changeImageModalPanel.hide(),ut.changeIconModalPanel.hide(),e.forma){if("Root"===e.forma.kind)gn(ut.tabButtonBackgroundImage),gn(ut.tabButtonBackgroundLooks),un(ut.tabButtonBackgroundColor,!1,!1),ut.tabButtonBackgroundColor.isSelected()||ut.tabButtonBackgroundColor.select();else if(e.forma.isTypeLockup())Ve.publish("editor:textSelected"),ut.textTabsWrapper.isActive()||ut.tabButtonTextType.select();else if(e.forma.isLogo())ut.logoTabsWrapper.isActive()||ut.tabButtonLogo.select();else if(at.isIcon(e.forma))ut.iconTabsWrapper.isActive()||ut.tabButtonIcon.select(),un(ut.tabButtonIconColor);else if(e.forma.isImage()){un(ut.tabButtonBackgroundImage);var t=e.forma.isVideo();t&&gn(ut.tabButtonBackgroundLooks),ut.tabButtonBackgroundLooks.isHidden()&&!t&&(gn(ut.tabButtonBackgroundColor),un(ut.tabButtonBackgroundLooks));var o=e.forma.controller,n=o.kind===oe.FrameController.KIND&&o.isBackgroundImageWithAlpha();if(at.inCropMode())return;const a=oe.ImageFacade.getFrameFormaForForma(e.forma);oe.ImageFacade.canApplyBackgroundColor(a)?un(ut.tabButtonBackgroundColor):(gn(ut.tabButtonBackgroundColor),ut.tabButtonBackgroundColor.isSelected()&&ut.tabButtonBackgroundColor.deselect()),ut.backgroundTabsWrapper.isActive()&&(n||ut.tabButtonBackgroundImage.isSelected()||ut.tabButtonBackgroundLooks.isSelected()||ut.tabButtonBackgroundColor.isSelected())||ut.tabButtonBackgroundImage.select()}else e.forma.isGridCell()&&(gn(ut.tabButtonBackgroundLooks),un(ut.tabButtonBackgroundColor,!0,!1),ut.tabButtonBackgroundColor.isSelected()||ut.tabButtonBackgroundColor.select());(e.forma.isBackgroundImage()||e.forma.isGridCell())&&(e.forma.isGridCell()&&!e.forma.isImage()&&un(ut.tabButtonBackgroundColor),e.forma.controller.moveable?gn(ut.tabButtonBackgroundImage):un(ut.tabButtonBackgroundImage))}else pa()}(e)}function un(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e&&e.isHidden()&&e.show({silent:t,preventSelection:o})}function gn(e){e&&e.hide()}function mn(){if(!at.isMultiSelect()){var e=at.getSelectedForma();e&&(e.isTypeLockup()?To():(e.isImage()&&!e.isLogo()||at.isIcon(e))&&Ko())}}function bn(e){let{backgroundColor:t}=e;ut.errorDialogs.imageCorruptedModal||(ut.errorDialogs.imageCorruptedModal=new L({headerText:'\n            <span class="error-modal-header">\n              <span>i18n.dialogs.corruptedDocument.kHeaderText</span>\n              <i class="error-modal-header__icon"></i>\n            </span>\n          ',contentText:'<div class="error-modal-content">\n                <span>i18n.dialogs.corruptedDocument.kContentText</span>\n                <span class="error-modal-content_placeholder-indicator" style="background-color: #'.concat(t,';"></span>\n              </div>'),dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.corruptedDocument.kButtonLabel",onClick:function(){ut.errorDialogs.imageCorruptedModal.hide()}}]})),ut.errorDialogs.imageCorruptedModal.show()}function hn(){if(ut.sidebarLayout){var e=ut.sidebarResize.getSelected(),t=at.getDocumentSize(),o=at.getImageSizeIfFullBleed(),n=o&&o.width&&o.height&&Math.atan(o.height/o.width)*(4/Math.PI),a=t&&t.width&&t.height&&Math.atan(t.height/t.width)*(4/Math.PI),r=Math.abs(n-a)<=.01;e&&e.item&&"original"===e.item.data.aspect&&!r&&ut.sidebarResize.deselectSelected()}}function fn(e){var t=w.toLocaleKey(at.getUndoDescription());t?(ut.undo.update({hoverLabel:"i18n.app.kActionLabel",context:{"action-type":"i18n.app.kUndo","action-name":"i18n.actions."+t}}),ut.undo.enable()):(ut.undo.update({hoverLabel:"i18n.app.kUndo"}),ut.undo.disable());var o=w.toLocaleKey(at.getRedoDescription());o?(ut.redo.update({hoverLabel:"i18n.app.kActionLabel",context:{"action-type":"i18n.app.kRedo","action-name":"i18n.actions."+o}}),ut.redo.enable()):(ut.redo.update({hoverLabel:"i18n.app.kRedo"}),ut.redo.disable());const n=at.getWatermarkEnabledForDoc();ut.watermarkUI.updateWatermarkStatus(n),function(e){(function(){if(!ut.downloadButton)return;const{downloadOptionsList:e,selectedOption:t}=Qt();ut.downloadButton.update({selectedOption:t,optionsList:e})})(),function(e){if(!ut.animationPlayButton)return;const t=e.atShowEditor,o=e.changeType,n=at.hasAnimationStyle();if(ut.animationPlayButton.update({hidden:!n}),n)if(t)ut.animationPlayButton.reset(),ia(ut.posterAdornments,"first-full-render",()=>{Oa()});else{const e=at.getCurrentTimelineState();e.action&&"k_apply_animation_style"===e.action.description?"state-changed"===o&&Oa():ja()}else ja()}(e)}(e)}function wn(){Tn(),at.updateConstrainedImages(),at.validateDoc("undo")}function vn(){Tn(),at.updateConstrainedImages(),at.validateDoc("redo")}function Tn(){ut.sidebarBackground&&!ut.sidebarBackground.isHidden()&&ut.sidebarBackground.selectCurrentColor({silent:!0}),ut.sidebarIcon&&!ut.sidebarIcon.isHidden()&&ut.sidebarIcon.selectCurrentColor({silent:!0}),ut.sidebarText&&!ut.sidebarText.isHidden()&&ut.sidebarText.selectCurrentColor({silent:!0}),ut.sidebarPalette&&!ut.sidebarPalette.isHidden()&&ut.sidebarPalette.selectCurrentPalette({silent:!0})}function kn(){at.deselect()}function In(){ut.addTextSidebar.hide()}function Pn(){En()}function Sn(){ut.undo.show(),ut.redo.show(),ut.sidebarCrop.hide()}function Bn(){En()}function Cn(){at.ensureLockupSelected(),En()}function xn(){wa(re.currentBrandElements()),En()}function yn(){En()}function Dn(){En()}function An(){En()}function En(){ut.tabButtonPalette.isSelected()&&ut.sidebarPalette.unbindColorPicker(),ut.sidebarTemplates&&!ut.sidebarTemplates.isHidden()&&ut.sidebarTemplates.switchedToLocalTabSet()}function Ln(e){e=e||{},ut.sidebarLayout.isHidden()&&at.disableAutomaticLayoutMode(),e.component&&(Dt=e.component,ut.brandIndicator&&(Dt===ut.sidebarTemplates?(ut.brandIndicator.hide(),ut.postControlStrip.update({panels:[{id:"PostBrandIndicatorContainer",size:"0px"},{id:"PostSidebar",size:"auto"}]})):(ut.brandIndicator.show(),ut.postControlStrip.update({panels:[{id:"PostBrandIndicatorContainer",size:"50px"},{id:"PostSidebar",size:"auto"}]}))))}function Mn(){Ln({component:ut.sidebarLayout}),"layout"!==ut.sidebarGlobal.activeSidebarId()&&(ut.sidebarGlobal.showSidebarWithId("layout"),Ve.publish("editor:layoutPressed"))}function Fn(){return Ve.publish("editor:resizePressed"),Be.run("PostResize").catch(e=>{lt.error("Ran into error with PostResize experiment",e)}).done(),!Et.featureEnabled("post-resize-is-paid-feature")||Lt.tryPremiumFeature({$element:ut.tabButtonResize.$el,position:"left",touchpointName:"postResizeButton"})}function Wn(){Ln({component:ut.sidebarResize}),"resize"!==ut.sidebarGlobal.activeSidebarId()&&(ut.sidebarGlobal.showSidebarWithId("resize"),Ve.publish("layoutResizeDisplayed"))}function Nn(){Ln({component:ut.sidebarTemplates}),"templates"!==ut.sidebarGlobal.activeSidebarId()&&ut.sidebarGlobal.showSidebarWithId("templates")}function Rn(){Ln({component:ut.sidebarTheme}),"theme"!==ut.sidebarGlobal.activeSidebarId()&&(ut.sidebarGlobal.showSidebarWithId("theme"),ut.sidebarTheme.setDefaultSelection(),ro(),Ve.publish("editor:designFilterPressed"))}function zn(){Ln({component:ut.sidebarPalette}),"palette"!==ut.sidebarGlobal.activeSidebarId()&&(ut.sidebarGlobal.showSidebarWithId("palette"),io({updateSelection:!0}),Ve.publish("editor:colorPressed"),at.triggerEnteredPalette())}function Un(e){var t=(e=e||{}).tabId||"type";switch(ut.sidebarText.showSidebarWithId(t),Ln({component:ut.sidebarText}),ut.posterAdornments.handleTextTabSelected(),Ve.publish("textSidebarDisplayed"),Ve.publish("text"+t.toLowerCase()+"SidebarDisplayed"),t){case"type":Ve.publish("textSidebarDisplayed:type");break;case"color":Ve.publish("textSidebarDisplayed:color");break;case"shape":Ve.publish("textSidebarDisplayed:shape");break;case"style":Ve.publish("textSidebarDisplayed:style");break;case"effects":Ve.publish("textSidebarDisplayed:effects")}}function Gn(e){var t=(e=e||{}).tabId||"color";ut.sidebarBackground.isHiding()&&null==e.reselectWhenHiding?n.delay((function(){e.reselectWhenHiding=!0,Gn(e)}),200):(ut.sidebarBackground.showSidebarWithId(e.tabId),Ln({component:ut.sidebarBackground}),Ve.publish("photoSidebarDisplayed"),"image"===t?Ve.publish("backgroundSidebarDisplayed:image"):"color"===t?Ve.publish("backgroundSidebarDisplayed:color"):"looks"===t&&Ve.publish("backgroundSidebarDisplayed:looks"))}function On(){Ln({component:ut.sidebarLogo}),ut.sidebarLogo.show(),Ve.publish("logoSidebarDisplayed")}function jn(e){var t=(e=e||{}).tabId||"icon";ut.sidebarIcon.showSidebarWithId(e.tabId),Ln({component:ut.sidebarIcon}),"icon"===t?Ve.publish("iconSidebarDisplayed:icon"):"color"===t&&Ve.publish("iconSidebarDisplayed:color")}function Hn(e){ut.sidebarAnimation&&(Ln({component:ut.sidebarAnimation}),"animation"!==ut.sidebarGlobal.activeSidebarId()&&(so(),ut.sidebarGlobal.showSidebarWithId("animation"),Ve.publish("editor:AnimationPressed")))}function _n(e){$n(e,Jn,!0)}function Vn(e){var t,o=he.getImageMediaMetadata(e.info);xt&&(t=at.getSelectedForma()),at.createFormaFromSVG(e.files[0],o,t),Ve.publish("addedIconToProject:icon")}function Kn(){return!Et.featureEnabled("post-pgm-poster")}function $n(t,o){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(xt||at.canAddMoreImages(1)){o=o||ta;var a=at.getSelectedForma();if((xt||null!=a&&a.isShape())&&(t.replacementForma=a,ut.posterAdornments.showImageMenu(),t.replacementForma&&("Root"===t.replacementForma.kind?t.replacementForma=null:t.replacementFrame=t.replacementForma.finalFrame)),n&&(t.floatingImageStrategy=oe.FloatingImageStrategy.IfHasAlphaOrIsLogo),n||null!=t.replacementForma)Yn(t,o);else{Ve.publish("editor:addImagePressed",{contextualData1:"numImages:1",contextualData2:"actionType:success"});var r=at.backgroundImageFormas().length>0?"kChoosePhotoAddToCollageButtonLabel":"kChoosePhotoPinToBackgroundButtonLabel";if(Kn())return t.floatingImageStrategy=oe.FloatingImageStrategy.IfHasAlphaOrIsLogo,void Yn(t,o);var i=new L({id:"PostImageLayerPicker",headerText:"i18n.dialogs.choosePhotoLayer.kHeaderText",contentText:'<div class="image-layer-picker-visualization">\n           <span class="background-layer-visualization"></span>\n           <span class="foreground-layer-visualization"></span>\n           </div>',dismissable:!1,addButtonParent:!0,onShow:function(){e(".background-layer-visualization").click((function(){Xn(t,o,i)})),e(".foreground-layer-visualization").click((function(){qn(t,o,i)}))},onHide:function(){e(".background-layer-visualization").off("click",Xn),e(".foreground-layer-visualization").off("click",qn)},buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.choosePhotoLayer.kChoosePhotoMoveFreelyButtonLabel",onClick:function(){qn(t,o,i)}},{class:"pill pill-primary-on-light",label:"i18n.dialogs.choosePhotoLayer."+r,onClick:function(){Xn(t,o,i)}}]})}}else Ho()}function qn(e,t,o){Ve.publish("editor:imageLayerPressed",{contextualData1:"imageLayer:floating"}),e.floatingImageStrategy=oe.FloatingImageStrategy.Always,Yn(e,t),o.hide()}function Xn(e,t,o){Ve.publish("editor:imageLayerPressed",{contextualData1:"imageLayer:background"}),e.floatingImageStrategy=oe.FloatingImageStrategy.Never,Yn(e,t),o.hide()}function Yn(e,o){var n=t.defer();o(e,n),n.promise.done()}var Qn=1600;function Zn(e){Ve.publish("brandKitLogoApplied"),ut.poster&&ut.poster.events.publish("image-loading-begin"),Ve.publish("editor:logoAdded"),at.addLogo(e).then((function(){ut.poster&&ut.poster.events.publish("image-loading-end")}))}function Jn(e,o){ut.poster&&ut.poster.events.publish("image-loading-begin");var n=e.files[0];return me.renderBlobToCanvas(n).then(e=>{var n=t.defer();if(e.width<180||e.height<180)var a=new L({headerText:"i18n.panels.addNewLogo.kSizeWarningHeader",contentText:"i18n.panels.addNewLogo.kSizeWarningContent",dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"i18n.components.buttons.kContinue",onClick:function(){a.hide(),n.resolve(e)}},{class:"pill pill-secondary-on-light",label:"i18n.common.kCancel",onClick:function(){ut.poster&&ut.poster.events.publish("image-loading-end"),a.hide(),n.reject(),o.resolve()}}]});else n.resolve(e);return n.promise}).then(o=>{var a=o.getContext("2d");return e.hasAlpha=me.checkCanvasForAlpha(a,o.width,o.height),e.hasAlpha?(me.trimTransparentEdges(o),me.canvasToBlob(o)):t.resolve(n)}).then(o=>{if(e.processedImgData=o,!Et.featureEnabled("entitle-brand-kit")||"brandkit"===e.source)return t.resolve(o);var n=re.currentBrandElements(),a=!n||!n.logos||n.logos.length<1;return re.addLogoToCurrentBrand(o,a)}).then(t=>(e.isLogo=!0,t&&(Pa(!0),e.sparkElementId=t.getValue("id"),e.sparkRoles=t.getValue("ac#roles")),ta(e,o))).catch(()=>t.resolve())}function ea(e){var t={files:[{source:"adobestock",mimeType:e.newItemInfo.mimeType,original:{link:e.newItemInfo.href,height:e.newItemInfo.height,width:e.newItemInfo.width},preview:{link:e.newItemInfo.href,height:e.newItemInfo.height,width:e.newItemInfo.width},thumbnail:{link:e.newItemInfo.thumb.url,height:e.newItemInfo.thumb.height,width:e.newItemInfo.thumb.width},licenseInfo:e.newItemInfo.info}],info:e.newItemInfo.info};xt=!0,$n(t,ta)}function ta(e,o,a,r,i){let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];o=o||t.defer(),a=a||t.defer(),r=r||!1,i=i||!1,at.validateDoc("addImageBegin"),_e.beginTrackingPendingXhrRequests();var d=Date.now();_e.pageUnloadBlockingBegin();var c=e.processedImgData||e.files[0],p=c.type||c.mimeType||"image/jpeg";"dooplo"===c.source&&c.preview.link.indexOf(".png")>-1&&"image/png"!==p&&(p="image/png");var u,g,m,b,h,f,w,v=he.getImageMediaMetadata(e.info),T=c instanceof Blob,k="Adobe Stock"===v.sourceName,I="google drive"===c.source,P=null,S=e.isLogo;return ut.poster&&ut.poster.events.publish("image-loading-begin"),t().then((function(){if(T||k||I)return t.resolve();var e=c.thumbnail||c.small||c.preview,o="/api/post/v1/proxy?url="+encodeURIComponent(e.link);return["dropbox","cc","lightroom","ccl"].indexOf(c.source)>-1&&(o=e.link),tt.load(o)})).then((function(o){if(T||k||I)return t.resolve();var n=me.createCanvas(o),a=n.getContext("2d");if(P=me.checkCanvasForAlpha(a,n.width,n.height)){if(xt)return t.resolve();me.trimTransparentEdges(n)}return u=n.toDataURL(),at.addOrReplaceImage({id:null,imageId:null,metadata:v,isLowResImage:!0,isNewPostImage:r,url:u,width:n.width,height:n.height,mimeType:p,replacementForma:e.replacementForma,replacementFrame:e.replacementFrame,sparkRoles:e.sparkRoles,sparkElementId:e.sparkElementId,hasAlpha:P,forceReplacement:xt,floatingImageStrategy:e.floatingImageStrategy,allowSelection:s})})).then((function(e){return f=e&&e.formaId,w=e&&e.contentNodeId,T||k||I||xt&&P||!ut.poster?e:(a.resolve(),n.delay((function(){ut.poster&&ut.poster.events.publish("image-loading-end")}),350),e)})).then((function(t){if(t=t||{},ut.savingIndicator&&ut.savingIndicator.show(),c instanceof Blob)return at.saveImageComponent(c,p);var o=function(e,t){if(e instanceof Blob)return e;var o=e.source,n=e.original.link,a=e.original.width,r=e.original.height;if("dooplo"===e.source&&e.original.width&&e.original.height&&e.original.width*e.original.height>Qn*Qn){var i=t._links.rendition.filter((function(e){return!!(e.href&&e.width&&e.height)&&e.width*e.height<Qn*Qn}));i.sort((function(e,t){return e.width<t.width?-1:e.width>t.width?1:0}));var s=i.pop();s&&(o="dooplocdn",n=s.href,a=s.width,r=s.height)}return o||lt.error("getBestRenditionForImageSaving source is falsy, imgData is ",e),{source:o,assetId:n,width:a,height:r}}(c,e.info);return b=o.width,h=o.height,l(at.saveImageComponent,{maxAttempts:3})({source:o.source,assetId:o.assetId},p,null,t.contentNodeId,t.contentNodeId)})).then((function(e){return c instanceof Blob?tt.loadImageFromBlob(c).then((function(t){return b=t.width,h=t.height,e})).catch((function(){return t.reject()})):e})).then((function(e){return g=e,m=je.decodeUrl(g.encodedUrl),tt.load(m)})).then((function(e){var t;return null===P&&(t=me.createCanvas(e),P=me.checkCanvasForAlpha(t.getContext("2d"),t.width,t.height)),b=e.width,h=e.height,P&&!S?(t||(t=me.createCanvas(e)),me.trimTransparentEdges(t),b=t.width,h=t.height,me.canvasToBlob(t)):e})).then((function(e){return!P||S?e:(ut.savingIndicator&&ut.savingIndicator.show(),at.saveImageComponent(e,p))})).then((function(e){return!P||S?e:(g=e,m=je.decodeUrl(g.encodedUrl),tt.load(m))})).then((function(t){if(S){var o={url:g.encodedUrl,pixelWidth:t.width,pixelHeight:t.height,mimeType:p,acRoles:e.sparkRoles,id:e.sparkElementId,componentId:g.component.id};return Ve.publish("editor:logoAdded"),at.addLogo(o)}var n={id:g.component.id,imageId:null,metadata:v,isLowResImage:!1,isNewPostImage:r,url:g.encodedUrl,width:b||t.width,height:h||t.height,mimeType:p,replacementForma:e.replacementForma,replacementFrame:e.replacementFrame,lowResImageUrl:u,hasAlpha:P,forceReplacement:xt,contentNodeId:w,floatingImageStrategy:e.floatingImageStrategy,allowSelection:s};return u?at.replaceImageWithHighRes(n):at.addOrReplaceImage(n)})).then((function(e){e&&e.formaId&&(f=e.formaId),at.updateConstrainedImages();var t=Date.now()-d;return Ve.publish("post:addImageEnd",{contextualData1:"timeElapsedMs:"+t,contextualData2:"imageSource:"+c.source}),a.resolve()})).then((function(){_e.endTrackingPendingXhrRequests(),at.validateDoc("addImageSuccess"),o&&o.resolve(),(T||xt&&P)&&n.delay((function(){ut.poster&&ut.poster.events.publish("image-loading-end")}),350)})).catch((function(t){if(t instanceof at.ActionError&&!t.isAllowedError&&at.shouldReloadOnActionFailure())return lt.error("doAction",t.message),void la();var n;if(e.replacementForma||e.replacementFrame?(lt.error("failed to replace image",t),at.cleanupInvalidImageWithColorSync(f,w,[]),n="i18n.dialogs.addOrReplaceImageFailed.kContentTextReplace"):(lt.error("failed to add image",t),at.cleanupInvalidImageSync(f,w),n="i18n.dialogs.addOrReplaceImageFailed.kContentText"),!i)var r=new L({headerText:"i18n.dialogs.addOrReplaceImageFailed.kHeaderText",contentText:n,dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.addOrReplaceImageFailed.kOK",onClick:function(){r.hide()}}]});ut.poster&&ut.poster.events.publish("image-loading-end"),at.updateConstrainedImages(),at.validateDoc("addImageFail"),o.reject(),a.reject()})).done(),a.promise}function oa(e){e&&e.id&&0===e.id.indexOf("bk_")&&Ve.publish("usedBrandKitPalette"),Ve.publish("paletteSelected")}const na=function(){let e,o,n,a=!1,r=!1;return function(s){var l,d;return at.validateDoc("saveBegin"),l=i.currentDoc.getDataFromRoot("cp#isExported"),"boolean"==typeof(d=at.getIsExported())&&d!==l&&at.setIsExported(l),(s?at.validateDBSaveState(s)?t.resolve(s):t.reject():at.postDocumentHasHighResImageSaveableState()).then(l=>{if(ut.savingIndicator&&ut.savingIndicator.show(),a)return o||(o=t.defer()),r=!0,o.promise;a=!0,n=Date.now(),Ve.publish("saveDocumentBegin"),i.currentDoc&&window.marvel.logger.beginTrackingFlow("saveProjectFromEditor",{sparkFormat:"post",projectId:i.currentDoc.id,projectUrn:i.currentDoc.getDCXComposite().assetId}),e||(e=t.defer());const d=at.imageFormas();for(let e=0;e<d.length;e++){const t=d[e];null==t.contentNode?lt.error("saving image with no contentNode"):null==t.contentNode.url&&lt.error("saving image with no url")}_e.pageUnloadBlockingBegin();let c,p,u;u="edit-template"===St.operation||"new-template-from-template"===St.operation||Et.featureEnabled("post-preview-image-disabled2")?t():ut.poster.getRendition({width:1200,imageQuality:.94}),u.then(e=>(c=e,ut.poster.getRendition({width:500,imageQuality:.94}))).then(e=>(p=e,ft===At.TEMPLATE&&re.currentBrandKit()&&Pt?ie.setUsedBrandElementsData(re.currentBrandKit(),Pt,at,!1):t.resolve(null))).then(()=>at.saveWithRenditions(c,p,l)).then(()=>{if(ut.docNameInput){const e=ut.docNameInput.getText();i.currentDoc.setProjectName(e)}e.resolve();const t=Date.now()-n;c?Ve.publish("saveDocumentEnd",{saveTimeElapsedMs:t,docId:i.currentDoc.id,previewImageSize:c.size}):Ve.publish("saveDocumentEnd",{saveTimeElapsedMs:t,docId:i.currentDoc.id}),a=!1,i.currentDoc&&window.marvel.logger.endTrackingFlow("saveProjectFromEditor"),at.validateDoc("saveSuccess"),r&&at.canSave()?(r=!1,e=o,na(s)):(ut.savingIndicator&&ut.savingIndicator.hide(),e=null,_e.pageUnloadBlockingEnd(),rt.resolve()),o=null},t=>{a=!1,e.reject(t),ut.savingIndicator&&ut.savingIndicator.hide(),lt.error("Failed to save Post project",t),at.validateDoc("saveFail"),e=null,_e.pageUnloadBlockingEnd(),rt.reject(t),aa(t)})}).catch(()=>{a=!1,ut.savingIndicator&&ut.savingIndicator.hide(),e=null,_e.pageUnloadBlockingEnd(),rt.reject(),aa({code:"VALIDATION_FAILED"})}).done(),e}}();function aa(e){function o(){window.location.pathname.includes("/design/post/")||window.location.reload()}if("UPDATE_CONFLICT"===e.code)var n=new L({headerText:"i18n.dialogs.saveFailedMergeConflict.kHeaderText",contentText:"i18n.dialogs.saveFailedMergeConflict.kContentText",dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.saveFailedMergeConflict.kRefresh",onClick:function(){n.hide(),(ht=t.defer()).resolve(),window.location.reload()}}]});else if("VALIDATION_FAILED"===e.code)var a=new L({headerText:"i18n.dialogs.saveFailed.kHeaderText",contentText:"i18n.dialogs.saveFailed.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.saveFailed.kRefresh",onClick:function(){a.hide(),(ht=t.defer()).resolve(),window.location.reload()}}]});else var r=new L({headerText:"i18n.dialogs.saveFailed.kHeaderText",contentText:"i18n.dialogs.saveFailed.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.saveFailed.kRefresh",onClick:function(){r.hide(),(ht=t.defer()).resolve(),window.location.reload()}},{class:"pill pill-secondary-on-light",label:"i18n.dialogs.saveFailed.kTryAgain",onClick:function(){r.hide(),at.requestSave(!0),za().done(o)}}]})}function ra(){return at&&(at.cancelPendingSaves(),at.requestSave(!0)),Et.featureEnabled("spark-home-enabled")?(zt=!0,Fa()):ht.promise}function ia(e,t,o){gt.push(e.events.subscribe(t,o))}function sa(e,t){var o=ut.poster.$el.offset(),n=ut.poster.getViewScale(),a=ut.poster.getWidth(),r=ut.poster.getHeight(),i=e.pageX-o.left,s=e.pageY-o.top;i>0&&i<a&&s>0&&s<r?ut.poster.getColorAtPoint({x:Math.round(i/n),y:Math.round(s/n)}).then((function(o){var n=de.rgb2hex(o);"click"===e.type?t.handleEyeDropperClicked(n):t.handleEyeDropperMoved(n,e)})):"click"===e.type?t.handleEyeDropperClicked(!1):t.handleEyeDropperMoved(!1,e)}function la(e){const t=new L({headerText:"i18n.dialogs.mustReloadEditor.kHeaderText",contentText:e||"i18n.dialogs.mustReloadEditor.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.mustReloadEditor.kRefresh",onClick:function(){t.hide(),window.location.reload()}}]});t.show()}function da(e){_e.pageUnloadBlockingBegin();var o=t.defer();ht=o,e.finalized?o.resolve():e.then((function(){o.resolve()})).fail((function(e){o.reject(e)}))}function ca(e){rt=e.coreDeferred,na(e.stateID)}function pa(e){(e=e||{}).silent="boolean"==typeof e.silent&&e.silent,ut.posterAdornments&&ut.posterAdornments.dismissPopUp(),ut.globalTabsWrapper&&!ut.globalTabsWrapper.isActive()&&(ut.textTabsWrapper.hide(),ut.backgroundTabsWrapper.hide(),ut.logoTabsWrapper.hide(),ut.globalTabsWrapper.show()),ut.tabButtonLayout&&ut.tabButtonLayout.isSelected()&&ut.sidebarLayout.returnFromSelectionState(),ut.tabButtonPalette&&ut.tabButtonPalette.isSelected()&&ut.sidebarPalette.rebindColorPicker(),ut.sidebarTemplates&&!ut.sidebarTemplates.isHidden()&&(ut.sidebarTemplates.returnedToGlobalSidebarState(),ut.brandIndicator&&(ut.brandIndicator.hide(),ut.postControlStrip.update({panels:[{id:"PostBrandIndicatorContainer",size:"0px"},{id:"PostSidebar",size:"auto"}]})))}function ua(){const e=at.getRootForma().page;return{sizeID:e.sizeID,pageSize:e.pageSize,exportData:e.exportData}}function ga(){let e=!0;if(!i.currentDoc.belongsToUser()){const t=re.currentBrandKit();t&&!1!==re.currentBrandElements().showBrandInUI&&t.getLogosSync().length||(e=!1)}e?ut.addContentLogoButton.enable():ut.addContentLogoButton.disable()}async function ma(e){(Ve.publish("showEditor"),pt&&ft===wt||await Zt().catch(lt.error),kt=new $e({doc:at.getDocument(),am:It,poster:ut.poster}),ut.addContentLogoButton&&ga(),ia(at,"design-updated",on),ia(at,"forma-updated",rn),ia(at,"formae-duplicated",sn),ia(at,"formae-deleted",ln),ia(at,"forma-added",dn),ia(at,"forma-selected",pn),ia(at,"filter-applied",ut.sidebarBackground.updateFilters),ia(at,"undo-redo-state-changed",fn),ia(at,"undo-finished",wn),ia(at,"redo-finished",vn),ia(at,"layer-double-tapped",mn),ia(at,"show-image-forma-corrupted-modal",bn),ia(at,"current-brand-changed",Ba),ia(at,"exit-crop-mode",xo),ia(at,"show-actionfeedback-message-modal",yo),ia(at,"enter-char-style-mode",wo),ia(at,"exit-char-style-mode",vo),ia(at,"force-reload-editor",la),ia(at,"update-save-promise",da),ia(at,"trigger-save",ca),at.bindToSaveManager(),ia(ut.posterAdornments,"buttonpress-style",ut.tabButtonTextType.select),ia(ut.posterAdornments,"buttonpress-edit",To),ia(ut.posterAdornments,"buttonpress-duplicate",Io),ia(ut.posterAdornments,"buttonpress-delete",Fo),ia(ut.posterAdornments,"buttonpress-group",Wo),ia(ut.posterAdornments,"buttonpress-ungroup",No),ia(ut.posterAdornments,"buttonpress-addText",ko),ia(ut.posterAdornments,"buttonpress-change-photo",Ko),ia(ut.posterAdornments,"buttonpress-logo",Yo),ia(ut.posterAdornments,"create-swap-thumbnail",zo),ia(ut.posterAdornments,"remove-swap-thumbnail",Uo),ia(ut.posterAdornments,"handle-drag",jo),ia(ut.posterAdornments,"create-swap-forma-overlay",Go),ia(ut.posterAdornments,"remove-swap-forma-overlay",Oo),ia(ut.posterAdornments,"stock-image-licensed",ea),ia(ut.posterAdornments,"post-interaction-layer-clicked",(function(){ut.docNameInput.$el.is(":focus")&&ut.docNameInput.blur(),ut.downloadButton&&ut.downloadButton.el.hideDownloadList(),ut.sharePostButton&&ut.sharePostButton.el.hideMenuDropdown(),qt&&Xt()})),ia(ut.sidebarText,"buttonpress-edit",To),ia(ut.sidebarText,"buttonpress-delete",Fo),ia(ut.sidebarText,"buttonpress-addText",ko),ia(ut.sidebarText,"get-new-brandkit-colors",Ta),ia(ut.sidebarText,"eyedropper-changed",(function(e){sa(e,ut.sidebarText)})),ia(ut.sidebarText,"buttonpress-close",pa),ia(ut.sidebarText,"size-slide-start",ut.posterAdornments.hideSelectionBox),ia(ut.sidebarText,"size-slide-end",ut.posterAdornments.showSelectionBox),ia(ut.poster,"rendered-image-layer-url-changed",hn),ia(ut.sidebarTheme,"item-selected",nn),ia(ut.sidebarTheme,"brand-button-pressed",ha),ia(ut.sidebarBackground,"buttonpress-change-photo",Ko),ia(ut.sidebarBackground,"buttonpress-add-photo",Vo),ia(ut.sidebarBackground,"filter-selected",(function(e,t,o){at.setImageFilterForSelection(e,t,o).done()})),ia(ut.sidebarBackground,"bg-color-selected",(function(e){at.setColorForSelection(e).done()})),ia(ut.sidebarBackground,"image-forma-replace-with-color",at.updateConstrainedImages),ia(ut.sidebarBackground,"eyedropper-changed",(function(e){sa(e,ut.sidebarBackground)})),ia(ut.sidebarBackground,"buttonpress-close",pa),ia(ut.sidebarBackground,"buttonpress-set-foreground",Do),ia(ut.sidebarBackground,"buttonpress-set-background",Ao),ia(ut.sidebarBackground,"buttonpress-crop",Po),ia(ut.sidebarBackground,"buttonpress-set-cutout-none",Eo),ia(ut.sidebarBackground,"buttonpress-set-cutout-remove-background",Lo),ia(ut.sidebarLayout,"grid-item-selected",Zo),ia(ut.sidebarResize,"size-item-selected",en),ia(ut.sidebarPalette,"item-selected",tn),ia(ut.sidebarPalette,"item-selected",oa),ia(ut.sidebarPalette,"eyedropper-changed",(function(e){sa(e,ut.sidebarPalette)})),ia(ut.sidebarPalette,"update-palette-color",(function(e,t){at.updateColorInTheme(e,t).done()})),ia(ut.sidebarLogo,"item-selected",Zn),ia(ut.sidebarLogo,"buttonpress-uploadNewLogo",Qo),ia(ut.sidebarLogo,"logo-uploaded",_n),ia(ut.sidebarLogo,"buttonpress-closeLogoPanel",pa),ia(ut.sidebarIcon,"buttonpress-replace-icon",Ko),ia(ut.sidebarIcon,"icon-color-selected",(function(e,t){at.setColorForSelection(e,t).done()})),ia(ut.sidebarIcon,"hide-icon-picker",(function(){ut.changeIconModalPanel.hide()})),ia(ut.sidebarIcon,"eyedropper-changed",(function(e){sa(e,ut.sidebarIcon)})),ia(ut.iconPicker,"item-selected",Vn),ia(ut.iconPicker,"hide",(function(){ut.changeIconModalPanel.hide()})),ia(ut.addTextSidebar,"badge-selected",an),ia(ut.addTextSidebar,"buttonpress-addTextPanel",pa),ia(ut.sidebarCrop,"crop-shape-selected",Bo),ia(ut.sidebarCrop,"crop-aspect-ratio-selected",So),ia(ut.sidebarCrop,"close-crop-picker",Co),ia(ut.imagePicker,"item-selected",$n),ia(ut.imagePicker,"hide",(function(){ut.changeImageModalPanel.hide()})),ia(ut.sidebarBackground,"hide-image-picker",(function(){ut.changeImageModalPanel.hide()})),ia(ut.colorPicker,"brand-color-added",Ta),ia(ut.colorPicker,"colorChangeModal",(function(e){"begin"===e.type?at.beginBranch():"confirm"!==e.type&&"cancel"!==e.type||at.endBranch("confirm"===e.type)})),ut.brandIndicator&&ia(ut.brandIndicator,"switch-brand",Vt),ut.sidebarAnimation&&(ia(ut.sidebarAnimation,"animation-loading-begin",Ua),ia(ut.sidebarAnimation,"animation-loading-end",Ga)),at.resumeSave(),Et.featureEnabled("entitle-brand-kit")&&!Et.featureEnabled("hide-premium-font-onboarding")&&(ut.tabButtonTextType.$el.addClass("premium-highlight-badge"),ut.sidebarText.events.subscribe("font-picker-opened",(function(){ut.tabButtonTextType.$el.removeClass("premium-highlight-badge")}))),ut.imagePicker&&ut.imagePicker.home(),ft===At.TEMPLATE?ut.topColorStrip.$el.css({background:"#ffffff"}):ut.topColorStrip.$el.css({background:"#10c459"}),ut.collabStatusButton)&&Ht(i.currentDoc.getCollaboration()&&"NONE"!==i.currentDoc.getCollaboration());!function(){const e=at.getRootForma(),t=e.filterWithCallback(e=>e.isSticker()),o=e.filterWithCallback(e=>e.isVideo());var n=t.length>0||o.length>0;if(!dt.webAnimationEnabled()){const t=e.filterWithCallback(e=>!!e.animation);n=n||t.length>0}if(n){const e=new L({headerText:"i18n.dialogs.minisFeatureNotice.kHeaderText",contentText:"i18n.dialogs.minisFeatureNotice.kContentText",buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.minisFeatureNotice.kButtonLabel",onClick:function(){e.hide()}}]});e.show()}}(),ft!==At.TEMPLATE&&(e.showShareButton?ut.sharePostButton.show():ut.sharePostButton.hide(),e.showDownloadButton?ut.downloadButton.show():ut.downloadButton.hide()),e.showFacebookUpdateCoverButton?ut.facebookUpdateCover.show():ut.facebookUpdateCover.hide(),e.showFacebookUploadButton?ut.facebookUploadButton.show():ut.facebookUploadButton.hide(),e.showTwitterUpload?ut.twitterUpload.show():ut.twitterUpload.hide(),ut.sidebarTheme.setCoreWrapper(at),ut.sidebarText.setCoreWrapper(at),ut.sidebarBackground.setCoreWrapper(at),ut.sidebarLogo.setCoreWrapper(at),ut.sidebarIcon.setCoreWrapper(at),ut.sidebarMultiselect.setCoreWrapper(at),ut.sidebarGroup.setCoreWrapper(at),ut.sidebarLayout.setCoreWrapper(at),ut.sidebarLayout.deselectSelected(),ut.sidebarCrop.setCoreWrapper(at),ut.sidebarResize.setCoreWrapper(at),ut.sidebarResize.deselectSelected(),ut.sidebarAnimation&&ut.sidebarAnimation.setCoreWrapper(at),ut.debugView&&ut.debugView.setCoreWrapper(at),ut.postEditorView.show(),ut.windowPanel.resize(),ut.sidebarTemplates&&(St.projectContext||(St.projectContext=i.getProjectContexts()),ut.sidebarTemplates.setupSessionData(St,i.currentDoc,Ct,It.remixParentAnalyticsMetadata,Et.featureEnabled("is-paid-user")),ut.sidebarTemplates.setCoreWrapper(at));var t,o,n=Date.now(),a=ut.poster.events.subscribe("rendered",(function(){var e=Date.now()-n;Ve.publish("post:posterInitialRenderEnd",{contextualData1:"timeElapsedMs:"+e,contextualData2:"editorOperation:"+St.operation,contextualData3:"numImages:"+at.imageFormas().length}),ut.sidebarTemplates&&ut.sidebarTemplates.events.publish("poster-initial-render-end"),a.remove()}));ut.poster.update({core:at}),at.setViewScale(ut.poster.getViewScale()),ut.posterAdornments.setPageElement(nt),ut.posterAdornments.setCoreWrapper(at),ut.posterAdornments.enable(),ut.imageWrapper.update({aspect:ut.poster.getAspect()}),ut.brandIndicator&&ut.brandIndicator.update({collaborationStatus:i.currentDoc.getCollaboration()||"NONE",isEntitled:Et.featureEnabled("entitle-brand-kit"),navigateToCreateBrandMethod:Aa}),ut.sidebarBackground.update(),ut.watermarkUI.updateWatermarkStatus(ct,!0),ft===At.TEMPLATE?(ut.tabButtonResize.select(),t=ie.getTemplateName(Pt),o=w.translate(Ft)):(e.startingMenu?"colors"===e.startingMenu?ut.tabButtonPalette.select():"layout"===e.startingMenu?ut.tabButtonLayout.select():"resize"===e.startingMenu?ut.tabButtonResize.select():"templates"===e.startingMenu?(ut.tabButtonTemplates.select(),delete e.startingMenu):ut.tabButtonTheme.select():e.showImageModalPanelOnload?(ut.tabButtonBackgroundImage.select(),ut.changeImageModalPanel.show()):"remix"===St.operation||"new-from-template"===St.operation?ut.tabButtonLayout.select():ut.tabButtonTheme.select(),t=i.currentDoc.getProjectName(),o=w.translate(Mt)),ut.docNameInput&&((t=t||o)===o?(ut.docNameInput.$el.addClass("placeholder"),ut.docNameInput.$el.removeClass("named")):(ut.docNameInput.$el.removeClass("placeholder"),ut.docNameInput.$el.addClass("named")),ut.docNameInput.setText(t)),window.addEventListener("resize",(function(e){Xt(),ut.posterAdornments.handleWindowResize(),ut.watermarkUI.updateWatermarkDiscoverabilityComponents()})),fn({atShowEditor:!0})}function ba(e){const o=re.currentBrandElements();if(!o||!o.activated)return t.resolve(null);e||o.coreBrandPromise&&o.coreBrandPromise.isFulfilled()||fa(o),ut.poster&&ut.poster.events.publish("image-loading-begin");const n=e?se.getLiteCoreBrand(o):o.coreBrandPromise,a=o.belongsToUser?re.checkForRestrictedFonts():t.resolve([]);let r;return n.then(e=>(r=e,a)).then((function(e){if(e.length){const o=t.defer();return window.marvel.events.trigger("missing-brand-fonts-ux",{doc:i.currentDoc,missingFonts:e,defer:o}),o.promise.then(e=>e?t.resolve():t.reject({brandFontsVerificationFailed:!0}))}return t.resolve()})).then(()=>r?at.brandDocument(r):t.resolve()).then(()=>{ut.poster&&ut.poster.events.publish("image-loading-end")}).catch(e=>{if(e&&e.brandFontsVerificationFailed)return t.resolve();const o=e&&e.message?": ".concat(e.message):"";return lt.error("brandDocument error ".concat(o),e),t.resolve()})}function ha(e){const t=re.currentBrandElements();"INCOMING"!==i.currentDoc.getCollaboration()||t&&(!t||!1!==t.showBrandInUI)?t&&t.activated?(ba().done(),Ve.publish("brandifyApplied")):window.marvel.events.trigger("spark-post-show-brandify-onboarding",{element:e.$element}):Me.showAlert(w.translate("dialogs.brandifySharedProjectAlert.kHeaderText"),w.translate("dialogs.brandifySharedProjectAlert.kContentText"),{okText:w.translate("dialogs.brandifySharedProjectAlert.kButtonLabel")})}function fa(e){e&&e.coreBrandPromise?e.coreBrandPromise.done(()=>(oe.Host.setAuthoringContext(e.coreBrand),e.coreBrand)):oe.Host.setAuthoringContext(null)}function wa(e){ut.sidebarLogo&&(e&&e.primaryLogoPromise?ut.sidebarLogo.updateListOfBrandKitLogos(e):ut.sidebarLogo.updateListOfBrandKitLogos([]))}function va(e){var t=e&&e.activated?e:null;ut.sidebarPalette&&ut.sidebarPalette.setListOfBrandKitPalettes(t),ut.sidebarText&&ut.sidebarText.setBrandKitColors(at.getBrandKitColorsPalettesForSelectedLockup(t)),ut.sidebarBackground&&ut.sidebarBackground.setBrandKitColors(t),ut.sidebarIcon&&ut.sidebarIcon.setBrandKitColors(t),ut.colorPicker&&ut.colorPicker.update({authoringContext:re.currentBrandKit()})}function Ta(){!function(e){const o=re.currentBrandElements();!Et.featureEnabled("entitle-brand-kit")||o&&!1===o.showBrandInUI?t():re.refreshBrandColors().then((function(t){fa(t),e&&va(t)}))}(!0)}function ka(e){e=e||re.currentBrandElements();const t=re.currentBrandKit();let o=e;e&&!1===e.showBrandInUI&&(o=null),wa(o),va(o),ut.sidebarText&&ut.sidebarText.setBrandkit(e&&!1!==e.showBrandInUI?t:null),ut.sidebarTheme&&ut.sidebarTheme.setBrandKitThemes(o),ut.brandIndicator&&ut.brandIndicator.setBrand(e,t)}function Ia(e,t){fa(e),t&&ka(e)}function Pa(e,o){return re.refreshCachedCurrentBrandElements().then(Na(o,t=>{Ia(t,e)})).catch(e=>{if(e&&e.message===ot.STALE_SESSION)return t.reject(e);lt.error("refreshCurrentBrandElements: ".concat(e))})}function Sa(e){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return re.switchCurrentAuthoringContext(e).then(e=>(Ia(e,!0),e.coreBrandPromise)).then(e=>{if(o)return at.changeBranding(e)}).timeout(3e5).catch(e=>{const o=e?e.message:"";return Me.showAlert(w.translate("dialogs.switchBrandFailureAlert.kHeaderText"),w.translate("dialogs.switchBrandFailureAlert.kContentText"),{okText:w.translate("dialogs.switchBrandFailureAlert.kButtonLabel")}),lt.error("switchBrand error: ".concat(o),e),t.reject()})}function Ba(e){e!==(re.currentBrandElements()&&re.currentBrandElements().id)&&Sa(e,!1)}function Ca(t){e(t.target).is("#PosterImageWrapper")||1===e(t.target).closest("#PosterImageWrapper").length||1===e(t.target).closest("#selectionPopUp").length||ut.globalTabsWrapper.isActive()||pa()}let xa;function ya(e){if(e=e||{},!xa){xa=t.defer();const n=Date.now();o.e(51).then(function(a){const r=o("+7aA"),i=Date.now();lt.info("headless load time = "+(i-n)),("string"==typeof e.authoringContextId?re.getBrandKitById(e.authoringContextId):t.resolve()).then(e=>r.initialize(e)).done(()=>{const e=Date.now();lt.info("headless init time = ".concat(e-i)),xa.resolve(r)})}.bind(null,o)).catch(o.oe)}return xa.promise}function Da(e){La(e,"home")}function Aa(e){La(e,"create_brand")}function Ea(e){La(e,"organizer")}function La(e,t){var o="/";if("organizer"===t?o+="projects":"create_brand"===t&&(o+="branding/create"),zt=!0,e="boolean"==typeof e&&e)at&&at.cancelPendingSaves(),ht.resolve();else{if(Ma())return at&&at.cancelPendingSaves(),void Wa({returnPath:o});at&&at.executePendingSaves()}za().done((function(){at&&at.willCloseDocument(),window.marvel.navigate(o,{trigger:!0})}))}function Ma(){return Et.featureEnabled("spark-home-enabled")&&"new"===St.operation&&"blank"===St.workflow&&!Rt}function Fa(){const e=t.defer();return ht.promise.finally((function(){i.waitForQuiet().then((function(){e.resolve()}))})),e.promise}function Wa(e){e=e||{};const o=t.defer(),n=new L({headerText:"i18n.dialogs.saveNonDirtyNewBlank.kHeaderText",contentText:"i18n.dialogs.saveNonDirtyNewBlank.kContentText",dismissable:!0,onDismissed:function(){o.resolve({dismissed:!0})},buttons:[{class:"pill pill-primary-on-dark",label:"i18n.dialogs.saveNonDirtyNewBlank.kDontSave",onClick:function(){n.hide(),o.resolve(!1)}},{class:"pill pill-secondary-on-light",label:"i18n.dialogs.saveNonDirtyNewBlank.kSaveProject",onClick:function(){n.hide(),o.resolve(!0)}}]});o.promise.then((function(o){if(!o.dismissed)if(at.requestSave(!0),o)Fa().done((function(){e.returnPath?window.marvel.navigate(e.returnPath,{trigger:!0}):e.defer&&e.defer.resolve()}));else{const o=new L({headerText:"i18n.dialogs.saveNonDirtyNewBlank.kDeleteProgress",contentText:'<div class="postspinner postspinner-small"></div>',dismissable:!1});o.show();const n=function(){o.hide()};window.marvel.events.once("design-view-unloading",n),Fa().done((function(){const o=t.defer();window.marvel.events.trigger("delete-current-doc",{doc:i.currentDoc,defer:o}),o.promise.then((function(){e.returnPath?window.marvel.navigate(e.returnPath,{trigger:!0}):e.defer&&e.defer.resolve()}))}))}}))}function Na(e,o){var n=this;return function(){if("number"==typeof e&&e!==mt)return t.reject(new Error(ot.STALE_SESSION));var a=[].slice.apply(arguments);try{var r=o.apply(n,a);return r}catch(e){return t.reject(e)}}}function Ra(e){e&&e.message===ot.STALE_SESSION?lt.error("Abandoning stale session. May be benign."):(window.marvel.events.trigger("hide-interstitial"),!e||e.userCanceledNPW||e.doNotLog||e.isWebGLUnavailable?(e&&e.isWebGLUnavailable&&lt.warn("Failed to enable Post editor due to WebGL unavailability"),La(!0)):(e.url=window.location.href,lt.error("error enabling Post editor",e),ut.windowPanel.show(),ut.errorDialogs.enableEditorErrorModal=Ee(e,()=>{La(!0)})))}function za(e){var t="string"==typeof e?e:"i18n.app.kSavingPost";ht.promise.isPending()&&(it&&t===Tt||(it=new L({headerText:t,contentText:'<div class="postspinner postspinner-large"></div>',dismissable:!1}),Tt=t),it.show());var o=setTimeout((function(){at.triggerAssert("Save timed out, manually resolving save promise to unblock user"),ht.resolve()}),12e4);return ht.promise.finally((function(){clearTimeout(o),it&&it.hide()})).done(),ht.promise}function Ua(){ut.posterAdornments.showLoadingSkrim()}function Ga(){ut.posterAdornments.hideLoadingSkrim()}function Oa(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Ha(e),function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];at.hasAnimationStyle()&&"function"==typeof ut.poster.playAnimation&&(at.generateKeyFrames(),e&&ut.animationPlayButton&&ut.animationPlayButton.startProgress(),ut.poster.playAnimation())}(e)}function ja(){Ha(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])}function Ha(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];"function"==typeof ut.poster.pauseAnimation&&ut.poster.stopAnimation(),e&&ut.animationPlayButton&&ut.animationPlayButton.reset()}return dt.enable=function(o,a){It=new qe;var r=++mt;if(o){ut.errorDialogs.fontMissingNoticeModal&&ut.errorDialogs.fontMissingNoticeModal.hide(),nt=o,ut.windowPanel?ut.windowPanel.update({parentDomElement:nt,hidden:!0}):ut.windowPanel=new C({id:"PostWindowPanel",parentDomElement:nt,hidden:!0});var l,d,c=Date.now(),p=!pt,u=0,g="new"===(St=a).operation;wt=ft,ft=At.DOCUMENT,"edit-template"===St.operation&&(ft=At.TEMPLATE);var b={};dt.enabled=!0,ce.resetLoadingTimes();var h,v,T=(h=Ye.getSetting(Ce.keys.POST_WATERMARK_UNLOCKED).catch(e=>{const o=e?e.message:"";return lt.warn("Error fetching user settings for watermark status. Error: ".concat(o),e),t.resolve(!1)}),v=Et.loadFeatures(),Promise.all([h,v]).then((function(e){var t=e[0],o=Et.featureEnabled("show-remove-branding-flow"),n=Et.featureEnabled("remove-branding-enabled");return!t&&o&&n?(Ye.setSetting(Ce.keys.POST_WATERMARK_UNLOCKED,!0),!0):t}))),k=t.allSettled([ht.promise,Et.loadFeatures()]);m.doSerial([k,function(){return w.initLocalization(w.sparkSelectedLocale)}]).then(Na(r,(function(){window.marvel.events.on("saved-composite-doc",Kt),Et.featureEnabled("entitle-brand-kit")&&window.marvel.events.on("onboarding-premium-templates-remove",jt),window.marvel.events.on("document-collaboration-changed",_t),oe.Host.setFeatureController(Et)}))).then(Na(r,(function(){if(Et.featureEnabled("entitle-brand-kit")||"remix"!==St.operation)return t.resolve();var e=t.defer();return It.getRemixParentCPMetadata(St.cpAssetId,St.cpServiceDomain||"cc-api-cp.adobe.io",!1).then(Na(r,t=>{const{tags:o,id:n,alias:a}=t;o&&o.includes("remixpaid")?(window.marvel.events.trigger("hide-interstitial"),ut.windowPanel.show(),s.showMerchMessagingModal({workflow:"remixPremiumTemplate",destinationUrl:St.routeFragment,asset:{id:n,alias:a,tags:o,isPremiumTemplate:!0,remixable:!0,remixpaid:!0,app:"post"},analyticsPage:"editor:post",analyticsFullTagNames:"[".concat(o.join(", "),"]")}),window.marvel.events.on("upgrade-view-closed",()=>{window.marvel.events.off("upgrade-view-closed"),e.reject({message:"user not entitled to remix premium template",doNotLog:!0})})):e.resolve()})).catch((function(t){e.reject(t)})),e.promise}))).then(Na(r,(function(){var e=t.defer(),o=document.createElement("canvas").getContext("webgl");if(!1===(null!==o&&o instanceof WebGLRenderingContext)){var n=be.webGLSystemInfo();Ve.publish("webGLUnavailable",n),ut.errorDialogs.webglWarningModal=new L({headerText:"i18n.dialogs.webGLDisabled.kHeaderText",contentText:"i18n.dialogs.webGLDisabled.kContentText<br/><br/>Vendor: "+n.vendor+"<br/>Renderer: "+n.renderer+"<br/>Platform: "+n.platform+"<br/>UserAgent: "+n.userAgent,dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"OK",onClick:function(){ut.errorDialogs.webglWarningModal.hide(),e.reject({isWebGLUnavailable:!0})}}]}),window.marvel.events.trigger("hide-interstitial"),ut.windowPanel.show(),ut.errorDialogs.webglWarningModal.show()}else Ve.publish("webGLAvailable"),e.resolve();return e.promise}))).then(Na(r,(function(){if(!g)return t.resolve();ut.newPostWorkflow||(ut.newPostWorkflow=new R({parent:ut.windowPanel})),Ve.publish("newProjectWorkflowLoaded");var e=Date.now(),o=ut.newPostWorkflow.prompt(a);return ut.windowPanel.show(),o.then((function(t){Ct=l=t,u=Date.now()-e,window.marvel.events.trigger("show-interstitial",{typeName:"post"})}))}))).then(Na(r,(function(){return function(e,t){return(t=t||{}).belongsToUser="boolean"!=typeof t.belongsToUser||t.belongsToUser,e=Et.featureEnabled("entitle-brand-kit")?e:null,re.loadBrandKit(e,t).then(e=>{const o=!!(t.belongsToUser||e&&!e.belongsToUser()),n=e&&o?e.getId():null;oe.Host.brandkitManager.activateBrand(n)})}(St.contextId||i.currentDoc.getDCXRoot().getValue("authctx#ctxid"),{skipReload:!0,belongsToUser:"INCOMING"!==i.currentDoc.getCollaboration(),isEntitledUser:Et.featureEnabled("entitle-brand-kit")})}))).then(Na(r,(function(){return e=re.currentBrandKit(),ce.load({loadForEditor:!0,authoringContext:e});var e}))).then(Na(r,()=>Pa(!1,r))).then(Na(r,(function(){const e=re.currentBrandKit(),t=re.currentBrandElements();if(g){t&&t.activated&&((d="true"===St.branded)?Ve.publish("paidProjectStartBranded"):Ve.publish("paidProjectStartUnbranded"))}else{if("edit-template"===St.operation||"new-from-template"===St.operation||"new-template-from-template"===St.operation)return Pt=e.getThemeById(St.templateId),b.persistSource=fe.fromTemplate(e,Pt),"new-template-from-template"===St.operation?(Ve.publish("createdTemplateFromTemplate"),ie.createEmptyPostTemplate(e).then(Na(r,(function(t){return b.persistSave=we.toTemplateLocal(e,Pt,we.CommitChanges.AUTO),St.newTemplateId=t.id,b})))):("edit-template"===St.operation?(Ve.publish("editedTemplate"),b.persistSave=we.toTemplateLocal(e,Pt,we.CommitChanges.AUTO)):(Ve.publish("projectCreated",{projectId:i.currentDoc.id}),Ve.publish("createdBrandedProject",{projectId:i.currentDoc.id,templateName:Pt._data["theme#data"].name,themeletId:St.templateId}),Ve.publish("createdProjectFromTemplate"),$t(i.currentDoc.id),b.persistSave=we.toDocument(i.currentDoc)),b);"remix"===St.operation?(je.setCPServiceDomain(St.cpServiceDomain),$t(i.currentDoc.id),new Ke({cpServiceDomain:St.cpServiceDomain}).trackRepeatableActivity(St.cpAssetId,"remix_count"),b={persistSource:new He({assetId:St.cpAssetId,cpServiceDomain:St.cpServiceDomain,urn:St.urn}),persistSave:we.toDocument(i.currentDoc)}):(je.setCPServiceDomain(""),b={persistSource:fe.fromDocument(i.currentDoc),persistSave:we.toDocument(i.currentDoc)})}return oe.FormaToPGMUtils.cpEnv=St.cpServiceDomain===window.marvel.settings.cpsStage?"stage":"prod",b}))).then(Na(r,(function(e){return(at=new f(e)).whenInitialized().then(Na(r,(function(){ce.logLoadingTimes();var e=at.missingFontListInDoc();e.length>0&&function(e){var t=e.join(", ");ut.errorDialogs.fontMissingNoticeModal||(ut.errorDialogs.fontMissingNoticeModal=new L({headerText:"i18n.dialogs.fontMissingNotice.kHeaderText",contentText:w.translate("dialogs.fontMissingNotice.kContentText",{missingFontNames:t}),buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.fontMissingNotice.kEditButtonLabel",onClick:function(){ut.errorDialogs.fontMissingNoticeModal.hide(),Ve.publish("missingFontsWhenOpenReplaceButtonPressed")}},{class:"pill pill-secondary-on-light",label:"i18n.dialogs.fontMissingNotice.kCancelButtonLabel",onClick:function(){ut.errorDialogs.fontMissingNoticeModal.hide(),La(!0),Ve.publish("missingFontsWhenOpenCancelButtonPressed")}}]})),ut.errorDialogs.fontMissingNoticeModal.show()}(e),oe.Host.setCoreWrapper(at),at.validateDoc("open"),It.setDocument(at.getDocument()),bt.resolve(at)})))}))).then(Na(r,(function(){if("remix"===St.operation){var e;if(St.aspectId||St.customSize)if(St.customSize){var o=St.customSize.split(":");4===o.length&&(e=oe.DesignSizeLibrary.getCustomSize(o[0],o[1],o[2],o[3]))}else e=oe.DesignSizeLibrary.getById(St.aspectId);return(e?at.setPageSizeFromDesignSize(e):t.resolve()).then(Na(r,(function(){return at.recordOriginalSize()})))}return g?at.setPageSizeFromDesignSize(l.shapeData).then(Na(r,(function(){return at.recordOriginalSize()}))).then(Na(r,(function(){if(!l.image)return t.resolve();if(l.image&&(Rt=!0),Array.isArray(l.image)){var e,o=[];return l.image.forEach((function(n){var a=t.defer();a.promise.catch((function(){if(!e){var t=new L({headerText:"i18n.dialogs.addImageError.kHeaderText",contentText:"i18n.dialogs.addImageError.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"Ok",onClick:function(){t.hide()}}]});ut.errorDialogs.addImageErrorOverlay=t,e=!0}})),o.push(ta(n,a,null,!0,!0,!1))})),t.allSettled(o)}return ta(l.image,null,null,!0,null,!1).catch((function(){return t.resolve()}))}))).then(Na(r,(function(){return at.initializeNewPost(l)}))).then(Na(r,(function(){return d?ba(!0):t.resolve()}))).then(Na(r,(function(){Ve.publish("projectCreated",{projectId:i.currentDoc.id,aspectRatio:l.shapeData.aspectRatio,targetId:l.shapeData.id,id:l.id,textLength:l.text.length,workflow:a.workflow}),d&&Ve.publish("createdBrandedProject",{projectId:i.currentDoc.id})}))):t.resolve()}))).then(Na(r,(function(){var e="remix"===St.operation,o="new-from-template"===St.operation,n=St.cpServiceDomain||"cc-api-cp.adobe.io",a=at.getRemixParentsCpIds(),s=St.cpAssetId||(a?a[a.length-1]:null),l=o?St.templateId:at.getAuthoringContextThemeId();return o&&at.setAuthoringContextThemeId(St.templateId),It.getRemixParentCPMetadata(s,n,!!l).then(Na(r,(function(t){e&&(i.currentDoc.name="",at.setRemixParentCpId(t.id))}))).catch((function(o){return o&&o.message===ot.STALE_SESSION?t.reject(o):e?t.reject(o):(lt.warn("Failed to get parent CP metadata for a non-remix flow",o),t.resolve())}))}))).then(Na(r,(function(){if("remix"!==St.operation&&"new-from-template"!==St.operation)return t.resolve();var e=t.defer();return 0===at.getRootForma().childCount?(ut.errorDialogs.notRemixableOverlay=new L({headerText:"i18n.dialogs.remixFailed.kHeaderText",contentText:"i18n.dialogs.remixFailed.kContentText",dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"OK",onClick:function(){ut.errorDialogs.notRemixableOverlay.hide(),e.reject(),La(!0)}}]}),window.marvel.events.trigger("hide-interstitial"),ut.windowPanel.show(),ut.errorDialogs.notRemixableOverlay.show()):(at.requestSave(),e.resolve()),e.promise}))).then(Na(r,(function(){return T}))).then(Na(r,(function(e){var o=Et.featureEnabled("entitle-brand-kit"),n=Et.featureEnabled("post-create-template-contentteam");return ct=!n&&(!e&&!o&&("remix"===St.operation||at.getWatermarkEnabledForDoc())),at.setWatermarkEnabledForDoc(ct),Ye.getSetting(Ce.keys.POST_WATERMARK_COACHMARK_DISMISSED).then(Na(r,(function(e){Bt=e}))).catch(e=>{const o=e?e.message:"";if(o===ot.STALE_SESSION)return t.reject(e);lt.warn("Error fetching user settings for watermark coachmark. Error: ".concat(o),e),Bt=!1})}))).then(Na(r,(function(){at.resetUserActions(),at.monitorTransactions(),ma(function(e){e=e||{};var t=Nt.default;if(e.workflow&&Nt.hasOwnProperty(e.workflow)&&(t=n.clone(Nt[e.workflow])),e.startingMenu&&(t.startingMenu=e.startingMenu),!t.isDefault&&e.buttons){var o=e.buttons;o.indexOf("facebook_upload")>=0&&(t.showFacebookUploadButton=!0),o.indexOf("share")>=0&&(t.showShareButton=!0),o.indexOf("download")>=0&&(t.showDownloadButton=!0)}return n.each(Wt,(function(o){var a;n.isUndefined(e[o])||(a="true"===e[o]||"false"!==e[o]&&e[o],t[o]=a)})),t}(a)).then(Na(r,()=>{ft===At.TEMPLATE&&(vt={templateName:ie.getTemplateName(Pt)}),ut.windowPanel.show(),window.marvel.events.trigger("hide-interstitial"),ka(re.currentBrandElements())})).catch(lt.error)}))).then(Na(r,(function(){var t=["new","new-from-theme","new-from-template","remix"].indexOf(St.operation)>=0,o=re.currentBrandElements()||{id:""};const a=It.remixParentAnalyticsMetadata;Ve.publish("project:editorDisplayed",{isBranded:!n.isEmpty(i.currentDoc.getDCXRoot().getValue("authctx#ctxid")),contextualData23:o.isDefault?"":o.id,isNewProject:t,sparkFormat:"post",contextData:["projectId"],includesUploadedFonts:dt.includesUploadedFonts(),contextualData5:"tagNames:"+a.tagNames,contextualData6:"templateType:"+a.templateType,contextualData24:"collabStatus:"+i.currentDoc.getCollaborationForAnalytics(),templateId:a.templateId}),window.marvel.events.trigger("editor-displayed",{appName:"post"});var r=Date.now()-c;u&&(r-=u),Ve.publish("post:editorStartupEnd",{contextualData1:"timeElapsedMs:"+r,contextualData2:"editorOperation:"+St.operation,contextualData3:"isFreshLoad:"+p,contextualData4:"hasActivatedBrand:"+(!!o&&o.activated),contextualData5:"timeSpentInNpw:"+u}),Je.startListening({handleUndo:to,handleRedo:oo,selectAll:at.selectAll,deselectAll:at.deselectAll}),e("#PostCanvasSection").on("click",Ca)}))).then(Na(r,()=>{"new"!==St.operation&&(at.replaceCorruptImageFrames()&&(lt.error("Replacing corrupt images in document during open"),ut.errorDialogs.replacedLowResImagesModal||(ut.errorDialogs.replacedLowResImagesModal=new L({headerText:'\n                  <span class="error-modal-header">\n                    <span>i18n.dialogs.corruptImageReplacement.kHeaderText</span>\n                    <i class="error-modal-header__icon"></i>\n                  </span>\n                ',contentText:'<div class="error-modal-content">\n                      <span>i18n.dialogs.corruptImageReplacement.kContentText</span>\n                      <span class="error-modal-content_placeholder-indicator" style="background-color: #FF0000;"></span>\n                    </div>',dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.corruptImageReplacement.kButtonLabel",onClick:()=>ut.errorDialogs.replacedLowResImagesModal.hide()}]})),ut.errorDialogs.replacedLowResImagesModal.show()))})).catch(Ra).done()}},dt.getMetadataForExportAnalytics=function(e,t){return It.getMetadataForExportAnalytics(e,t)},dt.disable=function(){dt.enabled=!1,re.resetBrandCaches(),Pt=null,vt=null,Rt=!1,Ct=null,Object.keys(ut.errorDialogs).forEach(e=>ut.errorDialogs[e].hide()),pa({silent:!0}),ut.windowPanel&&ut.windowPanel.hide(),bt=t.defer(),ht.promise.done((function(){ut.poster&&ut.poster.update({core:null}),ut.posterAdornments&&ut.posterAdornments.disable(),ut.postEditorView&&ut.postEditorView.hide(),ut.newPostWorkflow&&ut.newPostWorkflow.hide(),window.marvel.events.off("saved-composite-doc",Kt),window.marvel.events.off("onboarding-premium-templates-remove",Jt),window.marvel.events.off("upgrade-view-closed"),window.marvel.events.off("document-collaboration-changed",_t),function(){for(var e=0;e<gt.length;e++)gt[e].remove();gt=[]}(),Je.stopListening(),e("#PostCanvasSection").off("click",Ca)}))},dt.handleUnload=function(){if(!at)return t();const e=at.getDocument();if(!e)return t();const o=ge.getAllStringForFormaUsedWheelSuggestions(e);if(o.length>0&&Ve.publish("lockupStyleCaptured",{contextualData1:"styleString:".concat(o),contextualData2:"location:EditorClose"}),!zt&&Ma()){var n=t.defer();return Wa({defer:n}),n.promise}return zt=!1,zt=!1,zt=!1,za()},dt.getCurrentDocumentSynthesizedName=function(){return at.getCurrentDocumentSynthesizedName()},dt.getCurrentDocumentDescription=function(){return at.getCurrentDocumentDescription()},dt.getRemixAncestorsIntoMachineTags=function(e){return at.getRemixAncestorsIntoMachineTags(e)},dt.getDocumentSize=function(){return at.getDocumentSize()},dt.getCoreWrapperPromise=function(){return bt.promise},dt.saveAsCopyToTemplate=function(){var e,t;return ut.poster.getRendition({width:500,imageQuality:.75}).then((function(e){return t=e,r.getController()})).then((function(e){return e.getGlobalActiveContext()})).then((function(t){if(!(e=t))throw new Error("No current BrandKit.");return ie.createEmptyPostTemplate(e)})).then((function(o){var n=we.toTemplateExternal(e,o,we.CommitChanges.AUTO);return at.saveCopyWithRenditions(n,null,t)}))},dt.getDownloadImageBlobPromise=function(e,t,o){if(dt.enabled)return kt.generateImageBlob(t,o);let n;return ya({authoringContextId:e.getDCXRoot().getValue("authctx#ctxid")}).then(t=>{const o=fe.fromDocument(e),a=new Te;return n=new f({persistSource:o,persistSave:a}),n.whenInitialized().then(()=>t)}).then(e=>{var o=n.getDocument();Ge.reportNounProjectIds(o,a,n.requestSave);const r=$e.getRenditionParams(o,t);return e.getRenditionBlobPromise(n,r)})},dt.getPgmGraphForPublish=function(){return et.getPgmGraphForPublish(at)},dt.hasAnimationStyle=function(){return!!at&&at.hasAnimationStyle()},dt.webAnimationEnabled=function(){return Et.featureEnabled("post-web-animation-enabled")||Et.featureEnabled("force-post-web-animation-enabled-for-adobe")&&st},dt.getCompositeImageFiles=function(e){var o;return ya().then((function(){var t=fe.fromDocument(e),n=new Te;return(o=new f({persistSource:t,persistSave:n})).whenInitialized()})).then((function(){var e=o.imageFormas(),n=[];e.forEach((function(e){n.push(tt.load(je.decodeUrl(e.contentNode.url)))}));var a=[];return t.all(n).then((function(){for(var e=[],o=[],n=0;n<arguments[0].length;n++){var r=arguments[0][n];if(r instanceof HTMLImageElement){o.push(r.src);var i=r.src.substring(r.src.lastIndexOf("=")+1),s=me.createCanvas(r);e.push(me.canvasToBlob(s,i))}}return t.all(e).then((function(){for(var e=0;e<arguments[0].length;e++){var t=arguments[0][e],n=new RegExp(/asset_id=([^&]*)/),r=n.exec(o[e])[1],i=o[e].substring(o[e].lastIndexOf("/")+1);a.push({name:r+"."+i,assetId:r,blob:t})}return a})).catch((function(e){lt.error("getCompositeImageFiles fail-1",e)}))})).catch((function(e){lt.error("getCompositeImageFiles fail-2",e)}))}))},dt.includesUploadedFonts=function(){return!!at&&at.includesUploadedFonts()},dt.includesPaidAdobeFonts=function(){return at?at.getDocFontSourceUsage().indexOf(oe.describeFontSource(oe.FontSource.TYPEKIT_PREMIUM))>-1:(lt.warn("includesPaidAdobeFonts: Unable to get font usage info from doc - coreWrapper unavailable"),"unknown")},dt.getRemixParentsCpIds=function(){return at?at.getRemixParentsCpIds():(lt.warn("getRemixParentsCpIds: Unable to get remix parent ids from doc - coreWrapper unavailable"),null)},dt.getConstrainedImages=function(){return at?at.getConstrainedImages():(lt.warn("getConstrainedImages: Unable to get constrained images info from doc - coreWrapper unavailable"),null)},dt.getFontsUsed=function(){var e=t.defer();return bt.promise.done((function(){at?e.resolve(at.getFontsUsed()):e.reject("coreWrapper is undefined")}),(function(){e.reject("could not load coreWrapper")})),e.promise},dt.setCPProjectId=function(e){at&&at.setCPProjectID(e)},dt.setCPAlias=function(e){at&&at.setCommunityPlatformAlias(e)},dt.setCPAssetId=function(e){at&&at.setCommunityPlatformAssetID(e)},dt.setPublishedContentEtag=function(e){at&&at.setPublishedEtag(e)},dt}.apply(t,n))||(e.exports=a)}}]);
//# sourceMappingURL=theo-web-view_e27cd5be-096ddbf9.js.map