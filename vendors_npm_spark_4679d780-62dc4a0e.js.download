(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[16],{"+N83":function(t,e,n){var o,r,i,a=e,s=n("oAGj"),l=n("c9Jm"),u=n("yGNn"),c=n("jo4Y"),h=n("lmwz");a.DeleteImagesTest=(o=function(){this.actionSequence_Delete=[],this.page_=null,this.backgroundImages_=[],l.ActionTestBase.call(this)},s.defineClass({name:"DeleteImagesTest",ctor:o,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return h.ImageFacade.getBackgroundImagesFromPage(n.firstPage).length>0},populateActionSequence:function(t,e,n){var o=this,r=s.clone(t);return this.backgroundImages_=s.clone(h.ImageFacade.getBackgroundImagesFromPage(n.firstPage)),this.backgroundImages_.length>0&&(r=r.concat([function(){return new c.DeleteAction(s.clone(o.backgroundImages_))}])),u.CorePromise.resolve(s.clone(r))},setUpActionSequence:function(t,e,n){this.page_=n.firstPage},validateAfterActionSequence:function(t,e){var n=s.clone(h.ImageFacade.getBackgroundImagesFromPage(this.page_));XCTAssertEqual(n.length,0)},validateAfterUndo:function(t,e){var n=s.clone(h.ImageFacade.getBackgroundImagesFromPage(this.page_));XCTAssertEqual(n.length,this.backgroundImages_.length)},validateAfterRedo:function(t,e){var n=s.clone(h.ImageFacade.getBackgroundImagesFromPage(this.page_));XCTAssertEqual(n.length,0)}}}),o),a.DeleteCellsTest=(r=function(){this.actionSequence_Delete=[],this.doc_=null,this.frameCells_=[],this.deleteableCells_=[],this.expectedRemainingCells_=0,l.ActionTestBase.call(this)},s.defineClass({name:"DeleteCellsTest",ctor:r,superName:"ActionTestBase",props:{getFrameCells:function(t){return this.allSelectableFormae(t,(function(t){return t.isGridCell()}))},deleteableFrameCells:function(t){var e;return this.getFrameCells(t).filter((function(t){return!(!(e=s.opt(t.controller,(function(t){return t.deleteable})))&&null==e)&&e}),this)},canRunActionSequence:function(t,e,n){var o=this.getFrameCells(n).length,r=this.deleteableFrameCells(n).length;return o>r&&r>0||r>1},populateActionSequence:function(t,e,n){var o=this,r=s.clone(t);this.frameCells_=s.clone(this.getFrameCells(n)),this.deleteableCells_=s.clone(this.deleteableFrameCells(n)),this.deleteableCells_.length==this.frameCells_.length&&this.deleteableCells_.splice(0,1),this.expectedRemainingCells_=this.frameCells_.length-this.deleteableCells_.length;for(var i=s.iter(s.range(1,this.deleteableCells_.length,!0));!i.done;i.next())r=r.concat([function(){var t=s.clone(o.deleteableFrameCells(o.doc_));return new c.DeleteAction([s.first(t)])}]);return u.CorePromise.resolve(s.clone(r))},setUpActionSequence:function(t,e,n){this.doc_=n},validateAfterActionSequence:function(t,e){var n=s.clone(this.getFrameCells(this.doc_));XCTAssertEqual(n.length,this.expectedRemainingCells_)},validateAfterUndo:function(t,e){var n=s.clone(this.getFrameCells(this.doc_));XCTAssertEqual(n.length,this.frameCells_.length)},validateAfterRedo:function(t,e){var n=s.clone(this.getFrameCells(this.doc_));XCTAssertEqual(n.length,this.expectedRemainingCells_)}}}),r),a.DeleteItemsTest=(i=function(){this.actionSequence_Delete=[],this.doc_=null,this.floatingItems_=[],l.ActionTestBase.call(this)},s.defineClass({name:"DeleteItemsTest",ctor:i,superName:"ActionTestBase",props:{getDeletableForma:function(t){return s.clone(this.allSelectableFormae(t,(function(t){return t.controller.canMultiSelect})))},populateActionSequence:function(t,e,n){var o=this,r=s.clone(t);return this.floatingItems_=s.clone(this.getDeletableForma(n)),this.floatingItems_.length>0&&(r=r.concat([function(){return new c.DeleteAction(s.clone(o.floatingItems_))}])),u.CorePromise.resolve(s.clone(r))},setUpActionSequence:function(t,e,n){this.doc_=n},validateAfterActionSequence:function(t,e){var n=s.clone(this.getDeletableForma(this.doc_));XCTAssertEqual(n.length,0)},validateAfterUndo:function(t,e){var n=s.clone(this.getDeletableForma(this.doc_));XCTAssertEqual(n.length,this.floatingItems_.length)},validateAfterRedo:function(t,e){var n=s.clone(this.getDeletableForma(this.doc_));XCTAssertEqual(n.length,0)}}}),i)},"1vuF":function(t,e,n){var o,r,i,a,s,l=e,u=n("oAGj"),c=n("c9Jm"),h=n("yGNn"),m=n("sTUO"),f=n("MYNe");l.LayerTest=(o=function(){this.actionSequence_LayerTest=[],this.testDoc_=null,this.initialFormaIndex_=0,this.finalFormaIndex_=0,c.ActionTestBase.call(this)},u.defineClass({name:"LayerTest",ctor:o,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){var o;return this.testDoc_=n,!!(o=this.getLayerItem())&&(this.initialLayerItem_=o,f.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)>1)},populateActionSequence:function(t,e,n){var o=this;this.initialFormaIndex_=f.LayerFacade.getZOrder(this.initialLayerItem_);var r=f.LayerFacade.getMinLayerIndex(this.initialLayerItem_),i=f.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)+r-1;return this.initialFormaIndex_<i?this.finalFormaIndex_=this.initialFormaIndex_+1:this.initialFormaIndex_>r?this.finalFormaIndex_=this.initialFormaIndex_-1:XCTFail("Not enough items to change zorder"),h.CorePromise.resolve([function(){return new m.ChangeZOrderAction(o.finalFormaIndex_)}])},setUpActionSequence:function(t,e,n){n.controller.selection.replaceSelection(this.initialLayerItem_)},validateAfterActionSequence:function(t,e){var n=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(n==this.finalFormaIndex_)},validateAfterUndo:function(t,e){var n=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(n==this.initialFormaIndex_)},validateAfterRedo:function(t,e){var n=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(n==this.finalFormaIndex_)},getLayerItem:function(){var t=null,e=u.clone(this.allSelectableFormae(this.testDoc_,(function(t){return 1==t.controller.floating})));return e.length>0&&(t=u.first(e)),t}}}),o),l.SendForwardTest=(r=function(){this.actionSequence_SendForwardTest=[],this.testDoc_=null,this.initialFormaIndex_=0,this.finalFormaIndex_=0,c.ActionTestBase.call(this)},u.defineClass({name:"SendForwardTest",ctor:r,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){var o;return this.testDoc_=n,!!(o=this.getLayerItem())&&(this.initialLayerItem_=o,f.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)>1)},populateActionSequence:function(t,e,n){var o=this;this.initialFormaIndex_=f.LayerFacade.getZOrder(this.initialLayerItem_);var r=f.LayerFacade.getMinLayerIndex(this.initialLayerItem_),i=f.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)+r-1;this.initialFormaIndex_>i||this.initialFormaIndex_<r?XCTFail("Selected forma index is out-of-bounds for z-order index. Cannot change z-order."):this.initialFormaIndex_==i?this.finalFormaIndex_=this.initialFormaIndex_:this.initialFormaIndex_>=r&&(this.finalFormaIndex_=this.initialFormaIndex_+1);var a=f.ZOrderEnum.Forward;return h.CorePromise.resolve([function(){return new m.SendForwardBackwardAction(a,[o.initialLayerItem_])}])},validateAfterActionSequence:function(t,e){var n=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(n==this.finalFormaIndex_)},validateAfterUndo:function(t,e){var n=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(n==this.initialFormaIndex_)},validateAfterRedo:function(t,e){var n=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(n==this.finalFormaIndex_)},getLayerItem:function(){var t=null,e=u.clone(this.allSelectableFormae(this.testDoc_,(function(t){return 1==t.controller.floating})));return e.length>0&&(t=u.first(e)),t}}}),r),l.SendBackwardTest=(i=function(){this.actionSequence_SendBackwardTest=[],this.testDoc_=null,this.initialFormaIndex_=0,this.finalFormaIndex_=0,c.ActionTestBase.call(this)},u.defineClass({name:"SendBackwardTest",ctor:i,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){var o;return this.testDoc_=n,!!(o=this.getLayerItem())&&(this.initialLayerItem_=o,f.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)>1)},populateActionSequence:function(t,e,n){var o=this;this.initialFormaIndex_=f.LayerFacade.getZOrder(this.initialLayerItem_);var r=f.LayerFacade.getMinLayerIndex(this.initialLayerItem_),i=f.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)+r-1;this.initialFormaIndex_>i||this.initialFormaIndex_<r?XCTFail("Selected forma index is out-of-bounds for z-order index. Cannot change z-order."):this.initialFormaIndex_==r?this.finalFormaIndex_=this.initialFormaIndex_:this.initialFormaIndex_<=i&&(this.finalFormaIndex_=this.initialFormaIndex_-1);var a=f.ZOrderEnum.Backward;return h.CorePromise.resolve([function(){return new m.SendForwardBackwardAction(a,[o.initialLayerItem_])}])},validateAfterActionSequence:function(t,e){var n=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(n==this.finalFormaIndex_)},validateAfterUndo:function(t,e){var n=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(n==this.initialFormaIndex_)},validateAfterRedo:function(t,e){var n=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(n==this.finalFormaIndex_)},getLayerItem:function(){var t=null,e=u.clone(this.allSelectableFormae(this.testDoc_,(function(t){return 1==t.controller.floating})));return e.length>0&&(t=u.first(e)),t}}}),i),l.SendToFrontTest=(a=function(){this.actionSequence_SendToFrontTest=[],this.testDoc_=null,this.initialFormaIndex_=0,this.finalFormaIndex_=0,c.ActionTestBase.call(this)},u.defineClass({name:"SendToFrontTest",ctor:a,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){var o;return this.testDoc_=n,!!(o=this.getLayerItem())&&(this.initialLayerItem_=o,f.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)>1)},populateActionSequence:function(t,e,n){var o=this;this.initialFormaIndex_=f.LayerFacade.getZOrder(this.initialLayerItem_);var r=f.LayerFacade.getMinLayerIndex(this.initialLayerItem_),i=f.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)+r-1;this.initialFormaIndex_>i||this.initialFormaIndex_<r?XCTFail("Selected forma index is out-of-bounds for z-order index. Cannot change z-order."):this.initialFormaIndex_==i?this.finalFormaIndex_=this.initialFormaIndex_:this.initialFormaIndex_>=r&&(this.finalFormaIndex_=i);var a=f.ZOrderEnum.Front;return h.CorePromise.resolve([function(){return new m.SendForwardBackwardAction(a,[o.initialLayerItem_])}])},validateAfterActionSequence:function(t,e){var n=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(n==this.finalFormaIndex_)},validateAfterUndo:function(t,e){var n=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(n==this.initialFormaIndex_)},validateAfterRedo:function(t,e){var n=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(n==this.finalFormaIndex_)},getLayerItem:function(){var t=null,e=u.clone(this.allSelectableFormae(this.testDoc_,(function(t){return 1==t.controller.floating})));return e.length>0&&(t=u.first(e)),t}}}),a),l.SendToBackTest=(s=function(){this.actionSequence_SendToBackTest=[],this.testDoc_=null,this.initialFormaIndex_=0,this.finalFormaIndex_=0,c.ActionTestBase.call(this)},u.defineClass({name:"SendToBackTest",ctor:s,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){var o;return this.testDoc_=n,!!(o=this.getLayerItem())&&(this.initialLayerItem_=o,f.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)>1)},populateActionSequence:function(t,e,n){var o=this;this.initialFormaIndex_=f.LayerFacade.getZOrder(this.initialLayerItem_);var r=f.LayerFacade.getMinLayerIndex(this.initialLayerItem_),i=f.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)+r-1;this.initialFormaIndex_>i||this.initialFormaIndex_<r?XCTFail("Selected forma index is out-of-bounds for z-order index. Cannot change z-order."):this.initialFormaIndex_==r?this.finalFormaIndex_=this.initialFormaIndex_:this.initialFormaIndex_<=i&&(this.finalFormaIndex_=r);var a=f.ZOrderEnum.Back;return h.CorePromise.resolve([function(){return new m.SendForwardBackwardAction(a,[o.initialLayerItem_])}])},validateAfterActionSequence:function(t,e){var n=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(n==this.finalFormaIndex_)},validateAfterUndo:function(t,e){var n=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(n==this.initialFormaIndex_)},validateAfterRedo:function(t,e){var n=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(n==this.finalFormaIndex_)},getLayerItem:function(){var t=null,e=u.clone(this.allSelectableFormae(this.testDoc_,(function(t){return 1==t.controller.floating})));return e.length>0&&(t=u.first(e)),t}}}),s)},"4zuo":function(t,e,n){var o,r=e,i=n("oAGj"),a=n("c9Jm"),s=n("pnSN"),l=n("434x"),u=n("8t9B"),c=n("oKlP"),h=n("sIWg");r.NudgeTest=(o=function(){this.actionSequence_NudgeUpRight=[function(){return new l.NudgeAction(new c.TheoPoint(10,0),null)},function(){return new l.NudgeAction(new c.TheoPoint(0,-10),null)}],this.formaToNudge_=null,this.initialBounds_=h.TheoRect.Zero,this.postNudgeBounds_=h.TheoRect.Zero,a.ActionTestBase.call(this)},i.defineClass({name:"NudgeTest",ctor:o,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){this.formaToNudge_=i.last(this.allSelectableFormae(n,(function(t){return t instanceof s.GroupForma&&t.controller.kind==u.TypeLockupController.KIND}))),XCTAssertNotNil(this.formaToNudge_),null!=this.formaToNudge_&&(n.controller.selection.replaceSelection(this.formaToNudge_),this.initialBounds_=this.formaToNudge_.finalFrame)},validateAfterActionSequence:function(t,e){this.postNudgeBounds_=this.formaToNudge_.finalFrame,XCTAssertFalse(this.postNudgeBounds_.equal(this.initialBounds_))},validateAfterUndo:function(t,e){var n=this.formaToNudge_.finalFrame;XCTAssertTrue(this.initialBounds_.equal(n))},validateAfterRedo:function(t,e){var n=this.formaToNudge_.finalFrame;XCTAssertTrue(n.equal(this.postNudgeBounds_))}}}),o)},ALtN:function(t,e,n){var o,r=e,i=n("oAGj"),a=n("cZuM"),s=n("lbYW"),l=n("c9Jm"),u=n("6Rk9"),c=n("sIWg");r.AlignTest=(o=function(){this.actionSequence_AlignRightAndBottom=[function(){return new s.AlignFormaeAction(a.AlignmentType.Right)},function(){return new s.AlignFormaeAction(a.AlignmentType.Bottom)}],this.formaeToAlign_=[],this.initialBounds_=c.TheoRect.Zero,this.postAlignBounds_=c.TheoRect.Zero,this.epsilon=1e-8,l.ActionTestBase.call(this)},i.defineClass({name:"AlignTest",ctor:o,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){var o=u.GeometryFacade.getFormaeBounds([n.firstPage.root],!0);this.formaeToAlign_=i.clone(this.allSelectableFormae(n,(function(t){return 1==t.controller.floating&&o.contains(u.GeometryFacade.getFormaeBounds([t],!0))}))),XCTAssertNotNil(i.clone(this.formaeToAlign_)),this.formaeToAlign_.length>0&&(n.controller.selection.replaceSelectionWithFormae(i.clone(this.formaeToAlign_)),this.initialBounds_=u.GeometryFacade.getFormaeBounds(i.clone(this.formaeToAlign_),!0))},validateAfterActionSequence:function(t,e){this.postAlignBounds_=u.GeometryFacade.getFormaeBounds(i.clone(this.formaeToAlign_),!0),this.validatePostAlignmentRightAndBottom()},validateAfterUndo:function(t,e){var n=u.GeometryFacade.getFormaeBounds(i.clone(this.formaeToAlign_),!0);XCTAssertTrue(this.initialBounds_.equal(n))},validateAfterRedo:function(t,e){this.postAlignBounds_=u.GeometryFacade.getFormaeBounds(i.clone(this.formaeToAlign_),!0),this.validatePostAlignmentRightAndBottom()},validatePostAlignmentRightAndBottom:function(){for(var t=i.iter(this.formaeToAlign_);!t.done;t.next()){var e=t.value,n=this.postAlignBounds_.evalXY(1,1),o=u.GeometryFacade.getFormaeBounds([e],!0).evalXY(1,1);XCTAssertTrue(n.equalWithAccuracy(o,this.epsilon))}},tearDown:function(){this.formaeToAlign_=[],l.ActionTestBase.prototype.tearDown.call(this)}}}),o)},CSb8:function(t,e,n){var o,r=e,i=n("oAGj"),a=n("c9Jm"),s=n("yGNn"),l=n("pjjd"),u=n("FNB+"),c=n("pnSN"),h=n("8t9B");r.DuplicateTest=(o=function(){this.actionSequence_DuplicateAllText=[],this.doc_=null,this.initialCounts_={},a.ActionTestBase.call(this)},i.defineClass({name:"DuplicateTest",ctor:o,superName:"ActionTestBase",props:{countDuplicates:function(t){var e,n=0;return(e=i.as(t.controller,h.TypeLockupController))&&i.opt(this.doc_,(function(t){return t.firstPage.root.visit(u.FormaTraversal.PreOrder,(function(t,o,r){var a,s;return(a=i.as(t,c.GroupForma))&&(s=i.as(a.controller,h.TypeLockupController))&&s.text==e.text&&(n+=1),!1}))})),n},populateActionSequence:function(t,e,n){for(var o=i.clone(this.allSelectableFormae(n,(function(t){return t instanceof c.GroupForma&&t.controller.kind==h.TypeLockupController.KIND}))),r=i.iter(o);!r.done;r.next()){var a=r.value;this.initialCounts_[a]=1}return s.CorePromise.resolve([function(){return new l.DuplicateAction(i.clone(o),!0,!1,!1)}])},setUpActionSequence:function(t,e,n){for(var o=i.iter(i.keys(this.initialCounts_));!o.done;o.next()){var r=o.value;this.initialCounts_[r]=this.countDuplicates(r)}},validateAfterActionSequence:function(t,e){for(var n=i.iter(i.keys(this.initialCounts_));!n.done;n.next()){var o=n.value;XCTAssertTrue(this.countDuplicates(o)==2*this.initialCounts_[o])}},validateAfterUndo:function(t,e){for(var n=i.iter(i.keys(this.initialCounts_));!n.done;n.next()){var o=n.value;XCTAssertTrue(this.countDuplicates(o)==this.initialCounts_[o])}},validateAfterRedo:function(t,e){for(var n=i.iter(i.keys(this.initialCounts_));!n.done;n.next()){var o=n.value;XCTAssertTrue(this.countDuplicates(o)==2*this.initialCounts_[o])}}}}),o)},Jgdj:function(t,e,n){var o,r,i,a,s=e,l=n("oAGj"),u=n("c9Jm"),c=n("yGNn"),h=n("lqhW"),m=n("ylxa"),f=n("cEBg"),d=n("1NAc");s.PageSizeLetterTest=(o=function(){this.actionSequence_PageSizeLetter=[],this.testDoc_=null,this.testPage_=null,this.initialPageSizeID_="",this.initialPageSizePPI_=m.FormaPageExportData.DEFAULT_PPI,this.initialPageSizeFormat_=m.PageExportFormat.PIXELS,u.ActionTestBase.call(this)},l.defineClass({name:"PageSizeLetterTest",ctor:o,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){var o,r,i;this.testDoc_=n,this.testPage_=n.firstPage,this.initialPageSizeID_=(o=l.opt(this.testPage_,(function(t){return t.sizeID})))||null!=o?o:"",this.initialPageSizePPI_=(r=l.opt(this.testPage_,(function(t){return t.customSizePPI})))||null!=r?r:300,this.initialPageSizeFormat_=(i=l.opt(this.testPage_,(function(t){return t.customSizeFormat})))||null!=i?i:m.PageExportFormat.PIXELS},populateActionSequence:function(t,e,n){var o=this,r=h.DesignSizeLibrary.getById("Letter");return c.CorePromise.resolve([function(){return new f.ChangePageSizeAction(o.testPage_,r)}])},validateAfterActionSequence:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue("Letter"==n),XCTAssertTrue(300==o),XCTAssertTrue(r==m.PageExportFormat.INCHES),XCTAssertTrue(this.testPage_.getPageExportData().pointDimensions.equal(new d.TheoSize(8.5,11).multiply(m.FormaPageExportData.POINTS_PER_INCH)))},validateAfterUndo:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue(n==this.initialPageSizeID_),XCTAssertTrue(o==this.initialPageSizePPI_),XCTAssertTrue(r==this.initialPageSizeFormat_)},validateAfterRedo:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue("Letter"==n),XCTAssertTrue(300==o),XCTAssertTrue(r==m.PageExportFormat.INCHES),XCTAssertTrue(this.testPage_.getPageExportData().pointDimensions.equal(new d.TheoSize(8.5,11).multiply(m.FormaPageExportData.POINTS_PER_INCH)))}}}),o),s.PageSizeCustomTest=(r=function(){this.actionSequence_PageSizeCustom=[],this.testDoc_=null,this.testPage_=null,this.initialPageSizeID_="",this.initialPageSizePPI_=m.FormaPageExportData.DEFAULT_PPI,this.initialPageSizeFormat_=m.PageExportFormat.PIXELS,u.ActionTestBase.call(this)},l.defineClass({name:"PageSizeCustomTest",ctor:r,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){var o,r,i;this.testDoc_=n,this.testPage_=n.firstPage,this.initialPageSizeID_=(o=l.opt(this.testPage_,(function(t){return t.sizeID})))||null!=o?o:"",this.initialPageSizePPI_=(r=l.opt(this.testPage_,(function(t){return t.customSizePPI})))||null!=r?r:300,this.initialPageSizeFormat_=(i=l.opt(this.testPage_,(function(t){return t.customSizeFormat})))||null!=i?i:m.PageExportFormat.PIXELS},populateActionSequence:function(t,e,n){var o=this,r=h.DesignSizeLibrary.getCustomSize(1011,990,m.PageExportFormat.PIXELS,m.FormaPageExportData.DEFAULT_PPI);return c.CorePromise.resolve([function(){return new f.ChangePageSizeAction(o.testPage_,r)}])},validateAfterActionSequence:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue("Custom"==n),XCTAssertTrue(300==o),XCTAssertTrue(r==m.PageExportFormat.PIXELS),XCTAssertTrue(this.testPage_.getPageExportData().pixelDimensions.equal(new d.TheoSize(1011,990)))},validateAfterUndo:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue(n==this.initialPageSizeID_),XCTAssertTrue(o==this.initialPageSizePPI_),XCTAssertTrue(r==this.initialPageSizeFormat_)},validateAfterRedo:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue("Custom"==n),XCTAssertTrue(300==o),XCTAssertTrue(r==m.PageExportFormat.PIXELS),XCTAssertTrue(this.testPage_.getPageExportData().pixelDimensions.equal(new d.TheoSize(1011,990)))}}}),r),s.PageSizeA4Test=(i=function(){this.actionSequence_PageSizeA4=[],this.testDoc_=null,this.testPage_=null,this.initialPageSizeID_="",this.initialPageSizePPI_=m.FormaPageExportData.DEFAULT_PPI,this.initialPageSizeFormat_=m.PageExportFormat.PIXELS,u.ActionTestBase.call(this)},l.defineClass({name:"PageSizeA4Test",ctor:i,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){var o,r,i;this.testDoc_=n,this.testPage_=n.firstPage,this.initialPageSizeID_=(o=l.opt(this.testPage_,(function(t){return t.sizeID})))||null!=o?o:"",this.initialPageSizePPI_=(r=l.opt(this.testPage_,(function(t){return t.customSizePPI})))||null!=r?r:300,this.initialPageSizeFormat_=(i=l.opt(this.testPage_,(function(t){return t.customSizeFormat})))||null!=i?i:m.PageExportFormat.PIXELS},populateActionSequence:function(t,e,n){var o=this,r=h.DesignSizeLibrary.getById("A4");return c.CorePromise.resolve([function(){return new f.ChangePageSizeAction(o.testPage_,r)}])},validateAfterActionSequence:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue("A4"==n),XCTAssertTrue(300==o),XCTAssertTrue(r==m.PageExportFormat.MILLIMETERS),XCTAssertTrue(this.testPage_.getPageExportData().pointDimensions.equal(new d.TheoSize(210,297).multiply(m.FormaPageExportData.POINTS_PER_INCH*m.FormaPageExportData.MM_TO_INCHES)))},validateAfterUndo:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue(n==this.initialPageSizeID_),XCTAssertTrue(o==this.initialPageSizePPI_),XCTAssertTrue(r==this.initialPageSizeFormat_)},validateAfterRedo:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue("A4"==n),XCTAssertTrue(300==o),XCTAssertTrue(r==m.PageExportFormat.MILLIMETERS),XCTAssertTrue(this.testPage_.getPageExportData().pointDimensions.equal(new d.TheoSize(210,297).multiply(m.FormaPageExportData.POINTS_PER_INCH*m.FormaPageExportData.MM_TO_INCHES)))}}}),i),s.PageSizePhoneTest=(a=function(){this.actionSequence_PageSizePhone=[],this.testDoc_=null,this.testPage_=null,this.initialPageSizeID_="",this.initialPageSizePPI_=m.FormaPageExportData.DEFAULT_PPI,this.initialPageSizeFormat_=m.PageExportFormat.PIXELS,u.ActionTestBase.call(this)},l.defineClass({name:"PageSizePhoneTest",ctor:a,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){var o,r,i;this.testDoc_=n,this.testPage_=n.firstPage,this.initialPageSizeID_=(o=l.opt(this.testPage_,(function(t){return t.sizeID})))||null!=o?o:"",this.initialPageSizePPI_=(r=l.opt(this.testPage_,(function(t){return t.customSizePPI})))||null!=r?r:300,this.initialPageSizeFormat_=(i=l.opt(this.testPage_,(function(t){return t.customSizeFormat})))||null!=i?i:m.PageExportFormat.PIXELS},populateActionSequence:function(t,e,n){var o=this,r=h.DesignSizeLibrary.getById("iPhone");return c.CorePromise.resolve([function(){return new f.ChangePageSizeAction(o.testPage_,r)}])},validateAfterActionSequence:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue("iPhone"==n),XCTAssertTrue(300==o),XCTAssertTrue(r==m.PageExportFormat.PIXELS),XCTAssertTrue(this.testPage_.getPageExportData().pixelDimensions.equal(new d.TheoSize(1080,1920)))},validateAfterUndo:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue(n==this.initialPageSizeID_),XCTAssertTrue(o==this.initialPageSizePPI_),XCTAssertTrue(r==this.initialPageSizeFormat_)},validateAfterRedo:function(t,e){var n=l.opt(this.testPage_,(function(t){return t.sizeID})),o=l.opt(this.testPage_,(function(t){return t.customSizePPI})),r=l.opt(this.testPage_,(function(t){return t.customSizeFormat}));XCTAssertTrue("iPhone"==n),XCTAssertTrue(300==o),XCTAssertTrue(r==m.PageExportFormat.PIXELS),XCTAssertTrue(this.testPage_.getPageExportData().pixelDimensions.equal(new d.TheoSize(1080,1920)))}}}),a)},QO3H:function(t,e,n){var o,r,i,a,s,l,u,c,h,m,f,d,A,_,p,T,g,C,F,S,v=e,y=n("oAGj"),I=n("Tq01"),E=n("KgU+"),P=n("KSe6"),R=n("VQVe"),D=n("c9Jm"),N=n("yGNn");v.AnimationTest=(o=function(){this.actionSequence_Animation=[],this.testDoc_=null,this.testPage_=null,this.initialAnimationStyle_=null,this.initialAnimationVariant_=null,this.appliedAnimationStyle_=null,D.ActionTestBase.call(this)},y.defineClass({name:"AnimationTest",ctor:o,superName:"ActionTestBase",props:{shuffledAnimationStyle_:{get:function(){return y.opt(y.as(this.getActionResult(0),I.AnimationStyleActionResult),(function(t){return t.style}))}},populateActionSequence:function(t,e,n){var o=this;if(this.testDoc_=n,this.testPage_=n.firstPage,this.initialAnimationStyle_=n.firstPage.animationController.animationStyle,this.initialAnimationVariant_=y.opt(this.initialAnimationStyle_,(function(t){return t.variant})),null!=this.initialAnimationStyle_)return N.CorePromise.resolve(t.concat([function(){return new E.ShuffleAnimationStyleAction(o.initialAnimationStyle_,o.testPage_)},function(){return new E.ApplyAnimationStyleAction(o.shuffledAnimationStyle_,o.testPage_)}]));var r=y.clone(P.AnimationLibrary.getDisplayableAnimationStyles(this.testPage_.root));return r.length>1?(this.appliedAnimationStyle_=y.last(r),null==this.appliedAnimationStyle_&&XCTAssertNotEqual(this.appliedAnimationStyle_,null),N.CorePromise.resolve(t.concat([function(){return new E.ApplyAnimationStyleAction(o.appliedAnimationStyle_,o.testPage_)}]))):(XCTFail("Could not get style for AnimationTest"),N.CorePromise.resolve([]))},validateAfterActionSequence:function(t,e){if(null!=this.initialAnimationStyle_){var n=(i=y.opt(this.testPage_,(function(t){return t.animationController.animationStyle}))).variant,o=i.variantCount,r=this.testPage_.animationLibrary.getNextAnimationStyleOfSameType(this.initialAnimationStyle_);XCTAssertEqual(r.name,this.initialAnimationStyle_.name),XCTAssertEqual(i.name,this.initialAnimationStyle_.name),XCTAssertEqual(n,this.initialAnimationVariant_+1%o)}else if(null!=this.appliedAnimationStyle_){var i;n=(i=y.opt(this.testPage_,(function(t){return t.animationController.animationStyle}))).variant,XCTAssertEqual(i.name,this.appliedAnimationStyle_.name),XCTAssertEqual(n,0)}},validateAfterUndo:function(t,e){if(null!=this.initialAnimationStyle_){var n=(o=y.opt(this.testPage_,(function(t){return t.animationController.animationStyle}))).variant;XCTAssertEqual(o.name,this.initialAnimationStyle_.name),XCTAssertEqual(n,this.initialAnimationVariant_)}else if(null!=this.appliedAnimationStyle_){var o=y.opt(this.testPage_,(function(t){return t.animationController.animationStyle}));XCTAssertEqual(o,null)}},validateAfterRedo:function(t,e){if(null!=this.initialAnimationStyle_){var n=(i=y.opt(this.testPage_,(function(t){return t.animationController.animationStyle}))).variant,o=i.variantCount,r=this.testPage_.animationLibrary.getNextAnimationStyleOfSameType(this.initialAnimationStyle_);XCTAssertEqual(r.name,this.initialAnimationStyle_.name),XCTAssertEqual(i.name,this.initialAnimationStyle_.name),XCTAssertEqual(n,this.initialAnimationVariant_+1%o)}else if(null!=this.appliedAnimationStyle_){var i;n=(i=y.opt(this.testPage_,(function(t){return t.animationController.animationStyle}))).variant,XCTAssertEqual(i.name,this.appliedAnimationStyle_.name),XCTAssertEqual(n,0)}}}}),o),v.AnimationTestBase=(r=function(){this.testDoc_=null,this.testPage_=null,this.initialAnimationStyle_=null,this.initialAnimationVariant_=null,this.appliedAnimationStyle_=null,this.appliedAnimationVariant_=0,D.ActionTestBase.call(this)},y.defineClass({name:"AnimationTestBase",ctor:r,superName:"ActionTestBase",props:{shuffledAnimationStyle_:{get:function(){return y.opt(y.as(this.getActionResult(0),I.AnimationStyleActionResult),(function(t){return t.style}))}},setAnimation:function(){},populateActionSequence:function(t,e,n){var o=this;return this.testDoc_=n,this.testPage_=n.firstPage,this.initialAnimationStyle_=n.firstPage.animationController.animationStyle,this.initialAnimationVariant_=y.opt(this.initialAnimationStyle_,(function(t){return t.variant})),this.setAnimation(),null==this.appliedAnimationStyle_&&XCTAssertNotEqual(this.appliedAnimationStyle_,null),N.CorePromise.resolve([function(){return new E.ApplyAndPrepareAnimationAction(o.appliedAnimationStyle_,o.testPage_)}])},validateAfterActionSequence:function(t,e){if(null!=this.appliedAnimationStyle_){var n=y.opt(this.testPage_,(function(t){return t.animationController.animationStyle})),o=n.variant;XCTAssertEqual(n.name,this.appliedAnimationStyle_.name),XCTAssertEqual(o,this.appliedAnimationVariant_)}},validateAfterUndo:function(t,e){if(null!=this.initialAnimationStyle_){var n=(o=y.opt(this.testPage_,(function(t){return t.animationController.animationStyle}))).variant;XCTAssertEqual(o.name,this.initialAnimationStyle_.name),XCTAssertEqual(n,this.initialAnimationVariant_)}else if(null!=this.appliedAnimationStyle_){var o=y.opt(this.testPage_,(function(t){return t.animationController.animationStyle}));XCTAssertEqual(o,null)}},validateAfterRedo:function(t,e){if(null!=this.appliedAnimationStyle_){var n=y.opt(this.testPage_,(function(t){return t.animationController.animationStyle})),o=n.variant;XCTAssertEqual(n.name,this.appliedAnimationStyle_.name),XCTAssertEqual(o,this.appliedAnimationVariant_)}}}}),r),v.AnimationLetterTest=(i=function(){this.actionSequence_AnimationLetter=[],v.AnimationTestBase.call(this)},y.defineClass({name:"AnimationLetterTest",ctor:i,superName:"AnimationTestBase",props:{canRunActionSequence:function(t,e,n){for(var o=y.clone(P.AnimationLibrary.getDisplayableAnimationStyles(n.firstPage.root)),r=y.iter(o);!r.done;r.next()){var i=r.value;if(i.name==R.AnimationStyle.NAME_TYPE)return this.appliedAnimationStyle_=i,!0}return!1}}}),i),v.AnimationLetterRandomTest=(a=function(){this.actionSequence_AnimationLetterRandom=[],v.AnimationTestBase.call(this)},y.defineClass({name:"AnimationLetterRandomTest",ctor:a,superName:"AnimationTestBase",props:{canRunActionSequence:function(t,e,n){for(var o=this,r=y.clone(P.AnimationLibrary.getDisplayableAnimationStyles(n.firstPage.root)),i=y.iter(r);!i.done;i.next()){var a=i.value;if(a.name==R.AnimationStyle.NAME_TYPE)return this.appliedAnimationStyle_=a,this.appliedAnimationVariant_=1,y.opt(this.appliedAnimationStyle_,(function(t){return t.variant=o.appliedAnimationVariant_})),!0}return!1}}}),a),v.AnimationLetterFlickerTest=(s=function(){this.actionSequence_AnimationLetterFlicker=[],v.AnimationTestBase.call(this)},y.defineClass({name:"AnimationLetterFlickerTest",ctor:s,superName:"AnimationTestBase",props:{canRunActionSequence:function(t,e,n){for(var o=this,r=y.clone(P.AnimationLibrary.getDisplayableAnimationStyles(n.firstPage.root)),i=y.iter(r);!i.done;i.next()){var a=i.value;if(a.name==R.AnimationStyle.NAME_FLICKER)return this.appliedAnimationStyle_=a,this.appliedAnimationVariant_=1,y.opt(this.appliedAnimationStyle_,(function(t){return t.variant=o.appliedAnimationVariant_})),!0}return!1}}}),s),v.AnimationFlickerTest=(l=function(){this.actionSequence_AnimationFlicker=[],v.AnimationTestBase.call(this)},y.defineClass({name:"AnimationFlickerTest",ctor:l,superName:"AnimationTestBase",props:{canRunActionSequence:function(t,e,n){for(var o=y.clone(P.AnimationLibrary.getDisplayableAnimationStyles(n.firstPage.root)),r=y.iter(o);!r.done;r.next()){var i=r.value;if(i.name==R.AnimationStyle.NAME_FLICKER)return this.appliedAnimationStyle_=i,!0}return!1}}}),l),v.AnimationGrowTest=(u=function(){this.actionSequence_AnimationGrow=[],v.AnimationTestBase.call(this)},y.defineClass({name:"AnimationGrowTest",ctor:u,superName:"AnimationTestBase",props:{canRunActionSequence:function(t,e,n){for(var o=y.clone(P.AnimationLibrary.getDisplayableAnimationStyles(n.firstPage.root)),r=y.iter(o);!r.done;r.next()){var i=r.value;if(i.name==R.AnimationStyle.NAME_GROW)return this.appliedAnimationStyle_=i,!0}return!1}}}),u),v.AnimationFadeTest=(c=function(){this.actionSequence_AnimationFade=[],v.AnimationTestBase.call(this)},y.defineClass({name:"AnimationFadeTest",ctor:c,superName:"AnimationTestBase",props:{canRunActionSequence:function(t,e,n){for(var o=y.clone(P.AnimationLibrary.getDisplayableAnimationStyles(n.firstPage.root)),r=y.iter(o);!r.done;r.next()){var i=r.value;if(i.name==R.AnimationStyle.NAME_FADE)return this.appliedAnimationStyle_=i,!0}return!1}}}),c),v.AnimationDynamicZoomTest=(h=function(){this.actionSequence_AnimationDynamicZoom=[],v.AnimationTestBase.call(this)},y.defineClass({name:"AnimationDynamicZoomTest",ctor:h,superName:"AnimationTestBase",props:{canRunActionSequence:function(t,e,n){for(var o=y.clone(P.AnimationLibrary.getDisplayableAnimationStyles(n.firstPage.root)),r=y.iter(o);!r.done;r.next()){var i=r.value;if(i.name==R.AnimationStyle.NAME_DYNAMIC)return this.appliedAnimationStyle_=i,!0}return!1}}}),h),v.AnimationDynamicCenterTest=(m=function(){this.actionSequence_AnimationDynamicCenter=[],v.AnimationTestBase.call(this)},y.defineClass({name:"AnimationDynamicCenterTest",ctor:m,superName:"AnimationTestBase",props:{canRunActionSequence:function(t,e,n){for(var o=this,r=y.clone(P.AnimationLibrary.getDisplayableAnimationStyles(n.firstPage.root)),i=y.iter(r);!i.done;i.next()){var a=i.value;if(a.name==R.AnimationStyle.NAME_DYNAMIC)return this.appliedAnimationStyle_=a,this.appliedAnimationVariant_=1,y.opt(this.appliedAnimationStyle_,(function(t){return t.variant=o.appliedAnimationVariant_})),!0}return!1}}}),m),v.AnimationDynamicTwoTest=(f=function(){this.actionSequence_AnimationDynamicTwo=[],v.AnimationTestBase.call(this)},y.defineClass({name:"AnimationDynamicTwoTest",ctor:f,superName:"AnimationTestBase",props:{canRunActionSequence:function(t,e,n){for(var o=this,r=y.clone(P.AnimationLibrary.getDisplayableAnimationStyles(n.firstPage.root)),i=y.iter(r);!i.done;i.next()){var a=i.value;if(a.name==R.AnimationStyle.NAME_DYNAMIC)return this.appliedAnimationStyle_=a,this.appliedAnimationVariant_=2,y.opt(this.appliedAnimationStyle_,(function(t){return t.variant=o.appliedAnimationVariant_})),!0}return!1}}}),f),v.AnimationDynamicThreeTest=(d=function(){this.actionSequence_AnimationDynamicThree=[],v.AnimationTestBase.call(this)},y.defineClass({name:"AnimationDynamicThreeTest",ctor:d,superName:"AnimationTestBase",props:{canRunActionSequence:function(t,e,n){for(var o=this,r=y.clone(P.AnimationLibrary.getDisplayableAnimationStyles(n.firstPage.root)),i=y.iter(r);!i.done;i.next()){var a=i.value;if(a.name==R.AnimationStyle.NAME_DYNAMIC)return this.appliedAnimationStyle_=a,this.appliedAnimationVariant_=3,y.opt(this.appliedAnimationStyle_,(function(t){return t.variant=o.appliedAnimationVariant_})),!0}return!1}}}),d),v.AnimationColorSwapOneTest=(A=function(){this.actionSequence_AnimationColorSwapOne=[],v.AnimationTestBase.call(this)},y.defineClass({name:"AnimationColorSwapOneTest",ctor:A,superName:"AnimationTestBase",props:{canRunActionSequence:function(t,e,n){for(var o=y.clone(P.AnimationLibrary.getDisplayableAnimationStyles(n.firstPage.root)),r=y.iter(o);!r.done;r.next()){var i=r.value;if(i.name==R.AnimationStyle.NAME_COLORSWAP)return this.appliedAnimationStyle_=i,!0}return!1}}}),A),v.AnimationSlideTest=(_=function(){this.actionSequence_AnimationSlide=[],v.AnimationTestBase.call(this)},y.defineClass({name:"AnimationSlideTest",ctor:_,superName:"AnimationTestBase",props:{canRunActionSequence:function(t,e,n){for(var o=y.clone(P.AnimationLibrary.getDisplayableAnimationStyles(n.firstPage.root)),r=y.iter(o);!r.done;r.next()){var i=r.value;if(i.name==R.AnimationStyle.NAME_SLIDE)return this.appliedAnimationStyle_=i,!0}return!1}}}),_),v.AnimationZoomTest=(p=function(){this.actionSequence_AnimationZoom=[],v.AnimationTestBase.call(this)},y.defineClass({name:"AnimationZoomTest",ctor:p,superName:"AnimationTestBase",props:{canRunActionSequence:function(t,e,n){for(var o=y.clone(P.AnimationLibrary.getDisplayableAnimationStyles(n.firstPage.root)),r=y.iter(o);!r.done;r.next()){var i=r.value;if(i.name==R.AnimationStyle.NAME_ZOOM)return this.appliedAnimationStyle_=i,!0}return!1}}}),p),v.AnimationPanTest=(T=function(){this.actionSequence_AnimationPan=[],v.AnimationTestBase.call(this)},y.defineClass({name:"AnimationPanTest",ctor:T,superName:"AnimationTestBase",props:{canRunActionSequence:function(t,e,n){for(var o=y.clone(P.AnimationLibrary.getDisplayableAnimationStyles(n.firstPage.root)),r=y.iter(o);!r.done;r.next()){var i=r.value;if(i.name==R.AnimationStyle.NAME_PAN)return this.appliedAnimationStyle_=i,!0}return!1}}}),T),v.AnimationGrayscaleTest=(g=function(){this.actionSequence_AnimationGrayscale=[],v.AnimationTestBase.call(this)},y.defineClass({name:"AnimationGrayscaleTest",ctor:g,superName:"AnimationTestBase",props:{canRunActionSequence:function(t,e,n){for(var o=y.clone(P.AnimationLibrary.getDisplayableAnimationStyles(n.firstPage.root)),r=y.iter(o);!r.done;r.next()){var i=r.value;if(i.name==R.AnimationStyle.NAME_GRAYSCALE)return this.appliedAnimationStyle_=i,!0}return!1}}}),g),v.AnimationPhotoBlurTest=(C=function(){this.actionSequence_AnimationPhotoBlur=[],v.AnimationTestBase.call(this)},y.defineClass({name:"AnimationPhotoBlurTest",ctor:C,superName:"AnimationTestBase",props:{canRunActionSequence:function(t,e,n){for(var o=y.clone(P.AnimationLibrary.getDisplayableAnimationStyles(n.firstPage.root)),r=y.iter(o);!r.done;r.next()){var i=r.value;if(i.name==R.AnimationStyle.NAME_BLUR)return this.appliedAnimationStyle_=i,!0}return!1}}}),C),v.AnimationColorizeTest=(F=function(){this.actionSequence_AnimationColorize=[],v.AnimationTestBase.call(this)},y.defineClass({name:"AnimationColorizeTest",ctor:F,superName:"AnimationTestBase",props:{canRunActionSequence:function(t,e,n){for(var o=y.clone(P.AnimationLibrary.getDisplayableAnimationStyles(n.firstPage.root)),r=y.iter(o);!r.done;r.next()){var i=r.value;if(i.name==R.AnimationStyle.NAME_COLOR)return this.appliedAnimationStyle_=i,!0}return!1}}}),F),v.AnimationFillTest=(S=function(){this.actionSequence_AnimationFill=[],v.AnimationTestBase.call(this)},y.defineClass({name:"AnimationFillTest",ctor:S,superName:"AnimationTestBase",props:{canRunActionSequence:function(t,e,n){for(var o=y.clone(P.AnimationLibrary.getDisplayableAnimationStyles(n.firstPage.root)),r=y.iter(o);!r.done;r.next()){var i=r.value;if(i.name==R.AnimationStyle.NAME_FILL)return this.appliedAnimationStyle_=i,!0}return!1}}}),S)},WR9q:function(t,e,n){var o,r,i=e,a=n("oAGj"),s=n("O8XL"),l=n("lbYW"),u=n("c9Jm"),c=n("FNB+"),h=n("6Rk9"),m=n("sIWg");i.DistributeTest=(o=function(){this.actionSequence_Distribute=[function(){return new l.DistributeFormaeAction(s.DistributeType.LeftEdge)},function(){return new l.DistributeFormaeAction(s.DistributeType.TopEdge)}],this.formaeToDistribute_=[],this.initialBounds_=m.TheoRect.Zero,this.postDistributeBounds_=m.TheoRect.Zero,this.epsilon=.001,u.ActionTestBase.call(this)},a.defineClass({name:"DistributeTest",ctor:o,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){var o=h.GeometryFacade.getFormaeBounds([n.firstPage.root],!0);return this.allSelectableFormae(n,(function(t){return 1==t.controller.floating&&o.contains(h.GeometryFacade.getFormaeBounds([t],!0))})).length>2},setUpActionSequence:function(t,e,n){var o=h.GeometryFacade.getFormaeBounds([n.firstPage.root],!0);this.formaeToDistribute_=a.clone(this.allSelectableFormae(n,(function(t){return 1==t.controller.floating&&o.contains(h.GeometryFacade.getFormaeBounds([t],!0))}))),XCTAssertNotNil(a.clone(this.formaeToDistribute_)),this.formaeToDistribute_.length>0&&(n.controller.selection.replaceSelectionWithFormae(a.clone(this.formaeToDistribute_)),this.initialBounds_=h.GeometryFacade.getFormaeBounds(a.clone(this.formaeToDistribute_),!0))},validateAfterActionSequence:function(t,e){this.postDistributeBounds_=h.GeometryFacade.getFormaeBounds(a.clone(this.formaeToDistribute_),!0),this.validatePostDistributeLeftAndTop()},validateAfterUndo:function(t,e){var n=h.GeometryFacade.getFormaeBounds(a.clone(this.formaeToDistribute_),!0);XCTAssertTrue(this.initialBounds_.equal(n))},validateAfterRedo:function(t,e){this.postDistributeBounds_=h.GeometryFacade.getFormaeBounds(a.clone(this.formaeToDistribute_),!0),this.validatePostDistributeLeftAndTop()},validatePostDistributeLeftAndTop:function(){for(var t=a.iter(this.formaeToDistribute_);!t.done;t.next()){var e=t.value,n=h.GeometryFacade.getFormaeBounds([e],!0).evalXY(0,0);XCTAssertTrue(this.postDistributeBounds_.containsPoint(n))}},tearDown:function(){this.formaeToDistribute_=[],u.ActionTestBase.prototype.tearDown.call(this)}}}),o),i.ArrangeTest=(r=function(){this.actionSequence_Distribute=[function(){return new l.ArrangeFormaeAction(!0)}],this.formaeToArrange_=[],this.initialBounds_=m.TheoRect.Zero,this.postArrangeBounds_=m.TheoRect.Zero,u.ActionTestBase.call(this)},a.defineClass({name:"ArrangeTest",ctor:r,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){var o=h.GeometryFacade.getFormaeBounds([n.firstPage.root],!0);this.formaeToArrange_=a.clone(this.allSelectableFormae(n,(function(t){return 1==t.controller.floating&&o.contains(h.GeometryFacade.getFormaeBounds([t],!0))}))),XCTAssertNotNil(a.clone(this.formaeToArrange_)),this.formaeToArrange_.length>0&&(n.controller.selection.replaceSelectionWithFormae(a.clone(this.formaeToArrange_)),this.initialBounds_=h.GeometryFacade.getFormaeBounds(a.clone(this.formaeToArrange_),!0))},validateAfterActionSequence:function(t,e){this.postArrangeBounds_=h.GeometryFacade.getFormaeBounds(a.clone(this.formaeToArrange_),!0),this.validatePostArrangeRow()},validateAfterUndo:function(t,e){var n=h.GeometryFacade.getFormaeBounds(a.clone(this.formaeToArrange_),!0);XCTAssertTrue(this.initialBounds_.equal(n))},validateAfterRedo:function(t,e){this.postArrangeBounds_=h.GeometryFacade.getFormaeBounds(a.clone(this.formaeToArrange_),!0),this.validatePostArrangeRow()},validatePostArrangeRow:function(){var t=a.clone(this.sortInRowOrder(a.clone(this.formaeToArrange_)));if(t.length>0){var e=a.first(t),n=h.GeometryFacade.getFormaeBounds([e],!0).evalXY(0,0).x;XCTAssertTrue(this.postArrangeBounds_.minX==n);for(var o=a.iter(t);!o.done;o.next()){var r=o.value,i=h.GeometryFacade.getFormaeBounds([r],!0).evalXY(0,0);XCTAssertTrue(i.x>n||a.eq(c._equality_Forma_Forma,r,e))}}},sortInRowOrder:function(t){var e=a.clone(t);return a.sortInPlace(e,(function(t,e){var n=h.GeometryFacade.getFormaeBounds([t],!0),o=h.GeometryFacade.getFormaeBounds([e],!0);return n.minX<o.minX})),e},tearDown:function(){this.formaeToArrange_=[],u.ActionTestBase.prototype.tearDown.call(this)}}}),r)},YX5m:function(t,e,n){var o,r,i,a,s=e,l=n("oAGj"),u=n("c9Jm"),c=n("yGNn"),h=n("quOg"),m=n("FNB+"),f=n("x6FH"),d=n("9Lk3"),A=n("x35w");s.CreatePaddedCollageTest=(o=function(){this.actionSequence_CreatePaddedCollage=[function(){return new f.CreatePaddedCollageAction}],u.ActionTestBase.call(this)},l.defineClass({name:"CreatePaddedCollageTest",ctor:o,superName:"ActionTestBase",props:{validateAfterActionSequence:function(t,e){},validateAfterUndo:function(t,e){},validateAfterRedo:function(t,e){}}}),o),s.SetGridParametersTest=(r=function t(){this.actionSequence_SetGridParameters=[function(){return new f.EnterGridLayoutModeAction},function(){return new f.SetGridParametersAction(t.spacing_,t.margin_)}],this.gridForma_=null,this.oldMargin_=0,this.oldSpacing_=0,u.ActionTestBase.call(this)},l.defineClass({name:"SetGridParametersTest",ctor:r,superName:"ActionTestBase",statics:{margin_:10,spacing_:5},props:{canRunActionSequence:function(t,e,n){return this.gridForma_=l.first(n.firstPage.root.filterByControllerKind(d.GridController.KIND)),null!=this.gridForma_},setUpActionSequence:function(t,e,n){var o;(o=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&(this.oldMargin_=o.margin,this.oldSpacing_=o.spacing)},validateAfterActionSequence:function(t,e){var n;(n=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&(XCTAssertEqual(n.margin,r.margin_),XCTAssertEqual(n.spacing,r.spacing_))},validateAfterUndo:function(t,e){var n;(n=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&(XCTAssertEqual(n.margin,this.oldMargin_),XCTAssertEqual(n.spacing,this.oldSpacing_))},validateAfterRedo:function(t,e){var n;(n=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&(XCTAssertEqual(n.margin,r.margin_),XCTAssertEqual(n.spacing,r.spacing_))}}}),r),s.SetGridStyleTest=(i=function(){this.actionSequence_SetGridStyle=[function(){return new f.EnterGridLayoutModeAction}],this.actionSequence_SetGridStyleMovableShift=[function(){return new f.EnterGridLayoutModeAction}],this.gridForma_=null,this.gridLayouts_=null,this.oldGridStyle_=null,this.newGridStyle_=null,u.ActionTestBase.call(this)},l.defineClass({name:"SetGridStyleTest",ctor:i,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){var o;if(this.gridForma_=l.first(n.firstPage.root.filterByControllerKind(d.GridController.KIND)),o=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController)){var r=o.numCells;this.gridLayouts_=l.clone(n.gridLibrary.getGridsByCellNumber(r,!0))}return null!=this.gridForma_&&null!=this.gridLayouts_&&this.gridLayouts_.length>0},populateActionSequence:function(t,e,n){var o=this;return this.newGridStyle_=l.last(this.gridLayouts_),c.CorePromise.resolve(t.concat([function(){return new f.SetGridStyleAction(o.newGridStyle_,0)}]))},setUpActionSequence:function(t,e,n){var o,r,i="actionSequence_SetGridStyleMovableShift"==e;l.opt(this.newGridStyle_,(function(t){return t.moveableShift=i})),l.opt(this.oldGridStyle_,(function(t){return t.moveableShift=i})),(o=n.controller)&&(o.interactionMode=h.InteractionMode.AutomaticGrid),(r=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&(this.oldGridStyle_=r.gridStyle)},validateAfterActionSequence:function(t,e){var n;(n=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&XCTAssertEqual(l.opt(n.gridStyle,(function(t){return t.asString})),l.opt(this.newGridStyle_,(function(t){return t.asString})))},validateAfterUndo:function(t,e){var n;(n=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&XCTAssertEqual(l.opt(n.gridStyle,(function(t){return t.asString})),l.opt(this.oldGridStyle_,(function(t){return t.asString})))},validateAfterRedo:function(t,e){var n;(n=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&XCTAssertEqual(l.opt(n.gridStyle,(function(t){return t.asString})),l.opt(this.newGridStyle_,(function(t){return t.asString})))}}}),i),s.SwapGridFormaTest=(a=function(){this.actionSequence_SwapGridForma=[function(){return new f.EnterGridLayoutModeAction}],this.gridForma_=null,this.childA_=null,this.childB_=null,this.oldChildACell_=-1,this.oldChildBCell_=-1,u.ActionTestBase.call(this)},l.defineClass({name:"SwapGridFormaTest",ctor:a,superName:"ActionTestBase",statics:{margin_:10,spacing_:5},props:{canRunActionSequence:function(t,e,n){var o,r=this;return this.gridForma_=l.first(n.firstPage.root.filterByControllerKind(d.GridController.KIND)),(o=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&l.opt(this.gridForma_,(function(t){return t.visit(m.FormaTraversal.PreOrder,(function(t,e,n){if(A.GridFacade.isChildSwappable(t))if(null==r.childA_)l.opt(o.gridStyle,(function(e){return null!=e.cellForForma(t)}))&&(r.childA_=t);else{var i,a=l.opt(o.gridStyle,(function(t){return t.cellForForma(r.childA_)}));null!=(i=l.opt(o.gridStyle,(function(e){return e.cellForForma(t)})))&&l.opt(a,(function(t){return t[0]!=i[0]}))&&(r.childB_=t)}return null!=r.childA_&&null!=r.childB_}))})),null!=this.gridForma_&&null!=this.childA_&&null!=this.childB_},populateActionSequence:function(t,e,n){var o=this;return c.CorePromise.resolve(t.concat([function(){return new f.SwapGridFormaAction(o.childA_,o.childB_)}]))},setUpActionSequence:function(t,e,n){var o,r;(o=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&(r=o.gridStyle)&&(this.oldChildACell_=r.cellForForma(this.childA_)[0],this.oldChildBCell_=r.cellForForma(this.childB_)[0])},validateAfterActionSequence:function(t,e){var n,o;(n=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&(o=n.gridStyle)&&(XCTAssertEqual(o.cellForForma(this.childA_)[0],this.oldChildBCell_),XCTAssertEqual(o.cellForForma(this.childB_)[0],this.oldChildACell_))},validateAfterUndo:function(t,e){var n,o;(n=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&(o=n.gridStyle)&&(XCTAssertEqual(o.cellForForma(this.childA_)[0],this.oldChildACell_),XCTAssertEqual(o.cellForForma(this.childB_)[0],this.oldChildBCell_))},validateAfterRedo:function(t,e){var n,o;(n=l.as(l.opt(this.gridForma_,(function(t){return t.controller})),d.GridController))&&(o=n.gridStyle)&&(XCTAssertEqual(o.cellForForma(this.childA_)[0],this.oldChildBCell_),XCTAssertEqual(o.cellForForma(this.childB_)[0],this.oldChildACell_))}}}),a)},Ztps:function(t,e,n){var o,r,i=e,a=n("oAGj"),s=n("c9Jm"),l=n("yGNn"),u=n("9Lk3"),c=n("j89o"),h=n("T8w7"),m=n("uxH+");i.OpacityTest=(o=function(){this.actionSequence_SetOpacity=[function(){return new c.SetOpacityAction(.55)}],this.formaeToChangeOpacity_=[],this.initialOpacities_=[],s.ActionTestBase.call(this)},a.defineClass({name:"OpacityTest",ctor:o,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){var o;this.formaeToChangeOpacity_=a.clone(this.allSelectableFormae(n,(function(t){return!(!(o=a.opt(t.controller,(function(t){return t.opacityChangeable})))&&null==o)&&o}))),this.initialOpacities_=this.formaeToChangeOpacity_.map((function(t){return h.OpacityFacade.getOpacityForForma(t)}),this),n.controller.selection.replaceSelectionWithFormae(a.clone(this.formaeToChangeOpacity_))},validateAfterActionSequence:function(t,e){for(var n=a.iter(this.formaeToChangeOpacity_);!n.done;n.next()){var o=n.value,r=h.OpacityFacade.getOpacityForForma(o);XCTAssertEqual(r,.55)}},validateAfterUndo:function(t,e){for(var n=a.iter(a.range(0,this.formaeToChangeOpacity_.length,!1));!n.done;n.next()){var o=n.value,r=this.formaeToChangeOpacity_[o],i=h.OpacityFacade.getOpacityForForma(r),s=this.initialOpacities_[o];XCTAssertEqual(i,s)}},validateAfterRedo:function(t,e){for(var n=a.iter(this.formaeToChangeOpacity_);!n.done;n.next()){var o=n.value,r=h.OpacityFacade.getOpacityForForma(o);XCTAssertEqual(r,.55)}}}}),o),i.BackgroundOpacityTest=(r=function(){this.testDoc_=null,this.rootForma_=null,this.actionSequence_SetBackgroundOpacity=[],s.ActionTestBase.call(this)},a.defineClass({name:"BackgroundOpacityTest",ctor:r,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){var o;return this.rootForma_=n.firstPage.root,this.testDoc_=n,!!(o=a.as(a.opt(this.rootForma_,(function(t){return t.controller})),m.RootController))&&o.suggestTransparentBackground()},populateActionSequence:function(t,e,n){return l.CorePromise.resolve([function(){return new c.SetBackgroundOpacityAction(0,n.firstPage)}])},setUpActionSequence:function(t,e,n){var o;if(o=a.as(a.opt(this.rootForma_,(function(t){return t.controller})),m.RootController)){XCTAssertTrue(o.suggestTransparentBackground());var r=h.OpacityFacade.getBackgroundOpacity(n.firstPage);XCTAssertTrue(1==r);for(var i=a.iter(this.rootForma_.filterWithCallback((function(t){return u.GridController.isBackgroundColoredCell(t)})));!i.done;i.next()){var s=i.value;XCTAssertTrue(1==s.style.opacity)}}else XCTFail("no root controller?")},validateAfterActionSequence:function(t,e){var n;if(n=a.as(a.opt(this.rootForma_,(function(t){return t.controller})),m.RootController)){XCTAssertTrue(n.suggestTransparentBackground());var o=h.OpacityFacade.getBackgroundOpacity(this.testDoc_.firstPage);XCTAssertTrue(0==o);for(var r=a.iter(this.rootForma_.filterWithCallback((function(t){return u.GridController.isBackgroundColoredCell(t)})));!r.done;r.next()){var i=r.value;XCTAssertTrue(0==i.style.opacity)}}else XCTFail("no root controller?")},validateAfterUndo:function(t,e){var n;if(n=a.as(a.opt(this.rootForma_,(function(t){return t.controller})),m.RootController)){XCTAssertTrue(n.suggestTransparentBackground());var o=h.OpacityFacade.getBackgroundOpacity(this.testDoc_.firstPage);XCTAssertTrue(1==o);for(var r=a.iter(this.rootForma_.filterWithCallback((function(t){return u.GridController.isBackgroundColoredCell(t)})));!r.done;r.next()){var i=r.value;XCTAssertTrue(1==i.style.opacity)}}else XCTFail("no root controller?")},validateAfterRedo:function(t,e){var n;if(n=a.as(a.opt(this.rootForma_,(function(t){return t.controller})),m.RootController)){XCTAssertTrue(n.suggestTransparentBackground());var o=h.OpacityFacade.getBackgroundOpacity(this.testDoc_.firstPage);XCTAssertTrue(0==o);for(var r=a.iter(this.rootForma_.filterWithCallback((function(t){return u.GridController.isBackgroundColoredCell(t)})));!r.done;r.next()){var i=r.value;XCTAssertTrue(0==i.style.opacity)}}else XCTFail("no root controller?")}}}),r)},bpSr:function(t,e,n){var o,r,i,a,s,l,u,c,h,m,f,d,A,_,p,T=e,g=n("oAGj"),C=n("Tq01"),F=n("c9Jm"),S=n("yGNn"),v=n("FNB+"),y=n("6ZWm"),I=n("cmoc"),E=n("bqbo"),P=n("U010"),R=n("fdtz"),D=n("lmwz"),N=n("uWOl"),L=n("j89o"),B=n("Zifs"),q=n("djAF"),k=n("umUn");T.ReplaceImagesWithColorsTest=(o=function t(){this.actionSequence_ReplaceImagesWithColors=[function(){return new E.ReplaceImagesWithColorsAction(null,[t.green_])}],this.formaToReplace_=null,F.ActionTestBase.call(this)},r={},g.defineClass({name:"ReplaceImagesWithColorsTest",ctor:o,superName:"ActionTestBase",statics:{green_:{get:function(){return void 0===r.green_&&(r.green_=k.TheoColor.init_5344(new B.SolidColor(0,1,0,1))),r.green_}}},props:{replacementForma:{get:function(){return g.first(g.opt(g.as(this.getActionResult(0),C.FormaActionResult),(function(t){return t.formae})))}},canRunActionSequence:function(t,e,n){return this.formaToReplace_=g.as(g.last(this.allSelectableFormae(n,(function(t){return t instanceof I.FrameForma&&g.opt(g.as(t,I.FrameForma),(function(t){return t.childAt(0)instanceof R.ImageForma}))}))),I.FrameForma),null!=this.formaToReplace_},setUpActionSequence:function(t,e,n){XCTAssertNotNil(this.formaToReplace_),null!=this.formaToReplace_&&n.controller.selection.replaceSelection(this.formaToReplace_)},validateAfterActionSequence:function(t,e){var n;if(XCTAssertNotNil(this.replacementForma),XCTAssertTrue(this.replacementForma instanceof q.ShapeForma),XCTAssertNil(g.opt(this.formaToReplace_,(function(t){return t.parent}))),n=g.as(this.replacementForma,q.ShapeForma)){var r=n.style.colors.fieldPrimary;XCTAssertNotNil(r),XCTAssertEqual(r,o.green_.rgbColor)}},validateAfterUndo:function(t,e){XCTAssertNil(g.opt(this.replacementForma,(function(t){return t.parent}))),XCTAssertNotNil(g.opt(this.formaToReplace_,(function(t){return t.parent})))},validateAfterRedo:function(t,e){var n;if(XCTAssertNotNil(this.replacementForma),XCTAssertTrue(this.replacementForma instanceof q.ShapeForma),XCTAssertNil(g.opt(this.formaToReplace_,(function(t){return t.parent}))),n=g.as(this.replacementForma,q.ShapeForma)){var r=n.style.colors.fieldPrimary;XCTAssertNotNil(r),XCTAssertEqual(r,o.green_.rgbColor)}this.formaToReplace_=null}}}),o),T.SetImageFilterTest=(i=function(){this.actionSequence_SetImageFilter=[],this.formaToChange_=null,this.originalStyleName_=null,F.ActionTestBase.call(this)},g.defineClass({name:"SetImageFilterTest",ctor:i,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.formaToChange_=g.as(g.last(this.allSelectableFormae(n,(function(t){return t instanceof I.FrameForma&&g.opt(g.as(t,I.FrameForma),(function(t){return t.childAt(0)instanceof R.ImageForma}))}))),I.FrameForma),null!=this.formaToChange_},populateActionSequence:function(t,e,n){return S.CorePromise.resolve([function(){return new E.SetImageFilterAction(n.firstPage.imageFilterLibrary.getImageStyle("Greyscale"))}])},setUpActionSequence:function(t,e,n){XCTAssertNotNil(this.formaToChange_),null!=this.formaToChange_&&(this.originalStyleName_=g.opt(g.as(g.opt(g.as(g.opt(this.formaToChange_,(function(t){return t.childAt(0)})),R.ImageForma),(function(t){return t.style})),N.ImageStyle),(function(t){return t.name})),n.controller.selection.replaceSelection(this.formaToChange_))},validateAfterActionSequence:function(t,e){if(null!=this.formaToChange_){var n=g.as(g.opt(this.formaToChange_,(function(t){return t.childAt(0)})),R.ImageForma);XCTAssertNotNil(n);var o=g.as(g.opt(n,(function(t){return t.style})),N.ImageStyle);XCTAssertNotNil(o),XCTAssertTrue(g.opt(o,(function(t){return"Greyscale"==t.name})))}},validateAfterUndo:function(t,e){if(null!=this.formaToChange_){var n=g.as(g.opt(this.formaToChange_,(function(t){return t.childAt(0)})),R.ImageForma);XCTAssertNotNil(n),XCTAssertEqual(this.originalStyleName_,g.opt(g.as(g.opt(n,(function(t){return t.style})),N.ImageStyle),(function(t){return t.name})))}},validateAfterRedo:function(t,e){if(null!=this.formaToChange_){var n=g.as(g.opt(this.formaToChange_,(function(t){return t.childAt(0)})),R.ImageForma);XCTAssertNotNil(n);var o=g.as(g.opt(n,(function(t){return t.style})),N.ImageStyle);XCTAssertNotNil(o),XCTAssertTrue(g.opt(o,(function(t){return"Greyscale"==t.name}))),this.formaToChange_=null}}}}),i),T.ShuffleImageFilterTest=(a=function(){this.actionSequence_ShuffleImageFilter=[],this.page_=null,this.formaToChange_=null,this.styleToShuffle_=null,this.originalStyleName_=null,F.ActionTestBase.call(this)},g.defineClass({name:"ShuffleImageFilterTest",ctor:a,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.formaToChange_=g.as(g.last(this.allSelectableFormae(n,(function(t){return t instanceof I.FrameForma&&g.opt(g.as(t,I.FrameForma),(function(t){return t.childAt(0)instanceof R.ImageForma}))}))),I.FrameForma),null!=this.formaToChange_},prepareDocument:function(t,e){var n=this;return this.page_=t.firstPage,this.styleToShuffle_=this.page_.imageFilterLibrary.getImageStyle("Multiply"),null!=this.formaToChange_&&t.controller.selection.replaceSelection(this.formaToChange_),S.CorePromise.resolve([function(){return new E.SetImageFilterAction(n.styleToShuffle_)}])},populateActionSequence:function(t,e,n){var o=this;return S.CorePromise.resolve([function(){return new E.ShuffleImageFilterAction(o.styleToShuffle_,o.page_)}])},setUpActionSequence:function(t,e,n){XCTAssertNotNil(this.formaToChange_),null!=this.formaToChange_&&(this.originalStyleName_=g.opt(g.as(g.opt(g.as(g.opt(this.formaToChange_,(function(t){return t.childAt(0)})),R.ImageForma),(function(t){return t.style})),N.ImageStyle),(function(t){return t.name})),n.controller.selection.replaceSelection(this.formaToChange_))},validateAfterActionSequence:function(t,e){if(null!=this.formaToChange_){var n=g.as(g.opt(this.formaToChange_,(function(t){return t.childAt(0)})),R.ImageForma);XCTAssertNotNil(n);var o=g.as(g.opt(n,(function(t){return t.style})),N.ImageStyle);XCTAssertNotNil(o),XCTAssertTrue(g.opt(o,(function(t){return"Multiply"==t.name})))}},validateAfterUndo:function(t,e){if(null!=this.formaToChange_){var n=g.as(g.opt(this.formaToChange_,(function(t){return t.childAt(0)})),R.ImageForma);XCTAssertNotNil(n),XCTAssertEqual(this.originalStyleName_,g.opt(g.as(g.opt(n,(function(t){return t.style})),N.ImageStyle),(function(t){return t.name})))}},validateAfterRedo:function(t,e){if(null!=this.formaToChange_){var n=g.as(g.opt(this.formaToChange_,(function(t){return t.childAt(0)})),R.ImageForma);XCTAssertNotNil(n);var o=g.as(g.opt(n,(function(t){return t.style})),N.ImageStyle);XCTAssertNotNil(o),XCTAssertTrue(g.opt(o,(function(t){return"Multiply"==t.name}))),this.formaToChange_=null}}}}),a),T.ChangeImageAdjustmentsTest=(s=function(){this.actionSequence_ChangeImageAdjustments=[function(){return E.ChangeImageAdjustmentsAction.init_dd66("saturation",100)}],this.formaToAdjust_=null,this.oldValue_=null,F.ActionTestBase.call(this)},g.defineClass({name:"ChangeImageAdjustmentsTest",ctor:s,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.formaToAdjust_=g.as(g.last(this.allSelectableFormae(n,(function(t){return t instanceof I.FrameForma&&g.opt(g.as(t,I.FrameForma),(function(t){return t.childAt(0)instanceof R.ImageForma}))}))),I.FrameForma),null!=this.formaToAdjust_},setUpActionSequence:function(t,e,n){if(XCTAssertNotNil(this.formaToAdjust_),null!=this.formaToAdjust_){var o=g.as(g.opt(this.formaToAdjust_,(function(t){return t.childAt(0)})),R.ImageForma);this.oldValue_=g.opt(g.opt(o,(function(t){return t.style.adjustments})),(function(t){return t.saturation})),n.controller.selection.replaceSelection(this.formaToAdjust_)}},validateAfterActionSequence:function(t,e){var n;if(null!=this.formaToAdjust_){var o=g.as(g.opt(this.formaToAdjust_,(function(t){return t.childAt(0)})),R.ImageForma);XCTAssertNotNil(o);var r=g.as(g.opt(o,(function(t){return t.style})),N.ImageStyle);XCTAssertNotNil(r),XCTAssertEqual(100,(n=g.opt(g.opt(r,(function(t){return t.adjustments})),(function(t){return t.saturation})))||null!=n?n:0)}},validateAfterUndo:function(t,e){var n,o;if(null!=this.formaToAdjust_){var r=g.as(g.opt(this.formaToAdjust_,(function(t){return t.childAt(0)})),R.ImageForma);XCTAssertNotNil(r);var i=g.as(g.opt(r,(function(t){return t.style})),N.ImageStyle);XCTAssertNotNil(i),XCTAssertEqual((n=this.oldValue_)||null!=n?n:0,(o=g.opt(g.opt(i,(function(t){return t.adjustments})),(function(t){return t.saturation})))||null!=o?o:0)}},validateAfterRedo:function(t,e){var n;if(null!=this.formaToAdjust_){var o=g.as(g.opt(this.formaToAdjust_,(function(t){return t.childAt(0)})),R.ImageForma);XCTAssertNotNil(o);var r=g.as(g.opt(o,(function(t){return t.style})),N.ImageStyle);XCTAssertNotNil(r),XCTAssertEqual(100,(n=g.opt(g.opt(r,(function(t){return t.adjustments})),(function(t){return t.saturation})))||null!=n?n:0),this.formaToAdjust_=null}}}}),s),T.SetImageAsFloatingTest=(l=function(){this.actionSequence_SetAsFloating=[function(){return new E.SetImageAsFloatingAction}],this.frameForma_=null,F.ActionTestBase.call(this)},g.defineClass({name:"SetImageAsFloatingTest",ctor:l,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.frameForma_=g.as(g.last(this.allSelectableFormae(n,(function(t){return t.isBackgroundImage()}))),I.FrameForma),null!=this.frameForma_},setUpActionSequence:function(t,e,n){XCTAssertFalse(this.frameForma_.controller.floating),n.controller.selection.replaceSelection(this.frameForma_)},validateAfterActionSequence:function(t,e){XCTAssertTrue(this.frameForma_.controller.floating)},validateAfterUndo:function(t,e){XCTAssertFalse(this.frameForma_.controller.floating)},validateAfterRedo:function(t,e){XCTAssertTrue(this.frameForma_.controller.floating)}}}),l),T.SetImageAsBackgroundTest=(u=function(){this.actionSequence_SetAsBackground=[function(){return new E.SetImageAsBackgroundAction}],this.oneFrameForma_=null,this.frameForma_=null,F.ActionTestBase.call(this)},g.defineClass({name:"SetImageAsBackgroundTest",ctor:u,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.oneFrameForma_=g.as(g.last(this.allSelectableFormae(n,(function(t){return t.isImage()}))),I.FrameForma),null!=this.oneFrameForma_},prepareDocument:function(t,e){var n=[];return this.frameForma_=g.as(g.last(this.allSelectableFormae(t,(function(t){return t.isImage()&&!t.isBackgroundImage()}))),I.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,t.controller.selection.replaceSelection(this.frameForma_),n.push((function(){return new E.SetImageAsFloatingAction}))),S.CorePromise.resolve(g.clone(n))},setUpActionSequence:function(t,e,n){XCTAssertTrue(this.frameForma_.controller.floating),n.controller.selection.replaceSelection(this.frameForma_)},validateAfterActionSequence:function(t,e){XCTAssertFalse(this.frameForma_.controller.floating)},validateAfterUndo:function(t,e){XCTAssertTrue(this.frameForma_.controller.floating)},validateAfterRedo:function(t,e){XCTAssertFalse(this.frameForma_.controller.floating)}}}),u),T.CropToRatioTest=(c=function(){this.actionSequence_CropToRatio=[],this.oneFrameForma_=null,this.frameForma_=null,this.imageForma_=null,this.initialRatio_=1,this.cropRatio_=1,F.ActionTestBase.call(this)},g.defineClass({name:"CropToRatioTest",ctor:c,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.oneFrameForma_=g.as(g.last(this.allSelectableFormae(n,(function(t){return t.isImage()}))),I.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(t,e,n){var o=this;return S.CorePromise.resolve([function(){return o.initialRatio_=o.frameForma_.bounds.aspectRatio,o.cropRatio_=o.initialRatio_<1?4/3:.75,new E.CropImageToRatioAction(o.imageForma_,o.cropRatio_,null)}])},prepareDocument:function(t,e){var n=[];return this.frameForma_=g.as(g.last(this.allSelectableFormae(t,(function(t){return t.isImage()&&!t.isBackgroundImage()}))),I.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,t.controller.selection.replaceSelection(this.frameForma_),n.push((function(){return new E.SetImageAsFloatingAction}))),this.imageForma_=D.ImageFacade.getImageFormaForForma(this.frameForma_),S.CorePromise.resolve(g.clone(n))},validateAfterActionSequence:function(t,e){var n=this.frameForma_.bounds.aspectRatio;XCTAssertEqual(n,this.cropRatio_,.001)},validateAfterUndo:function(t,e){var n=this.frameForma_.bounds.aspectRatio;XCTAssertEqual(n,this.initialRatio_,.001)},validateAfterRedo:function(t,e){var n=this.frameForma_.bounds.aspectRatio;XCTAssertEqual(n,this.cropRatio_,.001)}}}),c),T.ApplyShapeMaskTest=(h=function(){this.actionSequence_ApplyShapeMask=[],this.oneFrameForma_=null,this.frameForma_=null,F.ActionTestBase.call(this)},g.defineClass({name:"ApplyShapeMaskTest",ctor:h,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.oneFrameForma_=g.as(g.last(this.allSelectableFormae(n,(function(t){return t.isImage()}))),I.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(t,e,n){var o=this;return S.CorePromise.resolve([function(){return new E.ApplyShapeMaskToImageAction(o.frameForma_,"diamond")}])},prepareDocument:function(t,e){var n=this,o=[];return this.frameForma_=g.as(g.last(this.allSelectableFormae(t,(function(t){return t.isImage()&&!t.isBackgroundImage()}))),I.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,t.controller.selection.replaceSelection(this.frameForma_),o.push((function(){return new E.SetImageAsFloatingAction}))),D.ImageFacade.formaHasMask(this.frameForma_)&&o.push((function(){return new E.ApplyShapeMaskToImageAction(n.frameForma_)})),S.CorePromise.resolve(g.clone(o))},validateAfterActionSequence:function(t,e){var n;if(n=g.as(g.opt(this.frameForma_,(function(t){return t.controller})),y.FrameController)){var o=g.as(n.mask,q.ShapeForma);XCTAssertNotNil(o),XCTAssertEqual(o.shapeLibraryID,"diamond")}},validateAfterUndo:function(t,e){var n;(n=g.as(g.opt(this.frameForma_,(function(t){return t.controller})),y.FrameController))&&XCTAssertNil(n.mask)},validateAfterRedo:function(t,e){var n;if(n=g.as(g.opt(this.frameForma_,(function(t){return t.controller})),y.FrameController)){var o=g.as(n.mask,q.ShapeForma);XCTAssertNotNil(o),XCTAssertEqual(o.shapeLibraryID,"diamond")}}}}),h),T.ApplyCutoutTest=(m=function(){this.actionSequence_ApplyCutout=[],this.oneFrameForma_=null,this.frameForma_=null,F.ActionTestBase.call(this)},g.defineClass({name:"ApplyCutoutTest",ctor:m,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.oneFrameForma_=g.as(g.last(this.allSelectableFormae(n,(function(t){return t.isImage()}))),I.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(t,e,n){var o=this,r=P.ImageCutoutLibrary.getImageCutout(P.CutoutMode.BackgroundRemoval);return S.CorePromise.resolve([function(){return new E.SetImageCutoutAction(o.frameForma_,r,P.ImageCutoutModelLibrary.CURRENT_MODEL)}])},prepareDocument:function(t,e){var n=this,o=[];return this.frameForma_=g.as(g.last(this.allSelectableFormae(t,(function(t){return t.isImage()&&!t.isBackgroundImage()}))),I.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,t.controller.selection.replaceSelection(this.frameForma_),o.push((function(){return new E.SetImageAsFloatingAction}))),D.ImageFacade.getCutoutModeForForma(this.frameForma_)!=P.CutoutMode.Off&&o.push((function(){return new E.SetImageCutoutAction(n.frameForma_,new P.CutoutStyle(P.CutoutMode.Off))})),S.CorePromise.resolve(g.clone(o))},validateAfterActionSequence:function(t,e){var n;(n=g.as(g.opt(this.frameForma_,(function(t){return t.controller})),y.FrameController))&&(XCTAssertNotNil(n.cutout),XCTAssertEqual(D.ImageFacade.getCutoutModeForForma(this.frameForma_),P.CutoutMode.BackgroundRemoval))},validateAfterUndo:function(t,e){var n;(n=g.as(g.opt(this.frameForma_,(function(t){return t.controller})),y.FrameController))&&XCTAssertNil(n.cutout)},validateAfterRedo:function(t,e){var n;(n=g.as(g.opt(this.frameForma_,(function(t){return t.controller})),y.FrameController))&&(XCTAssertNotNil(n.cutout),XCTAssertEqual(D.ImageFacade.getCutoutModeForForma(this.frameForma_),P.CutoutMode.BackgroundRemoval))}}}),m),T.RemoveCutoutTest=(f=function(){this.actionSequence_RemoveCutout=[],this.oneFrameForma_=null,this.frameForma_=null,F.ActionTestBase.call(this)},g.defineClass({name:"RemoveCutoutTest",ctor:f,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.oneFrameForma_=g.as(g.last(this.allSelectableFormae(n,(function(t){return t.isImage()}))),I.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(t,e,n){var o=this;return S.CorePromise.resolve([function(){return new E.SetImageCutoutAction(o.frameForma_,new P.CutoutStyle(P.CutoutMode.Off))}])},prepareDocument:function(t,e){var n=this,o=[];if(this.frameForma_=g.as(g.last(this.allSelectableFormae(t,(function(t){return t.isImage()&&!t.isBackgroundImage()}))),I.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,t.controller.selection.replaceSelection(this.frameForma_),o.push((function(){return new E.SetImageAsFloatingAction}))),D.ImageFacade.getCutoutModeForForma(this.frameForma_)!=P.CutoutMode.BackgroundRemoval){var r=P.ImageCutoutLibrary.getImageCutout(P.CutoutMode.BackgroundRemoval);o.push((function(){return new E.SetImageCutoutAction(n.frameForma_,r)}))}return S.CorePromise.resolve(g.clone(o))},validateAfterActionSequence:function(t,e){var n;(n=g.as(g.opt(this.frameForma_,(function(t){return t.controller})),y.FrameController))&&(XCTAssertNil(n.cutout),XCTAssertNotNil(D.ImageFacade.getCutoutMaskFormaForForma(this.frameForma_)))},validateAfterUndo:function(t,e){var n;(n=g.as(g.opt(this.frameForma_,(function(t){return t.controller})),y.FrameController))&&(XCTAssertNotNil(n.cutout),XCTAssertEqual(D.ImageFacade.getCutoutModeForForma(this.frameForma_),P.CutoutMode.BackgroundRemoval))},validateAfterRedo:function(t,e){var n;(n=g.as(g.opt(this.frameForma_,(function(t){return t.controller})),y.FrameController))&&(XCTAssertNil(n.cutout),XCTAssertNotNil(D.ImageFacade.getCutoutMaskFormaForForma(this.frameForma_)))}}}),f),T.AllowFreeformCropTest=(d=function(){this.actionSequence_AllowFreeformCrop=[],this.oneFrameForma_=null,this.frameForma_=null,F.ActionTestBase.call(this)},g.defineClass({name:"AllowFreeformCropTest",ctor:d,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.oneFrameForma_=g.as(g.last(this.allSelectableFormae(n,(function(t){return t.isImage()}))),I.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(t,e,n){var o=this;return S.CorePromise.resolve([function(){return new E.SetImageCropToFreeformAction(o.frameForma_)}])},prepareDocument:function(t,e){var n=this,o=[];return this.frameForma_=g.as(g.last(this.allSelectableFormae(t,(function(t){return t.isImage()&&!t.isBackgroundImage()}))),I.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,t.controller.selection.replaceSelection(this.frameForma_),o.push((function(){return new E.SetImageAsFloatingAction}))),D.ImageFacade.formaHasMask(this.frameForma_)||o.push((function(){return new E.ApplyShapeMaskToImageAction(n.frameForma_,"diamond")})),S.CorePromise.resolve(g.clone(o))},validateAfterActionSequence:function(t,e){XCTAssertTrue(D.ImageFacade.usesFreeformCropPreset(this.frameForma_)),XCTAssertFalse(D.ImageFacade.formaHasShapeMask(this.frameForma_))},validateAfterUndo:function(t,e){XCTAssertFalse(D.ImageFacade.usesFreeformCropPreset(this.frameForma_)),XCTAssertTrue(D.ImageFacade.formaHasShapeMask(this.frameForma_))},validateAfterRedo:function(t,e){XCTAssertTrue(D.ImageFacade.usesFreeformCropPreset(this.frameForma_)),XCTAssertFalse(D.ImageFacade.formaHasShapeMask(this.frameForma_))}}}),d),T.EnterCropModeTest=(A=function(){this.actionSequence_EnterCropMode=[],this.oneFrameForma_=null,this.frameForma_=null,F.ActionTestBase.call(this)},g.defineClass({name:"EnterCropModeTest",ctor:A,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.oneFrameForma_=g.as(g.last(this.allSelectableFormae(n,(function(t){return t.isImage()}))),I.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(t,e,n){var o=this;return S.CorePromise.resolve([function(){return new E.EnterCropModeAction(o.frameForma_)}])},prepareDocument:function(t,e){var n=this,o=[];return this.frameForma_=g.as(g.last(this.allSelectableFormae(t,(function(t){return t.isImage()&&!t.isBackgroundImage()}))),I.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,t.controller.selection.replaceSelection(this.frameForma_),o.push((function(){return new E.SetImageAsFloatingAction})),o.push((function(){var t=n.frameForma_.bounds.aspectRatio<1?4/3:.75;return new E.CropImageToRatioAction(n.frameForma_,t,null)}))),S.CorePromise.resolve(g.clone(o))},validateAfterActionSequence:function(t,e){var n,o=null;if(n=g.opt(this.frameForma_,(function(t){return t.parent})))for(var r=g.iter(n.visitAsArray(v.FormaTraversal.JustChildren));!r.done;r.next()){var i=r.value;i.hasIntent(v.Forma.INTENT_TEMP_IMAGE_CROP)&&(o=i)}XCTAssertNotNil(o)},validateAfterUndo:function(t,e){var n,o=null;if(n=g.opt(this.frameForma_,(function(t){return t.parent})))for(var r=g.iter(n.visitAsArray(v.FormaTraversal.JustChildren));!r.done;r.next()){var i=r.value;i.hasIntent(v.Forma.INTENT_TEMP_IMAGE_CROP)&&(o=i)}XCTAssertNil(o)},validateAfterRedo:function(t,e){var n,o=null;if(n=g.opt(this.frameForma_,(function(t){return t.parent})))for(var r=g.iter(n.visitAsArray(v.FormaTraversal.JustChildren));!r.done;r.next()){var i=r.value;i.hasIntent(v.Forma.INTENT_TEMP_IMAGE_CROP)&&(o=i)}XCTAssertNotNil(o)}}}),A),T.ExitCropModeTest=(_=function(){this.actionSequence_ExitCropMode=[],this.oneFrameForma_=null,this.frameForma_=null,F.ActionTestBase.call(this)},g.defineClass({name:"ExitCropModeTest",ctor:_,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.oneFrameForma_=g.as(g.last(this.allSelectableFormae(n,(function(t){return t.isImage()}))),I.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(t,e,n){return S.CorePromise.resolve([function(){return new E.ExitCropModeAction}])},prepareDocument:function(t,e){var n=this,o=[];return this.frameForma_=g.as(g.last(this.allSelectableFormae(t,(function(t){return t.isImage()&&!t.isBackgroundImage()}))),I.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,t.controller.selection.replaceSelection(this.frameForma_),o.push((function(){return new E.SetImageAsFloatingAction})),o.push((function(){var t=n.frameForma_.bounds.aspectRatio<1?4/3:.75;return new E.CropImageToRatioAction(n.frameForma_,t,null)})),o.push((function(){return new E.EnterCropModeAction(n.frameForma_)}))),S.CorePromise.resolve(g.clone(o))}}}),_),T.AddHiddenImageToGridTest=(p=function(){this.actionSequence_AddHidden=[],this.oneFrameForma_=null,this.frameForma_=null,this.imageForma_=null,F.ActionTestBase.call(this)},g.defineClass({name:"AddHiddenImageToGridTest",ctor:p,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.oneFrameForma_=g.as(g.last(this.allSelectableFormae(n,(function(t){return t.isImage()}))),I.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(t,e,n){var o=this;return S.CorePromise.resolve([function(){return new E.AddHiddenImageToGridAction([o.imageForma_])}])},prepareDocument:function(t,e){var n=this,o=[];return this.frameForma_=g.as(g.last(this.allSelectableFormae(t,(function(t){return t.isImage()&&!t.isBackgroundImage()}))),I.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,t.controller.selection.replaceSelection(this.frameForma_),o.push((function(){return new E.SetImageAsFloatingAction}))),this.imageForma_=D.ImageFacade.getImageFormaForForma(this.frameForma_),o.push((function(){return new L.SetOpacityAction(0,[n.imageForma_])})),S.CorePromise.resolve(g.clone(o))},validateAfterActionSequence:function(t,e){XCTAssertFalse(this.frameForma_.controller.floating),XCTAssertEqual(this.imageForma_.style.opacity,1)},validateAfterUndo:function(t,e){XCTAssertTrue(this.frameForma_.controller.floating),XCTAssertEqual(this.imageForma_.style.opacity,0)},validateAfterRedo:function(t,e){XCTAssertFalse(this.frameForma_.controller.floating),XCTAssertEqual(this.imageForma_.style.opacity,1)}}}),p)},c9Jm:function(t,e,n){var o,r,i,a,s,l=e,u=n("oAGj"),c=n("Tq01"),h=n("kYI4"),m=n("yGNn"),f=n("C42b"),d=n("iCxV"),A=n("3lr5"),_=n("sRQj"),p=n("jcfx"),T=n("umUn"),g=n("VJ9E");l.ActionTestBase=(o=function(){this.canRun_=!0,this.runningSequenceName_="",this.qualifiedSequenceName_="",this.completePath_="",this.path_="",this.undoToIndex_=0,this.performanceFilename="performance.json",this.validationState_=new l.ValidationState,this.prepResults_=[],this.actionResults_=[],this.synchronizer=null,this.FAKE_COLOR_ELEMENT_PRIMARY_ID="themeColor0",this.FAKE_COLOR_ELEMENT_SECONDARY_ID1="themeColor1",this.FAKE_COLOR_ELEMENT_SECONDARY_ID2="themeColor2",this.FAKE_COLOR_ELEMENT_SHADE_ID0="themeColor3",this.FAKE_COLOR_ELEMENT_SHADE_ID1="themeColor4",this.FAKE_COLOR_ELEMENT_SHADE_ID2="themeColor5",this.FAKE_COLOR_ELEMENT_SHADE_ID3="themeColor6",this.FAKE_COLOR_ELEMENT_SHADE_ID4="themeColor7",this.FAKE_COLOR_ELEMENT_SHADE_ID5="themeColor8",this.FAKE_COLOR_ELEMENT_SHADE_ID6="themeColor9",this.FAKE_LOGO_ELEMENT_PRIMARY_ID="logo-001",this.FAKE_LOGO_ELEMENT_STAMP_ID="logo-002",this.FAKE_FONT_ELEMENT_HEADLINE_ID="fnt-001",this.FAKE_FONT_ELEMENT_BODY_ID="fnt-002",this.FAKE_COLOR_ELEMENT_PRIMARY_ID_2="themeColor0-2",this.FAKE_COLOR_ELEMENT_SECONDARY_ID1_2="themeColor1-2",this.FAKE_COLOR_ELEMENT_SECONDARY_ID2_2="themeColor2-2",this.FAKE_COLOR_ELEMENT_SHADE_ID0_2="themeColor3-2",this.FAKE_COLOR_ELEMENT_SHADE_ID1_2="themeColor4-2",this.FAKE_COLOR_ELEMENT_SHADE_ID2_2="themeColor5-2",this.FAKE_COLOR_ELEMENT_SHADE_ID3_2="themeColor6-2",this.FAKE_COLOR_ELEMENT_SHADE_ID4_2="themeColor7-2",this.FAKE_COLOR_ELEMENT_SHADE_ID5_2="themeColor8-2",this.FAKE_COLOR_ELEMENT_SHADE_ID6_2="themeColor9-2",this.FAKE_LOGO_ELEMENT_PRIMARY_ID_2="logo-001-2",this.FAKE_LOGO_ELEMENT_STAMP_ID_2="logo-002-2",this.FAKE_FONT_ELEMENT_HEADLINE_ID_2="fnt-001-2",this.FAKE_FONT_ELEMENT_BODY_ID_2="fnt-002-2"},u.defineClass({name:"ActionTestBase",ctor:o,statics:{actionPerformanceData:{},undoPerformanceData:{},redoPerformanceData:{}},props:{lastActionResult:{get:function(){return u.last(this.actionResults_)}},appendActionResult:function(t){this.actionResults_.push(t)},getActionResult:function(t){return t>=0&&t<this.actionResults_.length?this.actionResults_[t]:null},getPrepActionResult:function(t){return t>=0&&t<this.prepResults_.length?this.prepResults_[t]:null},testName:{get:function(){return"ActionTest:"+this.path_+"::"+this.runningSequenceName_}},initializeDocPath:function(t){this.completePath_=t,this.path_=u.toString(u.last(t.split("/")))},initializeTestParameters:function(t,e,n){this.runningSequence_=u.clone(t),this.runningSequenceName_=e,this.qualifiedSequenceName_=n},setUp:function(){var t=this;this.doc_=u.opt(d.Host.actionTesting,(function(e){return e.openDocument(t.completePath_)}))},tearDown:function(){var t=this;u.opt(d.Host.actionTesting,(function(e){return e.closeDocument(t.completePath_)}))},validateActionSequence:function(){var t=this,e=this.nextValidationState();u.opt(d.Host.actionTesting,(function(n){return n.awaitResult(e,t.synchronizer)}))},nextValidationState:function(){var t,e=this;switch(this.validationState_.next()){case 0:return new m.CorePromise((function(t,n){var o;(o=e.doc_)?(f.CoreRandom.seedRandom(5489),e.canRun_=e.canRunActionSequence(u.clone(e.runningSequence_),e.runningSequenceName_,o),e.canRun_||e.validationState_.finish()):e.validationState_.fail(),t(null)})).then((function(t){return e.nextValidationState()}));case 1:return this.prepareDocument(this.doc_,this.runningSequenceName_).then((function(n){return e.prepareSequence_=u.clone((t=u.as(n,["Array","Function"]))||null!=t?t:[]),e.runActions(u.clone(e.prepareSequence_))})).then((function(t){return e.nextValidationState()}));case 2:return this.populateActionSequence(u.clone(this.runningSequence_),this.runningSequenceName_,this.doc_).then((function(t){return e.runningSequence_=u.clone(u.as(t,["Array","Function"])),null})).then((function(t){return e.nextValidationState()}));case 3:return new m.CorePromise((function(t,n){e.setUpActionSequence(u.clone(e.runningSequence_),e.runningSequenceName_,e.doc_),t(null)})).then((function(t){return e.nextValidationState()}));case 4:return new m.CorePromise((function(t,n){e.renderBeforeRunning(u.clone(e.runningSequence_),e.runningSequenceName_),t(null)})).then((function(t){return e.nextValidationState()}));case 5:var n=0;return m.CorePromise.resolve(null).then((function(t){return n=d.Host.async.getSystemUptimeInSeconds(),m.CorePromise.resolve(null)})).then((function(t){return e.runActionSequence(u.clone(e.runningSequence_),e.runningSequenceName_)})).then((function(t){var r=d.Host.async.getSystemUptimeInSeconds()-n,i=d.Host.locale.formatNumber(r,3),a=e.qualifiedSequenceName_+"/"+e.path_;return o.actionPerformanceData[a]={time:i,buffer:"99.99"},e.nextValidationState()}));case 6:return new m.CorePromise((function(t,n){e.validateAfterActionSequence(u.clone(e.runningSequence_),e.runningSequenceName_),t(null)})).then((function(t){return e.nextValidationState()}));case 7:return new m.CorePromise((function(t,n){e.renderAfterRunning(u.clone(e.runningSequence_),e.runningSequenceName_),t(null)})).then((function(t){return e.nextValidationState()}));case 8:return n=0,m.CorePromise.resolve(null).then((function(t){return n=d.Host.async.getSystemUptimeInSeconds(),m.CorePromise.resolve(null)})).then((function(t){return e.undoActionSequence(u.clone(e.runningSequence_),e.runningSequenceName_)})).then((function(t){var r=d.Host.async.getSystemUptimeInSeconds()-n,i=d.Host.locale.formatNumber(r,3),a=e.qualifiedSequenceName_+"/"+e.path_;return o.undoPerformanceData[a]={time:i,buffer:"99.99"},e.nextValidationState()}));case 9:return new m.CorePromise((function(t,n){e.validateAfterUndo(u.clone(e.runningSequence_),e.runningSequenceName_),t(null)})).then((function(t){return e.nextValidationState()}));case 10:return new m.CorePromise((function(t,n){e.renderAfterUndo(u.clone(e.runningSequence_),e.runningSequenceName_),t(null)})).then((function(t){return e.nextValidationState()}));case 11:return n=0,m.CorePromise.resolve(null).then((function(t){return n=d.Host.async.getSystemUptimeInSeconds(),m.CorePromise.resolve(null)})).then((function(t){return e.redoActionSequence(u.clone(e.runningSequence_),e.runningSequenceName_)})).then((function(t){var r=d.Host.async.getSystemUptimeInSeconds()-n,i=d.Host.locale.formatNumber(r,3),a=e.qualifiedSequenceName_+"/"+e.path_;return o.redoPerformanceData[a]={time:i,buffer:"99.99"},e.nextValidationState()}));case 12:return new m.CorePromise((function(t,n){e.validateAfterRedo(u.clone(e.runningSequence_),e.runningSequenceName_),t(null)})).then((function(t){return e.nextValidationState()}));case 13:return new m.CorePromise((function(t,n){e.renderAfterRedo(u.clone(e.runningSequence_),e.runningSequenceName_),t(null)})).then((function(t){return e.nextValidationState()}));case 14:return new m.CorePromise((function(t,n){e.shutdown(u.clone(e.runningSequence_),e.runningSequenceName_,e.doc_),t(null)})).then((function(t){return e.nextValidationState()}));default:return m.CorePromise.resolve(null)}},canRunActionSequence:function(t,e,n){return!0},populateActionSequence:function(t,e,n){return m.CorePromise.resolve(u.clone(t))},prepareDocument:function(t,e){return m.CorePromise.resolve([])},setUpActionSequence:function(t,e,n){},renderBeforeRunning:function(t,e){this.render(this.doc_,"before/"+this.qualifiedSequenceName_)},runActions:function(t){var e=this,n=new l.TestActionHandler(this.doc_.controller),o=u.clone(t);if(0==o.length)return m.CorePromise.resolve(null);var r=n.doAction(o.shift()()).then((function(t){return e.appendActionResult(c.ActionResult.fromPromiseAny(t))}));if(0==!o.length)for(var i=u.iter(o);!i.done;i.next()){var a=i.value;r=r.then((function(t){var e=a();return n.doAction(e)})).then((function(t){return e.appendActionResult(c.ActionResult.fromPromiseAny(t))}))}return r},clearResultsBeforeRunning:function(){this.prepResults_=u.clone(this.actionResults_),this.actionResults_=[]},runActionSequence:function(t,e){var n,o=this;return this.clearResultsBeforeRunning(),XCTAssertTrue(t.length>0,"should not run a test with no actions. Implement CanRun for this test to skip if the test can't be run on it"),(n=u.opt(u.opt(this.doc_,(function(t){return t.controller})),(function(t){return t.undoRedoMgr})))&&(this.undoToIndex_=n.getCurrentTimelineIndex()),this.runActions(u.clone(t)).then((function(e){return XCTAssertTrue(o.actionResults_.length==t.length)}))},validateAfterActionSequence:function(t,e){},renderAfterRunning:function(t,e){var n=this;this.render(this.doc_,"after_actions/"+this.qualifiedSequenceName_);var r={action:o.actionPerformanceData};u.opt(d.Host.actionTesting,(function(t){return t.writeJsonToFile(u.clone(r),"after_actions/"+n.performanceFilename)}))},undoActionSequence:function(t,e){var n,o=m.CorePromise.resolve(null);if(0==!t.length&&(n=u.opt(u.opt(this.doc_,(function(t){return t.controller})),(function(t){return t.undoRedoMgr})))){o=o.then((function(t){return XCTAssertTrue(null!=n.getUndoDescription(),"Undo not found before undoing tested actions"),XCTAssertTrue(null==n.getRedoDescription(),"Redo found before undoing tested actions"),null}));for(var r=this.undoToIndex_,i=u.iter(u.range(0,t.length,!1));!i.done;i.next())o=o.then((function(t){return new m.CorePromise((function(t,e){n.getCurrentTimelineIndex()>r?n.undo((function(){return t(null)})):t(null)}))}));o=o.then((function(t){return XCTAssertTrue(null!=n.getRedoDescription(),"No redo found after undoing tested actions"),null}))}return o},validateAfterUndo:function(t,e){},renderAfterUndo:function(t,e){var n=this;this.render(this.doc_,"after_undo/"+this.qualifiedSequenceName_);var r={undo:o.undoPerformanceData};u.opt(d.Host.actionTesting,(function(t){return t.writeJsonToFile(u.clone(r),"after_undo/"+n.performanceFilename)}))},redoActionSequence:function(t,e){var n,o=m.CorePromise.resolve(null);if(0==!t.length&&(n=u.opt(u.opt(this.doc_,(function(t){return t.controller})),(function(t){return t.undoRedoMgr})))){o=o.then((function(t){return XCTAssertTrue(null!=n.getRedoDescription(),"Redo not found before redoing tested actions"),null}));for(var r=u.iter(u.range(0,t.length,!1));!r.done;r.next())o=o.then((function(t){return new m.CorePromise((function(t,e){return n.redo((function(){return t(null)}))}))}));o=o.then((function(t){return XCTAssertTrue(null==n.getRedoDescription(),"Extra redo found after redoing tested actions"),XCTAssertTrue(null!=n.getUndoDescription(),"No undo found after redoing tested actions"),null}))}return o},validateAfterRedo:function(t,e){},renderAfterRedo:function(t,e){var n=this;this.render(this.doc_,"after_redo/"+this.qualifiedSequenceName_);var r={redo:o.redoPerformanceData};u.opt(d.Host.actionTesting,(function(t){return t.writeJsonToFile(u.clone(r),"after_redo/"+n.performanceFilename)}))},shutdown:function(t,e,n){},allSelectableFormae:function(t,e){var n;return void 0===e&&(e=null),t.firstPage.root.filterWithCallback((function(t){return null!=t.controller&&t.controller.selectable&&(!(n=u.opt(e,(function(e){return e(t)})))&&null==n||n)}))},findLargestForma:function(t){return t.reduce(this.chooseLargerForma,[null,0])[0]},chooseLargerForma:function(t,e){var n,o=(n=u.opt(e.bounds,(function(t){return t.area})))||null!=n?n:0;return o>t[1]?[e,o]:t},test_ValidateActionSequence:function(t,e){},installBrandkit:function(t){(new p.ProfilingColorMap).reset();var e=[],n=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_PRIMARY_ID,[T.TheoColor.SPARK_COLOR_ROLE_PRIMARY],25.5,127.5,255,1),o=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SECONDARY_ID1,[T.TheoColor.SPARK_COLOR_ROLE_SECONDARY],125,128,255,1),r=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SECONDARY_ID2,[T.TheoColor.SPARK_COLOR_ROLE_SECONDARY],25,228,155,1),i=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID0,[T.TheoColor.SPARK_COLOR_ROLE_SHADE0],30,20,40,1),a=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID1,[T.TheoColor.SPARK_COLOR_ROLE_SHADE1],60,40,80,1),s=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID2,[T.TheoColor.SPARK_COLOR_ROLE_SHADE2],100,50,255,1),l=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID3,[T.TheoColor.SPARK_COLOR_ROLE_SHADE3],140,60,120,1),c=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID4,[T.TheoColor.SPARK_COLOR_ROLE_SHADE4],190,80,160,1),m=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID5,[T.TheoColor.SPARK_COLOR_ROLE_SHADE5],230,100,200,1),f=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID6,[T.TheoColor.SPARK_COLOR_ROLE_SHADE6],255,255,255,1),C=T.TheoColor.init_bb45(n);e.push(C),e.push(T.TheoColor.init_bb45(o)),e.push(T.TheoColor.init_bb45(r)),e.push(T.TheoColor.init_bb45(i)),e.push(T.TheoColor.init_bb45(a)),e.push(T.TheoColor.init_bb45(s)),e.push(T.TheoColor.init_bb45(l)),e.push(T.TheoColor.init_bb45(c)),e.push(T.TheoColor.init_bb45(m)),e.push(T.TheoColor.init_bb45(f)),d.Host.fontProvider.getSuggestableFonts(A.ANY_DOCUMENT);var F=u.opt(d.Host.fontProvider,(function(t){return t.descriptorForPostScriptName("Yellowtail",A.ANY_DOCUMENT)})),S=u.opt(d.Host.fontProvider,(function(t){return t.descriptorForPostScriptName("WanderlustShine-Regular ",A.ANY_DOCUMENT)})),v=[],y=new _.MockAuthoringContextFont(this.FAKE_FONT_ELEMENT_HEADLINE_ID,g.TheoFont.SPARK_FONT_ROLE_HEADLINE,F),I=new _.MockAuthoringContextFont(this.FAKE_FONT_ELEMENT_BODY_ID,g.TheoFont.SPARK_FONT_ROLE_BODY,S);v.push(y),v.push(I);var E=new _.MockAuthoringContextLogo(this.FAKE_LOGO_ELEMENT_PRIMARY_ID,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNg/sXzHwAEFgIJ5hSCsQAAAABJRU5ErkJggg==",h.SPARK_LOGO_ROLE_PRIMARY,3,3),P=new _.MockAuthoringContextLogo(this.FAKE_LOGO_ELEMENT_STAMP_ID,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAADCAIAAADZSiLoAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAABZJREFUCJlj+P//PwMDA4REpf7//w8A4D0O8mtAqaUAAAAASUVORK5CYII=",h.SPARK_LOGO_ROLE_POST_STAMP,3,3),R=[];R.push(E),R.push(P);var D=_.MockAuthoringContext.init_44fd("Fake Brandkit","brandkit-for-actions",[n,o,r,i,a,s,l,c,m,f],u.clone(v),u.clone(R));d.Host.brandkitManager.fakeBrandkitForElementsForTesting=D},installSecondBrandkit:function(t){(new p.ProfilingColorMap).reset();var e=[],n=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_PRIMARY_ID_2,[T.TheoColor.SPARK_COLOR_ROLE_PRIMARY],65.5,167.5,222,1),o=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SECONDARY_ID1_2,[T.TheoColor.SPARK_COLOR_ROLE_SECONDARY],25,108,201,1),r=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SECONDARY_ID2_2,[T.TheoColor.SPARK_COLOR_ROLE_SECONDARY],75,208,105,1),i=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID0_2,[T.TheoColor.SPARK_COLOR_ROLE_SHADE0],245,245,245,1),a=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID1_2,[T.TheoColor.SPARK_COLOR_ROLE_SHADE1],230,100,200,1),s=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID2_2,[T.TheoColor.SPARK_COLOR_ROLE_SHADE2],190,80,160,1),l=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID3_2,[T.TheoColor.SPARK_COLOR_ROLE_SHADE3],140,60,120,1),c=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID4_2,[T.TheoColor.SPARK_COLOR_ROLE_SHADE4],100,50,255,1),m=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID5_2,[T.TheoColor.SPARK_COLOR_ROLE_SHADE5],60,40,80,1),f=new _.MockAuthoringContextColor(this.FAKE_COLOR_ELEMENT_SHADE_ID6_2,[T.TheoColor.SPARK_COLOR_ROLE_SHADE6],30,20,40,1),C=T.TheoColor.init_bb45(n);e.push(C),e.push(T.TheoColor.init_bb45(o)),e.push(T.TheoColor.init_bb45(r)),e.push(T.TheoColor.init_bb45(i)),e.push(T.TheoColor.init_bb45(a)),e.push(T.TheoColor.init_bb45(s)),e.push(T.TheoColor.init_bb45(l)),e.push(T.TheoColor.init_bb45(c)),e.push(T.TheoColor.init_bb45(m)),e.push(T.TheoColor.init_bb45(f)),d.Host.fontProvider.getSuggestableFonts(A.ANY_DOCUMENT);var F=u.opt(d.Host.fontProvider,(function(t){return t.descriptorForPostScriptName("Yellowtail",A.ANY_DOCUMENT)})),S=u.opt(d.Host.fontProvider,(function(t){return t.descriptorForPostScriptName("WanderlustShine-Regular ",A.ANY_DOCUMENT)})),v=[],y=new _.MockAuthoringContextFont(this.FAKE_FONT_ELEMENT_HEADLINE_ID_2,g.TheoFont.SPARK_FONT_ROLE_HEADLINE,F),I=new _.MockAuthoringContextFont(this.FAKE_FONT_ELEMENT_BODY_ID_2,g.TheoFont.SPARK_FONT_ROLE_BODY,S);v.push(y),v.push(I);var E=new _.MockAuthoringContextLogo(this.FAKE_LOGO_ELEMENT_PRIMARY_ID_2,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNg/sXzHwAEFgIJ5hSCsQAAAABJRU5ErkJggg==",h.SPARK_LOGO_ROLE_PRIMARY,3,3),P=new _.MockAuthoringContextLogo(this.FAKE_LOGO_ELEMENT_STAMP_ID_2,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAADCAIAAADZSiLoAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAABZJREFUCJlj+P//PwMDA4REpf7//w8A4D0O8mtAqaUAAAAASUVORK5CYII=",h.SPARK_LOGO_ROLE_POST_STAMP,3,3),R=[];R.push(E),R.push(P);var D=_.MockAuthoringContext.init_44fd("Fake Brandkit 2","brandkit-for-actions-2",[n,o,r,i,a,s,l,c,m,f],u.clone(v),u.clone(R));d.Host.brandkitManager.fakeBrandkitForElementsForTesting=D},removeBrandkit:function(t){d.Host.brandkitManager.fakeBrandkitForElementsForTesting=null,(new p.ProfilingColorMap).reset()},urlForAsset:function(t){return u.opt(d.Host.actionTesting,(function(e){return e.urlForAsset(t)}))},imageDataForAsset:function(t){return null!=d.Host.actionTesting?d.Host.actionTesting.imageDataForAsset(t):m.CorePromise.resolve(null)},render:function(t,e,n){void 0===n&&(n="");var o,r=this,i=((o=u.opt(d.Host.actionTesting,(function(t){return t.outputFolder})))||null!=o?o:"")+e+"/";u.opt(d.Host.actionTesting,(function(e){return e.render(t,i,r.path_+n)}))}}}),o),l.TestActionHandler=(r=function(t){this.actionQueue=[],this.executingAction=null,this.dc=t},u.defineClass({name:"TestActionHandler",ctor:r,statics:{_implements:function(t){return"IActionHandler"==t}},props:{canDoAction:function(t){return XCTAssertTrue(t.canDo(this.dc)),t.canDo(this.dc)},finishAction:function(){this.executingAction=null;var t=u.first(this.actionQueue);null!=t&&(this.actionQueue.shift(),this.doActionWithCallback(t[0],t[1]))},doActionWithCallback:function(t,e){var n,o=this;if(null!=this.executingAction)this.actionQueue.push([t,e]);else if(n=this.dc){var r=null;n.undoRedoMgr.beginUserActionAsync(t.getUserAction(n)).then((function(e){return t.execute(n)})).then((function(t){return r=t,n.undoRedoMgr.endUserActionAsync()})).then((function(e){return t.updateSelection(n)})).then((function(t){return e(c.ActionResult.fromPromiseAny(r),null)})).fail((function(t){return e(null,t)})).then((function(t){return o.finishAction()}))}else XCTFail("Document controller destroyed")},doAction:function(t){var e=this;return new m.CorePromise((function(n,o){return e.doActionWithCallback(t,(function(t,e){var r;null!=(r=e)?o(r):n(t)}))}))}}}),r),l.TestState=u.defineEnum("TestState",{kFailed:-1,kCanRun:0,kPrepDoc:1,kPopulate:2,kSetUp:3,kRenderBeforeRunning:4,kRun:5,kValidateAfterRunning:6,kRenderAfterRunning:7,kUndo:8,kValidateAfterUndo:9,kRenderAfterUndo:10,kRedo:11,kValidateAfterRedo:12,kRenderAfterRedo:13,kShutdown:14,kFinished:15}),l.EnabledTestStates=(i=function(){},a={},u.defineClass({name:"EnabledTestStates",ctor:i,statics:{kRunStates:{get:function(){return void 0===a.kRunStates&&(a.kRunStates=i.init_34d9([l.TestState.kCanRun,l.TestState.kPrepDoc,l.TestState.kPopulate,l.TestState.kSetUp,l.TestState.kRun,l.TestState.kValidateAfterRunning,l.TestState.kRenderAfterRunning,l.TestState.kShutdown])),a.kRunStates}},kUndoStates:{get:function(){return void 0===a.kUndoStates&&(a.kUndoStates=i.init_34d9([l.TestState.kUndo,l.TestState.kValidateAfterUndo,l.TestState.kRenderAfterUndo])),a.kUndoStates}},kRedoStates:{get:function(){return void 0===a.kRedoStates&&(a.kRedoStates=i.init_34d9([l.TestState.kRedo,l.TestState.kValidateAfterRedo,l.TestState.kRenderAfterRedo])),a.kRedoStates}},kRenderingStates:{get:function(){return void 0===a.kRenderingStates&&(a.kRenderingStates=i.init_34d9([l.TestState.kRenderBeforeRunning,l.TestState.kRenderAfterRunning,l.TestState.kRenderAfterUndo,l.TestState.kRenderAfterRedo])),a.kRenderingStates}},kValidationStates:{get:function(){return void 0===a.kValidationStates&&(a.kValidationStates=i.init_34d9([l.TestState.kValidateAfterRunning,l.TestState.kValidateAfterUndo,l.TestState.kValidateAfterRedo])),a.kValidationStates}},kAllStates:{get:function(){return void 0===a.kAllStates&&(a.kAllStates=i.init_34d9([l.TestState.kCanRun,l.TestState.kPrepDoc,l.TestState.kPopulate,l.TestState.kSetUp,l.TestState.kRenderBeforeRunning,l.TestState.kRun,l.TestState.kValidateAfterRunning,l.TestState.kRenderAfterRunning,l.TestState.kUndo,l.TestState.kValidateAfterUndo,l.TestState.kRenderAfterUndo,l.TestState.kRedo,l.TestState.kValidateAfterRedo,l.TestState.kRenderAfterRedo,l.TestState.kShutdown])),a.kAllStates}}},props:{init_5d5e:function(t){this.rawValue=t},init_b14a:function(t){this.rawValue=1<<t},init_34d9:function(t){this.rawValue=t.reduce((function(t,e){return t|1<<e}),0)},enabled:function(t){return this.rawValue&1<<t!=0},enable:function(t){return i.init_5d5e(this.rawValue|1<<t)},disable:function(t){return i.init_5d5e(this.rawValue&(i.kAllStates.rawValue^1<<t))},subtracting:function(t){return i.init_5d5e(this.rawValue&(i.kAllStates.rawValue^t.rawValue))}}}),i),l.ValidationState=(s=function(){var t,e,n;this.state_=l.TestState.kCanRun,this.enabledStates_=l.EnabledTestStates.kAllStates,((t=u.opt(d.Host.actionTesting,(function(t){return t.renderingEnabled})))||null!=t)&&t||(this.enabledStates_=this.enabledStates_.subtracting(l.EnabledTestStates.kRenderingStates)),((e=u.opt(d.Host.actionTesting,(function(t){return t.undoEnabled})))||null!=e)&&e||(this.enabledStates_=this.enabledStates_.subtracting(l.EnabledTestStates.kUndoStates),this.enabledStates_=this.enabledStates_.subtracting(l.EnabledTestStates.kRedoStates)),((n=u.opt(d.Host.actionTesting,(function(t){return t.validationEnabled})))||null!=n)&&n||(this.enabledStates_=this.enabledStates_.subtracting(l.EnabledTestStates.kValidationStates))},u.defineClass({name:"ValidationState",ctor:s,props:{next:function(){var t,e,n=this.state_;for(this.state_=(t=l.TestState.toCaseValue(this.state_+1))||null!=t?t:l.TestState.kFailed;!this.enabledStates_.enabled(this.state_)&&this.hasNext;)this.state_=(e=l.TestState.toCaseValue(this.state_+1))||null!=e?e:l.TestState.kFailed;return n},hasNext:{get:function(){return this.state_!=l.TestState.kFailed&&this.state_!=l.TestState.kFinished}},fail:function(){this.state_=l.TestState.kFailed},finish:function(){this.hasNext&&(this.state_=l.TestState.kFinished)}}}),s)},eLhV:function(t,e,n){var o,r,i,a,s=e,l=n("oAGj"),u=n("Tq01"),c=n("4mEG"),h=n("c9Jm"),m=n("yGNn"),f=n("FNB+"),d=n("iCxV"),A=n("3lr5"),_=n("cRpU"),p=n("a9ow"),T=n("enh0"),g=n("VJ9E"),C=n("8t9B"),F=n("uUew");s.SetHighlightMethodTest=(o=function t(){this.actionSequence_SetHighlightMethod=[function(){return new c.AddTextContentAction(t.initialText_)}],this.testDoc_=null,this.testPage_=null,this.testFormaID_=null,this.lockupFont_=null,h.ActionTestBase.call(this)},l.defineClass({name:"SetHighlightMethodTest",ctor:o,superName:"ActionTestBase",statics:{initialText_:"Some text that is long enough to span lines",testFont_:"Bellfort",getTheoFont:function(t){var e=g.TheoFont.init_9e5c(d.Host.fontProvider.getIncludedFonts(A.ANY_DOCUMENT).find((function(e){return e.postScriptName==t})));return XCTAssertEqual(e.fontData.postScriptName,t),e}},props:{textForma:{get:function(){return l.first(l.opt(l.as(this.getActionResult(0),u.FormaActionResult),(function(t){return t.formae})))}},populateActionSequence:function(t,e,n){var r=this;return m.CorePromise.resolve(t.concat([function(){return r.lockupFont_=l.opt(l.opt(l.opt(l.as(l.opt(r.textForma,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.lockupStyle})),(function(t){return t.font})),(function(t){return t.fontData.postScriptName})),l.opt(l.opt(r.testDoc_,(function(t){return t.controller})),(function(t){return t.selection.replaceSelection(r.textForma)})),new _.EnterCharStyleModeAction(r.textForma)},function(){return new _.SetHighlightMethodAction(C.HighlightMethod.EvenRows,!0)},function(){return new _.SetFontAction(o.getTheoFont(o.testFont_))},function(){return new _.ExitCharStyleModeAction(r.textForma)}]))},setUpActionSequence:function(t,e,n){this.testDoc_=n,this.testPage_=n.firstPage},validateAfterActionSequence:function(t,e){var n=this;this.testFormaID_=l.opt(this.textForma,(function(t){return t.formaID})),XCTAssertNotNil(this.testDoc_),XCTAssertNotNil(this.testPage_),XCTAssertNotNil(this.testFormaID_);var r=l.opt(this.testPage_,(function(t){return t.formaByID(n.testFormaID_)}));XCTAssertTrue(r===this.textForma),XCTAssertEqual(l.opt(l.opt(r,(function(t){return t.controller})),(function(t){return t.kind})),C.TypeLockupController.KIND),XCTAssertEqual(l.opt(l.opt(l.opt(l.as(l.opt(r,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.lockupStyle})),(function(t){return t.font})),(function(t){return t.fontData.postScriptName})),this.lockupFont_),r.visit(f.FormaTraversal.PreOrder,(function(t,e,n){var r;return(r=l.as(t,T.TextForma))&&r.rowIndex%2==0&&(XCTAssertNotNil(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0)),XCTAssertNotNil(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute)),XCTAssertEqual(l.opt(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute),(function(t){return t.value.postScriptName})),o.testFont_)),!1}))},validateAfterUndo:function(t,e){var n=this;XCTAssertEqual(l.opt(l.opt(l.opt(l.as(l.opt(this.textForma,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.lockupStyle})),(function(t){return t.font})),(function(t){return t.fontData.postScriptName})),this.lockupFont_),XCTAssertNil(l.opt(this.testPage_,(function(t){return t.formaByID(n.testFormaID_)})))},validateAfterRedo:function(t,e){var n=this,r=l.opt(this.testPage_,(function(t){return t.formaByID(n.testFormaID_)}));XCTAssertNotNil(r),XCTAssertEqual(l.opt(l.opt(r,(function(t){return t.controller})),(function(t){return t.kind})),C.TypeLockupController.KIND),XCTAssertEqual(l.opt(l.opt(l.opt(l.as(l.opt(r,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.lockupStyle})),(function(t){return t.font})),(function(t){return t.fontData.postScriptName})),this.lockupFont_),r.visit(f.FormaTraversal.PreOrder,(function(t,e,n){var r;return(r=l.as(t,T.TextForma))&&r.rowIndex%2==0&&(XCTAssertNotNil(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0)),XCTAssertNotNil(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute)),XCTAssertEqual(l.opt(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute),(function(t){return t.value.postScriptName})),o.testFont_)),!1}))}}}),o),s.ApplyCharStyleTest=(r=function t(){this.actionSequence_ApplyCharStyle=[function(){return new c.AddTextContentAction(t.initialText_)}],this.testDoc_=null,this.testPage_=null,this.testFormaID_=null,this.oldRanges_=null,this.lastChildForma_=null,h.ActionTestBase.call(this)},l.defineClass({name:"ApplyCharStyleTest",ctor:r,superName:"ActionTestBase",statics:{initialText_:"0 1 2 3 4"},props:{textForma:{get:function(){return l.first(l.opt(l.as(this.getActionResult(0),u.FormaActionResult),(function(t){return t.formae})))}},populateActionSequence:function(t,e,n){var o=this;return m.CorePromise.resolve(t.concat([function(){return o.oldRanges_=l.clone(l.opt(l.as(l.opt(o.textForma,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges}))||[]),l.opt(l.opt(o.testDoc_,(function(t){return t.controller})),(function(t){return t.selection.replaceSelection(o.textForma)})),o.textForma.visit(f.FormaTraversal.PreOrder,(function(t,e,n){var r;return(r=l.as(t,T.TextForma))&&(o.lastChildForma_=r),!1})),new _.EnterCharStyleModeAction(o.textForma)},function(){return new _.ApplyCharStyleAction(o.lastChildForma_,C.TypeLockupController.HIGHLIGHT_STYLE,C.CharStyleApplyMode.Apply,new F.TextRange(0,0))},function(){return new _.ExitCharStyleModeAction(o.textForma)}]))},setUpActionSequence:function(t,e,n){this.testDoc_=n,this.testPage_=n.firstPage},validateAfterActionSequence:function(t,e){var n=this;this.testFormaID_=l.opt(this.textForma,(function(t){return t.formaID})),XCTAssertNotNil(this.testDoc_),XCTAssertNotNil(this.testPage_),XCTAssertNotNil(this.testFormaID_);var o,r=l.opt(this.testPage_,(function(t){return t.formaByID(n.testFormaID_)}));XCTAssertTrue(r===this.textForma),XCTAssertEqual(l.opt(l.opt(r,(function(t){return t.controller})),(function(t){return t.kind})),C.TypeLockupController.KIND),XCTAssertNotNil(l.clone(l.opt(l.as(l.opt(r,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges})))),(o=l.opt(l.as(l.opt(r,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges})))&&(XCTAssertEqual(l.last(o).start,this.lastChildForma_.rangeInLockup.start),XCTAssertEqual(l.last(o).end,this.lastChildForma_.rangeInLockup.end))},validateAfterUndo:function(t,e){var n=this;XCTAssertEqual(l.clone(l.opt(l.as(l.opt(this.textForma,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges}))),l.clone(this.oldRanges_)),XCTAssertNil(l.opt(this.testPage_,(function(t){return t.formaByID(n.testFormaID_)})))},validateAfterRedo:function(t,e){var n,o=this,r=l.opt(this.testPage_,(function(t){return t.formaByID(o.testFormaID_)}));XCTAssertNotNil(r),XCTAssertEqual(l.opt(l.opt(r,(function(t){return t.controller})),(function(t){return t.kind})),C.TypeLockupController.KIND),XCTAssertNotNil(l.clone(l.opt(l.as(l.opt(r,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges})))),(n=l.opt(l.as(l.opt(r,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges})))&&(XCTAssertEqual(l.last(n).start,this.lastChildForma_.rangeInLockup.start),XCTAssertEqual(l.last(n).end,this.lastChildForma_.rangeInLockup.end))}}}),r),s.ApplyCharStyleWithoutUITest=(i=function t(){this.actionSequence_ApplyCharStyle=[function(){return new c.AddTextContentAction(t.initialText_)}],this.testDoc_=null,this.testPage_=null,this.testFormaID_=null,this.oldRanges_=null,this.lastChildForma_=null,h.ActionTestBase.call(this)},l.defineClass({name:"ApplyCharStyleWithoutUITest",ctor:i,superName:"ActionTestBase",statics:{initialText_:"0 1 2 3 4"},props:{textForma:{get:function(){return l.first(l.opt(l.as(this.getActionResult(0),u.FormaActionResult),(function(t){return t.formae})))}},populateActionSequence:function(t,e,n){var o=this;return m.CorePromise.resolve(t.concat([function(){return o.oldRanges_=l.clone(l.opt(l.as(l.opt(o.textForma,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges}))||[]),l.opt(l.opt(o.testDoc_,(function(t){return t.controller})),(function(t){return t.selection.replaceSelection(o.textForma)})),o.textForma.visit(f.FormaTraversal.PreOrder,(function(t,e,n){var r;return(r=l.as(t,T.TextForma))&&(o.lastChildForma_=r),!1})),new _.ApplyCharStyleWithoutUIAction(o.lastChildForma_,C.TypeLockupController.HIGHLIGHT_STYLE,C.CharStyleApplyMode.Apply,new F.TextRange(0,0))}]))},setUpActionSequence:function(t,e,n){this.testDoc_=n,this.testPage_=n.firstPage},validateAfterActionSequence:function(t,e){var n=this;this.testFormaID_=l.opt(this.textForma,(function(t){return t.formaID})),XCTAssertNotNil(this.testDoc_),XCTAssertNotNil(this.testPage_),XCTAssertNotNil(this.testFormaID_);var o,r=l.opt(this.testPage_,(function(t){return t.formaByID(n.testFormaID_)}));XCTAssertTrue(r===this.textForma),XCTAssertEqual(l.opt(l.opt(r,(function(t){return t.controller})),(function(t){return t.kind})),C.TypeLockupController.KIND),XCTAssertNotNil(l.clone(l.opt(l.as(l.opt(r,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges})))),(o=l.opt(l.as(l.opt(r,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges})))&&(XCTAssertEqual(l.last(o).start,this.lastChildForma_.rangeInLockup.start),XCTAssertEqual(l.last(o).end,this.lastChildForma_.rangeInLockup.end))},validateAfterUndo:function(t,e){var n=this;XCTAssertEqual(l.clone(l.opt(l.as(l.opt(this.textForma,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges}))),l.clone(this.oldRanges_)),XCTAssertNil(l.opt(this.testPage_,(function(t){return t.formaByID(n.testFormaID_)})))},validateAfterRedo:function(t,e){var n,o=this,r=l.opt(this.testPage_,(function(t){return t.formaByID(o.testFormaID_)}));XCTAssertNotNil(r),XCTAssertEqual(l.opt(l.opt(r,(function(t){return t.controller})),(function(t){return t.kind})),C.TypeLockupController.KIND),XCTAssertNotNil(l.clone(l.opt(l.as(l.opt(r,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges})))),(n=l.opt(l.as(l.opt(r,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.charStyleRanges})))&&(XCTAssertEqual(l.last(n).start,this.lastChildForma_.rangeInLockup.start),XCTAssertEqual(l.last(n).end,this.lastChildForma_.rangeInLockup.end))}}}),i),s.UpdateCharStyleRangeTest=(a=function t(){this.actionSequence_UpdateCharStyleRange=[function(){return new c.AddTextContentAction(t.initialText_)}],this.testDoc_=null,this.testPage_=null,this.testFormaID_=null,this.lockupFont_=null,h.ActionTestBase.call(this)},l.defineClass({name:"UpdateCharStyleRangeTest",ctor:a,superName:"ActionTestBase",statics:{initialText_:"1 2 3 4 5",newText_:"one two three four five",testFont_:"Bellfort",getTheoFont:function(t){var e=g.TheoFont.init_9e5c(d.Host.fontProvider.getIncludedFonts(A.ANY_DOCUMENT).find((function(e){return e.postScriptName==t})));return XCTAssertEqual(e.fontData.postScriptName,t),e}},props:{textForma:{get:function(){return l.first(l.opt(l.as(this.getActionResult(0),u.FormaActionResult),(function(t){return t.formae})))}},populateActionSequence:function(t,e,n){var o=this;return m.CorePromise.resolve(t.concat([function(){return o.lockupFont_=l.opt(l.opt(l.opt(l.as(l.opt(o.textForma,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.lockupStyle})),(function(t){return t.font})),(function(t){return t.fontData.postScriptName})),l.opt(l.opt(o.testDoc_,(function(t){return t.controller})),(function(t){return t.selection.replaceSelection(o.textForma)})),new _.EnterCharStyleModeAction(o.textForma)},function(){return new _.UpdateCharStyleRangeAction(o.textForma,new F.TextRange(0,1),3)},function(){return new _.SetTextAction(a.newText_,o.textForma)},function(){return new _.SetFontAction(a.getTheoFont(a.testFont_))},function(){return new _.ExitCharStyleModeAction(o.textForma)}]))},setUpActionSequence:function(t,e,n){this.testDoc_=n,this.testPage_=n.firstPage},validateAfterActionSequence:function(t,e){var n=this;this.testFormaID_=l.opt(this.textForma,(function(t){return t.formaID})),XCTAssertNotNil(this.testDoc_),XCTAssertNotNil(this.testPage_),XCTAssertNotNil(this.testFormaID_);var o=l.opt(this.testPage_,(function(t){return t.formaByID(n.testFormaID_)}));XCTAssertTrue(o===this.textForma),XCTAssertEqual(l.opt(l.opt(o,(function(t){return t.controller})),(function(t){return t.kind})),C.TypeLockupController.KIND),XCTAssertEqual(l.opt(l.opt(l.opt(l.as(l.opt(o,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.lockupStyle})),(function(t){return t.font})),(function(t){return t.fontData.postScriptName})),this.lockupFont_),o.visit(f.FormaTraversal.PreOrder,(function(t,e,o){var r;return(r=l.as(t,T.TextForma))&&(0==r.rangeInLockup.start?(XCTAssertNotNil(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0)),XCTAssertNotNil(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute)),XCTAssertEqual(l.opt(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute),(function(t){return t.value.postScriptName})),a.testFont_)):(XCTAssertNotNil(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0)),XCTAssertNotNil(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute)),XCTAssertEqual(l.opt(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute),(function(t){return t.value.postScriptName})),n.lockupFont_))),!1}))},validateAfterUndo:function(t,e){var n=this;XCTAssertEqual(l.opt(l.opt(l.opt(l.as(l.opt(this.textForma,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.lockupStyle})),(function(t){return t.font})),(function(t){return t.fontData.postScriptName})),this.lockupFont_),XCTAssertNil(l.opt(this.testPage_,(function(t){return t.formaByID(n.testFormaID_)})))},validateAfterRedo:function(t,e){var n=this,o=l.opt(this.testPage_,(function(t){return t.formaByID(n.testFormaID_)}));XCTAssertNotNil(o),XCTAssertEqual(l.opt(l.opt(o,(function(t){return t.controller})),(function(t){return t.kind})),C.TypeLockupController.KIND),XCTAssertEqual(l.opt(l.opt(l.opt(l.as(l.opt(o,(function(t){return t.controller})),C.TypeLockupController),(function(t){return t.lockupStyle})),(function(t){return t.font})),(function(t){return t.fontData.postScriptName})),this.lockupFont_),o.visit(f.FormaTraversal.PreOrder,(function(t,e,o){var r;return(r=l.as(t,T.TextForma))&&(0==r.rangeInLockup.start?(XCTAssertNotNil(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0)),XCTAssertNotNil(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute)),XCTAssertEqual(l.opt(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute),(function(t){return t.value.postScriptName})),a.testFont_)):(XCTAssertNotNil(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0)),XCTAssertNotNil(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute)),XCTAssertEqual(l.opt(l.as(l.opt(r.textModel.attributeAtIndex(p.FontDescriptorAttribute.NAME,0),(function(t){return t.attr})),p.FontDescriptorAttribute),(function(t){return t.value.postScriptName})),n.lockupFont_))),!1}))}}}),a)},jE7t:function(t,e,n){var o,r=e,i=n("oAGj"),a=n("c9Jm"),s=n("o+xL");r.RotateTest=(o=function(){this.actionSequence_Rotate=[function(){return new s.RotateAction(Math.PI/2,null,null,!1)}],this.formaeToRotate_=[],this.formaeToTest_=[],this.initialTransforms_=[],a.ActionTestBase.call(this)},i.defineClass({name:"RotateTest",ctor:o,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){var o;this.formaeToRotate_=i.clone(this.allSelectableFormae(n,(function(t){return!(!(o=i.opt(t.controller,(function(t){return t.rotateable})))&&null==o)&&o}))),this.initialTransforms_=this.formaeToTest_.map((function(t){return t.placement}),this),n.controller.selection.replaceSelectionWithFormae(i.clone(this.formaeToRotate_))},validateAfterActionSequence:function(t,e){for(var n=i.iter(i.range(0,this.formaeToTest_.length,!1));!n.done;n.next()){var o=n.value,r=this.initialTransforms_[o].rotate(0,1);XCTAssertEqual(this.formaeToTest_[o].placement.transformValues.rotSine,r.transformValues.rotSine,.001),XCTAssertEqual(this.formaeToTest_[o].placement.transformValues.rotCosine,r.transformValues.rotCosine,.001)}},validateAfterUndo:function(t,e){for(var n=i.iter(i.range(0,this.formaeToTest_.length,!1));!n.done;n.next()){var o=n.value;XCTAssertEqual(this.formaeToTest_[o].placement.transformValues.rotSine,this.initialTransforms_[o].transformValues.rotSine),XCTAssertEqual(this.formaeToTest_[o].placement.transformValues.rotCosine,this.initialTransforms_[o].transformValues.rotCosine)}},validateAfterRedo:function(t,e){for(var n=i.iter(i.range(0,this.formaeToTest_.length,!1));!n.done;n.next()){var o=n.value,r=this.initialTransforms_[o].rotate(0,1);XCTAssertEqual(this.formaeToTest_[o].placement.transformValues.rotSine,r.transformValues.rotSine,.001),XCTAssertEqual(this.formaeToTest_[o].placement.transformValues.rotCosine,r.transformValues.rotCosine,.001)}},tearDown:function(){this.formaeToRotate_=[],this.formaeToTest_=[],a.ActionTestBase.prototype.tearDown.call(this)}}}),o)},mSLX:function(t,e,n){var o,r,i,a,s,l=e,u=n("oAGj"),c=n("Tq01"),h=n("4mEG"),m=n("c9Jm"),f=n("kYI4"),d=n("70fJ"),A=n("yGNn"),_=n("ascj"),p=n("rsKm"),T=n("FNB+"),g=n("x6FH"),C=n("iCxV"),F=n("VkKB"),S=n("JO5d"),v=n("Zifs"),y=n("umUn"),I=n("8t9B");l.ApplyColorIconTest=(o=function t(){this.actionSequence_ApplyColorIcon=[function(){return new h.AddIconContentAction(t.originalIconURL_,F.MediaMetadata.init_36a2(),null)}],this.testDoc_=null,this.testPage_=null,this.testColor_=null,this.oldIconColor_=null,m.ActionTestBase.call(this)},r={},u.defineClass({name:"ApplyColorIconTest",ctor:o,superName:"ActionTestBase",statics:{originalIconURL_:"",purple_:{get:function(){return void 0===r.purple_&&(r.purple_=new v.SolidColor(.4,.2,.6,1)),r.purple_}}},props:{iconForma:{get:function(){return u.first(u.opt(u.as(this.getActionResult(0),c.FormaActionResult),(function(t){return t.formae})))}},populateActionSequence:function(t,e,n){var r=this;return A.CorePromise.resolve(t.concat([function(){return r.oldIconColor_=u.opt(u.opt(r.iconForma,(function(t){return t.style})),(function(t){return t.colors.theoColor(_.ColorRole.FieldPrimary)})),r.testColor_=y.TheoColor.init_5344(o.purple_),new d.ApplyColorAction([r.iconForma],[r.testColor_],!1,0)}]))},setUpActionSequence:function(t,e,n){var r;this.testDoc_=n,this.testPage_=n.firstPage,null!=(r=this.urlForAsset("dog1.svg"))&&(o.originalIconURL_=r)},validateAfterActionSequence:function(t,e){var n=u.opt(u.opt(this.iconForma,(function(t){return t.style})),(function(t){return t.colors.theoColor(_.ColorRole.FieldPrimary)}));XCTAssertEqual(n,this.testColor_)},validateAfterUndo:function(t,e){var n=u.opt(u.opt(this.iconForma,(function(t){return t.style})),(function(t){return t.colors.theoColor(_.ColorRole.FieldPrimary)}));XCTAssertEqual(n,this.oldIconColor_)},validateAfterRedo:function(t,e){var n=u.opt(u.opt(this.iconForma,(function(t){return t.style})),(function(t){return t.colors.theoColor(_.ColorRole.FieldPrimary)}));XCTAssertEqual(n,this.testColor_)}}}),o),l.ApplyColorRootTest=function(){var t=function(){this.actionSequence_ApplyColorRoot=[],this.testDoc_=null,this.testPage_=null,this.rootForma_=null,this.testColor_=null,this.oldColor_=null,m.ActionTestBase.call(this)},e={};return u.defineClass({name:"ApplyColorRootTest",ctor:t,superName:"ActionTestBase",statics:{purple_:{get:function(){return void 0===e.purple_&&(e.purple_=new v.SolidColor(.4,.2,.6,1)),e.purple_}}},props:{populateActionSequence:function(e,n,o){var r=this;return A.CorePromise.resolve(e.concat([function(){return r.oldColor_=u.opt(r.rootForma_,(function(t){return t.style.colors.theoColor(_.ColorRole.FieldPrimary)})),r.testColor_=y.TheoColor.init_5344(t.purple_),new g.EnterGridLayoutModeAction},function(){return new g.SetGridParametersAction(NaN,8)},function(){return new d.ApplyColorAction([r.rootForma_],[r.testColor_],!1,0)}]))},setUpActionSequence:function(t,e,n){this.testDoc_=n,this.testPage_=n.firstPage,this.rootForma_=u.opt(this.testPage_,(function(t){return t.root}))},validateAfterActionSequence:function(t,e){var n=u.opt(this.rootForma_,(function(t){return t.style.colors.theoColor(_.ColorRole.FieldPrimary)}));XCTAssertEqual(n,this.testColor_)},validateAfterUndo:function(t,e){var n=u.opt(this.rootForma_,(function(t){return t.style.colors.theoColor(_.ColorRole.FieldPrimary)}));XCTAssertEqual(n,this.oldColor_)},validateAfterRedo:function(t,e){var n=u.opt(this.rootForma_,(function(t){return t.style.colors.theoColor(_.ColorRole.FieldPrimary)}));XCTAssertEqual(n,this.testColor_)}}}),t}(),l.ApplyColorThemeTest=(i=function(){this.actionSequence_ApplyColorTheme=[],this.testDoc_=null,this.page_=null,this.themeColors_=[],m.ActionTestBase.call(this)},u.defineClass({name:"ApplyColorThemeTest",ctor:i,superName:"ActionTestBase",props:{verifyColors:function(t){for(var e=0,n=u.clone(this.page_.colorLibraryController.getTheoColorsUsedInDocument()),o=u.iter(n);!o.done;o.next()){var r=o.value;(r.isBrandkitPrimaryColor()||r.isBrandkitSecondaryColor()||r.isBrandkitShade())&&(e+=1)}t?XCTAssertTrue(e>0):XCTAssertEqual(e,0)},populateActionSequence:function(t,e,n){var o=this;this.installBrandkit(n);for(var r=C.Host.brandkitManager.fakeBrandkitForElementsForTesting,i=u.clone(f.BrandingFacade.getBrandkitColorsForUI(r,null)),a=u.iter(i);!a.done;a.next()){var s=a.value[0];this.themeColors_.push(s)}return A.CorePromise.resolve(t.concat([function(){return new p.ApplyColorThemeAction(u.clone(o.themeColors_),"brandkit-for-actions",o.page_,!0)}]))},setUpActionSequence:function(t,e,n){this.testDoc_=n,this.page_=n.firstPage},validateAfterActionSequence:function(t,e){this.verifyColors(!0)},validateAfterUndo:function(t,e){this.verifyColors(!1)},validateAfterRedo:function(t,e){this.verifyColors(!0)},shutdown:function(t,e,n){m.ActionTestBase.prototype.shutdown.call(this,u.clone(t),e,n),this.removeBrandkit(n)}}}),i),l.ApplyColorThemeWithShuffleTest=(a=function(){this.actionSequence_ApplyColorThemeWithShuffle=[],this.testDoc_=null,this.page_=null,this.themeColors_=[],this.colorDictionary_={},this.colorRelationshipTestUtils_=new l.ColorRelationshipTestUtils,this.colorPaletteRelationshipBefore_=null,this.colorPaletteRelationshipAfter_=null,m.ActionTestBase.call(this)},u.defineClass({name:"ApplyColorThemeWithShuffleTest",ctor:a,superName:"ActionTestBase",props:{gatherColors:function(){var t={},e=u.opt(this.page_,(function(t){return t.root}));return u.opt(e,(function(e){return e.visitAll(T.FormaTraversal.PreOrder,(function(e){var n;if((n=u.as(e,T.Forma))&&null!=n.style.colors.colorID(_.ColorRole.FieldPrimary)){var o,r=null;u.as(n.controller,I.TypeLockupController)&&(r=n.style.colors.theoColor(_.ColorRole.FieldPrimary)),u.as(n.controller,S.ShapeController)&&(r=n.style.colors.theoColor(_.ColorRole.FieldPrimary)),null!=(o=u.opt(r,(function(t){return t.asString})))&&(t[n.formaID]=o)}}))})),t},gatherSparkColors:function(){var t={},e=u.opt(this.page_,(function(t){return t.root}));return u.opt(e,(function(e){return e.visitAll(T.FormaTraversal.PreOrder,(function(e){var n,o;(n=u.as(e,T.Forma))&&null!=n.style.colors.colorID(_.ColorRole.FieldPrimary)&&null!=u.opt(n.style.colors.theoColor(_.ColorRole.FieldPrimary),(function(t){return t.sparkElementID}))&&null!=(o=u.opt(n.style.colors.theoColor(_.ColorRole.FieldPrimary),(function(t){return t.asString})))&&(t[n.formaID]=o)}))})),t},verifyShuffledColors:function(t,e){for(var n=0,o=u.iter(t);!o.done;o.next()){var r,i=o.key,a=o.value;null!=(r=e[i])&&a!=r&&(n+=1)}u.toDouble(n)/u.toDouble(u.count(t))<=.15&&C.Host.logging.info("verifyShuffledColors diffCount "+n+" and count "+u.count(t)),XCTAssertTrue(u.toDouble(n)/u.toDouble(u.count(t))>.15)},verifyColorBeforeAfterPreservation:function(){var t,e,n,o;(t=this.testDoc_)&&(this.colorPaletteRelationshipAfter_=u.clone(this.colorRelationshipTestUtils_.getCurrentPaletteMapping(t)),(e=this.colorPaletteRelationshipBefore_)&&(n=this.colorPaletteRelationshipAfter_)&&null!=(o=this.colorRelationshipTestUtils_.checkOverlapBetweenTwoPaletteMappings(u.clone(e),u.clone(n)))?XCTAssertTrue(o>.8,"score: "+u.toString(o)+" below threshold:"+u.toString(.8)):XCTFail("Unknown error, value was nil"))},populateActionSequence:function(t,e,n){var o=this;this.installBrandkit(n);for(var r=C.Host.brandkitManager.fakeBrandkitForElementsForTesting,i=u.iter(r.colors);!i.done;i.next()){var a=i.value;this.themeColors_.push(y.TheoColor.init_bb45(a))}return A.CorePromise.resolve(t.concat([function(){return new p.ApplyColorThemeAction(u.clone(o.themeColors_),"brandkit-for-actions",o.page_,!0)},function(){return o.colorDictionary_=u.clone(o.gatherColors()),new p.ApplyColorThemeAction(u.clone(o.themeColors_),"brandkit-for-actions",o.page_,!0)}]))},setUpActionSequence:function(t,e,n){var o;this.testDoc_=n,this.page_=n.firstPage,(o=this.testDoc_)&&(this.colorPaletteRelationshipBefore_=u.clone(this.colorRelationshipTestUtils_.getCurrentPaletteMapping(o)))},validateAfterActionSequence:function(t,e){var n=u.clone(this.gatherColors());this.verifyShuffledColors(u.clone(this.colorDictionary_),u.clone(n)),this.verifyColorBeforeAfterPreservation()},validateAfterUndo:function(t,e){var n=u.clone(this.gatherSparkColors());XCTAssertEqual(u.count(n),0),this.verifyColorBeforeAfterPreservation()},validateAfterRedo:function(t,e){var n=u.clone(this.gatherColors());this.verifyShuffledColors(u.clone(this.colorDictionary_),u.clone(n)),this.verifyColorBeforeAfterPreservation()},shutdown:function(t,e,n){m.ActionTestBase.prototype.shutdown.call(this,u.clone(t),e,n),this.removeBrandkit(n)}}}),a),l.ModifyColorThemeTest=function(){var t=function t(){this.actionSequence_ModifyColorTheme=[function(){return new h.AddIconContentAction(t.originalIconURL_,F.MediaMetadata.init_36a2(),null)}],this.testDoc_=null,this.testPage_=null,this.testColor_=null,this.oldIconColor_=null,this.iconColorKey_="",this.themeColors_=[],m.ActionTestBase.call(this)},e={};return u.defineClass({name:"ModifyColorThemeTest",ctor:t,superName:"ActionTestBase",statics:{originalIconURL_:"",darkBlue_:{get:function(){return void 0===e.darkBlue_&&(e.darkBlue_=new v.SolidColor(1/255,1/255,164/255,1)),e.darkBlue_}}},props:{iconForma:{get:function(){return u.first(u.opt(u.as(this.getActionResult(0),c.FormaActionResult),(function(t){return t.formae})))}},populateActionSequence:function(e,n,o){var r=this;this.installBrandkit(o);for(var i=C.Host.brandkitManager.fakeBrandkitForElementsForTesting,a=u.iter(i.colors);!a.done;a.next()){var s=a.value;this.themeColors_.push(y.TheoColor.init_bb45(s))}return A.CorePromise.resolve(e.concat([function(){return new p.ApplyColorThemeAction(u.clone(r.themeColors_),"brandkit-for-actions",r.testPage_,!1)},function(){return r.oldIconColor_=u.opt(u.opt(r.iconForma,(function(t){return t.style})),(function(t){return t.colors.theoColor(_.ColorRole.FieldPrimary)})),r.iconColorKey_=u.opt(u.opt(r.iconForma,(function(t){return t.style})),(function(t){return t.colors.colorID(_.ColorRole.FieldPrimary)})),r.testColor_=y.TheoColor.init_5344(t.darkBlue_),new p.ModifyColorThemeAction(r.testColor_,r.iconColorKey_,r.testPage_)}]))},setUpActionSequence:function(e,n,o){var r;this.testDoc_=o,this.testPage_=o.firstPage,null!=(r=this.urlForAsset("dog1.svg"))&&(t.originalIconURL_=r)},validateAfterActionSequence:function(t,e){var n=u.opt(u.opt(this.iconForma,(function(t){return t.style})),(function(t){return t.colors.theoColor(_.ColorRole.FieldPrimary)}));XCTAssertEqual(n,this.testColor_);var o=u.opt(u.opt(this.iconForma,(function(t){return t.style})),(function(t){return t.colors.colorID(_.ColorRole.FieldPrimary)}));XCTAssertEqual(o,this.iconColorKey_)},validateAfterUndo:function(t,e){XCTAssertEqual(u.opt(this.iconForma,(function(t){return t.parent})),null)},validateAfterRedo:function(t,e){var n=u.opt(u.opt(this.iconForma,(function(t){return t.style})),(function(t){return t.colors.theoColor(_.ColorRole.FieldPrimary)}));XCTAssertEqual(n,this.testColor_);var o=u.opt(u.opt(this.iconForma,(function(t){return t.style})),(function(t){return t.colors.colorID(_.ColorRole.FieldPrimary)}));XCTAssertEqual(o,this.iconColorKey_)},shutdown:function(t,e,n){m.ActionTestBase.prototype.shutdown.call(this,u.clone(t),e,n),this.removeBrandkit(n)}}}),t}(),l.ColorRelationshipTestUtils=(s=function(){},u.defineClass({name:"ColorRelationshipTestUtils",ctor:s,props:{getCurrentPaletteMapping:function(t){return t.firstPage.colorLibraryController.enteredPalettePicker(),t.firstPage.colorLibraryController.returnCurrentPaletteMapping()},checkOverlapBetweenTwoPaletteMappings:function(t,e){for(var n=null,o=0,r=0,i=u.iter(u.keys(t));!i.done;i.next()){var a,s=i.value;if(null!=(a=this.findCorrespondingMappingKey(u.clone(t[s]),u.clone(e))))for(var l=u.iter(t[s]);!l.done;l.next()){var c=l.value;c.length>1&&(e[a].includes(c)?(o+=1,r+=1):o+=1)}else o+=t[s].length}return o>0&&(n=u.toDouble(r)/u.toDouble(o)),n},getAverageArrayDouble:function(t){for(var e=0,n=0,o=0,r=u.iter(t);!r.done;r.next()){var i=r.value;isNaN(i)||(e+=i,n+=1)}return u.opt(C.Host.logging,(function(t){return t.info("Sum: "+u.toString(e))})),u.opt(C.Host.logging,(function(t){return t.info("Count: "+u.toString(n))})),n>0&&(o=e/u.toDouble(n)),o},printPaletteMapping:function(t){for(var e=[],n=u.iter(u.keys(t));!n.done;n.next()){for(var o=n.value,r=o+":",i=u.iter(t[o]);!i.done;i.next())r+=i.value+"\n";e.push(r)}for(var a=u.iter(e);!a.done;a.next()){var s=a.value;u.opt(C.Host.logging,(function(t){return t.info(s)}))}},findCorrespondingMappingKey:function(t,e){for(var n=null,o={},r=u.iter(u.keys(e));!r.done;r.next())for(var i=r.value,a=u.iter(t);!a.done;a.next()){var s=a.value;e[i].includes(s)&&(u.keys(o).includes(i)?o[i]=o[i]+1:o[i]=1)}for(var l=0,c=u.iter(u.keys(o));!c.done;c.next())o[i=c.value]>l&&(n=i,l=o[i]);return n}}}),s)},md5b:function(t,e,n){var o,r,i,a,s=e,l=n("oAGj"),u=n("c9Jm"),c=n("yGNn"),h=n("Pil/"),m=n("pnSN"),f=n("H1Z2"),d=n("c+uM"),A=n("tGKA"),_=n("cRpU"),p=n("Vm85"),T=n("8t9B"),g=n("oKlP"),C=n("sIWg");s.MoveHandleTest=(o=function(){this.actionSequence_MoveHandle=[],this.formaToMove_=null,this.delta_=new g.TheoPoint(5,-5),this.initialBounds_=C.TheoRect.Zero,this.postMoveBounds_=C.TheoRect.Zero,u.ActionTestBase.call(this)},l.defineClass({name:"MoveHandleTest",ctor:o,superName:"ActionTestBase",props:{findFormaToMove:function(t){return l.last(this.allSelectableFormae(t,(function(t){return t instanceof m.GroupForma&&t.controller.kind==T.TypeLockupController.KIND})))},canRunActionSequence:function(t,e,n){return null!=this.findFormaToMove(n)},populateActionSequence:function(t,e,n){var o=this;return this.formaToMove_=this.findFormaToMove(n),XCTAssertNotNil(this.formaToMove_),null!=this.formaToMove_&&(n.controller.selection.replaceSelection(this.formaToMove_),this.initialBounds_=this.formaToMove_.finalFrame),c.CorePromise.resolve([function(){return new f.MoveHandleAction(o.formaToMove_,o.delta_,o.initialBounds_.center,1)}])},validateAfterActionSequence:function(t,e){this.postMoveBounds_=this.formaToMove_.finalFrame,XCTAssertFalse(this.postMoveBounds_.equal(this.initialBounds_))},validateAfterUndo:function(t,e){var n=this.formaToMove_.finalFrame;XCTAssertTrue(this.initialBounds_.equal(n))},validateAfterRedo:function(t,e){var n=this.formaToMove_.finalFrame;XCTAssertTrue(n.equal(this.postMoveBounds_))}}}),o),s.ResizeHandleTest=(r=function(){this.actionSequence_ResizeHandleTracking=[],this.actionSequence_ResizeHandleLeading=[],this.actionSequence_ResizeHandleCorner=[],this.formaToResize_=null,this.trackingSpot_=new g.TheoPoint(1,.5),this.leadingSpot_=new g.TheoPoint(.5,1),this.cornerSpot_=new g.TheoPoint(1,1),this.initialBounds_=C.TheoRect.Zero,this.postResizeBounds_=C.TheoRect.Zero,u.ActionTestBase.call(this)},l.defineClass({name:"ResizeHandleTest",ctor:r,superName:"ActionTestBase",props:{findFormaToResize:function(t){return l.last(this.allSelectableFormae(t,(function(t){return t instanceof m.GroupForma&&t.controller.kind==T.TypeLockupController.KIND})))},canRunActionSequence:function(t,e,n){return null!=this.findFormaToResize(n)},populateActionSequence:function(t,e,n){var o=this;this.formaToResize_=this.findFormaToResize(n),XCTAssertNotNil(this.formaToResize_),null!=this.formaToResize_&&(n.controller.selection.replaceSelection(this.formaToResize_),this.initialBounds_=this.formaToResize_.finalFrame);var r=!1,i=this.cornerSpot_,a=new C.TheoRect(this.initialBounds_.minX,this.initialBounds_.minY,this.initialBounds_.minX+100,this.initialBounds_.minY+100);return"actionSequence_ResizeHandleTracking"==e?(i=this.trackingSpot_,r=!0):"actionSequence_ResizeHandleLeading"==e&&(i=this.leadingSpot_,r=!0),c.CorePromise.resolve([function(){return new f.ResizeHandleAction(o.formaToResize_,i,g.TheoPoint.ZERO,a,r)}])}}}),r),s.ResizeLockupHorizontallyTest=(i=function(){this.actionSequence_ResizeLockupWider_Right=[],this.actionSequence_ResizeLockupNarrower_Right=[],this.actionSequence_ResizeLockupWider_Left=[],this.actionSequence_ResizeLockupNarrower_Left=[],this.lockupForma_=null,this.initialFontSize_=0,this.initialBounds_=C.TheoRect.Zero,u.ActionTestBase.call(this)},l.defineClass({name:"ResizeLockupHorizontallyTest",ctor:i,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return this.lockupForma_=l.last(this.allSelectableFormae(n,(function(t){return p.TextFacade.getLayoutForForma(t)==d.LockupLayout.Standard}))),null!=this.lockupForma_},prepareDocument:function(t,e){var n,o,r=[];if((n=this.lockupForma_)&&(o=t.controller)){var i=p.TextFacade.getAlignmentForForma(n),a=i==d.LockupAlignment.Right?d.LockupAlignment.Left:d.LockupAlignment.Right;o.selection.replaceSelection(n),r.push((function(){return new _.ChangeTextLayoutAndAlignmentAction(d.LockupLayout.Standard,a)})),r.push((function(){return new _.ChangeTextLayoutAndAlignmentAction(d.LockupLayout.Standard,i)}))}return c.CorePromise.resolve(l.clone(r))},populateActionSequence:function(t,e,n){var o,r,i;if((o=this.lockupForma_)&&(r=o.bounds)&&(i=n.controller)){this.initialFontSize_=this.getFontSize();var a=e.includes("Right")?new g.TheoPoint(1,.5):new g.TheoPoint(0,.5),s=e.includes("Right")?new g.TheoPoint(0,.5):new g.TheoPoint(1,.5),u=e.includes("Wider")?r.width+100:Math.max(r.width-100,20),m=C.TheoRect.fromXYWH(r.minX,r.minY,u,r.height);return this.initialBounds_=r,i.selection.replaceSelection(o),l.opt(o.controller,(function(t){return t.onEvent(new h.BeginFormaResizeEvent(o,a))})),c.CorePromise.resolve([function(){return new f.ResizeHandleAction(o,a,s,m)}])}return XCTAssertFalse(!0),c.CorePromise.reject(null)},getFontSize:function(){var t;return(t=l.opt(l.as(l.opt(this.lockupForma_,(function(t){return t.controller})),T.TypeLockupController),(function(t){return t.getCurrentFontSize()})))||null!=t?t:0},validateAfterActionSequence:function(t,e){var n;(n=l.opt(this.lockupForma_,(function(t){return t.bounds})))?(e.includes("Wider")?XCTAssertTrue(n.width>=this.initialBounds_.width-.01):XCTAssertTrue(n.width<=this.initialBounds_.width+.01),XCTAssertEqual(this.getFontSize(),this.initialFontSize_,.01)):XCTAssertFalse(!0)},validateAfterUndo:function(t,e){var n;(n=l.opt(this.lockupForma_,(function(t){return t.bounds})))?(XCTAssertEqual(n.width,this.initialBounds_.width),XCTAssertEqual(this.getFontSize(),this.initialFontSize_,.01)):XCTAssertFalse(!0)},validateAfterRedo:function(t,e){var n;(n=l.opt(this.lockupForma_,(function(t){return t.bounds})))?(e.includes("Wider")?XCTAssertTrue(n.width>=this.initialBounds_.width-.01):XCTAssertTrue(n.width<=this.initialBounds_.width+.01),XCTAssertEqual(this.getFontSize(),this.initialFontSize_,.01)):XCTAssertFalse(!0)}}}),i),s.RotateHandleTest=(a=function(){this.actionSequence_RotateHandle=[],this.formaToRotate_=null,this.delta_=new g.TheoPoint(5,-5),this.initialPlacement_=A.Matrix2D.Identity,this.postRotatePlacement_=A.Matrix2D.Identity,u.ActionTestBase.call(this)},l.defineClass({name:"RotateHandleTest",ctor:a,superName:"ActionTestBase",props:{findFormaToRotate:function(t){return l.last(this.allSelectableFormae(t,(function(t){return t instanceof m.GroupForma&&t.controller.kind==T.TypeLockupController.KIND&&1==t.placement.transformValues.rotCosine})))},canRunActionSequence:function(t,e,n){return null!=this.findFormaToRotate(n)},populateActionSequence:function(t,e,n){var o=this;this.formaToRotate_=this.findFormaToRotate(n),XCTAssertNotNil(this.formaToRotate_);var r=g.TheoPoint.ZERO;return null!=this.formaToRotate_&&(n.controller.selection.replaceSelection(this.formaToRotate_),this.initialPlacement_=this.formaToRotate_.placement,r=this.formaToRotate_.frame.center),c.CorePromise.resolve([function(){return new f.RotateHandleAction(o.formaToRotate_,Math.PI/4,r,o.initialPlacement_,!0)}])},validateAfterActionSequence:function(t,e){this.postRotatePlacement_=this.formaToRotate_.placement,XCTAssertTrue(Math.abs(this.postRotatePlacement_.transformValues.rotCosine-.707)<.01),XCTAssertTrue(Math.abs(this.postRotatePlacement_.transformValues.rotSine-.707)<.01)},validateAfterUndo:function(t,e){var n=this.formaToRotate_.placement;XCTAssertTrue(this.initialPlacement_.equal(n))},validateAfterRedo:function(t,e){var n=this.formaToRotate_.placement;XCTAssertTrue(n.equal(this.postRotatePlacement_))}}}),a)},oTkQ:function(t,e,n){var o,r=e,i=n("oAGj"),a=n("c9Jm"),s=n("vV1H");r.FlipTest=(o=function(){this.actionSequence_FlipVertical=[function(){return new s.FlipAction(!0)}],this.actionSequence_FlipHorizontal=[function(){return new s.FlipAction(!1)}],this.formaeToFlip_=[],this.initialTransforms_=[],this.vertical_=!1,a.ActionTestBase.call(this)},i.defineClass({name:"FlipTest",ctor:o,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){var o;this.formaeToFlip_=i.clone(this.allSelectableFormae(n,(function(t){return!(!(o=i.opt(t.controller,(function(t){return t.flippable})))&&null==o)&&o}))),this.vertical_="actionSequence_FlipVertical"==e,this.initialTransforms_=this.formaeToFlip_.map((function(t){return t.totalPlacement}),this),n.controller.selection.replaceSelectionWithFormae(i.clone(this.formaeToFlip_))},validateAfterActionSequence:function(t,e){for(var n=i.iter(i.range(0,this.formaeToFlip_.length,!1));!n.done;n.next()){var o=n.value;XCTAssertEqual(this.formaeToFlip_[o].totalPlacement.extractedScale.scale,this.initialTransforms_[o].scaleXY(this.vertical_?1:-1,this.vertical_?-1:1).extractedScale.scale)}},validateAfterUndo:function(t,e){for(var n=i.iter(i.range(0,this.formaeToFlip_.length,!1));!n.done;n.next()){var o=n.value;XCTAssertEqual(this.formaeToFlip_[o].totalPlacement.extractedScale.scale,this.initialTransforms_[o].extractedScale.scale)}},validateAfterRedo:function(t,e){for(var n=i.iter(i.range(0,this.formaeToFlip_.length,!1));!n.done;n.next()){var o=n.value;XCTAssertEqual(this.formaeToFlip_[o].totalPlacement.extractedScale.scale,this.initialTransforms_[o].scaleXY(this.vertical_?1:-1,this.vertical_?-1:1).extractedScale.scale)}},tearDown:function(){this.formaeToFlip_=[],a.ActionTestBase.prototype.tearDown.call(this)}}}),o)},qWkq:function(t,e,n){var o,r,i=e,a=n("oAGj"),s=n("c9Jm"),l=n("yGNn"),u=n("FNB+"),c=n("y/On"),h=n("9Lk3"),m=n("6Rk9"),f=n("sIWg");i.GroupTest=(o=function(){this.actionSequence_Group=[function(){return new c.GroupAction}],this.formaeToGroup_=[],this.initialBounds_=f.TheoRect.Zero,this.testDoc_=null,s.ActionTestBase.call(this)},a.defineClass({name:"GroupTest",ctor:o,superName:"ActionTestBase",props:{setUpActionSequence:function(t,e,n){this.formaeToGroup_=a.clone(this.allSelectableFormae(n,(function(t){return 1==t.controller.floating}))),XCTAssertNotNil(a.clone(this.formaeToGroup_)),this.testDoc_=n,this.formaeToGroup_.length>1&&(n.controller.selection.replaceSelectionWithFormae(a.clone(this.formaeToGroup_)),this.initialBounds_=m.GeometryFacade.getFormaeBounds(a.clone(this.formaeToGroup_),!0))},validateAfterActionSequence:function(t,e){this.validateGrouping(!0)},validateAfterUndo:function(t,e){var n,o=m.GeometryFacade.getFormaeBounds(a.clone(this.formaeToGroup_),!0);XCTAssertTrue(this.initialBounds_.equal(o));for(var r=a.iter(this.formaeToGroup_);!r.done;r.next()){var i=r.value;XCTAssertFalse(i.controller.userGroupMember),XCTAssertTrue(i.parent.controller.kind==h.GridController.KIND)}if(this.formaeToGroup_.length>1){var s=!1;a.opt(this.formaeToGroup_[0].root,(function(t){return t.visitAll(u.FormaTraversal.PreOrder,(function(t){((n=a.opt(t.controller,(function(t){return t.userGroupMember})))||null!=n)&&n&&(s=!0)}))})),XCTAssertFalse(s)}},validateAfterRedo:function(t,e){this.validateGrouping(!1)},validateGrouping:function(t){var e=m.GeometryFacade.getFormaeBounds(a.clone(this.formaeToGroup_),!0);if(XCTAssertTrue(this.initialBounds_.equalWithAccuracy(e,.01)),this.formaeToGroup_.length>1){var n=this.formaeToGroup_[0].parent;XCTAssertTrue(n.controller.userGroup);for(var o=a.iter(this.formaeToGroup_);!o.done;o.next()){var r=o.value;XCTAssertTrue(r.controller.userGroupChild),XCTAssertTrue(r.parent==n)}if(t){XCTAssertTrue(1==this.testDoc_.controller.selection.selectedCountInDocument);var i=this.testDoc_.controller.selection.formaAt(0);XCTAssertTrue(i.controller.userGroup)}}},tearDown:function(){this.formaeToGroup_=[],s.ActionTestBase.prototype.tearDown.call(this)}}}),o),i.UngroupTest=(r=function(){this.actionSequence_Ungroup=[function(){return new c.UngroupAction}],this.formaeToGroup_=[],this.initialBounds_=f.TheoRect.Zero,this.root_=null,this.testDoc_=null,s.ActionTestBase.call(this)},a.defineClass({name:"UngroupTest",ctor:r,superName:"ActionTestBase",props:{prepareDocument:function(t,e){this.root_=t.firstPage.root,this.formaeToGroup_=a.clone(this.allSelectableFormae(t,(function(t){return 1==t.controller.floating}))),XCTAssertNotNil(a.clone(this.formaeToGroup_)),this.formaeToGroup_.length>0&&(t.controller.selection.replaceSelectionWithFormae(a.clone(this.formaeToGroup_)),this.initialBounds_=m.GeometryFacade.getFormaeBounds(a.clone(this.formaeToGroup_),!0));var n=[function(){return new c.GroupAction}];return l.CorePromise.resolve(a.clone(n))},setUpActionSequence:function(t,e,n){this.testDoc_=n},validateAfterActionSequence:function(t,e){this.validateNoGrouping(!0)},validateAfterUndo:function(t,e){this.validateGrouping()},validateAfterRedo:function(t,e){this.validateNoGrouping(!1)},validateGrouping:function(){if(this.formaeToGroup_.length>1){var t=this.formaeToGroup_[0].parent;XCTAssertTrue(t.controller.userGroup);for(var e=a.iter(this.formaeToGroup_);!e.done;e.next()){var n=e.value;XCTAssertTrue(n.controller.userGroupChild),XCTAssertTrue(n.parent==t)}}},validateNoGrouping:function(t){var e,n=m.GeometryFacade.getFormaeBounds(a.clone(this.formaeToGroup_),!0);XCTAssertTrue(this.initialBounds_.equalWithAccuracy(n,.01));for(var o=a.iter(this.formaeToGroup_);!o.done;o.next()){var r=o.value;XCTAssertFalse(r.controller.userGroupMember),XCTAssertTrue(r.parent.controller.kind==h.GridController.KIND)}if(this.formaeToGroup_.length>1){var i=!1;a.opt(this.formaeToGroup_[0].root,(function(t){return t.visitAll(u.FormaTraversal.PreOrder,(function(t){((e=a.opt(t.controller,(function(t){return t.userGroupMember})))||null!=e)&&e&&(i=!0)}))})),XCTAssertFalse(i),t&&XCTAssertTrue(this.testDoc_.controller.selection.selectedCountInDocument==this.formaeToGroup_.length)}},tearDown:function(){this.formaeToGroup_=[],s.ActionTestBase.prototype.tearDown.call(this)}}}),r)},wYGt:function(t,e,n){var o,r,i,a,s,l,u,c,h,m,f=e,d=n("oAGj"),A=n("Tq01"),_=n("4mEG"),p=n("c9Jm"),T=n("CWW7"),g=n("yGNn"),C=n("jo4Y"),F=n("FNB+"),S=n("pnSN"),v=n("iCxV"),y=n("xWmh"),I=n("bqbo"),E=n("fdtz"),P=n("lmwz"),R=n("VkKB"),D=n("djAF"),N=n("cRpU"),L=n("8t9B"),B=n("RkYL"),q=n("LGJg"),k=n("zjod");f.AddTextTest=(o=function(){this.actionSequence_AddText=[function(){return new _.AddTextContentAction("Dog")}],this.text_="Dog",this.rootForma_=null,p.ActionTestBase.call(this)},d.defineClass({name:"AddTextTest",ctor:o,superName:"ActionTestBase",props:{hasText:function(){var t=this,e=!1;return d.opt(this.rootForma_,(function(n){return n.visitAll(F.FormaTraversal.PreOrder,(function(n){var o,r;(o=d.as(n,S.GroupForma))&&(r=d.as(o.controller,L.TypeLockupController))&&r.text==t.text_&&(e=!0)}))})),e},setUpActionSequence:function(t,e,n){this.rootForma_=n.firstPage.root},validateAfterActionSequence:function(t,e){XCTAssertTrue(this.hasText())},validateAfterUndo:function(t,e){XCTAssertFalse(this.hasText())},validateAfterRedo:function(t,e){XCTAssertTrue(this.hasText())}}}),o),f.AddTextOverImageBackgroundTest=(r=function(){this.text_="Lorem ipsum dolor set",this.actionSequence_AddText=[function(){return new _.AddTextContentAction("Lorem ipsum dolor set")}],this.rootForma_=null,p.ActionTestBase.call(this)},d.defineClass({name:"AddTextOverImageBackgroundTest",ctor:r,superName:"ActionTestBase",props:{canRunActionSequence:function(t,e,n){return d.clone(n.firstPage.root.filterWithCallback((function(t){return P.ImageFacade.isPotentialBackgroundImage(t)}))).length>0},hasText:function(){var t=this,e=!1;return d.opt(this.rootForma_,(function(n){return n.visitAll(F.FormaTraversal.PreOrder,(function(n){var o,r;(o=d.as(n,S.GroupForma))&&(r=d.as(o.controller,L.TypeLockupController))&&r.text==t.text_&&(e=!0)}))})),e},prepareDocument:function(t,e){this.rootForma_=t.firstPage.root;var n=d.clone(t.firstPage.root.filterWithCallback((function(t){return P.ImageFacade.isPotentialBackgroundImage(t)})));XCTAssertTrue(n.length>0);var o=function(){var e=d.clone(t.firstPage.root.filterWithCallback((function(t){return null!=t.controller&&t.controller.floating})));return new C.DeleteAction(d.clone(e),!0)};if(n.length>0){var r=n.shift(),i=function(){return d.opt(t.controller,(function(t){return t.selection.replaceSelection(r)})),new I.SetImageAsBackgroundAction};return n.length>0?g.CorePromise.resolve([function(){return new C.DeleteAction(d.clone(n),!0)},i,o]):g.CorePromise.resolve([i,o])}return g.CorePromise.resolve([o])},validateAfterActionSequence:function(t,e){XCTAssertTrue(this.hasText())},validateAfterUndo:function(t,e){XCTAssertFalse(this.hasText())},validateAfterRedo:function(t,e){XCTAssertTrue(this.hasText())}}}),r),f.ReplaceTextTest=(i=function(){this.actionSequence_ReplaceText=[],this.initialText_="Initial...",this.finalText_="¡Final!",this.rootForma_=null,p.ActionTestBase.call(this)},d.defineClass({name:"ReplaceTextTest",ctor:i,superName:"ActionTestBase",props:{textForma:{get:function(){return d.first(d.opt(d.as(this.getActionResult(0),A.FormaActionResult),(function(t){return t.formae})))}},hasInitialText:function(){var t=this,e=!1;return d.opt(this.rootForma_,(function(n){return n.visitAll(F.FormaTraversal.PreOrder,(function(n){var o,r;(o=d.as(n,S.GroupForma))&&(r=d.as(o.controller,L.TypeLockupController))&&r.text==t.initialText_&&(e=!0)}))})),e},hasFinalText:function(){var t=this,e=!1;return d.opt(this.rootForma_,(function(n){return n.visitAll(F.FormaTraversal.PreOrder,(function(n){var o,r;(o=d.as(n,S.GroupForma))&&(r=d.as(o.controller,L.TypeLockupController))&&r.text==t.finalText_&&(e=!0)}))})),e},populateActionSequence:function(t,e,n){var o=this;return g.CorePromise.resolve(t.concat([function(){return new _.AddTextContentAction(o.initialText_)},function(){return new N.SetTextAction(o.finalText_,o.textForma)}]))},setUpActionSequence:function(t,e,n){this.rootForma_=n.firstPage.root},validateAfterActionSequence:function(t,e){XCTAssertTrue(this.hasFinalText()),XCTAssertFalse(this.hasInitialText())},validateAfterUndo:function(t,e){XCTAssertFalse(this.hasFinalText()),XCTAssertFalse(this.hasInitialText())},validateAfterRedo:function(t,e){XCTAssertTrue(this.hasFinalText()),XCTAssertFalse(this.hasInitialText())}}}),i),f.AddImageTest=(a=function(){this.actionSequence_AddImage=[],this.imageURL_="",this.imageMimeType_="",this.imageWidth_=0,this.imageHeight_=0,this.rootForma_=null,p.ActionTestBase.call(this)},d.defineClass({name:"AddImageTest",ctor:a,superName:"ActionTestBase",props:{hasImage:function(){var t=this,e=!1;return d.opt(this.rootForma_,(function(n){return n.visitAll(F.FormaTraversal.PreOrder,(function(n){var o,r;(o=d.as(n,E.ImageForma))&&(r=o.contentNode)&&r.url==t.imageURL_&&r.mimeType==t.imageMimeType_&&r.pixelWidth==t.imageWidth_&&r.pixelHeight==t.imageHeight_&&(e=!0)}))})),e},populateActionSequence:function(t,e,n){var o=this,r=n.firstPage;return this.imageDataForAsset("dog1.jpeg").then((function(t){var e;if(e=d.as(t,y.ActionTestImageData)){var n=new T.AddFormaParams(A.ControllerSettingsBehaviorEnum.SetControllerSettings);return o.imageURL_=e.url,o.imageMimeType_="image/jpeg",o.imageWidth_=e.width,o.imageHeight_=e.height,g.CorePromise.resolve([function(){return new _.AddImageContentAction(r,o.imageURL_,o.imageMimeType_,o.imageWidth_,o.imageHeight_,!1,R.MediaMetadata.init_36a2(),null,null,n)}])}return XCTFail("Could not get image data for AddImageTest"),g.CorePromise.resolve([])}))},setUpActionSequence:function(t,e,n){this.rootForma_=n.firstPage.root},validateAfterActionSequence:function(t,e){XCTAssertTrue(this.hasImage())},validateAfterUndo:function(t,e){XCTAssertFalse(this.hasImage())},validateAfterRedo:function(t,e){XCTAssertTrue(this.hasImage())}}}),a),f.ReplaceImageTest=(s=function(){this.originalImageURL_="",this.originalImageMimeType_="",this.originalImageWidth_=0,this.originalImageHeight_=0,this.replacementImageURL_="",this.replacementImageMimeType_="",this.replacementImageWidth_=0,this.replacementImageHeight_=0,this.rootForma_=null,this.testPage_=null,this.actionSequence_ReplaceImage=[],p.ActionTestBase.call(this)},d.defineClass({name:"ReplaceImageTest",ctor:s,superName:"ActionTestBase",props:{imageForma:{get:function(){return d.first(d.opt(d.as(this.getActionResult(0),A.FormaActionResult),(function(t){return t.formae})))}},hasImage:function(){var t=this,e=!1;return d.opt(this.rootForma_,(function(n){return n.visitAll(F.FormaTraversal.PreOrder,(function(n){var o,r;(o=d.as(n,E.ImageForma))&&(r=o.contentNode)&&(XCTAssertNotEqual(t.originalImageURL_,r.url),r.url==t.replacementImageURL_&&r.mimeType==t.replacementImageMimeType_&&r.pixelWidth==t.replacementImageWidth_&&r.pixelHeight==t.replacementImageHeight_&&(e=!0))}))})),e},populateActionSequence:function(t,e,n){var o,r=this,i=n.firstPage;return this.imageDataForAsset("dog1.jpeg").then((function(e){var n;return(n=d.as(e,y.ActionTestImageData))?(r.originalImageURL_=n.url,r.originalImageMimeType_="image/jpeg",r.originalImageWidth_=n.width,r.originalImageHeight_=n.height,r.imageDataForAsset("bird_in_snow.jpg").then((function(e){var n;return(n=d.as(e,y.ActionTestImageData))?(r.replacementImageURL_=n.url,r.replacementImageMimeType_="image/jpeg",r.replacementImageWidth_=n.width,r.replacementImageHeight_=n.height,g.CorePromise.resolve(t.concat([function(){var t=new T.AddFormaParams(A.ControllerSettingsBehaviorEnum.SetControllerSettings);return new _.AddImageContentAction(i,r.originalImageURL_,r.originalImageMimeType_,r.originalImageWidth_,r.originalImageHeight_,!1,R.MediaMetadata.init_36a2(),null,null,t)},function(){XCTAssertTrue(!(!(o=d.opt(d.opt(r.imageForma,(function(t){return t.controller})),(function(t){return t.replaceable})))&&null==o)&&o);var t=new T.AddFormaParams(A.ControllerSettingsBehaviorEnum.SetControllerSettings,!1,r.imageForma);return new _.AddImageContentAction(i,r.replacementImageURL_,r.replacementImageMimeType_,r.replacementImageWidth_,r.replacementImageHeight_,!1,R.MediaMetadata.init_36a2(),null,null,t)}]))):(XCTFail("Could not get image data for second image in ReplaceImageTest"),g.CorePromise.resolve([]))}))):(XCTFail("Could not get image data for first image in ReplaceImageTest"),g.CorePromise.resolve([]))}))},setUpActionSequence:function(t,e,n){this.rootForma_=n.firstPage.root,this.testPage_=n.firstPage},validateAfterActionSequence:function(t,e){XCTAssertTrue(this.hasImage())},validateAfterUndo:function(t,e){XCTAssertFalse(this.hasImage())},validateAfterRedo:function(t,e){XCTAssertTrue(this.hasImage())}}}),s),f.AddIconTest=(l=function(){this.actionSequence_AddIcon=[],this.iconURL_="",this.rootForma_=null,p.ActionTestBase.call(this)},d.defineClass({name:"AddIconTest",ctor:l,superName:"ActionTestBase",props:{hasIcon:function(){var t=this,e=!1;return d.opt(this.rootForma_,(function(n){return n.visitAll(F.FormaTraversal.PreOrder,(function(n){var o,r;(o=d.as(n,D.ShapeForma))&&(r=d.as(o.contentNode,q.VectorContentNode))&&r.url==t.iconURL_&&(e=!0)}))})),e},populateActionSequence:function(t,e,n){var o,r=this;return null!=(o=this.urlForAsset("dog1.svg"))?(this.iconURL_=o,g.CorePromise.resolve([function(){return new _.AddIconContentAction(r.iconURL_,R.MediaMetadata.init_36a2(),null)}])):(XCTFail("Could not get Icon URL for AddIconTest"),g.CorePromise.resolve([]))},setUpActionSequence:function(t,e,n){this.rootForma_=n.firstPage.root},validateAfterActionSequence:function(t,e){XCTAssertTrue(this.hasIcon())},validateAfterUndo:function(t,e){XCTAssertFalse(this.hasIcon())},validateAfterRedo:function(t,e){XCTAssertTrue(this.hasIcon())}}}),l),f.ReplaceIconTest=(u=function(){this.actionSequence_ReplaceIcon=[],this.rootForma_=null,this.iconForma_=null,p.ActionTestBase.call(this)},d.defineClass({name:"ReplaceIconTest",ctor:u,superName:"ActionTestBase",statics:{originalIconURL_:"",replacementIconURL_:""},props:{hasIcon:function(){var t=!1;return d.opt(this.rootForma_,(function(e){return e.visitAll(F.FormaTraversal.PreOrder,(function(e){var n,o;(n=d.as(e,D.ShapeForma))&&(o=d.as(n.contentNode,q.VectorContentNode))&&o.url==u.replacementIconURL_&&(t=!0)}))})),t},populateActionSequence:function(t,e,n){var o,r=this;return g.CorePromise.resolve(t.concat([function(){return XCTAssertTrue(!(!(o=d.opt(d.opt(r.iconForma_,(function(t){return t.controller})),(function(t){return t.replaceable})))&&null==o)&&o),new _.AddIconContentAction(u.replacementIconURL_,R.MediaMetadata.init_36a2(),r.iconForma_)}]))},prepareDocument:function(t,e){var n,o;return this.rootForma_=t.firstPage.root,null!=(n=this.urlForAsset("dog1.svg"))&&null!=(o=this.urlForAsset("fork_and_spoon.svg"))&&(u.originalIconURL_=n,u.replacementIconURL_=o,XCTAssertNotEqual(u.originalIconURL_,u.replacementIconURL_)),g.CorePromise.resolve([function(){return new _.AddIconContentAction(u.originalIconURL_,R.MediaMetadata.init_36a2(),null)}])},setUpActionSequence:function(t,e,n){this.iconForma_=d.first(d.opt(d.as(this.lastActionResult,A.FormaActionResult),(function(t){return t.formae})))},validateAfterActionSequence:function(t,e){XCTAssertTrue(this.hasIcon())},validateAfterUndo:function(t,e){XCTAssertFalse(this.hasIcon())},validateAfterRedo:function(t,e){XCTAssertTrue(this.hasIcon())}}}),u),f.AddVideoTest=(c=function(){this.actionSequence_AddVideo=[],this.videoURL_="",this.trackWidth_=0,this.trackHeight_=0,this.duration_=B.TheoTime.Zero,this.times_=[],this.posterURL_=null,this.posterWidth_=0,this.posterHeight_=0,this.posterParams_=null,this.rootForma_=null,p.ActionTestBase.call(this)},d.defineClass({name:"AddVideoTest",ctor:c,superName:"ActionTestBase",props:{hasVideo:function(){var t=this,e=!1;return d.opt(this.rootForma_,(function(n){return n.visitAll(F.FormaTraversal.PreOrder,(function(n){var o,r;(o=d.as(n,k.VideoForma))&&(r=o.videoContentNode)&&r.url==t.videoURL_&&(e=!0)}))})),e},populateActionSequence:function(t,e,n){var o,r=this,i=n.firstPage;if(null!=(o=this.urlForAsset("spokes.gif"))){this.videoURL_=o,this.posterURL_=o;var a=this.posterURL_.split(".");a.length>0&&(a.pop(),this.posterURL_=a.join(".")+".png"),this.trackWidth_=480,this.trackHeight_=480,this.posterWidth_=480,this.posterHeight_=480;for(var s,l=7,u=d.iter(d.range(1,34,!0));!u.done;u.next())this.times_.push(new B.TheoTime(l,100)),l+=7;return this.duration_=new B.TheoTime(l,100),null!=(s=this.posterURL_)&&(this.posterParams_=new _.VideoPosterParams(s,"image/jpeg",this.posterWidth_,this.posterHeight_)),g.CorePromise.resolve([function(){return new _.AddVideoContentAction(i,r.videoURL_,"image/gif",r.trackWidth_,r.trackHeight_,r.duration_,d.clone(r.times_),r.posterParams_,!1,R.MediaMetadata.init_36a2(),null,null,null,T.AddFormaParams.DEFAULTS)}])}return XCTFail("Could not get Video URL for AddVideoTest"),g.CorePromise.resolve([])},setUpActionSequence:function(t,e,n){this.rootForma_=n.firstPage.root},validateAfterActionSequence:function(t,e){XCTAssertTrue(this.hasVideo())},validateAfterUndo:function(t,e){XCTAssertFalse(this.hasVideo())},validateAfterRedo:function(t,e){XCTAssertTrue(this.hasVideo())}}}),c),f.AddLogoTest=(h=function(){this.actionSequence_AddLogo=[],this.primaryLogoID_="",this.rootForma_=null,p.ActionTestBase.call(this)},d.defineClass({name:"AddLogoTest",ctor:h,superName:"ActionTestBase",props:{hasLogo:function(){var t=!1;return d.opt(this.rootForma_,(function(e){return e.visitAll(F.FormaTraversal.PreOrder,(function(e){var n;(n=d.as(e,E.ImageForma))&&n.contentNode&&n.isLogo()&&(t=!0)}))})),t},hasLogoWithID:function(t){var e=!1;return d.opt(this.rootForma_,(function(n){return n.visitAll(F.FormaTraversal.PreOrder,(function(n){var o,r;(o=d.as(n,E.ImageForma))&&(r=o.contentNode)&&r.sparkElementID==t&&o.isLogo()&&(e=!0)}))})),e},populateActionSequence:function(t,e,n){var o=this;return this.installBrandkit(n),g.CorePromise.resolve(t.concat([function(){var t=v.Host.brandkitManager.fakeBrandkitForElementsForTesting.logos[0];return o.primaryLogoID_=t.id,new _.AddLogoContentAction(n.firstPage,t,null,null)}]))},setUpActionSequence:function(t,e,n){this.rootForma_=n.firstPage.root},validateAfterActionSequence:function(t,e){XCTAssertTrue(this.hasLogoWithID(this.primaryLogoID_))},validateAfterUndo:function(t,e){XCTAssertFalse(this.hasLogo())},validateAfterRedo:function(t,e){XCTAssertTrue(this.hasLogoWithID(this.primaryLogoID_))},shutdown:function(t,e,n){p.ActionTestBase.prototype.shutdown.call(this,d.clone(t),e,n),this.removeBrandkit(n)}}}),h),f.ReplaceLogoTest=(m=function(){this.actionSequence_ReplaceLogo=[],this.primaryLogoID_="",this.secondaryLogoID_="",this.rootForma_=null,p.ActionTestBase.call(this)},d.defineClass({name:"ReplaceLogoTest",ctor:m,superName:"ActionTestBase",props:{logoForma:{get:function(){return d.first(d.opt(d.as(this.getActionResult(0),A.FormaActionResult),(function(t){return t.formae})))}},hasLogo:function(){var t=!1;return d.opt(this.rootForma_,(function(e){return e.visitAll(F.FormaTraversal.PreOrder,(function(e){var n;(n=d.as(e,E.ImageForma))&&n.contentNode&&n.isLogo()&&(t=!0)}))})),t},hasLogoWithID:function(t){var e=!1;return d.opt(this.rootForma_,(function(n){return n.visitAll(F.FormaTraversal.PreOrder,(function(n){var o,r;(o=d.as(n,E.ImageForma))&&(r=o.contentNode)&&r.sparkElementID==t&&o.isLogo()&&(e=!0)}))})),e},populateActionSequence:function(t,e,n){var o=this;return this.installBrandkit(n),g.CorePromise.resolve(t.concat([function(){var t=v.Host.brandkitManager.fakeBrandkitForElementsForTesting.logos[0];o.primaryLogoID_=t.id;var e=v.Host.brandkitManager.fakeBrandkitForElementsForTesting.logos[1];return o.secondaryLogoID_=e.id,new _.AddLogoContentAction(n.firstPage,t,null,null)},function(){var t=v.Host.brandkitManager.fakeBrandkitForElementsForTesting.logos[1];return new _.AddLogoContentAction(n.firstPage,t,o.logoForma,null)}]))},setUpActionSequence:function(t,e,n){this.rootForma_=n.firstPage.root},validateAfterActionSequence:function(t,e){XCTAssertFalse(this.hasLogoWithID(this.primaryLogoID_)),XCTAssertTrue(this.hasLogoWithID(this.secondaryLogoID_))},validateAfterUndo:function(t,e){XCTAssertFalse(this.hasLogo())},validateAfterRedo:function(t,e){XCTAssertFalse(this.hasLogoWithID(this.primaryLogoID_)),XCTAssertTrue(this.hasLogoWithID(this.secondaryLogoID_))},shutdown:function(t,e,n){p.ActionTestBase.prototype.shutdown.call(this,d.clone(t),e,n),this.removeBrandkit(n)}}}),m)},zIaq:function(t,e,n){var o,r,i,a,s=e,l=n("oAGj"),u=n("c9Jm"),c=n("hJqd"),h=n("kYI4"),m=n("yGNn"),f=n("ascj"),d=n("iCxV"),A=n("DP9v"),_=n("Vm85");s.BrandifyTest=(o=function(){this.actionSequence_Brandify=[],this.testDoc_=null,this.page_=null,this.initialRootColor_=null,this.docHasText_=!1,u.ActionTestBase.call(this)},l.defineClass({name:"BrandifyTest",ctor:o,superName:"ActionTestBase",props:{hasText:function(t){for(var e=!1,n=l.iter(t.firstPage.root.filterWithCallback((function(t){return t.isTypeLockup()})));!n.done;n.next()){e=!0;break}return e},allTextBranded:function(t){for(var e,n=!0,o=l.iter(t.firstPage.root.filterWithCallback((function(t){return t.isTypeLockup()})));!o.done;o.next()){var r=o.value,i=_.TextFacade.getFontForForma(r);if(!(e=l.isEmpty(l.opt(i,(function(t){return t.getSparkFontRole()}))))&&null==e||e){n=!1;break}}return n},verifyColors:function(){var t=this.page_.root.style.colors.color(f.ColorRole.FieldPrimary);XCTAssertTrue(null!=t);for(var e=0,n=0,o=0,r=l.clone(this.page_.colorLibraryController.getTheoColorsUsedInDocument()),i=l.iter(r);!i.done;i.next()){var a=i.value;a.isBrandkitPrimaryColor()&&(e+=1),a.isBrandkitSecondaryColor()&&(n+=1),a.isBrandkitShade()&&(o+=1)}XCTAssertEqual(e,0),XCTAssertEqual(n,0),XCTAssertTrue(r.length>0),XCTAssertTrue(o>0);var s=l.clone(h.BrandingFacade.getDocumentBrandedElementsUsage(this.testDoc_,!1,!0));XCTAssertTrue(s.includes("color"))},populateActionSequence:function(t,e,n){var o=this;return this.docHasText_=this.hasText(n),this.installBrandkit(n),m.CorePromise.resolve(t.concat([function(){return new c.BrandifyAction(d.Host.brandkitManager.fakeBrandkitForElementsForTesting,o.docHasText_,!0,!0)}]))},setUpActionSequence:function(t,e,n){this.testDoc_=n,this.page_=n.firstPage,this.initialRootColor_=this.page_.root.style.colors.color(f.ColorRole.FieldPrimary)},validateAfterActionSequence:function(t,e){XCTAssertTrue(h.BrandingFacade.areSparkLogosInUse(this.testDoc_,[this.FAKE_LOGO_ELEMENT_STAMP_ID])),XCTAssertFalse(h.BrandingFacade.areSparkLogosInUse(this.testDoc_,[this.FAKE_LOGO_ELEMENT_PRIMARY_ID])),this.docHasText_?(XCTAssertTrue(h.BrandingFacade.areSparkFontsInUse(this.testDoc_,[this.FAKE_FONT_ELEMENT_HEADLINE_ID])),XCTAssertTrue(this.allTextBranded(this.testDoc_))):XCTAssertFalse(h.BrandingFacade.areSparkFontsInUse(this.testDoc_,[this.FAKE_FONT_ELEMENT_HEADLINE_ID])),this.verifyColors()},validateAfterUndo:function(t,e){XCTAssertFalse(h.BrandingFacade.areSparkLogosInUse(this.testDoc_,[this.FAKE_LOGO_ELEMENT_PRIMARY_ID,this.FAKE_LOGO_ELEMENT_STAMP_ID])),XCTAssertFalse(h.BrandingFacade.areSparkFontsInUse(this.testDoc_,[this.FAKE_FONT_ELEMENT_HEADLINE_ID,this.FAKE_FONT_ELEMENT_BODY_ID]))},validateAfterRedo:function(t,e){XCTAssertTrue(h.BrandingFacade.areSparkLogosInUse(this.testDoc_,[this.FAKE_LOGO_ELEMENT_STAMP_ID])),XCTAssertFalse(h.BrandingFacade.areSparkLogosInUse(this.testDoc_,[this.FAKE_LOGO_ELEMENT_PRIMARY_ID])),this.docHasText_?(XCTAssertTrue(h.BrandingFacade.areSparkFontsInUse(this.testDoc_,[this.FAKE_FONT_ELEMENT_HEADLINE_ID])),XCTAssertTrue(this.allTextBranded(this.testDoc_))):XCTAssertFalse(h.BrandingFacade.areSparkFontsInUse(this.testDoc_,[this.FAKE_FONT_ELEMENT_HEADLINE_ID])),this.verifyColors()},shutdown:function(t,e,n){u.ActionTestBase.prototype.shutdown.call(this,l.clone(t),e,n),this.removeBrandkit(n)}}}),o),s.AddBrandTest=(r=function(){this.actionSequence_AddBrand=[],this.testDoc_=null,this.page_=null,this.initialRootColor_=null,this.docHasText_=!1,u.ActionTestBase.call(this)},l.defineClass({name:"AddBrandTest",ctor:r,superName:"ActionTestBase",props:{hasText:function(t){for(var e=!1,n=l.iter(t.firstPage.root.filterWithCallback((function(t){return t.isTypeLockup()})));!n.done;n.next()){e=!0;break}return e},allTextBranded:function(t){for(var e,n=!0,o=l.iter(t.firstPage.root.filterWithCallback((function(t){return t.isTypeLockup()})));!o.done;o.next()){var r=o.value,i=_.TextFacade.getFontForForma(r);if(!(e=l.isEmpty(l.opt(i,(function(t){return t.getSparkFontRole()}))))&&null==e||e){n=!1;break}}return n},verifyColors:function(){var t=this.page_.root.style.colors.color(f.ColorRole.FieldPrimary);XCTAssertTrue(null!=t),XCTAssertFalse(t.isEqual(this.initialRootColor_));for(var e=0,n=0,o=0,r=l.clone(this.page_.colorLibraryController.getTheoColorsUsedInDocument()),i=l.iter(r);!i.done;i.next()){var a=i.value;a.isBrandkitPrimaryColor()&&(e+=1),a.isBrandkitSecondaryColor()&&(n+=1),a.isBrandkitShade()&&(o+=1)}XCTAssertEqual(e,0),XCTAssertEqual(n,0),XCTAssertTrue(r.length>0),XCTAssertTrue(o>0);var s=l.clone(h.BrandingFacade.getDocumentBrandedElementsUsage(this.testDoc_,!1,!0));XCTAssertTrue(s.includes("color"))},populateActionSequence:function(t,e,n){var o=this;return this.docHasText_=this.hasText(n),this.installBrandkit(n),m.CorePromise.resolve(t.concat([function(){return new c.BrandifyAction(d.Host.brandkitManager.fakeBrandkitForElementsForTesting,o.docHasText_,!0,!0)},function(){return o.installSecondBrandkit(o.testDoc_),new c.AddBrandingAction(d.Host.brandkitManager.fakeBrandkitForElementsForTesting)}]))},setUpActionSequence:function(t,e,n){this.testDoc_=n,this.page_=n.firstPage,this.initialRootColor_=this.page_.root.style.colors.color(f.ColorRole.FieldPrimary)},validateAfterActionSequence:function(t,e){XCTAssertTrue(h.BrandingFacade.areSparkLogosInUse(this.testDoc_,[this.FAKE_LOGO_ELEMENT_PRIMARY_ID_2])),this.docHasText_?(XCTAssertTrue(h.BrandingFacade.areSparkFontsInUse(this.testDoc_,[this.FAKE_FONT_ELEMENT_HEADLINE_ID_2])),XCTAssertTrue(this.allTextBranded(this.testDoc_))):XCTAssertFalse(h.BrandingFacade.areSparkFontsInUse(this.testDoc_,[this.FAKE_FONT_ELEMENT_HEADLINE_ID_2])),this.verifyColors()},validateAfterUndo:function(t,e){XCTAssertFalse(h.BrandingFacade.areSparkLogosInUse(this.testDoc_,[this.FAKE_LOGO_ELEMENT_PRIMARY_ID,this.FAKE_LOGO_ELEMENT_STAMP_ID])),XCTAssertFalse(h.BrandingFacade.areSparkFontsInUse(this.testDoc_,[this.FAKE_FONT_ELEMENT_HEADLINE_ID,this.FAKE_FONT_ELEMENT_BODY_ID]))},validateAfterRedo:function(t,e){XCTAssertTrue(h.BrandingFacade.areSparkLogosInUse(this.testDoc_,[this.FAKE_LOGO_ELEMENT_PRIMARY_ID_2])),this.docHasText_?(XCTAssertTrue(h.BrandingFacade.areSparkFontsInUse(this.testDoc_,[this.FAKE_FONT_ELEMENT_HEADLINE_ID_2])),XCTAssertTrue(this.allTextBranded(this.testDoc_))):XCTAssertFalse(h.BrandingFacade.areSparkFontsInUse(this.testDoc_,[this.FAKE_FONT_ELEMENT_HEADLINE_ID_2])),this.verifyColors()},shutdown:function(t,e,n){u.ActionTestBase.prototype.shutdown.call(this,l.clone(t),e,n),this.removeBrandkit(n)}}}),r),s.RemoveBrandingTest=(i=function(){this.actionSequence_RemoveBranding=[],this.testDoc_=null,this.page_=null,u.ActionTestBase.call(this)},l.defineClass({name:"RemoveBrandingTest",ctor:i,superName:"ActionTestBase",props:{verifyColors:function(t){for(var e=0,n=0,o=0,r=l.clone(this.page_.colorLibraryController.getTheoColorsUsedInDocument()),i=l.iter(r);!i.done;i.next()){var a=i.value;a.isBrandkitPrimaryColor()&&(e+=1),a.isBrandkitSecondaryColor()&&(n+=1),a.isBrandkitShade()&&(o+=1)}if(XCTAssertEqual(e,0),XCTAssertEqual(n,0),t){var s=l.clone(h.BrandingFacade.getDocumentBrandedElementsUsage(this.testDoc_,!1,!0));XCTAssertTrue(s.includes("color"))}else XCTAssertEqual(o,0);XCTAssertTrue(r.length>0)},populateActionSequence:function(t,e,n){return this.installBrandkit(n),m.CorePromise.resolve(t.concat([function(){return new c.BrandifyAction(d.Host.brandkitManager.fakeBrandkitForElementsForTesting,!0,!0,!0)},function(){return new c.RemoveBrandingAction}]))},setUpActionSequence:function(t,e,n){this.testDoc_=n,this.page_=n.firstPage},validateAfterActionSequence:function(t,e){var n=h.BrandingFacade.isDocumentBranded(this.testDoc_,!0);XCTAssertTrue(0==n),this.verifyColors(!0)},validateAfterUndo:function(t,e){var n=h.BrandingFacade.isDocumentBranded(this.testDoc_,!0);XCTAssertTrue(0==n),this.verifyColors(!1)},validateAfterRedo:function(t,e){var n=h.BrandingFacade.isDocumentBranded(this.testDoc_,!0);XCTAssertTrue(0==n),this.verifyColors(!0)},shutdown:function(t,e,n){u.ActionTestBase.prototype.shutdown.call(this,l.clone(t),e,n),this.removeBrandkit(n)}}}),i),s.ChangeBrandingTestToNone=(a=function(){this.actionSequence_ChangeBrandingToNone=[],this.testDoc_=null,this.page_=null,u.ActionTestBase.call(this)},l.defineClass({name:"ChangeBrandingTestToNone",ctor:a,superName:"ActionTestBase",props:{verifyColors:function(t){for(var e=0,n=0,o=0,r=l.clone(this.page_.colorLibraryController.getTheoColorsUsedInDocument()),i=l.iter(r);!i.done;i.next()){var a=i.value;a.isBrandkitPrimaryColor()&&(e+=1),a.isBrandkitSecondaryColor()&&(n+=1),a.isBrandkitShade()&&(o+=1)}if(XCTAssertEqual(e,0),XCTAssertEqual(n,0),t){var s=l.clone(h.BrandingFacade.getDocumentBrandedElementsUsage(this.testDoc_,!1,!0));XCTAssertTrue(s.includes("color"))}else XCTAssertEqual(o,0);XCTAssertTrue(r.length>0)},populateActionSequence:function(t,e,n){return this.installBrandkit(n),m.CorePromise.resolve(t.concat([function(){return new c.BrandifyAction(d.Host.brandkitManager.fakeBrandkitForElementsForTesting,!0,!0,!0)},function(){return new c.ChangeBrandingAction(null,d.Host.brandkitManager.fakeBrandkitForElementsForTesting.id,A.MultiBrandFacade.activeBrandkitID)}]))},setUpActionSequence:function(t,e,n){this.testDoc_=n,this.page_=n.firstPage},validateAfterActionSequence:function(t,e){var n=h.BrandingFacade.isDocumentBranded(this.testDoc_,!0);XCTAssertTrue(0==n),this.verifyColors(!0),XCTAssertTrue(null==A.MultiBrandFacade.getBrand(this.testDoc_))},validateAfterUndo:function(t,e){var n=h.BrandingFacade.isDocumentBranded(this.testDoc_,!0);XCTAssertTrue(0==n),this.verifyColors(!1)},validateAfterRedo:function(t,e){var n=h.BrandingFacade.isDocumentBranded(this.testDoc_,!0);XCTAssertTrue(0==n),this.verifyColors(!0),XCTAssertTrue(null==A.MultiBrandFacade.getBrand(this.testDoc_))},shutdown:function(t,e,n){u.ActionTestBase.prototype.shutdown.call(this,l.clone(t),e,n),this.removeBrandkit(n)}}}),a)}}]);
//# sourceMappingURL=vendors_npm_spark_4679d780-62dc4a0e.js.map