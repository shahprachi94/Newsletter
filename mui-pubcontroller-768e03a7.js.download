(window.webpackJsonp=window.webpackJsonp||[]).push([["mui-pubcontroller"],{1732:function(e,t,s){var i,n;i=[s(0),s(2),s(4)],void 0===(n=function(e,t,s){"use strict";return t.Model.extend({defaults:{title:""},doesThisRun:function(){console.log("YUP")},getShareHref:function(){return s.publishedContentBases.slate+"/"+this.get("alias")+"/"},initialize:function(e){var t="";e._links.rendition&&e._links.rendition.href&&(t=e._links.rendition.href.replace("{format}","png").replace("{dimension}","width").replace("{size}","133")),this.set("title",e.title),this.set("community",e.community),this.set("thumbHREF",t),this.set("published",e.published),this.set("id",e.id),this.set("alias",e.alias),e.stats?(this.set("likes",e.stats.anonymous_like_count),"text/html"===e.type?this.set("views",e.stats.website_count):"video/mp4"===e.type||"voice"===e.community?this.set("views",e.stats.custom_counts.play):this.set("views",e.stats.custom_counts.chrome||0)):(this.set("likes",0),this.set("views",0))}})}.apply(t,i))||(e.exports=n)},2827:function(e,t,s){var i,n;i=[s(2),s(1732)],void 0===(n=function(e,t){"use strict";return e.Collection.extend({model:t})}.apply(t,i))||(e.exports=n)},988:function(e,t,s){var i,n;i=[s(3),s(0),s(2),s(1),s(4),s(7),s(2827),s(1732)],void 0===(n=function(e,t,s,i,n,o,c,r){"use strict";var u,a;return u=s.Model.extend({initialize:function(e){this.cpService=n.cps,this.apiKey=n.cpkey},pubCollection:null,myPubsCollection:null,_fetchMyPubs:function(e){var s=i.defer();return o.ajax({type:"GET",url:"https://"+this.cpService+"/api/v2/"+e+"/users/me/assets?sort=date_desc",dataType:"json",headers:{"X-Api-Key":this.apiKey,Accept:"application/hal+json"}}).then((function(e){t.each(e._embedded.assets,(function(e){e.category&&("lucas"===e.category.id?e.community="luca":"voices"===e.category.id&&(e.community="voice"));var t=new r(e);a.myPubsCollection.add(t)})),s.resolve(a.myPubsCollection)}),(function(e){marvel.logger.error("Failed to fetch assets",e),s.reject(e)})),s.promise},getMyPubs:function(){if(this._getMyPubsDefer||(this._getMyPubsDefer=i.defer()),!this.myPubsCollection){this.myPubsCollection=new c;var e=[];e.push(this._fetchMyPubs("luca")),i.allSettled(e).then((function(e){a._getMyPubsDefer.resolve(a.myPubsCollection)}))}return this._getMyPubsDefer.promise},_fetchPubs:function(e,s){var n=i.defer();return s=s||0,o.ajax({url:"https://"+this.cpService+"/api/v2/"+e+"/assets?size="+s+"&sort=date",dataType:"json",headers:{"X-Api-Key":this.apiKey},success:function(e){t.each(e._embedded.assets,(function(e){if(e.category&&("lucas"===e.category.id?e.community="luca":"voices"===e.category.id&&(e.community="voice")),e.community||console.log("ignoring absent community"),e.community){var t=new r(e);a.pubCollection.add(t)}})),n.resolve()},error:function(e){console.log("CP FAIL "+e),n.reject(e)}}),n.promise},getPubs:function(){if(this._getPubsDefer||(this._getPubsDefer=i.defer()),!this.pubCollection){this.pubCollection=new c;var e=[];e.push(this._fetchPubs("luca",10)),e.push(this._fetchPubs("voice",10)),i.allSettled(e).then((function(e){a.pubCollection.comparator=function(e){return e.get("published")},a.pubCollection.sort(),a._getPubsDefer.resolve(a.pubCollection)}))}return this._getPubsDefer.promise},checkPublishState:function(e){return o.ajax({type:"GET",url:"https://"+this.cpService+"/api/v2/resources/"+e+"/:metadata",headers:{Accept:"*/*","X-api-key":this.apiKey}})},checkUnpublishedState:function(e,t){return o.ajax({type:"GET",url:"https://"+this.cpService+"/api/v2/"+t+"/assets/"+e,headers:{Accept:"*/*","X-api-key":this.apiKey}})},_fixPubInfo:function(e,s){var n=[],o=e.getMyApp();return marvel.logger.warn("Document has incorrect publish info, attempting to fix it",{doc:e,fixInfo:s}),t.isUndefined(s.cpAlias)||n.push(o.setCPAlias(e,s.cpAlias)),t.isUndefined(s.cpAssetId)||n.push(o.setCPAssetId(e,s.cpAssetId)),t.isUndefined(s.publishedEtag)||n.push(o.setPublishedContentETag(e,s.publishedEtag)),i.all(n)},_getAndCorrectPubModel:function(e){var s=e.getMyApp(),n=s.getCPCommunity(),o=s.getCPProjectId(e),c=s.getCPAlias(e),u=s.getCPAssetId(e),a=i.defer();if(o){var l,p={},d=i.defer();this.checkPublishState(o).then(function(t,i,a){var h=t.id;0===h.indexOf("US/")&&(h=h.substr(3)),u!==h&&(p.cpAssetId=h),this.checkUnpublishedState(h,n).then(function(t,i,n){t.alias?(c!==t.alias&&(p.cpAlias=t.alias),l=new r(t),t.custom&&t.custom.contentEtag&&t.custom.contentEtag!==s.getPublishedContentETag(e)&&(p.publishedEtag=t.custom.contentEtag)):u&&(p.cpAssetId=""),d.resolve()}.bind(this),function(e){404===e.status||403===e.status?(u&&(p.cpAssetId=""),d.resolve(),403===e.status&&console.warn("403 checking unpublished state:"+h,{projectId:o,cpAlias:c,cpAssetId:u})):d.reject(e)}.bind(this)).done()}.bind(this),function(e){404===e.status?(u?(p.cpAssetId="",c&&(p.cpAlias="")):c&&(p.cpAlias=""),d.resolve()):d.reject(e)}.bind(this)).done(),d.promise.then(function(){t.isUndefined(p.cpAssetId)&&t.isUndefined(p.cpAlias)?a.resolve(l):this._fixPubInfo(e,p).then((function(){a.resolve(l)}))}.bind(this),(function(e){a.reject(e)})).done()}else a.resolve();return a.promise},getAndCorrectPubModel:function(e){if(e.cachedPubInfo)return i(e.cachedPubInfo.pubModel);var t=e.getMyApp(),s=t.getCPCommunity(),n=t.getCPAlias(e);return this._getPubByAliasCorrectIfDoc(s,n,e)},getPubByAlias:function(e,t,s){return this._getPubByAliasCorrectIfDoc(e,t,null,s)},_getPubByAliasCorrectIfDoc:function(e,t,s,n){if(!t)return this._getAndCorrectPubModel(s);var c=i.defer(),u=this.cpService;return n&&(u="cc-api-cp.adobe.io"),o.ajax({url:"https://"+u+"/api/v2/"+e+"/assets/"+t,dataType:"json",headers:{"X-Api-Key":this.apiKey},success:function(e){var t=new r(e);c.resolve(t)},error:function(e){marvel.logger.debug("CP returned failure for pub-by-alias",e),s?this._getAndCorrectPubModel(s).then(function(e){c.resolve(e)}.bind(this),function(e){c.reject(e)}.bind(this)):c.reject(e)}.bind(this)}),c.promise}}),a=new u}.apply(t,i))||(e.exports=n)}}]);
//# sourceMappingURL=mui-pubcontroller-768e03a7.js.map